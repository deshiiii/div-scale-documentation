<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="pdoc 14.3.0"/>
    <title>divAtScale.src.bipartite_config.src.bicm API documentation</title>

    <style>/*! * Bootstrap Reboot v5.0.0 (https://getbootstrap.com/) * Copyright 2011-2021 The Bootstrap Authors * Copyright 2011-2021 Twitter, Inc. * Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE) * Forked from Normalize.css, licensed MIT (https://github.com/necolas/normalize.css/blob/master/LICENSE.md) */*,::after,::before{box-sizing:border-box}@media (prefers-reduced-motion:no-preference){:root{scroll-behavior:smooth}}body{margin:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans","Liberation Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";font-size:1rem;font-weight:400;line-height:1.5;color:#212529;background-color:#fff;-webkit-text-size-adjust:100%;-webkit-tap-highlight-color:transparent}hr{margin:1rem 0;color:inherit;background-color:currentColor;border:0;opacity:.25}hr:not([size]){height:1px}h1,h2,h3,h4,h5,h6{margin-top:0;margin-bottom:.5rem;font-weight:500;line-height:1.2}h1{font-size:calc(1.375rem + 1.5vw)}@media (min-width:1200px){h1{font-size:2.5rem}}h2{font-size:calc(1.325rem + .9vw)}@media (min-width:1200px){h2{font-size:2rem}}h3{font-size:calc(1.3rem + .6vw)}@media (min-width:1200px){h3{font-size:1.75rem}}h4{font-size:calc(1.275rem + .3vw)}@media (min-width:1200px){h4{font-size:1.5rem}}h5{font-size:1.25rem}h6{font-size:1rem}p{margin-top:0;margin-bottom:1rem}abbr[data-bs-original-title],abbr[title]{-webkit-text-decoration:underline dotted;text-decoration:underline dotted;cursor:help;-webkit-text-decoration-skip-ink:none;text-decoration-skip-ink:none}address{margin-bottom:1rem;font-style:normal;line-height:inherit}ol,ul{padding-left:2rem}dl,ol,ul{margin-top:0;margin-bottom:1rem}ol ol,ol ul,ul ol,ul ul{margin-bottom:0}dt{font-weight:700}dd{margin-bottom:.5rem;margin-left:0}blockquote{margin:0 0 1rem}b,strong{font-weight:bolder}small{font-size:.875em}mark{padding:.2em;background-color:#fcf8e3}sub,sup{position:relative;font-size:.75em;line-height:0;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}a{color:#0d6efd;text-decoration:underline}a:hover{color:#0a58ca}a:not([href]):not([class]),a:not([href]):not([class]):hover{color:inherit;text-decoration:none}code,kbd,pre,samp{font-family:SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;font-size:1em;direction:ltr;unicode-bidi:bidi-override}pre{display:block;margin-top:0;margin-bottom:1rem;overflow:auto;font-size:.875em}pre code{font-size:inherit;color:inherit;word-break:normal}code{font-size:.875em;color:#d63384;word-wrap:break-word}a>code{color:inherit}kbd{padding:.2rem .4rem;font-size:.875em;color:#fff;background-color:#212529;border-radius:.2rem}kbd kbd{padding:0;font-size:1em;font-weight:700}figure{margin:0 0 1rem}img,svg{vertical-align:middle}table{caption-side:bottom;border-collapse:collapse}caption{padding-top:.5rem;padding-bottom:.5rem;color:#6c757d;text-align:left}th{text-align:inherit;text-align:-webkit-match-parent}tbody,td,tfoot,th,thead,tr{border-color:inherit;border-style:solid;border-width:0}label{display:inline-block}button{border-radius:0}button:focus:not(:focus-visible){outline:0}button,input,optgroup,select,textarea{margin:0;font-family:inherit;font-size:inherit;line-height:inherit}button,select{text-transform:none}[role=button]{cursor:pointer}select{word-wrap:normal}select:disabled{opacity:1}[list]::-webkit-calendar-picker-indicator{display:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]:not(:disabled),[type=reset]:not(:disabled),[type=submit]:not(:disabled),button:not(:disabled){cursor:pointer}::-moz-focus-inner{padding:0;border-style:none}textarea{resize:vertical}fieldset{min-width:0;padding:0;margin:0;border:0}legend{float:left;width:100%;padding:0;margin-bottom:.5rem;font-size:calc(1.275rem + .3vw);line-height:inherit}@media (min-width:1200px){legend{font-size:1.5rem}}legend+*{clear:left}::-webkit-datetime-edit-day-field,::-webkit-datetime-edit-fields-wrapper,::-webkit-datetime-edit-hour-field,::-webkit-datetime-edit-minute,::-webkit-datetime-edit-month-field,::-webkit-datetime-edit-text,::-webkit-datetime-edit-year-field{padding:0}::-webkit-inner-spin-button{height:auto}[type=search]{outline-offset:-2px;-webkit-appearance:textfield}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-color-swatch-wrapper{padding:0}::file-selector-button{font:inherit}::-webkit-file-upload-button{font:inherit;-webkit-appearance:button}output{display:inline-block}iframe{border:0}summary{display:list-item;cursor:pointer}progress{vertical-align:baseline}[hidden]{display:none!important}</style>
    <style>/*! syntax-highlighting.css */pre{line-height:125%;}span.linenos{color:inherit; background-color:transparent; padding-left:5px; padding-right:20px;}.pdoc-code .hll{background-color:#ffffcc}.pdoc-code{background:#f8f8f8;}.pdoc-code .c{color:#3D7B7B; font-style:italic}.pdoc-code .err{border:1px solid #FF0000}.pdoc-code .k{color:#008000; font-weight:bold}.pdoc-code .o{color:#666666}.pdoc-code .ch{color:#3D7B7B; font-style:italic}.pdoc-code .cm{color:#3D7B7B; font-style:italic}.pdoc-code .cp{color:#9C6500}.pdoc-code .cpf{color:#3D7B7B; font-style:italic}.pdoc-code .c1{color:#3D7B7B; font-style:italic}.pdoc-code .cs{color:#3D7B7B; font-style:italic}.pdoc-code .gd{color:#A00000}.pdoc-code .ge{font-style:italic}.pdoc-code .gr{color:#E40000}.pdoc-code .gh{color:#000080; font-weight:bold}.pdoc-code .gi{color:#008400}.pdoc-code .go{color:#717171}.pdoc-code .gp{color:#000080; font-weight:bold}.pdoc-code .gs{font-weight:bold}.pdoc-code .gu{color:#800080; font-weight:bold}.pdoc-code .gt{color:#0044DD}.pdoc-code .kc{color:#008000; font-weight:bold}.pdoc-code .kd{color:#008000; font-weight:bold}.pdoc-code .kn{color:#008000; font-weight:bold}.pdoc-code .kp{color:#008000}.pdoc-code .kr{color:#008000; font-weight:bold}.pdoc-code .kt{color:#B00040}.pdoc-code .m{color:#666666}.pdoc-code .s{color:#BA2121}.pdoc-code .na{color:#687822}.pdoc-code .nb{color:#008000}.pdoc-code .nc{color:#0000FF; font-weight:bold}.pdoc-code .no{color:#880000}.pdoc-code .nd{color:#AA22FF}.pdoc-code .ni{color:#717171; font-weight:bold}.pdoc-code .ne{color:#CB3F38; font-weight:bold}.pdoc-code .nf{color:#0000FF}.pdoc-code .nl{color:#767600}.pdoc-code .nn{color:#0000FF; font-weight:bold}.pdoc-code .nt{color:#008000; font-weight:bold}.pdoc-code .nv{color:#19177C}.pdoc-code .ow{color:#AA22FF; font-weight:bold}.pdoc-code .w{color:#bbbbbb}.pdoc-code .mb{color:#666666}.pdoc-code .mf{color:#666666}.pdoc-code .mh{color:#666666}.pdoc-code .mi{color:#666666}.pdoc-code .mo{color:#666666}.pdoc-code .sa{color:#BA2121}.pdoc-code .sb{color:#BA2121}.pdoc-code .sc{color:#BA2121}.pdoc-code .dl{color:#BA2121}.pdoc-code .sd{color:#BA2121; font-style:italic}.pdoc-code .s2{color:#BA2121}.pdoc-code .se{color:#AA5D1F; font-weight:bold}.pdoc-code .sh{color:#BA2121}.pdoc-code .si{color:#A45A77; font-weight:bold}.pdoc-code .sx{color:#008000}.pdoc-code .sr{color:#A45A77}.pdoc-code .s1{color:#BA2121}.pdoc-code .ss{color:#19177C}.pdoc-code .bp{color:#008000}.pdoc-code .fm{color:#0000FF}.pdoc-code .vc{color:#19177C}.pdoc-code .vg{color:#19177C}.pdoc-code .vi{color:#19177C}.pdoc-code .vm{color:#19177C}.pdoc-code .il{color:#666666}</style>
    <style>/*! theme.css */:root{--pdoc-background:#fff;}.pdoc{--text:#212529;--muted:#6c757d;--link:#3660a5;--link-hover:#1659c5;--code:#f8f8f8;--active:#fff598;--accent:#eee;--accent2:#c1c1c1;--nav-hover:rgba(255, 255, 255, 0.5);--name:#0066BB;--def:#008800;--annotation:#007020;}</style>
    <style>/*! layout.css */html, body{width:100%;height:100%;}html, main{scroll-behavior:smooth;}body{background-color:var(--pdoc-background);}@media (max-width:769px){#navtoggle{cursor:pointer;position:absolute;width:50px;height:40px;top:1rem;right:1rem;border-color:var(--text);color:var(--text);display:flex;opacity:0.8;z-index:999;}#navtoggle:hover{opacity:1;}#togglestate + div{display:none;}#togglestate:checked + div{display:inherit;}main, header{padding:2rem 3vw;}header + main{margin-top:-3rem;}.git-button{display:none !important;}nav input[type="search"]{max-width:77%;}nav input[type="search"]:first-child{margin-top:-6px;}nav input[type="search"]:valid ~ *{display:none !important;}}@media (min-width:770px){:root{--sidebar-width:clamp(12.5rem, 28vw, 22rem);}nav{position:fixed;overflow:auto;height:100vh;width:var(--sidebar-width);}main, header{padding:3rem 2rem 3rem calc(var(--sidebar-width) + 3rem);width:calc(54rem + var(--sidebar-width));max-width:100%;}header + main{margin-top:-4rem;}#navtoggle{display:none;}}#togglestate{position:absolute;height:0;opacity:0;}nav.pdoc{--pad:clamp(0.5rem, 2vw, 1.75rem);--indent:1.5rem;background-color:var(--accent);border-right:1px solid var(--accent2);box-shadow:0 0 20px rgba(50, 50, 50, .2) inset;padding:0 0 0 var(--pad);overflow-wrap:anywhere;scrollbar-width:thin; scrollbar-color:var(--accent2) transparent; z-index:1}nav.pdoc::-webkit-scrollbar{width:.4rem; }nav.pdoc::-webkit-scrollbar-thumb{background-color:var(--accent2); }nav.pdoc > div{padding:var(--pad) 0;}nav.pdoc .module-list-button{display:inline-flex;align-items:center;color:var(--text);border-color:var(--muted);margin-bottom:1rem;}nav.pdoc .module-list-button:hover{border-color:var(--text);}nav.pdoc input[type=search]{display:block;outline-offset:0;width:calc(100% - var(--pad));}nav.pdoc .logo{max-width:calc(100% - var(--pad));max-height:35vh;display:block;margin:0 auto 1rem;transform:translate(calc(-.5 * var(--pad)), 0);}nav.pdoc ul{list-style:none;padding-left:0;}nav.pdoc > div > ul{margin-left:calc(0px - var(--pad));}nav.pdoc li a{padding:.2rem 0 .2rem calc(var(--pad) + var(--indent));}nav.pdoc > div > ul > li > a{padding-left:var(--pad);}nav.pdoc li{transition:all 100ms;}nav.pdoc li:hover{background-color:var(--nav-hover);}nav.pdoc a, nav.pdoc a:hover{color:var(--text);}nav.pdoc a{display:block;}nav.pdoc > h2:first-of-type{margin-top:1.5rem;}nav.pdoc .class:before{content:"class ";color:var(--muted);}nav.pdoc .function:after{content:"()";color:var(--muted);}nav.pdoc footer:before{content:"";display:block;width:calc(100% - var(--pad));border-top:solid var(--accent2) 1px;margin-top:1.5rem;padding-top:.5rem;}nav.pdoc footer{font-size:small;}</style>
    <style>/*! content.css */.pdoc{color:var(--text);box-sizing:border-box;line-height:1.5;background:none;}.pdoc .pdoc-button{cursor:pointer;display:inline-block;border:solid black 1px;border-radius:2px;font-size:.75rem;padding:calc(0.5em - 1px) 1em;transition:100ms all;}.pdoc .pdoc-alert{padding:1rem 1rem 1rem calc(1.5rem + 24px);border:1px solid transparent;border-radius:.25rem;background-repeat:no-repeat;background-position:1rem center;margin-bottom:1rem;}.pdoc .pdoc-alert > *:last-child{margin-bottom:0;}.pdoc .pdoc-alert-note {color:#084298;background-color:#cfe2ff;border-color:#b6d4fe;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23084298%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8%2016A8%208%200%201%200%208%200a8%208%200%200%200%200%2016zm.93-9.412-1%204.705c-.07.34.029.533.304.533.194%200%20.487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703%200-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381%202.29-.287zM8%205.5a1%201%200%201%201%200-2%201%201%200%200%201%200%202z%22/%3E%3C/svg%3E");}.pdoc .pdoc-alert-warning{color:#664d03;background-color:#fff3cd;border-color:#ffecb5;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23664d03%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8.982%201.566a1.13%201.13%200%200%200-1.96%200L.165%2013.233c-.457.778.091%201.767.98%201.767h13.713c.889%200%201.438-.99.98-1.767L8.982%201.566zM8%205c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%205.995A.905.905%200%200%201%208%205zm.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2z%22/%3E%3C/svg%3E");}.pdoc .pdoc-alert-danger{color:#842029;background-color:#f8d7da;border-color:#f5c2c7;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23842029%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M5.52.359A.5.5%200%200%201%206%200h4a.5.5%200%200%201%20.474.658L8.694%206H12.5a.5.5%200%200%201%20.395.807l-7%209a.5.5%200%200%201-.873-.454L6.823%209.5H3.5a.5.5%200%200%201-.48-.641l2.5-8.5z%22/%3E%3C/svg%3E");}.pdoc .visually-hidden{position:absolute !important;width:1px !important;height:1px !important;padding:0 !important;margin:-1px !important;overflow:hidden !important;clip:rect(0, 0, 0, 0) !important;white-space:nowrap !important;border:0 !important;}.pdoc h1, .pdoc h2, .pdoc h3{font-weight:300;margin:.3em 0;padding:.2em 0;}.pdoc > section:not(.module-info) h1{font-size:1.5rem;font-weight:500;}.pdoc > section:not(.module-info) h2{font-size:1.4rem;font-weight:500;}.pdoc > section:not(.module-info) h3{font-size:1.3rem;font-weight:500;}.pdoc > section:not(.module-info) h4{font-size:1.2rem;}.pdoc > section:not(.module-info) h5{font-size:1.1rem;}.pdoc a{text-decoration:none;color:var(--link);}.pdoc a:hover{color:var(--link-hover);}.pdoc blockquote{margin-left:2rem;}.pdoc pre{border-top:1px solid var(--accent2);border-bottom:1px solid var(--accent2);margin-top:0;margin-bottom:1em;padding:.5rem 0 .5rem .5rem;overflow-x:auto;background-color:var(--code);}.pdoc code{color:var(--text);padding:.2em .4em;margin:0;font-size:85%;background-color:var(--accent);border-radius:6px;}.pdoc a > code{color:inherit;}.pdoc pre > code{display:inline-block;font-size:inherit;background:none;border:none;padding:0;}.pdoc > section:not(.module-info){margin-bottom:1.5rem;}.pdoc .modulename{margin-top:0;font-weight:bold;}.pdoc .modulename a{color:var(--link);transition:100ms all;}.pdoc .git-button{float:right;border:solid var(--link) 1px;}.pdoc .git-button:hover{background-color:var(--link);color:var(--pdoc-background);}.view-source-toggle-state,.view-source-toggle-state ~ .pdoc-code{display:none;}.view-source-toggle-state:checked ~ .pdoc-code{display:block;}.view-source-button{display:inline-block;float:right;font-size:.75rem;line-height:1.5rem;color:var(--muted);padding:0 .4rem 0 1.3rem;cursor:pointer;text-indent:-2px;}.view-source-button > span{visibility:hidden;}.module-info .view-source-button{float:none;display:flex;justify-content:flex-end;margin:-1.2rem .4rem -.2rem 0;}.view-source-button::before{position:absolute;content:"View Source";display:list-item;list-style-type:disclosure-closed;}.view-source-toggle-state:checked ~ .attr .view-source-button::before,.view-source-toggle-state:checked ~ .view-source-button::before{list-style-type:disclosure-open;}.pdoc .docstring{margin-bottom:1.5rem;}.pdoc section:not(.module-info) .docstring{margin-left:clamp(0rem, 5vw - 2rem, 1rem);}.pdoc .docstring .pdoc-code{margin-left:1em;margin-right:1em;}.pdoc h1:target,.pdoc h2:target,.pdoc h3:target,.pdoc h4:target,.pdoc h5:target,.pdoc h6:target,.pdoc .pdoc-code > pre > span:target{background-color:var(--active);box-shadow:-1rem 0 0 0 var(--active);}.pdoc .pdoc-code > pre > span:target{display:block;}.pdoc div:target > .attr,.pdoc section:target > .attr,.pdoc dd:target > a{background-color:var(--active);}.pdoc *{scroll-margin:2rem;}.pdoc .pdoc-code .linenos{user-select:none;}.pdoc .attr:hover{filter:contrast(0.95);}.pdoc section, .pdoc .classattr{position:relative;}.pdoc .headerlink{--width:clamp(1rem, 3vw, 2rem);position:absolute;top:0;left:calc(0rem - var(--width));transition:all 100ms ease-in-out;opacity:0;}.pdoc .headerlink::before{content:"#";display:block;text-align:center;width:var(--width);height:2.3rem;line-height:2.3rem;font-size:1.5rem;}.pdoc .attr:hover ~ .headerlink,.pdoc *:target > .headerlink,.pdoc .headerlink:hover{opacity:1;}.pdoc .attr{display:block;margin:.5rem 0 .5rem;padding:.4rem .4rem .4rem 1rem;background-color:var(--accent);overflow-x:auto;}.pdoc .classattr{margin-left:2rem;}.pdoc .name{color:var(--name);font-weight:bold;}.pdoc .def{color:var(--def);font-weight:bold;}.pdoc .signature{background-color:transparent;}.pdoc .param, .pdoc .return-annotation{white-space:pre;}.pdoc .signature.multiline .param{display:block;}.pdoc .signature.condensed .param{display:inline-block;}.pdoc .annotation{color:var(--annotation);}.pdoc .view-value-toggle-state,.pdoc .view-value-toggle-state ~ .default_value{display:none;}.pdoc .view-value-toggle-state:checked ~ .default_value{display:inherit;}.pdoc .view-value-button{font-size:.5rem;vertical-align:middle;border-style:dashed;margin-top:-0.1rem;}.pdoc .view-value-button:hover{background:white;}.pdoc .view-value-button::before{content:"show";text-align:center;width:2.2em;display:inline-block;}.pdoc .view-value-toggle-state:checked ~ .view-value-button::before{content:"hide";}.pdoc .inherited{margin-left:2rem;}.pdoc .inherited dt{font-weight:700;}.pdoc .inherited dt, .pdoc .inherited dd{display:inline;margin-left:0;margin-bottom:.5rem;}.pdoc .inherited dd:not(:last-child):after{content:", ";}.pdoc .inherited .class:before{content:"class ";}.pdoc .inherited .function a:after{content:"()";}.pdoc .search-result .docstring{overflow:auto;max-height:25vh;}.pdoc .search-result.focused > .attr{background-color:var(--active);}.pdoc .attribution{margin-top:2rem;display:block;opacity:0.5;transition:all 200ms;filter:grayscale(100%);}.pdoc .attribution:hover{opacity:1;filter:grayscale(0%);}.pdoc .attribution img{margin-left:5px;height:35px;vertical-align:middle;width:70px;transition:all 200ms;}.pdoc table{display:block;width:max-content;max-width:100%;overflow:auto;margin-bottom:1rem;}.pdoc table th{font-weight:600;}.pdoc table th, .pdoc table td{padding:6px 13px;border:1px solid var(--accent2);}</style>
    <style>/*! custom.css */</style></head>
<body>
    <nav class="pdoc">
        <label id="navtoggle" for="togglestate" class="pdoc-button"><svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30 30'><path stroke-linecap='round' stroke="currentColor" stroke-miterlimit='10' stroke-width='2' d='M4 7h22M4 15h22M4 23h22'/></svg></label>
        <input id="togglestate" type="checkbox" aria-hidden="true" tabindex="-1">
        <div>            <a class="pdoc-button module-list-button" href="../src.html">
<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-box-arrow-in-left" viewBox="0 0 16 16">
  <path fill-rule="evenodd" d="M10 3.5a.5.5 0 0 0-.5-.5h-8a.5.5 0 0 0-.5.5v9a.5.5 0 0 0 .5.5h8a.5.5 0 0 0 .5-.5v-2a.5.5 0 0 1 1 0v2A1.5 1.5 0 0 1 9.5 14h-8A1.5 1.5 0 0 1 0 12.5v-9A1.5 1.5 0 0 1 1.5 2h8A1.5 1.5 0 0 1 11 3.5v2a.5.5 0 0 1-1 0v-2z"/>
  <path fill-rule="evenodd" d="M4.146 8.354a.5.5 0 0 1 0-.708l3-3a.5.5 0 1 1 .708.708L5.707 7.5H14.5a.5.5 0 0 1 0 1H5.707l2.147 2.146a.5.5 0 0 1-.708.708l-3-3z"/>
</svg>                &nbsp;divAtScale.src.bipartite_config.src</a>


            <input type="search" placeholder="Search..." role="searchbox" aria-label="search"
                   pattern=".+" required>



            <h2>API Documentation</h2>
                <ul class="memberlist">
            <li>
                    <a class="class" href="#BiCM">BiCM</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#BiCM.__init__">BiCM</a>
                        </li>
                        <li>
                                <a class="variable" href="#BiCM.bin_mat">bin_mat</a>
                        </li>
                        <li>
                                <a class="variable" href="#BiCM.dseq">dseq</a>
                        </li>
                        <li>
                                <a class="variable" href="#BiCM.dim">dim</a>
                        </li>
                        <li>
                                <a class="variable" href="#BiCM.sol">sol</a>
                        </li>
                        <li>
                                <a class="variable" href="#BiCM.adj_matrix">adj_matrix</a>
                        </li>
                        <li>
                                <a class="variable" href="#BiCM.input_queue">input_queue</a>
                        </li>
                        <li>
                                <a class="variable" href="#BiCM.output_queue">output_queue</a>
                        </li>
                        <li>
                                <a class="function" href="#BiCM.check_input_matrix_is_binary">check_input_matrix_is_binary</a>
                        </li>
                        <li>
                                <a class="function" href="#BiCM.set_degree_seq">set_degree_seq</a>
                        </li>
                        <li>
                                <a class="function" href="#BiCM.make_bicm">make_bicm</a>
                        </li>
                        <li>
                                <a class="function" href="#BiCM.solve_equations">solve_equations</a>
                        </li>
                        <li>
                                <a class="function" href="#BiCM.equations">equations</a>
                        </li>
                        <li>
                                <a class="function" href="#BiCM.jacobian">jacobian</a>
                        </li>
                        <li>
                                <a class="function" href="#BiCM.get_biadjacency_matrix">get_biadjacency_matrix</a>
                        </li>
                        <li>
                                <a class="function" href="#BiCM.print_max_degree_differences">print_max_degree_differences</a>
                        </li>
                        <li>
                                <a class="function" href="#BiCM.test_average_degrees">test_average_degrees</a>
                        </li>
                        <li>
                                <a class="function" href="#BiCM.lambda_motifs">lambda_motifs</a>
                        </li>
                        <li>
                                <a class="function" href="#BiCM.get_lambda_motif_block">get_lambda_motif_block</a>
                        </li>
                        <li>
                                <a class="function" href="#BiCM.get_plambda_block">get_plambda_block</a>
                        </li>
                        <li>
                                <a class="function" href="#BiCM.get_pvalues_q">get_pvalues_q</a>
                        </li>
                        <li>
                                <a class="function" href="#BiCM.add2inqueue">add2inqueue</a>
                        </li>
                        <li>
                                <a class="function" href="#BiCM.pval_process_worker">pval_process_worker</a>
                        </li>
                        <li>
                                <a class="function" href="#BiCM.outqueue2pval_mat">outqueue2pval_mat</a>
                        </li>
                        <li>
                                <a class="function" href="#BiCM.get_triup_dim">get_triup_dim</a>
                        </li>
                        <li>
                                <a class="function" href="#BiCM.split_range">split_range</a>
                        </li>
                        <li>
                                <a class="function" href="#BiCM.triumat2flat_idx">triumat2flat_idx</a>
                        </li>
                        <li>
                                <a class="function" href="#BiCM.triumat2flat_dim">triumat2flat_dim</a>
                        </li>
                        <li>
                                <a class="function" href="#BiCM.flat2triumat_dim">flat2triumat_dim</a>
                        </li>
                        <li>
                                <a class="function" href="#BiCM.flat2triumat_idx">flat2triumat_idx</a>
                        </li>
                        <li>
                                <a class="function" href="#BiCM.save_biadjacency">save_biadjacency</a>
                        </li>
                        <li>
                                <a class="function" href="#BiCM.save_array">save_array</a>
                        </li>
                </ul>

            </li>
    </ul>



        <a class="attribution" title="pdoc: Python API documentation generator" href="https://pdoc.dev" target="_blank">
            built with <span class="visually-hidden">pdoc</span><img
                alt="pdoc logo"
                src="data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20role%3D%22img%22%20aria-label%3D%22pdoc%20logo%22%20width%3D%22300%22%20height%3D%22150%22%20viewBox%3D%22-1%200%2060%2030%22%3E%3Ctitle%3Epdoc%3C/title%3E%3Cpath%20d%3D%22M29.621%2021.293c-.011-.273-.214-.475-.511-.481a.5.5%200%200%200-.489.503l-.044%201.393c-.097.551-.695%201.215-1.566%201.704-.577.428-1.306.486-2.193.182-1.426-.617-2.467-1.654-3.304-2.487l-.173-.172a3.43%203.43%200%200%200-.365-.306.49.49%200%200%200-.286-.196c-1.718-1.06-4.931-1.47-7.353.191l-.219.15c-1.707%201.187-3.413%202.131-4.328%201.03-.02-.027-.49-.685-.141-1.763.233-.721.546-2.408.772-4.076.042-.09.067-.187.046-.288.166-1.347.277-2.625.241-3.351%201.378-1.008%202.271-2.586%202.271-4.362%200-.976-.272-1.935-.788-2.774-.057-.094-.122-.18-.184-.268.033-.167.052-.339.052-.516%200-1.477-1.202-2.679-2.679-2.679-.791%200-1.496.352-1.987.9a6.3%206.3%200%200%200-1.001.029c-.492-.564-1.207-.929-2.012-.929-1.477%200-2.679%201.202-2.679%202.679A2.65%202.65%200%200%200%20.97%206.554c-.383.747-.595%201.572-.595%202.41%200%202.311%201.507%204.29%203.635%205.107-.037.699-.147%202.27-.423%203.294l-.137.461c-.622%202.042-2.515%208.257%201.727%2010.643%201.614.908%203.06%201.248%204.317%201.248%202.665%200%204.492-1.524%205.322-2.401%201.476-1.559%202.886-1.854%206.491.82%201.877%201.393%203.514%201.753%204.861%201.068%202.223-1.713%202.811-3.867%203.399-6.374.077-.846.056-1.469.054-1.537zm-4.835%204.313c-.054.305-.156.586-.242.629-.034-.007-.131-.022-.307-.157-.145-.111-.314-.478-.456-.908.221.121.432.25.675.355.115.039.219.051.33.081zm-2.251-1.238c-.05.33-.158.648-.252.694-.022.001-.125-.018-.307-.157-.217-.166-.488-.906-.639-1.573.358.344.754.693%201.198%201.036zm-3.887-2.337c-.006-.116-.018-.231-.041-.342.635.145%201.189.368%201.599.625.097.231.166.481.174.642-.03.049-.055.101-.067.158-.046.013-.128.026-.298.004-.278-.037-.901-.57-1.367-1.087zm-1.127-.497c.116.306.176.625.12.71-.019.014-.117.045-.345.016-.206-.027-.604-.332-.986-.695.41-.051.816-.056%201.211-.031zm-4.535%201.535c.209.22.379.47.358.598-.006.041-.088.138-.351.234-.144.055-.539-.063-.979-.259a11.66%2011.66%200%200%200%20.972-.573zm.983-.664c.359-.237.738-.418%201.126-.554.25.237.479.548.457.694-.006.042-.087.138-.351.235-.174.064-.694-.105-1.232-.375zm-3.381%201.794c-.022.145-.061.29-.149.401-.133.166-.358.248-.69.251h-.002c-.133%200-.306-.26-.45-.621.417.091.854.07%201.291-.031zm-2.066-8.077a4.78%204.78%200%200%201-.775-.584c.172-.115.505-.254.88-.378l-.105.962zm-.331%202.302a10.32%2010.32%200%200%201-.828-.502c.202-.143.576-.328.984-.49l-.156.992zm-.45%202.157l-.701-.403c.214-.115.536-.249.891-.376a11.57%2011.57%200%200%201-.19.779zm-.181%201.716c.064.398.194.702.298.893-.194-.051-.435-.162-.736-.398.061-.119.224-.3.438-.495zM8.87%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zm-.735-.389a1.15%201.15%200%200%200-.314.783%201.16%201.16%200%200%200%201.162%201.162c.457%200%20.842-.27%201.032-.653.026.117.042.238.042.362a1.68%201.68%200%200%201-1.679%201.679%201.68%201.68%200%200%201-1.679-1.679c0-.843.626-1.535%201.436-1.654zM5.059%205.406A1.68%201.68%200%200%201%203.38%207.085a1.68%201.68%200%200%201-1.679-1.679c0-.037.009-.072.011-.109.21.3.541.508.935.508a1.16%201.16%200%200%200%201.162-1.162%201.14%201.14%200%200%200-.474-.912c.015%200%20.03-.005.045-.005.926.001%201.679.754%201.679%201.68zM3.198%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zM1.375%208.964c0-.52.103-1.035.288-1.52.466.394%201.06.64%201.717.64%201.144%200%202.116-.725%202.499-1.738.383%201.012%201.355%201.738%202.499%201.738.867%200%201.631-.421%202.121-1.062.307.605.478%201.267.478%201.942%200%202.486-2.153%204.51-4.801%204.51s-4.801-2.023-4.801-4.51zm24.342%2019.349c-.985.498-2.267.168-3.813-.979-3.073-2.281-5.453-3.199-7.813-.705-1.315%201.391-4.163%203.365-8.423.97-3.174-1.786-2.239-6.266-1.261-9.479l.146-.492c.276-1.02.395-2.457.444-3.268a6.11%206.11%200%200%200%201.18.115%206.01%206.01%200%200%200%202.536-.562l-.006.175c-.802.215-1.848.612-2.021%201.25-.079.295.021.601.274.837.219.203.415.364.598.501-.667.304-1.243.698-1.311%201.179-.02.144-.022.507.393.787.213.144.395.26.564.365-1.285.521-1.361.96-1.381%201.126-.018.142-.011.496.427.746l.854.489c-.473.389-.971.914-.999%201.429-.018.278.095.532.316.713.675.556%201.231.721%201.653.721.059%200%20.104-.014.158-.02.207.707.641%201.64%201.513%201.64h.013c.8-.008%201.236-.345%201.462-.626.173-.216.268-.457.325-.692.424.195.93.374%201.372.374.151%200%20.294-.021.423-.068.732-.27.944-.704.993-1.021.009-.061.003-.119.002-.179.266.086.538.147.789.147.15%200%20.294-.021.423-.069.542-.2.797-.489.914-.754.237.147.478.258.704.288.106.014.205.021.296.021.356%200%20.595-.101.767-.229.438.435%201.094.992%201.656%201.067.106.014.205.021.296.021a1.56%201.56%200%200%200%20.323-.035c.17.575.453%201.289.866%201.605.358.273.665.362.914.362a.99.99%200%200%200%20.421-.093%201.03%201.03%200%200%200%20.245-.164c.168.428.39.846.68%201.068.358.273.665.362.913.362a.99.99%200%200%200%20.421-.093c.317-.148.512-.448.639-.762.251.157.495.257.726.257.127%200%20.25-.024.37-.071.427-.17.706-.617.841-1.314.022-.015.047-.022.068-.038.067-.051.133-.104.196-.159-.443%201.486-1.107%202.761-2.086%203.257zM8.66%209.925a.5.5%200%201%200-1%200c0%20.653-.818%201.205-1.787%201.205s-1.787-.552-1.787-1.205a.5.5%200%201%200-1%200c0%201.216%201.25%202.205%202.787%202.205s2.787-.989%202.787-2.205zm4.4%2015.965l-.208.097c-2.661%201.258-4.708%201.436-6.086.527-1.542-1.017-1.88-3.19-1.844-4.198a.4.4%200%200%200-.385-.414c-.242-.029-.406.164-.414.385-.046%201.249.367%203.686%202.202%204.896.708.467%201.547.7%202.51.7%201.248%200%202.706-.392%204.362-1.174l.185-.086a.4.4%200%200%200%20.205-.527c-.089-.204-.326-.291-.527-.206zM9.547%202.292c.093.077.205.114.317.114a.5.5%200%200%200%20.318-.886L8.817.397a.5.5%200%200%200-.703.068.5.5%200%200%200%20.069.703l1.364%201.124zm-7.661-.065c.086%200%20.173-.022.253-.068l1.523-.893a.5.5%200%200%200-.506-.863l-1.523.892a.5.5%200%200%200-.179.685c.094.158.261.247.432.247z%22%20transform%3D%22matrix%28-1%200%200%201%2058%200%29%22%20fill%3D%22%233bb300%22/%3E%3Cpath%20d%3D%22M.3%2021.86V10.18q0-.46.02-.68.04-.22.18-.5.28-.54%201.34-.54%201.06%200%201.42.28.38.26.44.78.76-1.04%202.38-1.04%201.64%200%203.1%201.54%201.46%201.54%201.46%203.58%200%202.04-1.46%203.58-1.44%201.54-3.08%201.54-1.64%200-2.38-.92v4.04q0%20.46-.04.68-.02.22-.18.5-.14.3-.5.42-.36.12-.98.12-.62%200-1-.12-.36-.12-.52-.4-.14-.28-.18-.5-.02-.22-.02-.68zm3.96-9.42q-.46.54-.46%201.18%200%20.64.46%201.18.48.52%201.2.52.74%200%201.24-.52.52-.52.52-1.18%200-.66-.48-1.18-.48-.54-1.26-.54-.76%200-1.22.54zm14.741-8.36q.16-.3.54-.42.38-.12%201-.12.64%200%201.02.12.38.12.52.42.16.3.18.54.04.22.04.68v11.94q0%20.46-.04.7-.02.22-.18.5-.3.54-1.7.54-1.38%200-1.54-.98-.84.96-2.34.96-1.8%200-3.28-1.56-1.48-1.58-1.48-3.66%200-2.1%201.48-3.68%201.5-1.58%203.28-1.58%201.48%200%202.3%201v-4.2q0-.46.02-.68.04-.24.18-.52zm-3.24%2010.86q.52.54%201.26.54.74%200%201.22-.54.5-.54.5-1.18%200-.66-.48-1.22-.46-.56-1.26-.56-.8%200-1.28.56-.48.54-.48%201.2%200%20.66.52%201.2zm7.833-1.2q0-2.4%201.68-3.96%201.68-1.56%203.84-1.56%202.16%200%203.82%201.56%201.66%201.54%201.66%203.94%200%201.66-.86%202.96-.86%201.28-2.1%201.9-1.22.6-2.54.6-1.32%200-2.56-.64-1.24-.66-2.1-1.92-.84-1.28-.84-2.88zm4.18%201.44q.64.48%201.3.48.66%200%201.32-.5.66-.5.66-1.48%200-.98-.62-1.46-.62-.48-1.34-.48-.72%200-1.34.5-.62.5-.62%201.48%200%20.96.64%201.46zm11.412-1.44q0%20.84.56%201.32.56.46%201.18.46.64%200%201.18-.36.56-.38.9-.38.6%200%201.46%201.06.46.58.46%201.04%200%20.76-1.1%201.42-1.14.8-2.8.8-1.86%200-3.58-1.34-.82-.64-1.34-1.7-.52-1.08-.52-2.36%200-1.3.52-2.34.52-1.06%201.34-1.7%201.66-1.32%203.54-1.32.76%200%201.48.22.72.2%201.06.4l.32.2q.36.24.56.38.52.4.52.92%200%20.5-.42%201.14-.72%201.1-1.38%201.1-.38%200-1.08-.44-.36-.34-1.04-.34-.66%200-1.24.48-.58.48-.58%201.34z%22%20fill%3D%22green%22/%3E%3C/svg%3E"/>
        </a>
</div>
    </nav>
    <main class="pdoc">
            <section class="module-info">
                    <h1 class="modulename">
divAtScale<wbr>.<a href="./../../../src.html">src</a><wbr>.<a href="./../../bipartite_config.html">bipartite_config</a><wbr>.<a href="./../src.html">src</a><wbr>.bicm    </h1>

                
                        <input id="mod-bicm-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">

                        <label class="view-source-button" for="mod-bicm-view-source"><span>View Source</span></label>

                        <div class="pdoc-code codehilite"><pre><span></span><span id="L-1"><a href="#L-1"><span class="linenos">  1</span></a><span class="kn">import</span> <span class="nn">ctypes</span>
</span><span id="L-2"><a href="#L-2"><span class="linenos">  2</span></a><span class="kn">import</span> <span class="nn">multiprocessing</span>
</span><span id="L-3"><a href="#L-3"><span class="linenos">  3</span></a><span class="kn">import</span> <span class="nn">scipy.optimize</span> <span class="k">as</span> <span class="nn">opt</span>
</span><span id="L-4"><a href="#L-4"><span class="linenos">  4</span></a><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
</span><span id="L-5"><a href="#L-5"><span class="linenos">  5</span></a><span class="kn">from</span> <span class="nn">divAtScale.src.bipartite_config.src.poibin.poibin</span> <span class="kn">import</span> <span class="n">PoiBin</span>
</span><span id="L-6"><a href="#L-6"><span class="linenos">  6</span></a>
</span><span id="L-7"><a href="#L-7"><span class="linenos">  7</span></a><span class="k">class</span> <span class="nc">BiCM</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
</span><span id="L-8"><a href="#L-8"><span class="linenos">  8</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Bipartite Configuration Model for undirected binary bipartite networks.</span>
</span><span id="L-9"><a href="#L-9"><span class="linenos">  9</span></a>
</span><span id="L-10"><a href="#L-10"><span class="linenos"> 10</span></a><span class="sd">    This class implements the Bipartite Configuration Model (BiCM), which can</span>
</span><span id="L-11"><a href="#L-11"><span class="linenos"> 11</span></a><span class="sd">    be used as a null model for the analysis of undirected and binary bipartite</span>
</span><span id="L-12"><a href="#L-12"><span class="linenos"> 12</span></a><span class="sd">    networks. The class provides methods for calculating the biadjacency matrix</span>
</span><span id="L-13"><a href="#L-13"><span class="linenos"> 13</span></a><span class="sd">    of the null model and for quantifying node similarities in terms of</span>
</span><span id="L-14"><a href="#L-14"><span class="linenos"> 14</span></a><span class="sd">    p-values.</span>
</span><span id="L-15"><a href="#L-15"><span class="linenos"> 15</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-16"><a href="#L-16"><span class="linenos"> 16</span></a>
</span><span id="L-17"><a href="#L-17"><span class="linenos"> 17</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bin_mat</span><span class="p">):</span>
</span><span id="L-18"><a href="#L-18"><span class="linenos"> 18</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize the parameters of the BiCM.</span>
</span><span id="L-19"><a href="#L-19"><span class="linenos"> 19</span></a>
</span><span id="L-20"><a href="#L-20"><span class="linenos"> 20</span></a><span class="sd">        :param bin_mat: binary input matrix describing the biadjacency matrix</span>
</span><span id="L-21"><a href="#L-21"><span class="linenos"> 21</span></a><span class="sd">                of a bipartite graph with the nodes of one layer along the rows</span>
</span><span id="L-22"><a href="#L-22"><span class="linenos"> 22</span></a><span class="sd">                and the nodes of the other layer along the columns.</span>
</span><span id="L-23"><a href="#L-23"><span class="linenos"> 23</span></a><span class="sd">        :type bin_mat: numpy.array</span>
</span><span id="L-24"><a href="#L-24"><span class="linenos"> 24</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-25"><a href="#L-25"><span class="linenos"> 25</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">bin_mat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">bin_mat</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">)</span>
</span><span id="L-26"><a href="#L-26"><span class="linenos"> 26</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">check_input_matrix_is_binary</span><span class="p">()</span>
</span><span id="L-27"><a href="#L-27"><span class="linenos"> 27</span></a>        <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">num_rows</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_columns</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bin_mat</span><span class="o">.</span><span class="n">shape</span>
</span><span id="L-28"><a href="#L-28"><span class="linenos"> 28</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">dseq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">set_degree_seq</span><span class="p">()</span>
</span><span id="L-29"><a href="#L-29"><span class="linenos"> 29</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">dim</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dseq</span><span class="o">.</span><span class="n">size</span>
</span><span id="L-30"><a href="#L-30"><span class="linenos"> 30</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">sol</span> <span class="o">=</span> <span class="kc">None</span>             <span class="c1"># solution of the equation system</span>
</span><span id="L-31"><a href="#L-31"><span class="linenos"> 31</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">adj_matrix</span> <span class="o">=</span> <span class="kc">None</span>      <span class="c1"># biadjacency matrix of the null model</span>
</span><span id="L-32"><a href="#L-32"><span class="linenos"> 32</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">input_queue</span> <span class="o">=</span> <span class="kc">None</span>     <span class="c1"># queue for parallel processing</span>
</span><span id="L-33"><a href="#L-33"><span class="linenos"> 33</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">output_queue</span> <span class="o">=</span> <span class="kc">None</span>    <span class="c1"># queue for parallel processing</span>
</span><span id="L-34"><a href="#L-34"><span class="linenos"> 34</span></a>
</span><span id="L-35"><a href="#L-35"><span class="linenos"> 35</span></a>    <span class="k">def</span> <span class="nf">check_input_matrix_is_binary</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-36"><a href="#L-36"><span class="linenos"> 36</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Check that the input matrix is binary, i.e. entries are 0 or 1.</span>
</span><span id="L-37"><a href="#L-37"><span class="linenos"> 37</span></a>
</span><span id="L-38"><a href="#L-38"><span class="linenos"> 38</span></a><span class="sd">        :raise AssertionError: raise an error if the input matrix is not</span>
</span><span id="L-39"><a href="#L-39"><span class="linenos"> 39</span></a><span class="sd">            binary</span>
</span><span id="L-40"><a href="#L-40"><span class="linenos"> 40</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-41"><a href="#L-41"><span class="linenos"> 41</span></a>        <span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">logical_or</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bin_mat</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">bin_mat</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)),</span> \
</span><span id="L-42"><a href="#L-42"><span class="linenos"> 42</span></a>            <span class="s2">&quot;Input matrix is not binary.&quot;</span>
</span><span id="L-43"><a href="#L-43"><span class="linenos"> 43</span></a>
</span><span id="L-44"><a href="#L-44"><span class="linenos"> 44</span></a>    <span class="k">def</span> <span class="nf">set_degree_seq</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-45"><a href="#L-45"><span class="linenos"> 45</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the node degree sequence of the input matrix.</span>
</span><span id="L-46"><a href="#L-46"><span class="linenos"> 46</span></a>
</span><span id="L-47"><a href="#L-47"><span class="linenos"> 47</span></a><span class="sd">        :returns: node degree sequence [degrees row-nodes, degrees column-nodes]</span>
</span><span id="L-48"><a href="#L-48"><span class="linenos"> 48</span></a><span class="sd">        :rtype: numpy.array</span>
</span><span id="L-49"><a href="#L-49"><span class="linenos"> 49</span></a>
</span><span id="L-50"><a href="#L-50"><span class="linenos"> 50</span></a><span class="sd">        :raise AssertionError: raise an error if the length of the returned</span>
</span><span id="L-51"><a href="#L-51"><span class="linenos"> 51</span></a><span class="sd">            degree sequence does not correspond to the total number of nodes</span>
</span><span id="L-52"><a href="#L-52"><span class="linenos"> 52</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-53"><a href="#L-53"><span class="linenos"> 53</span></a>        <span class="n">dseq</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_rows</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_columns</span><span class="p">)</span>
</span><span id="L-54"><a href="#L-54"><span class="linenos"> 54</span></a>        <span class="n">dseq</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">num_rows</span><span class="p">:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bin_mat</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>
</span><span id="L-55"><a href="#L-55"><span class="linenos"> 55</span></a>        <span class="n">dseq</span><span class="p">[:</span><span class="bp">self</span><span class="o">.</span><span class="n">num_rows</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bin_mat</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
</span><span id="L-56"><a href="#L-56"><span class="linenos"> 56</span></a>        <span class="k">assert</span> <span class="n">dseq</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_rows</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_columns</span><span class="p">)</span>
</span><span id="L-57"><a href="#L-57"><span class="linenos"> 57</span></a>        <span class="k">return</span> <span class="n">dseq</span>
</span><span id="L-58"><a href="#L-58"><span class="linenos"> 58</span></a>
</span><span id="L-59"><a href="#L-59"><span class="linenos"> 59</span></a>    <span class="k">def</span> <span class="nf">make_bicm</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x0</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;hybr&#39;</span><span class="p">,</span> <span class="n">jac</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">tol</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="L-60"><a href="#L-60"><span class="linenos"> 60</span></a>                  <span class="n">callback</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">options</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="L-61"><a href="#L-61"><span class="linenos"> 61</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Create the biadjacency matrix of the BiCM null model.</span>
</span><span id="L-62"><a href="#L-62"><span class="linenos"> 62</span></a>
</span><span id="L-63"><a href="#L-63"><span class="linenos"> 63</span></a><span class="sd">        Solve the log-likelihood maximization problem to obtain the BiCM</span>
</span><span id="L-64"><a href="#L-64"><span class="linenos"> 64</span></a><span class="sd">        null model which respects constraints on the degree sequence of the</span>
</span><span id="L-65"><a href="#L-65"><span class="linenos"> 65</span></a><span class="sd">        input matrix.</span>
</span><span id="L-66"><a href="#L-66"><span class="linenos"> 66</span></a>
</span><span id="L-67"><a href="#L-67"><span class="linenos"> 67</span></a><span class="sd">        The problem is solved using ``scipy``&#39;s root function with the solver</span>
</span><span id="L-68"><a href="#L-68"><span class="linenos"> 68</span></a><span class="sd">        defined by ``method``. The status of the solver after running</span>
</span><span id="L-69"><a href="#L-69"><span class="linenos"> 69</span></a><span class="sd">        ``scipy.root``and the difference between the network and BiCM degrees</span>
</span><span id="L-70"><a href="#L-70"><span class="linenos"> 70</span></a><span class="sd">        are printed in the console.</span>
</span><span id="L-71"><a href="#L-71"><span class="linenos"> 71</span></a>
</span><span id="L-72"><a href="#L-72"><span class="linenos"> 72</span></a><span class="sd">        The default solver is the modified Powell method ``hybr``. Least-squares</span>
</span><span id="L-73"><a href="#L-73"><span class="linenos"> 73</span></a><span class="sd">        can be chosen with ``method=&#39;lm&#39;`` for the Levenberg-Marquardt approach.</span>
</span><span id="L-74"><a href="#L-74"><span class="linenos"> 74</span></a>
</span><span id="L-75"><a href="#L-75"><span class="linenos"> 75</span></a><span class="sd">        Depending on the solver, keyword arguments ``kwargs`` can be passed to</span>
</span><span id="L-76"><a href="#L-76"><span class="linenos"> 76</span></a><span class="sd">        the solver. Please refer to the `scipy.optimize.root documentation</span>
</span><span id="L-77"><a href="#L-77"><span class="linenos"> 77</span></a><span class="sd">        &lt;https://docs.scipy.org/doc/scipy-0.19.0/reference/generated/</span>
</span><span id="L-78"><a href="#L-78"><span class="linenos"> 78</span></a><span class="sd">        scipy.optimize.root.html&gt;`_ for detailed descriptions.</span>
</span><span id="L-79"><a href="#L-79"><span class="linenos"> 79</span></a>
</span><span id="L-80"><a href="#L-80"><span class="linenos"> 80</span></a><span class="sd">        .. note::</span>
</span><span id="L-81"><a href="#L-81"><span class="linenos"> 81</span></a>
</span><span id="L-82"><a href="#L-82"><span class="linenos"> 82</span></a><span class="sd">            It can happen that the solver ``method`` used by ``scipy.root``</span>
</span><span id="L-83"><a href="#L-83"><span class="linenos"> 83</span></a><span class="sd">            does not converge to a solution.</span>
</span><span id="L-84"><a href="#L-84"><span class="linenos"> 84</span></a><span class="sd">            In this case, please try another ``method`` or different initial</span>
</span><span id="L-85"><a href="#L-85"><span class="linenos"> 85</span></a><span class="sd">            conditions and refer to the `scipy.optimize.root documentation</span>
</span><span id="L-86"><a href="#L-86"><span class="linenos"> 86</span></a><span class="sd">            &lt;https://docs.scipy.org/doc/scipy-0.19.0/reference/generated/</span>
</span><span id="L-87"><a href="#L-87"><span class="linenos"> 87</span></a><span class="sd">            scipy.optimize.root.html&gt;`_.</span>
</span><span id="L-88"><a href="#L-88"><span class="linenos"> 88</span></a>
</span><span id="L-89"><a href="#L-89"><span class="linenos"> 89</span></a><span class="sd">        :param x0: initial guesses for the solutions. The first entries are the</span>
</span><span id="L-90"><a href="#L-90"><span class="linenos"> 90</span></a><span class="sd">            initial guesses for the row-nodes, followed by the initial guesses</span>
</span><span id="L-91"><a href="#L-91"><span class="linenos"> 91</span></a><span class="sd">            for the column-nodes.</span>
</span><span id="L-92"><a href="#L-92"><span class="linenos"> 92</span></a><span class="sd">        :type x0: 1d numpy.array, optional</span>
</span><span id="L-93"><a href="#L-93"><span class="linenos"> 93</span></a><span class="sd">        :param method: type of solver, default is ‘hybr’. For other</span>
</span><span id="L-94"><a href="#L-94"><span class="linenos"> 94</span></a><span class="sd">            solvers, see the `scipy.optimize.root documentation</span>
</span><span id="L-95"><a href="#L-95"><span class="linenos"> 95</span></a><span class="sd">            &lt;https://docs.scipy.org/doc/</span>
</span><span id="L-96"><a href="#L-96"><span class="linenos"> 96</span></a><span class="sd">            scipy-0.19.0/reference/generated/scipy.optimize.root.html&gt;`_.</span>
</span><span id="L-97"><a href="#L-97"><span class="linenos"> 97</span></a><span class="sd">        :type method: str, optional</span>
</span><span id="L-98"><a href="#L-98"><span class="linenos"> 98</span></a><span class="sd">        :param jac: Jacobian of the system</span>
</span><span id="L-99"><a href="#L-99"><span class="linenos"> 99</span></a><span class="sd">        :type jac: bool or callable, optional</span>
</span><span id="L-100"><a href="#L-100"><span class="linenos">100</span></a><span class="sd">        :param tol: tolerance for termination. For detailed control, use</span>
</span><span id="L-101"><a href="#L-101"><span class="linenos">101</span></a><span class="sd">            solver-specific options.</span>
</span><span id="L-102"><a href="#L-102"><span class="linenos">102</span></a><span class="sd">        :type tol: float, optional</span>
</span><span id="L-103"><a href="#L-103"><span class="linenos">103</span></a><span class="sd">        :param callback: optional callback function to be called at</span>
</span><span id="L-104"><a href="#L-104"><span class="linenos">104</span></a><span class="sd">            every iteration as ``callback(self.equations, x)``,</span>
</span><span id="L-105"><a href="#L-105"><span class="linenos">105</span></a><span class="sd">            see ``scipy.root`` documentation</span>
</span><span id="L-106"><a href="#L-106"><span class="linenos">106</span></a><span class="sd">        :type callback: function, optional</span>
</span><span id="L-107"><a href="#L-107"><span class="linenos">107</span></a><span class="sd">        :param options: a dictionary of solver options, e.g. ``xtol`` or</span>
</span><span id="L-108"><a href="#L-108"><span class="linenos">108</span></a><span class="sd">            ``maxiter``, see scipy.root documentation</span>
</span><span id="L-109"><a href="#L-109"><span class="linenos">109</span></a><span class="sd">        :type options: dict, optional</span>
</span><span id="L-110"><a href="#L-110"><span class="linenos">110</span></a><span class="sd">        :param kwargs: solver-specific options, please refer to the SciPy</span>
</span><span id="L-111"><a href="#L-111"><span class="linenos">111</span></a><span class="sd">            documentation</span>
</span><span id="L-112"><a href="#L-112"><span class="linenos">112</span></a>
</span><span id="L-113"><a href="#L-113"><span class="linenos">113</span></a><span class="sd">        :raise ValueError: raise an error if not enough initial conditions</span>
</span><span id="L-114"><a href="#L-114"><span class="linenos">114</span></a><span class="sd">            are provided</span>
</span><span id="L-115"><a href="#L-115"><span class="linenos">115</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-116"><a href="#L-116"><span class="linenos">116</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="L-117"><a href="#L-117"><span class="linenos">117</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">sol</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">solve_equations</span><span class="p">(</span><span class="n">x0</span><span class="o">=</span><span class="n">x0</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="n">method</span><span class="p">,</span> <span class="n">jac</span><span class="o">=</span><span class="n">jac</span><span class="p">,</span> <span class="n">tol</span><span class="o">=</span><span class="n">tol</span><span class="p">,</span>
</span><span id="L-118"><a href="#L-118"><span class="linenos">118</span></a>                                            <span class="n">callback</span><span class="o">=</span><span class="n">callback</span><span class="p">,</span> <span class="n">options</span><span class="o">=</span><span class="n">options</span><span class="p">)</span>
</span><span id="L-119"><a href="#L-119"><span class="linenos">119</span></a>            <span class="c1"># create BiCM biadjacency matrix:</span>
</span><span id="L-120"><a href="#L-120"><span class="linenos">120</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">adj_matrix</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_biadjacency_matrix</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sol</span><span class="o">.</span><span class="n">x</span><span class="p">)</span>
</span><span id="L-121"><a href="#L-121"><span class="linenos">121</span></a>            <span class="c1"># self.print_max_degree_differences()</span>
</span><span id="L-122"><a href="#L-122"><span class="linenos">122</span></a>            <span class="c1"># assert self.test_average_degrees(eps=1e-2)</span>
</span><span id="L-123"><a href="#L-123"><span class="linenos">123</span></a>        <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="L-124"><a href="#L-124"><span class="linenos">124</span></a>            <span class="c1"># Catch and handle the ValueError</span>
</span><span id="L-125"><a href="#L-125"><span class="linenos">125</span></a>            <span class="c1">#print(f&quot;Caught a ValueError: {e}&quot;)</span>
</span><span id="L-126"><a href="#L-126"><span class="linenos">126</span></a>            <span class="n">errror_msg</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="L-127"><a href="#L-127"><span class="linenos">127</span></a>
</span><span id="L-128"><a href="#L-128"><span class="linenos">128</span></a>
</span><span id="L-129"><a href="#L-129"><span class="linenos">129</span></a><span class="c1"># ------------------------------------------------------------------------------</span>
</span><span id="L-130"><a href="#L-130"><span class="linenos">130</span></a><span class="c1"># Solve coupled nonlinear equations and get BiCM biadjacency matrix</span>
</span><span id="L-131"><a href="#L-131"><span class="linenos">131</span></a><span class="c1"># ------------------------------------------------------------------------------</span>
</span><span id="L-132"><a href="#L-132"><span class="linenos">132</span></a>
</span><span id="L-133"><a href="#L-133"><span class="linenos">133</span></a>    <span class="k">def</span> <span class="nf">solve_equations</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x0</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;hybr&#39;</span><span class="p">,</span> <span class="n">jac</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">tol</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="L-134"><a href="#L-134"><span class="linenos">134</span></a>                        <span class="n">callback</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">options</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="L-135"><a href="#L-135"><span class="linenos">135</span></a>
</span><span id="L-136"><a href="#L-136"><span class="linenos">136</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Solve the system of equations of the maximum log-likelihood problem.</span>
</span><span id="L-137"><a href="#L-137"><span class="linenos">137</span></a>
</span><span id="L-138"><a href="#L-138"><span class="linenos">138</span></a><span class="sd">        The system of equations is solved using ``scipy``&#39;s root function with</span>
</span><span id="L-139"><a href="#L-139"><span class="linenos">139</span></a><span class="sd">        the solver defined by ``method``. The solutions correspond to the</span>
</span><span id="L-140"><a href="#L-140"><span class="linenos">140</span></a><span class="sd">        Lagrange multipliers</span>
</span><span id="L-141"><a href="#L-141"><span class="linenos">141</span></a>
</span><span id="L-142"><a href="#L-142"><span class="linenos">142</span></a><span class="sd">        .. math::</span>
</span><span id="L-143"><a href="#L-143"><span class="linenos">143</span></a>
</span><span id="L-144"><a href="#L-144"><span class="linenos">144</span></a><span class="sd">            x_i = \exp(-\\theta_i).</span>
</span><span id="L-145"><a href="#L-145"><span class="linenos">145</span></a>
</span><span id="L-146"><a href="#L-146"><span class="linenos">146</span></a><span class="sd">        Depending on the solver, keyword arguments ``kwargs`` can be passed to</span>
</span><span id="L-147"><a href="#L-147"><span class="linenos">147</span></a><span class="sd">        the solver. Please refer to the `scipy.optimize.root documentation</span>
</span><span id="L-148"><a href="#L-148"><span class="linenos">148</span></a><span class="sd">        &lt;https://docs.scipy.org/doc/scipy-0.19.0/reference/generated/</span>
</span><span id="L-149"><a href="#L-149"><span class="linenos">149</span></a><span class="sd">        scipy.optimize.root.html&gt;`_ for detailed descriptions.</span>
</span><span id="L-150"><a href="#L-150"><span class="linenos">150</span></a>
</span><span id="L-151"><a href="#L-151"><span class="linenos">151</span></a><span class="sd">        The default solver is the modified Powell method ``hybr``. Least-squares</span>
</span><span id="L-152"><a href="#L-152"><span class="linenos">152</span></a><span class="sd">        can be chosen with ``method=&#39;lm&#39;`` for the Levenberg-Marquardt approach.</span>
</span><span id="L-153"><a href="#L-153"><span class="linenos">153</span></a>
</span><span id="L-154"><a href="#L-154"><span class="linenos">154</span></a><span class="sd">        .. note::</span>
</span><span id="L-155"><a href="#L-155"><span class="linenos">155</span></a>
</span><span id="L-156"><a href="#L-156"><span class="linenos">156</span></a><span class="sd">            It can happen that the solver ``method`` used by ``scipy.root``</span>
</span><span id="L-157"><a href="#L-157"><span class="linenos">157</span></a><span class="sd">            does not converge to a solution.</span>
</span><span id="L-158"><a href="#L-158"><span class="linenos">158</span></a><span class="sd">            In this case, please try another ``method`` or different initial</span>
</span><span id="L-159"><a href="#L-159"><span class="linenos">159</span></a><span class="sd">            conditions and refer to the `scipy.optimize.root documentation</span>
</span><span id="L-160"><a href="#L-160"><span class="linenos">160</span></a><span class="sd">            &lt;https://docs.scipy.org/doc/scipy-0.19.0/reference/generated/</span>
</span><span id="L-161"><a href="#L-161"><span class="linenos">161</span></a><span class="sd">            scipy.optimize.root.html&gt;`_.</span>
</span><span id="L-162"><a href="#L-162"><span class="linenos">162</span></a>
</span><span id="L-163"><a href="#L-163"><span class="linenos">163</span></a><span class="sd">        :param x0: initial guesses for the solutions. The first entries are the</span>
</span><span id="L-164"><a href="#L-164"><span class="linenos">164</span></a><span class="sd">            initial guesses for the row-nodes, followed by the initial guesses</span>
</span><span id="L-165"><a href="#L-165"><span class="linenos">165</span></a><span class="sd">            for the column-nodes.</span>
</span><span id="L-166"><a href="#L-166"><span class="linenos">166</span></a><span class="sd">        :type x0: 1d numpy.array, optional</span>
</span><span id="L-167"><a href="#L-167"><span class="linenos">167</span></a><span class="sd">        :param method: type of solver, default is ‘hybr’. For other</span>
</span><span id="L-168"><a href="#L-168"><span class="linenos">168</span></a><span class="sd">            solvers, see the `scipy.optimize.root documentation</span>
</span><span id="L-169"><a href="#L-169"><span class="linenos">169</span></a><span class="sd">            &lt;https://docs.scipy.org/doc/</span>
</span><span id="L-170"><a href="#L-170"><span class="linenos">170</span></a><span class="sd">            scipy-0.19.0/reference/generated/scipy.optimize.root.html&gt;`_.</span>
</span><span id="L-171"><a href="#L-171"><span class="linenos">171</span></a><span class="sd">        :type method: str, optional</span>
</span><span id="L-172"><a href="#L-172"><span class="linenos">172</span></a><span class="sd">        :param jac: Jacobian of the system</span>
</span><span id="L-173"><a href="#L-173"><span class="linenos">173</span></a><span class="sd">        :type jac: bool or callable, optional</span>
</span><span id="L-174"><a href="#L-174"><span class="linenos">174</span></a><span class="sd">        :param tol: tolerance for termination. For detailed control, use</span>
</span><span id="L-175"><a href="#L-175"><span class="linenos">175</span></a><span class="sd">            solver-specific options.</span>
</span><span id="L-176"><a href="#L-176"><span class="linenos">176</span></a><span class="sd">        :type tol: float, optional</span>
</span><span id="L-177"><a href="#L-177"><span class="linenos">177</span></a><span class="sd">        :param callback: optional callback function to be called at</span>
</span><span id="L-178"><a href="#L-178"><span class="linenos">178</span></a><span class="sd">            every iteration as ``callback(self.equations, x)``,</span>
</span><span id="L-179"><a href="#L-179"><span class="linenos">179</span></a><span class="sd">            see ``scipy.root`` documentation</span>
</span><span id="L-180"><a href="#L-180"><span class="linenos">180</span></a><span class="sd">        :type callback: function, optional</span>
</span><span id="L-181"><a href="#L-181"><span class="linenos">181</span></a><span class="sd">        :param options: a dictionary of solver options, e.g. ``xtol`` or</span>
</span><span id="L-182"><a href="#L-182"><span class="linenos">182</span></a><span class="sd">            ``maxiter``, see scipy.root documentation</span>
</span><span id="L-183"><a href="#L-183"><span class="linenos">183</span></a><span class="sd">        :type options: dict, optional</span>
</span><span id="L-184"><a href="#L-184"><span class="linenos">184</span></a><span class="sd">        :param kwargs: solver-specific options, please refer to the SciPy</span>
</span><span id="L-185"><a href="#L-185"><span class="linenos">185</span></a><span class="sd">            documentation</span>
</span><span id="L-186"><a href="#L-186"><span class="linenos">186</span></a><span class="sd">        :returns: solution of the equation system</span>
</span><span id="L-187"><a href="#L-187"><span class="linenos">187</span></a><span class="sd">        :rtype: scipy.optimize.OptimizeResult</span>
</span><span id="L-188"><a href="#L-188"><span class="linenos">188</span></a>
</span><span id="L-189"><a href="#L-189"><span class="linenos">189</span></a><span class="sd">        :raise ValueError: raise an error if not enough initial conditions</span>
</span><span id="L-190"><a href="#L-190"><span class="linenos">190</span></a><span class="sd">            are provided</span>
</span><span id="L-191"><a href="#L-191"><span class="linenos">191</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-192"><a href="#L-192"><span class="linenos">192</span></a>        <span class="c1"># use Jacobian if the hybr solver is chosen</span>
</span><span id="L-193"><a href="#L-193"><span class="linenos">193</span></a>        <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;hybr&#39;</span><span class="p">:</span>
</span><span id="L-194"><a href="#L-194"><span class="linenos">194</span></a>            <span class="n">jac</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">jacobian</span>
</span><span id="L-195"><a href="#L-195"><span class="linenos">195</span></a>
</span><span id="L-196"><a href="#L-196"><span class="linenos">196</span></a>        <span class="c1"># set initial conditions</span>
</span><span id="L-197"><a href="#L-197"><span class="linenos">197</span></a>        <span class="k">if</span> <span class="n">x0</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-198"><a href="#L-198"><span class="linenos">198</span></a>            <span class="n">x0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dseq</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dseq</span><span class="p">))</span>
</span><span id="L-199"><a href="#L-199"><span class="linenos">199</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-200"><a href="#L-200"><span class="linenos">200</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="nb">len</span><span class="p">(</span><span class="n">x0</span><span class="p">)</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">dim</span><span class="p">:</span>
</span><span id="L-201"><a href="#L-201"><span class="linenos">201</span></a>                <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;One initial condition for each parameter is required.&quot;</span>
</span><span id="L-202"><a href="#L-202"><span class="linenos">202</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</span><span id="L-203"><a href="#L-203"><span class="linenos">203</span></a>
</span><span id="L-204"><a href="#L-204"><span class="linenos">204</span></a>        <span class="c1"># solve equation system</span>
</span><span id="L-205"><a href="#L-205"><span class="linenos">205</span></a>        <span class="n">sol</span> <span class="o">=</span> <span class="n">opt</span><span class="o">.</span><span class="n">root</span><span class="p">(</span><span class="n">fun</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">equations</span><span class="p">,</span> <span class="n">x0</span><span class="o">=</span><span class="n">x0</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="n">method</span><span class="p">,</span> <span class="n">jac</span><span class="o">=</span><span class="n">jac</span><span class="p">,</span>
</span><span id="L-206"><a href="#L-206"><span class="linenos">206</span></a>                       <span class="n">tol</span><span class="o">=</span><span class="n">tol</span><span class="p">,</span> <span class="n">options</span><span class="o">=</span><span class="n">options</span><span class="p">,</span> <span class="n">callback</span><span class="o">=</span><span class="n">callback</span><span class="p">)</span>
</span><span id="L-207"><a href="#L-207"><span class="linenos">207</span></a>
</span><span id="L-208"><a href="#L-208"><span class="linenos">208</span></a>        <span class="c1"># check whether system has been solved successfully</span>
</span><span id="L-209"><a href="#L-209"><span class="linenos">209</span></a>        <span class="c1">#print(&quot;Solver successful:&quot;, sol.success)</span>
</span><span id="L-210"><a href="#L-210"><span class="linenos">210</span></a>        <span class="c1">#print sol.message</span>
</span><span id="L-211"><a href="#L-211"><span class="linenos">211</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">sol</span><span class="o">.</span><span class="n">success</span><span class="p">:</span>
</span><span id="L-212"><a href="#L-212"><span class="linenos">212</span></a>            <span class="n">errmsg</span> <span class="o">=</span> <span class="s2">&quot;Try different initial conditions and/or a&quot;</span> <span class="o">+</span> \
</span><span id="L-213"><a href="#L-213"><span class="linenos">213</span></a>                     <span class="s2">&quot;different solver, see documentation at &quot;</span> <span class="o">+</span> \
</span><span id="L-214"><a href="#L-214"><span class="linenos">214</span></a>                     <span class="s2">&quot;https://docs.scipy.org/doc/scipy-0.19.0/reference/&quot;</span> <span class="o">+</span> \
</span><span id="L-215"><a href="#L-215"><span class="linenos">215</span></a>                     <span class="s2">&quot;generated/scipy.optimize.root.html&quot;</span>
</span><span id="L-216"><a href="#L-216"><span class="linenos">216</span></a>
</span><span id="L-217"><a href="#L-217"><span class="linenos">217</span></a>            <span class="c1">#print(errmsg)</span>
</span><span id="L-218"><a href="#L-218"><span class="linenos">218</span></a>        <span class="k">return</span> <span class="n">sol</span>
</span><span id="L-219"><a href="#L-219"><span class="linenos">219</span></a>
</span><span id="L-220"><a href="#L-220"><span class="linenos">220</span></a>    <span class="k">def</span> <span class="nf">equations</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xx</span><span class="p">):</span>
</span><span id="L-221"><a href="#L-221"><span class="linenos">221</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the equations of the log-likelihood maximization problem.</span>
</span><span id="L-222"><a href="#L-222"><span class="linenos">222</span></a>
</span><span id="L-223"><a href="#L-223"><span class="linenos">223</span></a><span class="sd">        Note that the equations for the row-nodes depend only on the</span>
</span><span id="L-224"><a href="#L-224"><span class="linenos">224</span></a><span class="sd">        column-nodes and vice versa, see [Saracco2015]_.</span>
</span><span id="L-225"><a href="#L-225"><span class="linenos">225</span></a>
</span><span id="L-226"><a href="#L-226"><span class="linenos">226</span></a><span class="sd">        :param xx: Lagrange multipliers which have to be solved</span>
</span><span id="L-227"><a href="#L-227"><span class="linenos">227</span></a><span class="sd">        :type xx: numpy.array</span>
</span><span id="L-228"><a href="#L-228"><span class="linenos">228</span></a><span class="sd">        :returns: equations to be solved (:math:`f(x) = 0`)</span>
</span><span id="L-229"><a href="#L-229"><span class="linenos">229</span></a><span class="sd">        :rtype: numpy.array</span>
</span><span id="L-230"><a href="#L-230"><span class="linenos">230</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-231"><a href="#L-231"><span class="linenos">231</span></a>        <span class="n">eq</span> <span class="o">=</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">dseq</span>
</span><span id="L-232"><a href="#L-232"><span class="linenos">232</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_rows</span><span class="p">):</span>
</span><span id="L-233"><a href="#L-233"><span class="linenos">233</span></a>            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_rows</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dim</span><span class="p">):</span>
</span><span id="L-234"><a href="#L-234"><span class="linenos">234</span></a>                <span class="n">dum</span> <span class="o">=</span> <span class="n">xx</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">xx</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">/</span> <span class="p">(</span><span class="mf">1.</span> <span class="o">+</span> <span class="n">xx</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">xx</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>
</span><span id="L-235"><a href="#L-235"><span class="linenos">235</span></a>                <span class="n">eq</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+=</span> <span class="n">dum</span>
</span><span id="L-236"><a href="#L-236"><span class="linenos">236</span></a>                <span class="n">eq</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">+=</span> <span class="n">dum</span>
</span><span id="L-237"><a href="#L-237"><span class="linenos">237</span></a>        <span class="k">return</span> <span class="n">eq</span>
</span><span id="L-238"><a href="#L-238"><span class="linenos">238</span></a>
</span><span id="L-239"><a href="#L-239"><span class="linenos">239</span></a>    <span class="k">def</span> <span class="nf">jacobian</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xx</span><span class="p">):</span>
</span><span id="L-240"><a href="#L-240"><span class="linenos">240</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Return a NumPy array with the Jacobian of the equation system.</span>
</span><span id="L-241"><a href="#L-241"><span class="linenos">241</span></a>
</span><span id="L-242"><a href="#L-242"><span class="linenos">242</span></a><span class="sd">        :param xx: Lagrange multipliers which have to be solved</span>
</span><span id="L-243"><a href="#L-243"><span class="linenos">243</span></a><span class="sd">        :type xx: numpy.array</span>
</span><span id="L-244"><a href="#L-244"><span class="linenos">244</span></a><span class="sd">        :returns: Jacobian</span>
</span><span id="L-245"><a href="#L-245"><span class="linenos">245</span></a><span class="sd">        :rtype: numpy.array</span>
</span><span id="L-246"><a href="#L-246"><span class="linenos">246</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-247"><a href="#L-247"><span class="linenos">247</span></a>        <span class="n">jac</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">dim</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dim</span><span class="p">))</span>
</span><span id="L-248"><a href="#L-248"><span class="linenos">248</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_rows</span><span class="p">):</span>
</span><span id="L-249"><a href="#L-249"><span class="linenos">249</span></a>            <span class="c1"># df_c / df_c&#39; = 0 for all c&#39; != c</span>
</span><span id="L-250"><a href="#L-250"><span class="linenos">250</span></a>            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_rows</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dim</span><span class="p">):</span>
</span><span id="L-251"><a href="#L-251"><span class="linenos">251</span></a>                <span class="c1"># df_c / dx_c != 0</span>
</span><span id="L-252"><a href="#L-252"><span class="linenos">252</span></a>                <span class="n">xxi</span> <span class="o">=</span> <span class="n">xx</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">/</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">+</span> <span class="n">xx</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">xx</span><span class="p">[</span><span class="n">j</span><span class="p">])</span> <span class="o">**</span> <span class="mi">2</span>
</span><span id="L-253"><a href="#L-253"><span class="linenos">253</span></a>                <span class="n">xxj</span> <span class="o">=</span> <span class="n">xx</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">/</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">+</span> <span class="n">xx</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">xx</span><span class="p">[</span><span class="n">j</span><span class="p">])</span> <span class="o">**</span> <span class="mi">2</span>
</span><span id="L-254"><a href="#L-254"><span class="linenos">254</span></a>                <span class="n">jac</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">+=</span> <span class="n">xxj</span>
</span><span id="L-255"><a href="#L-255"><span class="linenos">255</span></a>                <span class="n">jac</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">xxi</span>
</span><span id="L-256"><a href="#L-256"><span class="linenos">256</span></a>                <span class="n">jac</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">xxj</span>
</span><span id="L-257"><a href="#L-257"><span class="linenos">257</span></a>                <span class="n">jac</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">+=</span> <span class="n">xxi</span>
</span><span id="L-258"><a href="#L-258"><span class="linenos">258</span></a>        <span class="k">return</span> <span class="n">jac</span>
</span><span id="L-259"><a href="#L-259"><span class="linenos">259</span></a>
</span><span id="L-260"><a href="#L-260"><span class="linenos">260</span></a>    <span class="k">def</span> <span class="nf">get_biadjacency_matrix</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xx</span><span class="p">):</span>
</span><span id="L-261"><a href="#L-261"><span class="linenos">261</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot; Calculate the biadjacency matrix of the null model.</span>
</span><span id="L-262"><a href="#L-262"><span class="linenos">262</span></a>
</span><span id="L-263"><a href="#L-263"><span class="linenos">263</span></a><span class="sd">        The biadjacency matrix describes the BiCM null model, i.e. the optimal</span>
</span><span id="L-264"><a href="#L-264"><span class="linenos">264</span></a><span class="sd">        average graph :math:`&lt;G&gt;^*` with the average link probabilities</span>
</span><span id="L-265"><a href="#L-265"><span class="linenos">265</span></a><span class="sd">        :math:`&lt;G&gt;^*_{rc} = p_{rc}` ,</span>
</span><span id="L-266"><a href="#L-266"><span class="linenos">266</span></a><span class="sd">        :math:`p_{rc} = \\frac{x_r \\cdot x_c}{1 + x_r\\cdot x_c}.`</span>
</span><span id="L-267"><a href="#L-267"><span class="linenos">267</span></a><span class="sd">        :math:`x` are the solutions of the equation system which has to be</span>
</span><span id="L-268"><a href="#L-268"><span class="linenos">268</span></a><span class="sd">        solved for the null model.</span>
</span><span id="L-269"><a href="#L-269"><span class="linenos">269</span></a><span class="sd">        Note that :math:`r` and :math:`c` are taken from opposite bipartite</span>
</span><span id="L-270"><a href="#L-270"><span class="linenos">270</span></a><span class="sd">        node sets, thus :math:`r \\neq c`.</span>
</span><span id="L-271"><a href="#L-271"><span class="linenos">271</span></a>
</span><span id="L-272"><a href="#L-272"><span class="linenos">272</span></a><span class="sd">        :param xx: solutions of the equation system (Lagrange multipliers)</span>
</span><span id="L-273"><a href="#L-273"><span class="linenos">273</span></a><span class="sd">        :type xx: numpy.array</span>
</span><span id="L-274"><a href="#L-274"><span class="linenos">274</span></a><span class="sd">        :returns: biadjacency matrix of the null model</span>
</span><span id="L-275"><a href="#L-275"><span class="linenos">275</span></a><span class="sd">        :rtype: numpy.array</span>
</span><span id="L-276"><a href="#L-276"><span class="linenos">276</span></a>
</span><span id="L-277"><a href="#L-277"><span class="linenos">277</span></a><span class="sd">        :raises ValueError: raise an error if :math:`p_{rc} &lt; 0` or</span>
</span><span id="L-278"><a href="#L-278"><span class="linenos">278</span></a><span class="sd">            :math:`p_{rc} &gt; 1` for any :math:`r, c`</span>
</span><span id="L-279"><a href="#L-279"><span class="linenos">279</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-280"><a href="#L-280"><span class="linenos">280</span></a>        <span class="n">mat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">num_rows</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_columns</span><span class="p">))</span>
</span><span id="L-281"><a href="#L-281"><span class="linenos">281</span></a>        <span class="n">xp</span> <span class="o">=</span> <span class="n">xx</span><span class="p">[</span><span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_rows</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dim</span><span class="p">)]</span>
</span><span id="L-282"><a href="#L-282"><span class="linenos">282</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_rows</span><span class="p">):</span>
</span><span id="L-283"><a href="#L-283"><span class="linenos">283</span></a>            <span class="n">mat</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">]</span> <span class="o">=</span> <span class="n">xx</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">xp</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">xx</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">xp</span><span class="p">)</span>
</span><span id="L-284"><a href="#L-284"><span class="linenos">284</span></a>
</span><span id="L-285"><a href="#L-285"><span class="linenos">285</span></a>        <span class="c1"># account for machine precision:</span>
</span><span id="L-286"><a href="#L-286"><span class="linenos">286</span></a>        <span class="n">mat</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">finfo</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span><span class="o">.</span><span class="n">eps</span>
</span><span id="L-287"><a href="#L-287"><span class="linenos">287</span></a>
</span><span id="L-288"><a href="#L-288"><span class="linenos">288</span></a>        <span class="c1">#print(&#39;matrix debug:&#39;)</span>
</span><span id="L-289"><a href="#L-289"><span class="linenos">289</span></a>        <span class="c1">#for r in mat:</span>
</span><span id="L-290"><a href="#L-290"><span class="linenos">290</span></a>        <span class="c1">#    print(r)</span>
</span><span id="L-291"><a href="#L-291"><span class="linenos">291</span></a>
</span><span id="L-292"><a href="#L-292"><span class="linenos">292</span></a>        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">mat</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">):</span>
</span><span id="L-293"><a href="#L-293"><span class="linenos">293</span></a>            <span class="n">errmsg</span> <span class="o">=</span> <span class="s1">&#39;Error in get_adjacency_matrix: probabilities &lt; 0 in &#39;</span> \
</span><span id="L-294"><a href="#L-294"><span class="linenos">294</span></a>                  <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">mat</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">))</span>
</span><span id="L-295"><a href="#L-295"><span class="linenos">295</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">errmsg</span><span class="p">)</span>
</span><span id="L-296"><a href="#L-296"><span class="linenos">296</span></a>        <span class="k">elif</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">mat</span> <span class="o">&gt;</span> <span class="p">(</span><span class="mf">1.</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">finfo</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span><span class="o">.</span><span class="n">eps</span><span class="p">)):</span>
</span><span id="L-297"><a href="#L-297"><span class="linenos">297</span></a>            <span class="n">errmsg</span> <span class="o">=</span> <span class="s1">&#39;Error in get_adjacency_matrix: probabilities &gt; 1 in&#39;</span> \
</span><span id="L-298"><a href="#L-298"><span class="linenos">298</span></a>                  <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">mat</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">))</span>
</span><span id="L-299"><a href="#L-299"><span class="linenos">299</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">errmsg</span><span class="p">)</span>
</span><span id="L-300"><a href="#L-300"><span class="linenos">300</span></a>        <span class="k">assert</span> <span class="n">mat</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">bin_mat</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> \
</span><span id="L-301"><a href="#L-301"><span class="linenos">301</span></a>            <span class="s2">&quot;Biadjacency matrix has wrong dimensions.&quot;</span>
</span><span id="L-302"><a href="#L-302"><span class="linenos">302</span></a>        <span class="k">return</span> <span class="n">mat</span>
</span><span id="L-303"><a href="#L-303"><span class="linenos">303</span></a>
</span><span id="L-304"><a href="#L-304"><span class="linenos">304</span></a><span class="c1"># ------------------------------------------------------------------------------</span>
</span><span id="L-305"><a href="#L-305"><span class="linenos">305</span></a><span class="c1"># Test correctness of results:</span>
</span><span id="L-306"><a href="#L-306"><span class="linenos">306</span></a><span class="c1"># ------------------------------------------------------------------------------</span>
</span><span id="L-307"><a href="#L-307"><span class="linenos">307</span></a>
</span><span id="L-308"><a href="#L-308"><span class="linenos">308</span></a>    <span class="k">def</span> <span class="nf">print_max_degree_differences</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-309"><a href="#L-309"><span class="linenos">309</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Print the maximal differences between input network and BiCM degrees.</span>
</span><span id="L-310"><a href="#L-310"><span class="linenos">310</span></a>
</span><span id="L-311"><a href="#L-311"><span class="linenos">311</span></a><span class="sd">        Check that the degree sequence of the solved BiCM null model graph</span>
</span><span id="L-312"><a href="#L-312"><span class="linenos">312</span></a><span class="sd">        corresponds to the degree sequence of the input graph.</span>
</span><span id="L-313"><a href="#L-313"><span class="linenos">313</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-314"><a href="#L-314"><span class="linenos">314</span></a>        <span class="n">ave_deg_columns</span> <span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">adj_matrix</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span><span id="L-315"><a href="#L-315"><span class="linenos">315</span></a>        <span class="n">ave_deg_rows</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">adj_matrix</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="L-316"><a href="#L-316"><span class="linenos">316</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Maximal degree differences between data and BiCM:&quot;</span><span class="p">)</span>
</span><span id="L-317"><a href="#L-317"><span class="linenos">317</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Columns:&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span>
</span><span id="L-318"><a href="#L-318"><span class="linenos">318</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">dseq</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">num_rows</span><span class="p">:]</span> <span class="o">-</span> <span class="n">ave_deg_columns</span><span class="p">)))</span>
</span><span id="L-319"><a href="#L-319"><span class="linenos">319</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Rows:&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span>
</span><span id="L-320"><a href="#L-320"><span class="linenos">320</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">dseq</span><span class="p">[:</span><span class="bp">self</span><span class="o">.</span><span class="n">num_rows</span><span class="p">]</span> <span class="o">-</span> <span class="n">ave_deg_rows</span><span class="p">)))</span>
</span><span id="L-321"><a href="#L-321"><span class="linenos">321</span></a>
</span><span id="L-322"><a href="#L-322"><span class="linenos">322</span></a>    <span class="k">def</span> <span class="nf">test_average_degrees</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">eps</span><span class="o">=</span><span class="mf">1e-2</span><span class="p">):</span>
</span><span id="L-323"><a href="#L-323"><span class="linenos">323</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Test the constraints on the node degrees.</span>
</span><span id="L-324"><a href="#L-324"><span class="linenos">324</span></a>
</span><span id="L-325"><a href="#L-325"><span class="linenos">325</span></a><span class="sd">        Check that the degree sequence of the solved BiCM null model graph</span>
</span><span id="L-326"><a href="#L-326"><span class="linenos">326</span></a><span class="sd">        corresponds to the degree sequence of the input graph.</span>
</span><span id="L-327"><a href="#L-327"><span class="linenos">327</span></a>
</span><span id="L-328"><a href="#L-328"><span class="linenos">328</span></a><span class="sd">        :param eps: maximum difference between degrees of the real network</span>
</span><span id="L-329"><a href="#L-329"><span class="linenos">329</span></a><span class="sd">            and the BiCM</span>
</span><span id="L-330"><a href="#L-330"><span class="linenos">330</span></a><span class="sd">        :type eps: float</span>
</span><span id="L-331"><a href="#L-331"><span class="linenos">331</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-332"><a href="#L-332"><span class="linenos">332</span></a>        <span class="n">ave_deg_columns</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">adj_matrix</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>
</span><span id="L-333"><a href="#L-333"><span class="linenos">333</span></a>        <span class="n">ave_deg_rows</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">adj_matrix</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
</span><span id="L-334"><a href="#L-334"><span class="linenos">334</span></a>        <span class="n">c_derr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">logical_or</span><span class="p">(</span>
</span><span id="L-335"><a href="#L-335"><span class="linenos">335</span></a>            <span class="c1"># average degree too small:</span>
</span><span id="L-336"><a href="#L-336"><span class="linenos">336</span></a>            <span class="n">ave_deg_rows</span> <span class="o">+</span> <span class="n">eps</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">dseq</span><span class="p">[:</span><span class="bp">self</span><span class="o">.</span><span class="n">num_rows</span><span class="p">],</span>
</span><span id="L-337"><a href="#L-337"><span class="linenos">337</span></a>            <span class="c1"># average degree too large:</span>
</span><span id="L-338"><a href="#L-338"><span class="linenos">338</span></a>            <span class="n">ave_deg_rows</span> <span class="o">-</span> <span class="n">eps</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">dseq</span><span class="p">[:</span><span class="bp">self</span><span class="o">.</span><span class="n">num_rows</span><span class="p">]))</span>
</span><span id="L-339"><a href="#L-339"><span class="linenos">339</span></a>        <span class="n">p_derr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">logical_or</span><span class="p">(</span>
</span><span id="L-340"><a href="#L-340"><span class="linenos">340</span></a>            <span class="n">ave_deg_columns</span> <span class="o">+</span> <span class="n">eps</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">dseq</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">num_rows</span><span class="p">:],</span>
</span><span id="L-341"><a href="#L-341"><span class="linenos">341</span></a>            <span class="n">ave_deg_columns</span> <span class="o">-</span> <span class="n">eps</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">dseq</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">num_rows</span><span class="p">:]))</span>
</span><span id="L-342"><a href="#L-342"><span class="linenos">342</span></a>        <span class="c1"># Check row-nodes degrees:</span>
</span><span id="L-343"><a href="#L-343"><span class="linenos">343</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">array_equiv</span><span class="p">(</span><span class="n">c_derr</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])):</span>
</span><span id="L-344"><a href="#L-344"><span class="linenos">344</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;...inaccurate row-nodes degrees:&#39;</span><span class="p">)</span>
</span><span id="L-345"><a href="#L-345"><span class="linenos">345</span></a>            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">c_derr</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
</span><span id="L-346"><a href="#L-346"><span class="linenos">346</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Row-node &#39;</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
</span><span id="L-347"><a href="#L-347"><span class="linenos">347</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;input: </span><span class="si">{}</span><span class="s1">, avg </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dseq</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">ave_deg_rows</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
</span><span id="L-348"><a href="#L-348"><span class="linenos">348</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span><span id="L-349"><a href="#L-349"><span class="linenos">349</span></a>        <span class="c1"># Check column-nodes degrees:</span>
</span><span id="L-350"><a href="#L-350"><span class="linenos">350</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">array_equiv</span><span class="p">(</span><span class="n">p_derr</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])):</span>
</span><span id="L-351"><a href="#L-351"><span class="linenos">351</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;...inaccurate column-nodes degrees:&#39;</span><span class="p">)</span>
</span><span id="L-352"><a href="#L-352"><span class="linenos">352</span></a>            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">c_derr</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
</span><span id="L-353"><a href="#L-353"><span class="linenos">353</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Column-node &#39;</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
</span><span id="L-354"><a href="#L-354"><span class="linenos">354</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;input: </span><span class="si">{}</span><span class="s1">, avg </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dseq</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_rows</span><span class="p">],</span> <span class="n">ave_deg_columns</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
</span><span id="L-355"><a href="#L-355"><span class="linenos">355</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span><span id="L-356"><a href="#L-356"><span class="linenos">356</span></a>        <span class="k">return</span> <span class="kc">True</span>
</span><span id="L-357"><a href="#L-357"><span class="linenos">357</span></a>
</span><span id="L-358"><a href="#L-358"><span class="linenos">358</span></a><span class="c1"># ------------------------------------------------------------------------------</span>
</span><span id="L-359"><a href="#L-359"><span class="linenos">359</span></a><span class="c1"># Lambda motifs</span>
</span><span id="L-360"><a href="#L-360"><span class="linenos">360</span></a><span class="c1"># ------------------------------------------------------------------------------</span>
</span><span id="L-361"><a href="#L-361"><span class="linenos">361</span></a>
</span><span id="L-362"><a href="#L-362"><span class="linenos">362</span></a>    <span class="k">def</span> <span class="nf">lambda_motifs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bip_set</span><span class="p">,</span> <span class="n">parallel</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="L-363"><a href="#L-363"><span class="linenos">363</span></a>            <span class="n">delim</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">binary</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">num_chunks</span><span class="o">=</span><span class="mi">4</span><span class="p">):</span>
</span><span id="L-364"><a href="#L-364"><span class="linenos">364</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Calculate and save the p-values of the :math:`\\Lambda`-motifs.</span>
</span><span id="L-365"><a href="#L-365"><span class="linenos">365</span></a>
</span><span id="L-366"><a href="#L-366"><span class="linenos">366</span></a><span class="sd">        For each node couple in the bipartite layer specified by ``bip_set``,</span>
</span><span id="L-367"><a href="#L-367"><span class="linenos">367</span></a><span class="sd">        calculate the p-values of the corresponding :math:`\\Lambda`-motifs</span>
</span><span id="L-368"><a href="#L-368"><span class="linenos">368</span></a><span class="sd">        according to the link probabilities in the biadjacency matrix of the</span>
</span><span id="L-369"><a href="#L-369"><span class="linenos">369</span></a><span class="sd">        BiCM null model.</span>
</span><span id="L-370"><a href="#L-370"><span class="linenos">370</span></a>
</span><span id="L-371"><a href="#L-371"><span class="linenos">371</span></a><span class="sd">        The results can be saved either as a binary ``.npy`` or a</span>
</span><span id="L-372"><a href="#L-372"><span class="linenos">372</span></a><span class="sd">        human-readable ``.csv`` file, depending on ``binary``.</span>
</span><span id="L-373"><a href="#L-373"><span class="linenos">373</span></a>
</span><span id="L-374"><a href="#L-374"><span class="linenos">374</span></a><span class="sd">        .. note::</span>
</span><span id="L-375"><a href="#L-375"><span class="linenos">375</span></a>
</span><span id="L-376"><a href="#L-376"><span class="linenos">376</span></a><span class="sd">            * The total number of p-values that are calculated is split into</span>
</span><span id="L-377"><a href="#L-377"><span class="linenos">377</span></a><span class="sd">              ``num_chunks`` chunks, which are processed sequentially in order</span>
</span><span id="L-378"><a href="#L-378"><span class="linenos">378</span></a><span class="sd">              to avoid memory allocation errors. Note that a larger value of</span>
</span><span id="L-379"><a href="#L-379"><span class="linenos">379</span></a><span class="sd">              ``num_chunks`` will lead to less memory occupation, but comes at</span>
</span><span id="L-380"><a href="#L-380"><span class="linenos">380</span></a><span class="sd">              the cost of slower processing speed.</span>
</span><span id="L-381"><a href="#L-381"><span class="linenos">381</span></a>
</span><span id="L-382"><a href="#L-382"><span class="linenos">382</span></a><span class="sd">            * The output consists of a one-dimensional array of p-values. If</span>
</span><span id="L-383"><a href="#L-383"><span class="linenos">383</span></a><span class="sd">              the bipartite layer ``bip_set`` contains ``n`` nodes, this means</span>
</span><span id="L-384"><a href="#L-384"><span class="linenos">384</span></a><span class="sd">              that the array will contain :math:`\\binom{n}{2}` entries. The</span>
</span><span id="L-385"><a href="#L-385"><span class="linenos">385</span></a><span class="sd">              indices ``(i, j)`` of the nodes corresponding to entry ``k`` in</span>
</span><span id="L-386"><a href="#L-386"><span class="linenos">386</span></a><span class="sd">              the array can be reconstructed using the method</span>
</span><span id="L-387"><a href="#L-387"><span class="linenos">387</span></a><span class="sd">              :func:`BiCM.flat2_triumat_idx`. The number of nodes ``n``</span>
</span><span id="L-388"><a href="#L-388"><span class="linenos">388</span></a><span class="sd">              can be recovered from the length of the array with</span>
</span><span id="L-389"><a href="#L-389"><span class="linenos">389</span></a><span class="sd">              :func:`BiCM.flat2_triumat_dim`</span>
</span><span id="L-390"><a href="#L-390"><span class="linenos">390</span></a>
</span><span id="L-391"><a href="#L-391"><span class="linenos">391</span></a><span class="sd">            * If ``binary == False``, the ``filename`` should end with</span>
</span><span id="L-392"><a href="#L-392"><span class="linenos">392</span></a><span class="sd">              ``.csv``. If ``binary == True``, it will be saved in binary NumPy</span>
</span><span id="L-393"><a href="#L-393"><span class="linenos">393</span></a><span class="sd">              ``.npy`` format and the suffix ``.npy`` will be appended</span>
</span><span id="L-394"><a href="#L-394"><span class="linenos">394</span></a><span class="sd">              automatically. By default, the file is saved in binary format.</span>
</span><span id="L-395"><a href="#L-395"><span class="linenos">395</span></a>
</span><span id="L-396"><a href="#L-396"><span class="linenos">396</span></a><span class="sd">        :param bip_set: select row-nodes (``True``) or column-nodes (``False``)</span>
</span><span id="L-397"><a href="#L-397"><span class="linenos">397</span></a><span class="sd">        :type bip_set: bool</span>
</span><span id="L-398"><a href="#L-398"><span class="linenos">398</span></a><span class="sd">        :param parallel: select whether the calculation of the p-values should</span>
</span><span id="L-399"><a href="#L-399"><span class="linenos">399</span></a><span class="sd">            be run in parallel (``True``) or not (``False``)</span>
</span><span id="L-400"><a href="#L-400"><span class="linenos">400</span></a><span class="sd">        :type parallel: bool</span>
</span><span id="L-401"><a href="#L-401"><span class="linenos">401</span></a><span class="sd">        :param filename: name of the output file</span>
</span><span id="L-402"><a href="#L-402"><span class="linenos">402</span></a><span class="sd">        :type filename: str</span>
</span><span id="L-403"><a href="#L-403"><span class="linenos">403</span></a><span class="sd">        :param delim: delimiter between entries in the ``.csv``file, default is</span>
</span><span id="L-404"><a href="#L-404"><span class="linenos">404</span></a><span class="sd">            ``\\t``</span>
</span><span id="L-405"><a href="#L-405"><span class="linenos">405</span></a><span class="sd">        :type delim: str</span>
</span><span id="L-406"><a href="#L-406"><span class="linenos">406</span></a><span class="sd">        :param binary: if ``True``, the file will be saved in the binary</span>
</span><span id="L-407"><a href="#L-407"><span class="linenos">407</span></a><span class="sd">            NumPy format ``.npy``, otherwise as ``.csv``</span>
</span><span id="L-408"><a href="#L-408"><span class="linenos">408</span></a><span class="sd">        :type binary: bool</span>
</span><span id="L-409"><a href="#L-409"><span class="linenos">409</span></a><span class="sd">        :param num_chunks: number of chunks of p-value calculations that are</span>
</span><span id="L-410"><a href="#L-410"><span class="linenos">410</span></a><span class="sd">            performed sequentially</span>
</span><span id="L-411"><a href="#L-411"><span class="linenos">411</span></a><span class="sd">        :type num_chunks: int</span>
</span><span id="L-412"><a href="#L-412"><span class="linenos">412</span></a><span class="sd">        :raise ValueError: raise an error if the parameter ``bip_set`` is</span>
</span><span id="L-413"><a href="#L-413"><span class="linenos">413</span></a><span class="sd">            neither ``True`` nor ``False``</span>
</span><span id="L-414"><a href="#L-414"><span class="linenos">414</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-415"><a href="#L-415"><span class="linenos">415</span></a>        <span class="k">if</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">bip_set</span><span class="p">)</span> <span class="o">==</span> <span class="nb">bool</span><span class="p">)</span> <span class="ow">and</span> <span class="n">bip_set</span><span class="p">:</span>
</span><span id="L-416"><a href="#L-416"><span class="linenos">416</span></a>            <span class="n">biad_mat</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">adj_matrix</span>
</span><span id="L-417"><a href="#L-417"><span class="linenos">417</span></a>            <span class="n">bin_mat</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bin_mat</span>
</span><span id="L-418"><a href="#L-418"><span class="linenos">418</span></a>        <span class="k">elif</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">bip_set</span><span class="p">)</span> <span class="o">==</span> <span class="nb">bool</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">bip_set</span><span class="p">:</span>
</span><span id="L-419"><a href="#L-419"><span class="linenos">419</span></a>            <span class="n">biad_mat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">adj_matrix</span><span class="p">)</span>
</span><span id="L-420"><a href="#L-420"><span class="linenos">420</span></a>            <span class="n">bin_mat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bin_mat</span><span class="p">)</span>
</span><span id="L-421"><a href="#L-421"><span class="linenos">421</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-422"><a href="#L-422"><span class="linenos">422</span></a>            <span class="n">errmsg</span> <span class="o">=</span> <span class="s2">&quot;&#39;&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">bip_set</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&#39; &quot;</span> <span class="o">+</span> <span class="s1">&#39;not supported.&#39;</span>
</span><span id="L-423"><a href="#L-423"><span class="linenos">423</span></a>            <span class="k">raise</span> <span class="ne">NameError</span><span class="p">(</span><span class="n">errmsg</span><span class="p">)</span>
</span><span id="L-424"><a href="#L-424"><span class="linenos">424</span></a>
</span><span id="L-425"><a href="#L-425"><span class="linenos">425</span></a>        <span class="n">n</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_triup_dim</span><span class="p">(</span><span class="n">bip_set</span><span class="p">))</span> <span class="c1"># n. pairs..</span>
</span><span id="L-426"><a href="#L-426"><span class="linenos">426</span></a>        <span class="n">pval</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;float&#39;</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mf">0.1</span><span class="p">)</span>
</span><span id="L-427"><a href="#L-427"><span class="linenos">427</span></a>
</span><span id="L-428"><a href="#L-428"><span class="linenos">428</span></a>
</span><span id="L-429"><a href="#L-429"><span class="linenos">429</span></a>        <span class="c1"># handle layers of dimension 2 separately</span>
</span><span id="L-430"><a href="#L-430"><span class="linenos">430</span></a>        <span class="k">if</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="L-431"><a href="#L-431"><span class="linenos">431</span></a>            <span class="n">nlam</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">bin_mat</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:],</span> <span class="n">bin_mat</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
</span><span id="L-432"><a href="#L-432"><span class="linenos">432</span></a>            <span class="n">plam</span> <span class="o">=</span> <span class="n">biad_mat</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]</span> <span class="o">*</span> <span class="n">biad_mat</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span>
</span><span id="L-433"><a href="#L-433"><span class="linenos">433</span></a>            <span class="n">pb</span> <span class="o">=</span> <span class="n">PoiBin</span><span class="p">(</span><span class="n">plam</span><span class="p">)</span>
</span><span id="L-434"><a href="#L-434"><span class="linenos">434</span></a>            <span class="n">pval</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">pb</span><span class="o">.</span><span class="n">pval</span><span class="p">(</span><span class="n">nlam</span><span class="p">)</span>
</span><span id="L-435"><a href="#L-435"><span class="linenos">435</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-436"><a href="#L-436"><span class="linenos">436</span></a>            <span class="c1"># if the dimension of the network is too large, split the</span>
</span><span id="L-437"><a href="#L-437"><span class="linenos">437</span></a>            <span class="c1"># calculations # of the p-values in ``m`` intervals to avoid memory</span>
</span><span id="L-438"><a href="#L-438"><span class="linenos">438</span></a>            <span class="c1"># allocation errors</span>
</span><span id="L-439"><a href="#L-439"><span class="linenos">439</span></a>
</span><span id="L-440"><a href="#L-440"><span class="linenos">440</span></a>            <span class="c1"># correced - never bother with splitting for now</span>
</span><span id="L-441"><a href="#L-441"><span class="linenos">441</span></a>            <span class="k">if</span> <span class="n">n</span> <span class="o">&gt;</span> <span class="mi">100000</span><span class="p">:</span>
</span><span id="L-442"><a href="#L-442"><span class="linenos">442</span></a>                <span class="n">kk</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">split_range</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">m</span><span class="o">=</span><span class="n">num_chunks</span><span class="p">)</span>
</span><span id="L-443"><a href="#L-443"><span class="linenos">443</span></a>
</span><span id="L-444"><a href="#L-444"><span class="linenos">444</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-445"><a href="#L-445"><span class="linenos">445</span></a>                <span class="n">k1</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-446"><a href="#L-446"><span class="linenos">446</span></a>                <span class="n">k2</span> <span class="o">=</span> <span class="n">n</span>
</span><span id="L-447"><a href="#L-447"><span class="linenos">447</span></a>                <span class="n">nlam</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_lambda_motif_block</span><span class="p">(</span><span class="n">bin_mat</span><span class="p">,</span> <span class="n">k1</span><span class="p">,</span> <span class="n">k2</span><span class="p">)</span>
</span><span id="L-448"><a href="#L-448"><span class="linenos">448</span></a>                <span class="n">plam</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_plambda_block</span><span class="p">(</span><span class="n">biad_mat</span><span class="p">,</span> <span class="n">k1</span><span class="p">,</span> <span class="n">k2</span><span class="p">)</span>
</span><span id="L-449"><a href="#L-449"><span class="linenos">449</span></a>
</span><span id="L-450"><a href="#L-450"><span class="linenos">450</span></a>                <span class="n">pv</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_pvalues_q</span><span class="p">(</span><span class="n">plam</span><span class="p">,</span> <span class="n">nlam</span><span class="p">,</span> <span class="n">k1</span><span class="p">,</span> <span class="n">k2</span><span class="p">)</span>
</span><span id="L-451"><a href="#L-451"><span class="linenos">451</span></a>                <span class="c1">#print(&#39;p values found:&#39;)</span>
</span><span id="L-452"><a href="#L-452"><span class="linenos">452</span></a>                <span class="c1">#print(pv)</span>
</span><span id="L-453"><a href="#L-453"><span class="linenos">453</span></a>                <span class="n">pval</span><span class="p">[</span><span class="n">k1</span><span class="p">:]</span> <span class="o">=</span> <span class="n">pv</span>
</span><span id="L-454"><a href="#L-454"><span class="linenos">454</span></a>
</span><span id="L-455"><a href="#L-455"><span class="linenos">455</span></a>            <span class="c1">#print(&#39;pvals before:&#39;)</span>
</span><span id="L-456"><a href="#L-456"><span class="linenos">456</span></a>            <span class="c1">#print(pval)</span>
</span><span id="L-457"><a href="#L-457"><span class="linenos">457</span></a>
</span><span id="L-458"><a href="#L-458"><span class="linenos">458</span></a>            <span class="c1">## last interval</span>
</span><span id="L-459"><a href="#L-459"><span class="linenos">459</span></a>            <span class="c1">#k1 = kk[len(kk) - 1]</span>
</span><span id="L-460"><a href="#L-460"><span class="linenos">460</span></a>            <span class="c1">#k2 = n - 1</span>
</span><span id="L-461"><a href="#L-461"><span class="linenos">461</span></a>            <span class="c1">#nlam = self.get_lambda_motif_block(bin_mat, k1, k2)</span>
</span><span id="L-462"><a href="#L-462"><span class="linenos">462</span></a>            <span class="c1">#plam = self.get_plambda_block(biad_mat, k1, k2)</span>
</span><span id="L-463"><a href="#L-463"><span class="linenos">463</span></a>
</span><span id="L-464"><a href="#L-464"><span class="linenos">464</span></a>            <span class="c1"># for the last entry we have to INCLUDE k2, thus k2 + 1</span>
</span><span id="L-465"><a href="#L-465"><span class="linenos">465</span></a>            <span class="c1">#pv = self.get_pvalues_q(plam, nlam, k1, k2 + 1)</span>
</span><span id="L-466"><a href="#L-466"><span class="linenos">466</span></a>            <span class="c1">#pval[k1:] = pv</span>
</span><span id="L-467"><a href="#L-467"><span class="linenos">467</span></a>
</span><span id="L-468"><a href="#L-468"><span class="linenos">468</span></a>        <span class="c1"># check that all p-values have been calculated</span>
</span><span id="L-469"><a href="#L-469"><span class="linenos">469</span></a><span class="c1">#        assert np.all(pval &gt;= 0) and np.all(pval &lt;= 1)</span>
</span><span id="L-470"><a href="#L-470"><span class="linenos">470</span></a>        <span class="k">if</span> <span class="n">filename</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-471"><a href="#L-471"><span class="linenos">471</span></a>            <span class="n">fname</span> <span class="o">=</span> <span class="s1">&#39;p_values_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">bip_set</span><span class="p">)</span>
</span><span id="L-472"><a href="#L-472"><span class="linenos">472</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">binary</span><span class="p">:</span>
</span><span id="L-473"><a href="#L-473"><span class="linenos">473</span></a>                <span class="n">fname</span> <span class="o">+=</span>  <span class="s1">&#39;.csv&#39;</span>
</span><span id="L-474"><a href="#L-474"><span class="linenos">474</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-475"><a href="#L-475"><span class="linenos">475</span></a>            <span class="n">fname</span> <span class="o">=</span> <span class="n">filename</span>
</span><span id="L-476"><a href="#L-476"><span class="linenos">476</span></a>
</span><span id="L-477"><a href="#L-477"><span class="linenos">477</span></a>        <span class="c1"># account for machine precision:</span>
</span><span id="L-478"><a href="#L-478"><span class="linenos">478</span></a>        <span class="n">pval</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">finfo</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span><span class="o">.</span><span class="n">eps</span>
</span><span id="L-479"><a href="#L-479"><span class="linenos">479</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">save_array</span><span class="p">(</span><span class="n">pval</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="n">fname</span><span class="p">,</span> <span class="n">delim</span><span class="o">=</span><span class="n">delim</span><span class="p">,</span>
</span><span id="L-480"><a href="#L-480"><span class="linenos">480</span></a>                         <span class="n">binary</span><span class="o">=</span><span class="n">binary</span><span class="p">)</span>
</span><span id="L-481"><a href="#L-481"><span class="linenos">481</span></a>
</span><span id="L-482"><a href="#L-482"><span class="linenos">482</span></a>    <span class="k">def</span> <span class="nf">get_lambda_motif_block</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mm</span><span class="p">,</span> <span class="n">k1</span><span class="p">,</span> <span class="n">k2</span><span class="p">):</span>
</span><span id="L-483"><a href="#L-483"><span class="linenos">483</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Return a subset of :math:`\\Lambda`-motifs as observed in ``mm``.</span>
</span><span id="L-484"><a href="#L-484"><span class="linenos">484</span></a>
</span><span id="L-485"><a href="#L-485"><span class="linenos">485</span></a><span class="sd">        Given the binary input matrix ``mm``, count the number of</span>
</span><span id="L-486"><a href="#L-486"><span class="linenos">486</span></a><span class="sd">        :math:`\\Lambda`-motifs for all the node couples specified by the</span>
</span><span id="L-487"><a href="#L-487"><span class="linenos">487</span></a><span class="sd">        interval :math:`\\left[k_1, k_2\\right[`.</span>
</span><span id="L-488"><a href="#L-488"><span class="linenos">488</span></a>
</span><span id="L-489"><a href="#L-489"><span class="linenos">489</span></a>
</span><span id="L-490"><a href="#L-490"><span class="linenos">490</span></a><span class="sd">        .. note::</span>
</span><span id="L-491"><a href="#L-491"><span class="linenos">491</span></a>
</span><span id="L-492"><a href="#L-492"><span class="linenos">492</span></a><span class="sd">            * The :math:`\\Lambda`-motifs are counted between the **row-nodes**</span>
</span><span id="L-493"><a href="#L-493"><span class="linenos">493</span></a><span class="sd">              of the input matrix ``mm``.</span>
</span><span id="L-494"><a href="#L-494"><span class="linenos">494</span></a>
</span><span id="L-495"><a href="#L-495"><span class="linenos">495</span></a><span class="sd">            * If :math:`k_2 \equiv \\binom{mm.shape[0]}{2}`, the interval</span>
</span><span id="L-496"><a href="#L-496"><span class="linenos">496</span></a><span class="sd">              becomes :math:`\\left[k_1, k_2\\right]`.</span>
</span><span id="L-497"><a href="#L-497"><span class="linenos">497</span></a>
</span><span id="L-498"><a href="#L-498"><span class="linenos">498</span></a><span class="sd">        :param mm: binary matrix</span>
</span><span id="L-499"><a href="#L-499"><span class="linenos">499</span></a><span class="sd">        :type mm: numpy.array</span>
</span><span id="L-500"><a href="#L-500"><span class="linenos">500</span></a><span class="sd">        :param k1: lower interval limit</span>
</span><span id="L-501"><a href="#L-501"><span class="linenos">501</span></a><span class="sd">        :type k1: int</span>
</span><span id="L-502"><a href="#L-502"><span class="linenos">502</span></a><span class="sd">        :param k2: upper interval limit</span>
</span><span id="L-503"><a href="#L-503"><span class="linenos">503</span></a><span class="sd">        :type k2: int</span>
</span><span id="L-504"><a href="#L-504"><span class="linenos">504</span></a><span class="sd">        :returns: array of observed :math:`\\Lambda`-motifs</span>
</span><span id="L-505"><a href="#L-505"><span class="linenos">505</span></a><span class="sd">        :rtype: numpy.array</span>
</span><span id="L-506"><a href="#L-506"><span class="linenos">506</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-507"><a href="#L-507"><span class="linenos">507</span></a>        <span class="n">k1</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">k1</span><span class="p">)</span>
</span><span id="L-508"><a href="#L-508"><span class="linenos">508</span></a>        <span class="n">k2</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">k2</span><span class="p">)</span>
</span><span id="L-509"><a href="#L-509"><span class="linenos">509</span></a>        <span class="n">ndim</span> <span class="o">=</span> <span class="n">mm</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-510"><a href="#L-510"><span class="linenos">510</span></a>        <span class="c1"># if the upper limit is the largest possible index, i.e. corresponds to</span>
</span><span id="L-511"><a href="#L-511"><span class="linenos">511</span></a>        <span class="c1"># the node couple (ndim - 2, ndim - 1), where node indices start from 0,</span>
</span><span id="L-512"><a href="#L-512"><span class="linenos">512</span></a>        <span class="c1"># include the result</span>
</span><span id="L-513"><a href="#L-513"><span class="linenos">513</span></a>        <span class="k">if</span> <span class="n">k2</span> <span class="o">==</span> <span class="p">(</span><span class="n">ndim</span> <span class="o">*</span> <span class="p">(</span><span class="n">ndim</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
</span><span id="L-514"><a href="#L-514"><span class="linenos">514</span></a>            <span class="n">flag</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="L-515"><a href="#L-515"><span class="linenos">515</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-516"><a href="#L-516"><span class="linenos">516</span></a>            <span class="n">flag</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-517"><a href="#L-517"><span class="linenos">517</span></a>        <span class="n">aux</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="n">k2</span> <span class="o">-</span> <span class="n">k1</span> <span class="o">+</span> <span class="n">flag</span><span class="p">,</span> <span class="p">))</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="c1"># -1 as a test</span>
</span><span id="L-518"><a href="#L-518"><span class="linenos">518</span></a>        <span class="p">[</span><span class="n">i1</span><span class="p">,</span> <span class="n">j1</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">flat2triumat_idx</span><span class="p">(</span><span class="n">k1</span><span class="p">,</span> <span class="n">ndim</span><span class="p">)</span>
</span><span id="L-519"><a href="#L-519"><span class="linenos">519</span></a>        <span class="p">[</span><span class="n">i2</span><span class="p">,</span> <span class="n">j2</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">flat2triumat_idx</span><span class="p">(</span><span class="n">k2</span><span class="p">,</span> <span class="n">ndim</span><span class="p">)</span>
</span><span id="L-520"><a href="#L-520"><span class="linenos">520</span></a>
</span><span id="L-521"><a href="#L-521"><span class="linenos">521</span></a>        <span class="c1"># if limits have the same row index</span>
</span><span id="L-522"><a href="#L-522"><span class="linenos">522</span></a>        <span class="k">if</span> <span class="n">i1</span> <span class="o">==</span> <span class="n">i2</span><span class="p">:</span>
</span><span id="L-523"><a href="#L-523"><span class="linenos">523</span></a>            <span class="n">aux</span><span class="p">[:</span><span class="n">k2</span> <span class="o">-</span> <span class="n">k1</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">mm</span><span class="p">[</span><span class="n">i1</span><span class="p">,</span> <span class="p">:],</span> <span class="n">mm</span><span class="p">[</span><span class="n">j1</span><span class="p">:</span><span class="n">j2</span><span class="p">,</span> <span class="p">:]</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
</span><span id="L-524"><a href="#L-524"><span class="linenos">524</span></a>        <span class="c1"># if limits have different row indices</span>
</span><span id="L-525"><a href="#L-525"><span class="linenos">525</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-526"><a href="#L-526"><span class="linenos">526</span></a>            <span class="n">k</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-527"><a href="#L-527"><span class="linenos">527</span></a>            <span class="c1">#print(&#39;i1:&#39;, i1)</span>
</span><span id="L-528"><a href="#L-528"><span class="linenos">528</span></a>            <span class="c1">#print(&#39;j1:&#39;, j1)</span>
</span><span id="L-529"><a href="#L-529"><span class="linenos">529</span></a>            <span class="c1"># get values for lower limit row</span>
</span><span id="L-530"><a href="#L-530"><span class="linenos">530</span></a>            <span class="n">fi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">mm</span><span class="p">[</span><span class="n">i1</span><span class="p">,</span> <span class="p">:],</span> <span class="n">mm</span><span class="p">[</span><span class="n">j1</span><span class="p">:,</span> <span class="p">:]</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
</span><span id="L-531"><a href="#L-531"><span class="linenos">531</span></a>            <span class="n">aux</span><span class="p">[:</span><span class="nb">len</span><span class="p">(</span><span class="n">fi</span><span class="p">)]</span> <span class="o">=</span> <span class="n">fi</span>
</span><span id="L-532"><a href="#L-532"><span class="linenos">532</span></a>            <span class="n">k</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">fi</span><span class="p">)</span>
</span><span id="L-533"><a href="#L-533"><span class="linenos">533</span></a>            <span class="c1"># get values for intermediate rows</span>
</span><span id="L-534"><a href="#L-534"><span class="linenos">534</span></a>            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i1</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">i2</span><span class="p">):</span>
</span><span id="L-535"><a href="#L-535"><span class="linenos">535</span></a>                <span class="n">mid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">mm</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:],</span> <span class="n">mm</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:,</span> <span class="p">:]</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
</span><span id="L-536"><a href="#L-536"><span class="linenos">536</span></a>                <span class="n">aux</span><span class="p">[</span><span class="n">k</span> <span class="p">:</span> <span class="n">k</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">mid</span><span class="p">)]</span> <span class="o">=</span> <span class="n">mid</span>
</span><span id="L-537"><a href="#L-537"><span class="linenos">537</span></a>                <span class="n">k</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">mid</span><span class="p">)</span>
</span><span id="L-538"><a href="#L-538"><span class="linenos">538</span></a>            <span class="c1"># get values for upper limit row</span>
</span><span id="L-539"><a href="#L-539"><span class="linenos">539</span></a>            <span class="k">if</span> <span class="n">flag</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="L-540"><a href="#L-540"><span class="linenos">540</span></a>                <span class="n">aux</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">mm</span><span class="p">[</span><span class="n">ndim</span> <span class="o">-</span> <span class="mi">2</span><span class="p">,</span> <span class="p">:],</span> <span class="n">mm</span><span class="p">[</span><span class="n">ndim</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="p">:]</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
</span><span id="L-541"><a href="#L-541"><span class="linenos">541</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-542"><a href="#L-542"><span class="linenos">542</span></a>                <span class="n">la</span> <span class="o">=</span>  <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">mm</span><span class="p">[</span><span class="n">i2</span><span class="p">,</span> <span class="p">:],</span> <span class="n">mm</span><span class="p">[</span><span class="n">i2</span> <span class="o">+</span> <span class="mi">1</span> <span class="p">:</span> <span class="n">j2</span><span class="p">,</span> <span class="p">:]</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
</span><span id="L-543"><a href="#L-543"><span class="linenos">543</span></a>                <span class="n">aux</span><span class="p">[</span><span class="n">k</span><span class="p">:]</span> <span class="o">=</span> <span class="n">la</span>
</span><span id="L-544"><a href="#L-544"><span class="linenos">544</span></a>        <span class="k">return</span> <span class="n">aux</span>
</span><span id="L-545"><a href="#L-545"><span class="linenos">545</span></a>
</span><span id="L-546"><a href="#L-546"><span class="linenos">546</span></a>    <span class="k">def</span> <span class="nf">get_plambda_block</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">biad_mat</span><span class="p">,</span> <span class="n">k1</span><span class="p">,</span> <span class="n">k2</span><span class="p">):</span>
</span><span id="L-547"><a href="#L-547"><span class="linenos">547</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Return a subset of the :math:`\\Lambda` probability matrix.</span>
</span><span id="L-548"><a href="#L-548"><span class="linenos">548</span></a>
</span><span id="L-549"><a href="#L-549"><span class="linenos">549</span></a><span class="sd">        Given the biadjacency matrix ``biad_mat`` with</span>
</span><span id="L-550"><a href="#L-550"><span class="linenos">550</span></a><span class="sd">        :math:`\\mathbf{M}_{rc} = p_{rc}`, which describes the probabilities of</span>
</span><span id="L-551"><a href="#L-551"><span class="linenos">551</span></a><span class="sd">        row-node ``r`` and column-node ``c`` being linked, the method returns</span>
</span><span id="L-552"><a href="#L-552"><span class="linenos">552</span></a><span class="sd">        the matrix</span>
</span><span id="L-553"><a href="#L-553"><span class="linenos">553</span></a>
</span><span id="L-554"><a href="#L-554"><span class="linenos">554</span></a><span class="sd">        :math:`P(\\Lambda)_{ij} = \\left(M_{i\\alpha_1} \\cdot M_{j\\alpha_1},</span>
</span><span id="L-555"><a href="#L-555"><span class="linenos">555</span></a><span class="sd">        M_{i\\alpha_2} \\cdot M_{j\\alpha_2}, \\ldots\\right),`</span>
</span><span id="L-556"><a href="#L-556"><span class="linenos">556</span></a>
</span><span id="L-557"><a href="#L-557"><span class="linenos">557</span></a><span class="sd">        for all the node couples in the interval</span>
</span><span id="L-558"><a href="#L-558"><span class="linenos">558</span></a><span class="sd">        :math:`\\left[k_1, k_2\\right[`.  :math:`(i, j)` are two **row-nodes**</span>
</span><span id="L-559"><a href="#L-559"><span class="linenos">559</span></a><span class="sd">        of ``biad_mat`` and :math:`\\alpha_k` runs over the nodes in the</span>
</span><span id="L-560"><a href="#L-560"><span class="linenos">560</span></a><span class="sd">        opposite layer.</span>
</span><span id="L-561"><a href="#L-561"><span class="linenos">561</span></a>
</span><span id="L-562"><a href="#L-562"><span class="linenos">562</span></a><span class="sd">        .. note::</span>
</span><span id="L-563"><a href="#L-563"><span class="linenos">563</span></a>
</span><span id="L-564"><a href="#L-564"><span class="linenos">564</span></a><span class="sd">            * The probabilities are calculated between the **row-nodes** of the</span>
</span><span id="L-565"><a href="#L-565"><span class="linenos">565</span></a><span class="sd">              input matrix ``biad_mat``.</span>
</span><span id="L-566"><a href="#L-566"><span class="linenos">566</span></a>
</span><span id="L-567"><a href="#L-567"><span class="linenos">567</span></a><span class="sd">            * If :math:`k_2 \equiv \\binom{biad\\_mat.shape[0]}{2}`, the</span>
</span><span id="L-568"><a href="#L-568"><span class="linenos">568</span></a><span class="sd">              interval becomes :math:`\\left[k1, k2\\right]`.</span>
</span><span id="L-569"><a href="#L-569"><span class="linenos">569</span></a>
</span><span id="L-570"><a href="#L-570"><span class="linenos">570</span></a><span class="sd">        :param biad_mat: biadjacency matrix</span>
</span><span id="L-571"><a href="#L-571"><span class="linenos">571</span></a><span class="sd">        :type biad_mat: numpy.array</span>
</span><span id="L-572"><a href="#L-572"><span class="linenos">572</span></a><span class="sd">        :param k1: lower interval limit</span>
</span><span id="L-573"><a href="#L-573"><span class="linenos">573</span></a><span class="sd">        :type k1: int</span>
</span><span id="L-574"><a href="#L-574"><span class="linenos">574</span></a><span class="sd">        :param k2: upper interval limit</span>
</span><span id="L-575"><a href="#L-575"><span class="linenos">575</span></a><span class="sd">        :type k2: int</span>
</span><span id="L-576"><a href="#L-576"><span class="linenos">576</span></a><span class="sd">        :returns: :math:`\\Lambda`-motif probability matrix</span>
</span><span id="L-577"><a href="#L-577"><span class="linenos">577</span></a><span class="sd">        :rtype: numpy.array</span>
</span><span id="L-578"><a href="#L-578"><span class="linenos">578</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-579"><a href="#L-579"><span class="linenos">579</span></a>        <span class="p">[</span><span class="n">ndim1</span><span class="p">,</span> <span class="n">ndim2</span><span class="p">]</span> <span class="o">=</span> <span class="n">biad_mat</span><span class="o">.</span><span class="n">shape</span>
</span><span id="L-580"><a href="#L-580"><span class="linenos">580</span></a>        <span class="c1"># if the upper limit is the largest possible index, i.e. corresponds to</span>
</span><span id="L-581"><a href="#L-581"><span class="linenos">581</span></a>        <span class="c1"># the node couple (ndim - 2, ndim - 1), where node indices start from 0,</span>
</span><span id="L-582"><a href="#L-582"><span class="linenos">582</span></a>        <span class="c1"># include the result</span>
</span><span id="L-583"><a href="#L-583"><span class="linenos">583</span></a>        <span class="k">if</span> <span class="n">k2</span> <span class="o">==</span> <span class="p">(</span><span class="n">ndim1</span> <span class="o">*</span> <span class="p">(</span><span class="n">ndim1</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
</span><span id="L-584"><a href="#L-584"><span class="linenos">584</span></a>            <span class="n">flag</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="L-585"><a href="#L-585"><span class="linenos">585</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-586"><a href="#L-586"><span class="linenos">586</span></a>            <span class="n">flag</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-587"><a href="#L-587"><span class="linenos">587</span></a>        <span class="n">paux</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="n">k2</span> <span class="o">-</span> <span class="n">k1</span> <span class="o">+</span> <span class="n">flag</span><span class="p">,</span> <span class="n">ndim2</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;float&#39;</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mf">0.1</span><span class="p">)</span>
</span><span id="L-588"><a href="#L-588"><span class="linenos">588</span></a>        <span class="p">[</span><span class="n">i1</span><span class="p">,</span> <span class="n">j1</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">flat2triumat_idx</span><span class="p">(</span><span class="n">k1</span><span class="p">,</span> <span class="n">ndim1</span><span class="p">)</span>
</span><span id="L-589"><a href="#L-589"><span class="linenos">589</span></a>        <span class="p">[</span><span class="n">i2</span><span class="p">,</span> <span class="n">j2</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">flat2triumat_idx</span><span class="p">(</span><span class="n">k2</span><span class="p">,</span> <span class="n">ndim1</span><span class="p">)</span>
</span><span id="L-590"><a href="#L-590"><span class="linenos">590</span></a>
</span><span id="L-591"><a href="#L-591"><span class="linenos">591</span></a>        <span class="c1"># if limits have the same row index</span>
</span><span id="L-592"><a href="#L-592"><span class="linenos">592</span></a>        <span class="k">if</span> <span class="n">i1</span> <span class="o">==</span> <span class="n">i2</span><span class="p">:</span>
</span><span id="L-593"><a href="#L-593"><span class="linenos">593</span></a>            <span class="n">paux</span><span class="p">[:</span><span class="n">k2</span> <span class="o">-</span> <span class="n">k1</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">biad_mat</span><span class="p">[</span><span class="n">i1</span><span class="p">,</span> <span class="p">]</span> <span class="o">*</span> <span class="n">biad_mat</span><span class="p">[</span><span class="n">j1</span><span class="p">:</span><span class="n">j2</span><span class="p">,</span> <span class="p">:]</span>
</span><span id="L-594"><a href="#L-594"><span class="linenos">594</span></a>        <span class="c1"># if limits have different indices</span>
</span><span id="L-595"><a href="#L-595"><span class="linenos">595</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-596"><a href="#L-596"><span class="linenos">596</span></a>            <span class="n">k</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-597"><a href="#L-597"><span class="linenos">597</span></a>            <span class="c1"># get values for lower limit row</span>
</span><span id="L-598"><a href="#L-598"><span class="linenos">598</span></a>            <span class="n">fi</span> <span class="o">=</span> <span class="n">biad_mat</span><span class="p">[</span><span class="n">i1</span><span class="p">,</span> <span class="p">:]</span> <span class="o">*</span> <span class="n">biad_mat</span><span class="p">[</span><span class="n">j1</span><span class="p">:,</span> <span class="p">:]</span>
</span><span id="L-599"><a href="#L-599"><span class="linenos">599</span></a>            <span class="n">paux</span><span class="p">[:</span><span class="nb">len</span><span class="p">(</span><span class="n">fi</span><span class="p">),</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">fi</span>
</span><span id="L-600"><a href="#L-600"><span class="linenos">600</span></a>            <span class="n">k</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">fi</span><span class="p">)</span>
</span><span id="L-601"><a href="#L-601"><span class="linenos">601</span></a>            <span class="c1"># get values for intermediate rows</span>
</span><span id="L-602"><a href="#L-602"><span class="linenos">602</span></a>            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i1</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">i2</span><span class="p">):</span>
</span><span id="L-603"><a href="#L-603"><span class="linenos">603</span></a>                <span class="n">mid</span> <span class="o">=</span> <span class="n">biad_mat</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span> <span class="o">*</span> <span class="n">biad_mat</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:,</span> <span class="p">:]</span>
</span><span id="L-604"><a href="#L-604"><span class="linenos">604</span></a>                <span class="n">paux</span><span class="p">[</span><span class="n">k</span> <span class="p">:</span> <span class="n">k</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">mid</span><span class="p">),</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">mid</span>
</span><span id="L-605"><a href="#L-605"><span class="linenos">605</span></a>                <span class="n">k</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">mid</span><span class="p">)</span>
</span><span id="L-606"><a href="#L-606"><span class="linenos">606</span></a>            <span class="c1"># get values for upper limit row</span>
</span><span id="L-607"><a href="#L-607"><span class="linenos">607</span></a>            <span class="k">if</span> <span class="n">flag</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="L-608"><a href="#L-608"><span class="linenos">608</span></a>                <span class="n">paux</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">biad_mat</span><span class="p">[</span><span class="n">ndim1</span> <span class="o">-</span> <span class="mi">2</span><span class="p">,</span> <span class="p">:]</span> <span class="o">*</span> <span class="n">biad_mat</span><span class="p">[</span><span class="n">ndim1</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="p">:]</span>
</span><span id="L-609"><a href="#L-609"><span class="linenos">609</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-610"><a href="#L-610"><span class="linenos">610</span></a>                <span class="n">la</span> <span class="o">=</span> <span class="n">biad_mat</span><span class="p">[</span><span class="n">i2</span><span class="p">,</span> <span class="p">:]</span> <span class="o">*</span> <span class="n">biad_mat</span><span class="p">[</span><span class="n">i2</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:</span><span class="n">j2</span><span class="p">,</span> <span class="p">:]</span>
</span><span id="L-611"><a href="#L-611"><span class="linenos">611</span></a>                <span class="n">paux</span><span class="p">[</span><span class="n">k</span><span class="p">:,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">la</span>
</span><span id="L-612"><a href="#L-612"><span class="linenos">612</span></a>        <span class="k">return</span> <span class="n">paux</span>
</span><span id="L-613"><a href="#L-613"><span class="linenos">613</span></a>
</span><span id="L-614"><a href="#L-614"><span class="linenos">614</span></a>    <span class="k">def</span> <span class="nf">get_pvalues_q</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">plam_mat</span><span class="p">,</span> <span class="n">nlam_mat</span><span class="p">,</span> <span class="n">k1</span><span class="p">,</span> <span class="n">k2</span><span class="p">,</span> <span class="n">parallel</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
</span><span id="L-615"><a href="#L-615"><span class="linenos">615</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Calculate the p-values of the observed :math:`\\Lambda`-motifs.</span>
</span><span id="L-616"><a href="#L-616"><span class="linenos">616</span></a>
</span><span id="L-617"><a href="#L-617"><span class="linenos">617</span></a><span class="sd">        For each number of :math:`\\Lambda`-motifs in ``nlam_mat`` for the node</span>
</span><span id="L-618"><a href="#L-618"><span class="linenos">618</span></a><span class="sd">        interval :math:`\\left[k1, k2\\right[`, construct the Poisson Binomial</span>
</span><span id="L-619"><a href="#L-619"><span class="linenos">619</span></a><span class="sd">        distribution using the corresponding</span>
</span><span id="L-620"><a href="#L-620"><span class="linenos">620</span></a><span class="sd">        probabilities in ``plam_mat`` and calculate the p-value.</span>
</span><span id="L-621"><a href="#L-621"><span class="linenos">621</span></a>
</span><span id="L-622"><a href="#L-622"><span class="linenos">622</span></a><span class="sd">        :param plam_mat: array containing the list of probabilities for the</span>
</span><span id="L-623"><a href="#L-623"><span class="linenos">623</span></a><span class="sd">            single observations of :math:`\\Lambda`-motifs</span>
</span><span id="L-624"><a href="#L-624"><span class="linenos">624</span></a><span class="sd">        :type plam_mat: numpy.array (square matrix)</span>
</span><span id="L-625"><a href="#L-625"><span class="linenos">625</span></a><span class="sd">        :param nlam_mat: array containing the observations of</span>
</span><span id="L-626"><a href="#L-626"><span class="linenos">626</span></a><span class="sd">            :math:`\\Lambda`-motifs</span>
</span><span id="L-627"><a href="#L-627"><span class="linenos">627</span></a><span class="sd">        :type nlam_mat: numpy.array (square matrix)</span>
</span><span id="L-628"><a href="#L-628"><span class="linenos">628</span></a><span class="sd">        :param k1: lower interval limit</span>
</span><span id="L-629"><a href="#L-629"><span class="linenos">629</span></a><span class="sd">        :type k1: int</span>
</span><span id="L-630"><a href="#L-630"><span class="linenos">630</span></a><span class="sd">        :param k2: upper interval limit</span>
</span><span id="L-631"><a href="#L-631"><span class="linenos">631</span></a><span class="sd">        :type k2: int</span>
</span><span id="L-632"><a href="#L-632"><span class="linenos">632</span></a><span class="sd">        :param parallel: if ``True``, the calculation is executed in parallel;</span>
</span><span id="L-633"><a href="#L-633"><span class="linenos">633</span></a><span class="sd">            if ``False``, only one process is started</span>
</span><span id="L-634"><a href="#L-634"><span class="linenos">634</span></a><span class="sd">        :type parallel: bool</span>
</span><span id="L-635"><a href="#L-635"><span class="linenos">635</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-636"><a href="#L-636"><span class="linenos">636</span></a>        <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">nlam_mat</span><span class="p">)</span>
</span><span id="L-637"><a href="#L-637"><span class="linenos">637</span></a>        <span class="c1"># the array must be sharable to be accessible by all processes</span>
</span><span id="L-638"><a href="#L-638"><span class="linenos">638</span></a>        <span class="n">shared_array_base</span> <span class="o">=</span> <span class="n">multiprocessing</span><span class="o">.</span><span class="n">Array</span><span class="p">(</span><span class="n">ctypes</span><span class="o">.</span><span class="n">c_double</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
</span><span id="L-639"><a href="#L-639"><span class="linenos">639</span></a>        <span class="n">pval_mat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">frombuffer</span><span class="p">(</span><span class="n">shared_array_base</span><span class="o">.</span><span class="n">get_obj</span><span class="p">())</span>
</span><span id="L-640"><a href="#L-640"><span class="linenos">640</span></a>
</span><span id="L-641"><a href="#L-641"><span class="linenos">641</span></a>        <span class="c1"># number of processes running in parallel has to be tested.</span>
</span><span id="L-642"><a href="#L-642"><span class="linenos">642</span></a>        <span class="c1"># good guess is multiprocessing.cpu_count() +- 1</span>
</span><span id="L-643"><a href="#L-643"><span class="linenos">643</span></a>        <span class="k">if</span> <span class="n">parallel</span><span class="p">:</span>
</span><span id="L-644"><a href="#L-644"><span class="linenos">644</span></a>            <span class="n">num_procs</span> <span class="o">=</span> <span class="n">multiprocessing</span><span class="o">.</span><span class="n">cpu_count</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span>
</span><span id="L-645"><a href="#L-645"><span class="linenos">645</span></a>        <span class="k">elif</span> <span class="ow">not</span> <span class="n">parallel</span><span class="p">:</span>
</span><span id="L-646"><a href="#L-646"><span class="linenos">646</span></a>            <span class="n">num_procs</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="L-647"><a href="#L-647"><span class="linenos">647</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-648"><a href="#L-648"><span class="linenos">648</span></a>            <span class="n">num_procs</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="L-649"><a href="#L-649"><span class="linenos">649</span></a>
</span><span id="L-650"><a href="#L-650"><span class="linenos">650</span></a>        <span class="c1"># create 2 queues</span>
</span><span id="L-651"><a href="#L-651"><span class="linenos">651</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">input_queue</span> <span class="o">=</span> <span class="n">multiprocessing</span><span class="o">.</span><span class="n">Queue</span><span class="p">()</span>
</span><span id="L-652"><a href="#L-652"><span class="linenos">652</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">output_queue</span> <span class="o">=</span> <span class="n">multiprocessing</span><span class="o">.</span><span class="n">Queue</span><span class="p">()</span>
</span><span id="L-653"><a href="#L-653"><span class="linenos">653</span></a>
</span><span id="L-654"><a href="#L-654"><span class="linenos">654</span></a>        <span class="c1"># (1) add tuples of matrix elements and indices to the input queue</span>
</span><span id="L-655"><a href="#L-655"><span class="linenos">655</span></a>        <span class="n">p_inqueue</span> <span class="o">=</span> <span class="n">multiprocessing</span><span class="o">.</span><span class="n">Process</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">add2inqueue</span><span class="p">,</span>
</span><span id="L-656"><a href="#L-656"><span class="linenos">656</span></a>                                            <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">num_procs</span><span class="p">,</span> <span class="n">plam_mat</span><span class="p">,</span> <span class="n">nlam_mat</span><span class="p">,</span>
</span><span id="L-657"><a href="#L-657"><span class="linenos">657</span></a>                                                <span class="n">k1</span><span class="p">,</span> <span class="n">k2</span><span class="p">))</span>
</span><span id="L-658"><a href="#L-658"><span class="linenos">658</span></a>
</span><span id="L-659"><a href="#L-659"><span class="linenos">659</span></a>
</span><span id="L-660"><a href="#L-660"><span class="linenos">660</span></a>        <span class="n">pval_mat</span> <span class="o">=</span> <span class="n">multiprocessing</span><span class="o">.</span><span class="n">Array</span><span class="p">(</span><span class="s1">&#39;d&#39;</span><span class="p">,</span> <span class="n">pval_mat</span><span class="p">)</span>
</span><span id="L-661"><a href="#L-661"><span class="linenos">661</span></a>
</span><span id="L-662"><a href="#L-662"><span class="linenos">662</span></a>        <span class="c1">#  (2) Put the results from the out-queue into the p-value array.</span>
</span><span id="L-663"><a href="#L-663"><span class="linenos">663</span></a>        <span class="n">p_outqueue</span> <span class="o">=</span> <span class="n">multiprocessing</span><span class="o">.</span><span class="n">Process</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">outqueue2pval_mat</span><span class="p">,</span>
</span><span id="L-664"><a href="#L-664"><span class="linenos">664</span></a>                                             <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">num_procs</span><span class="p">,</span> <span class="n">pval_mat</span><span class="p">))</span>
</span><span id="L-665"><a href="#L-665"><span class="linenos">665</span></a>
</span><span id="L-666"><a href="#L-666"><span class="linenos">666</span></a>        <span class="c1"># (3) pval computer...</span>
</span><span id="L-667"><a href="#L-667"><span class="linenos">667</span></a>        <span class="n">ps</span> <span class="o">=</span> <span class="p">[</span><span class="n">multiprocessing</span><span class="o">.</span><span class="n">Process</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">pval_process_worker</span><span class="p">,</span>
</span><span id="L-668"><a href="#L-668"><span class="linenos">668</span></a>                                      <span class="n">args</span><span class="o">=</span><span class="p">())</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_procs</span><span class="p">)]</span>
</span><span id="L-669"><a href="#L-669"><span class="linenos">669</span></a>
</span><span id="L-670"><a href="#L-670"><span class="linenos">670</span></a>        <span class="c1"># start queues</span>
</span><span id="L-671"><a href="#L-671"><span class="linenos">671</span></a>        <span class="n">p_inqueue</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
</span><span id="L-672"><a href="#L-672"><span class="linenos">672</span></a>        <span class="n">p_outqueue</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
</span><span id="L-673"><a href="#L-673"><span class="linenos">673</span></a>
</span><span id="L-674"><a href="#L-674"><span class="linenos">674</span></a>        <span class="c1"># start processes</span>
</span><span id="L-675"><a href="#L-675"><span class="linenos">675</span></a>        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">ps</span><span class="p">:</span>
</span><span id="L-676"><a href="#L-676"><span class="linenos">676</span></a>            <span class="n">p</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>       <span class="c1"># each process has an id, p.pid</span>
</span><span id="L-677"><a href="#L-677"><span class="linenos">677</span></a>        <span class="n">p_inqueue</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>
</span><span id="L-678"><a href="#L-678"><span class="linenos">678</span></a>
</span><span id="L-679"><a href="#L-679"><span class="linenos">679</span></a>        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">ps</span><span class="p">:</span>
</span><span id="L-680"><a href="#L-680"><span class="linenos">680</span></a>            <span class="n">p</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>
</span><span id="L-681"><a href="#L-681"><span class="linenos">681</span></a>        <span class="n">p_outqueue</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>
</span><span id="L-682"><a href="#L-682"><span class="linenos">682</span></a>
</span><span id="L-683"><a href="#L-683"><span class="linenos">683</span></a>        <span class="c1">#print(&#39;final matrix:&#39;)</span>
</span><span id="L-684"><a href="#L-684"><span class="linenos">684</span></a>        <span class="n">pval_mat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">frombuffer</span><span class="p">(</span><span class="n">pval_mat</span><span class="o">.</span><span class="n">get_obj</span><span class="p">(),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
</span><span id="L-685"><a href="#L-685"><span class="linenos">685</span></a>        <span class="c1">#for i in range(len(pval_mat)):</span>
</span><span id="L-686"><a href="#L-686"><span class="linenos">686</span></a>        <span class="c1">#    value = pval_mat[i]</span>
</span><span id="L-687"><a href="#L-687"><span class="linenos">687</span></a>        <span class="c1">#    print(value)</span>
</span><span id="L-688"><a href="#L-688"><span class="linenos">688</span></a>        <span class="c1">#print(&#39;--------&#39;)</span>
</span><span id="L-689"><a href="#L-689"><span class="linenos">689</span></a>        <span class="c1">#print(pval_mat)</span>
</span><span id="L-690"><a href="#L-690"><span class="linenos">690</span></a>        <span class="c1">#print(&#39;-------&#39;)</span>
</span><span id="L-691"><a href="#L-691"><span class="linenos">691</span></a>
</span><span id="L-692"><a href="#L-692"><span class="linenos">692</span></a>
</span><span id="L-693"><a href="#L-693"><span class="linenos">693</span></a>        <span class="k">return</span> <span class="n">pval_mat</span>
</span><span id="L-694"><a href="#L-694"><span class="linenos">694</span></a>
</span><span id="L-695"><a href="#L-695"><span class="linenos">695</span></a>    <span class="k">def</span> <span class="nf">add2inqueue</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nprocs</span><span class="p">,</span> <span class="n">plam_mat</span><span class="p">,</span> <span class="n">nlam_mat</span><span class="p">,</span> <span class="n">k1</span><span class="p">,</span> <span class="n">k2</span><span class="p">):</span>
</span><span id="L-696"><a href="#L-696"><span class="linenos">696</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Add elements to the in-queue to calculate the p-values.</span>
</span><span id="L-697"><a href="#L-697"><span class="linenos">697</span></a>
</span><span id="L-698"><a href="#L-698"><span class="linenos">698</span></a><span class="sd">        :param nprocs: number of processes running in parallel</span>
</span><span id="L-699"><a href="#L-699"><span class="linenos">699</span></a><span class="sd">        :type nprocs: int</span>
</span><span id="L-700"><a href="#L-700"><span class="linenos">700</span></a><span class="sd">        :param plam_mat: array containing the list of probabilities for the</span>
</span><span id="L-701"><a href="#L-701"><span class="linenos">701</span></a><span class="sd">            single observations of :math:`\\Lambda`-motifs</span>
</span><span id="L-702"><a href="#L-702"><span class="linenos">702</span></a><span class="sd">        :type plam_mat: numpy.array (square matrix)</span>
</span><span id="L-703"><a href="#L-703"><span class="linenos">703</span></a><span class="sd">        :param nlam_mat: array containing the observations of</span>
</span><span id="L-704"><a href="#L-704"><span class="linenos">704</span></a><span class="sd">            :math:`\\Lambda`-motifs</span>
</span><span id="L-705"><a href="#L-705"><span class="linenos">705</span></a><span class="sd">        :type nlam_mat: numpy.array (square matrix)</span>
</span><span id="L-706"><a href="#L-706"><span class="linenos">706</span></a><span class="sd">        :param k1: lower interval limit</span>
</span><span id="L-707"><a href="#L-707"><span class="linenos">707</span></a><span class="sd">        :type k1: int</span>
</span><span id="L-708"><a href="#L-708"><span class="linenos">708</span></a><span class="sd">        :param k2: upper interval limit</span>
</span><span id="L-709"><a href="#L-709"><span class="linenos">709</span></a><span class="sd">        :type k2: int</span>
</span><span id="L-710"><a href="#L-710"><span class="linenos">710</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-711"><a href="#L-711"><span class="linenos">711</span></a>        <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">plam_mat</span><span class="p">)</span>
</span><span id="L-712"><a href="#L-712"><span class="linenos">712</span></a>        <span class="c1"># add tuples of matrix elements and indices to the input queue</span>
</span><span id="L-713"><a href="#L-713"><span class="linenos">713</span></a>        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">k1</span><span class="p">,</span> <span class="n">k2</span><span class="p">):</span>
</span><span id="L-714"><a href="#L-714"><span class="linenos">714</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">input_queue</span><span class="o">.</span><span class="n">put</span><span class="p">((</span><span class="n">k</span> <span class="o">-</span> <span class="n">k1</span><span class="p">,</span> <span class="n">plam_mat</span><span class="p">[</span><span class="n">k</span> <span class="o">-</span> <span class="n">k1</span><span class="p">,</span> <span class="p">:],</span>
</span><span id="L-715"><a href="#L-715"><span class="linenos">715</span></a>                                  <span class="n">nlam_mat</span><span class="p">[</span><span class="n">k</span> <span class="o">-</span> <span class="n">k1</span><span class="p">]))</span>
</span><span id="L-716"><a href="#L-716"><span class="linenos">716</span></a>
</span><span id="L-717"><a href="#L-717"><span class="linenos">717</span></a>        <span class="c1"># add as many poison pills &quot;STOP&quot; to the queue as there are workers</span>
</span><span id="L-718"><a href="#L-718"><span class="linenos">718</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nprocs</span><span class="p">):</span>
</span><span id="L-719"><a href="#L-719"><span class="linenos">719</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">input_queue</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="s2">&quot;STOP&quot;</span><span class="p">)</span>
</span><span id="L-720"><a href="#L-720"><span class="linenos">720</span></a>
</span><span id="L-721"><a href="#L-721"><span class="linenos">721</span></a>    <span class="k">def</span> <span class="nf">pval_process_worker</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-722"><a href="#L-722"><span class="linenos">722</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Calculate p-values and add them to the out-queue.&quot;&quot;&quot;</span>
</span><span id="L-723"><a href="#L-723"><span class="linenos">723</span></a>        <span class="c1"># take elements from the queue as long as the element is not &quot;STOP&quot;</span>
</span><span id="L-724"><a href="#L-724"><span class="linenos">724</span></a>        <span class="k">for</span> <span class="n">tupl</span> <span class="ow">in</span> <span class="nb">iter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">input_queue</span><span class="o">.</span><span class="n">get</span><span class="p">,</span> <span class="s2">&quot;STOP&quot;</span><span class="p">):</span>
</span><span id="L-725"><a href="#L-725"><span class="linenos">725</span></a>            <span class="n">pb</span> <span class="o">=</span> <span class="n">PoiBin</span><span class="p">(</span><span class="n">tupl</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</span><span id="L-726"><a href="#L-726"><span class="linenos">726</span></a>
</span><span id="L-727"><a href="#L-727"><span class="linenos">727</span></a>            <span class="n">pv</span> <span class="o">=</span> <span class="n">pb</span><span class="o">.</span><span class="n">pval</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">tupl</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
</span><span id="L-728"><a href="#L-728"><span class="linenos">728</span></a>            <span class="c1">#print(&#39;loc {}, pval computed: {}&#39;.format(pb, pv))</span>
</span><span id="L-729"><a href="#L-729"><span class="linenos">729</span></a>            <span class="c1"># add the result to the output queue</span>
</span><span id="L-730"><a href="#L-730"><span class="linenos">730</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">output_queue</span><span class="o">.</span><span class="n">put</span><span class="p">((</span><span class="n">tupl</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">pv</span><span class="p">))</span>
</span><span id="L-731"><a href="#L-731"><span class="linenos">731</span></a>        <span class="c1"># once all the elements in the input queue have been dealt with, add a</span>
</span><span id="L-732"><a href="#L-732"><span class="linenos">732</span></a>        <span class="c1"># &quot;STOP&quot; to the output queue</span>
</span><span id="L-733"><a href="#L-733"><span class="linenos">733</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">output_queue</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="s2">&quot;STOP&quot;</span><span class="p">)</span>
</span><span id="L-734"><a href="#L-734"><span class="linenos">734</span></a>
</span><span id="L-735"><a href="#L-735"><span class="linenos">735</span></a>    <span class="k">def</span> <span class="nf">outqueue2pval_mat</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nprocs</span><span class="p">,</span> <span class="n">pvalmat</span><span class="p">):</span>
</span><span id="L-736"><a href="#L-736"><span class="linenos">736</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Put the results from the out-queue into the p-value array.&quot;&quot;&quot;</span>
</span><span id="L-737"><a href="#L-737"><span class="linenos">737</span></a>        <span class="c1"># stop the work after having met nprocs times &quot;STOP&quot;</span>
</span><span id="L-738"><a href="#L-738"><span class="linenos">738</span></a>        <span class="k">for</span> <span class="n">work</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nprocs</span><span class="p">):</span>
</span><span id="L-739"><a href="#L-739"><span class="linenos">739</span></a>            <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="nb">iter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">output_queue</span><span class="o">.</span><span class="n">get</span><span class="p">,</span> <span class="s2">&quot;STOP&quot;</span><span class="p">):</span>
</span><span id="L-740"><a href="#L-740"><span class="linenos">740</span></a>                <span class="n">k</span> <span class="o">=</span> <span class="n">val</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-741"><a href="#L-741"><span class="linenos">741</span></a>                <span class="c1">#print(&#39;popping pval from out que:&#39;, val[1])</span>
</span><span id="L-742"><a href="#L-742"><span class="linenos">742</span></a>                <span class="n">pvalmat</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="L-743"><a href="#L-743"><span class="linenos">743</span></a>
</span><span id="L-744"><a href="#L-744"><span class="linenos">744</span></a>        <span class="c1">#print(&#39;final matrix&#39;)</span>
</span><span id="L-745"><a href="#L-745"><span class="linenos">745</span></a>        <span class="c1">#print(pvalmat)</span>
</span><span id="L-746"><a href="#L-746"><span class="linenos">746</span></a>
</span><span id="L-747"><a href="#L-747"><span class="linenos">747</span></a>
</span><span id="L-748"><a href="#L-748"><span class="linenos">748</span></a>    <span class="k">def</span> <span class="nf">get_triup_dim</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bip_set</span><span class="p">):</span>
</span><span id="L-749"><a href="#L-749"><span class="linenos">749</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the number of possible node couples in ``bip_set``.</span>
</span><span id="L-750"><a href="#L-750"><span class="linenos">750</span></a>
</span><span id="L-751"><a href="#L-751"><span class="linenos">751</span></a><span class="sd">        :param bip_set: selects row-nodes (``True``) or column-nodes</span>
</span><span id="L-752"><a href="#L-752"><span class="linenos">752</span></a><span class="sd">            (``False``)</span>
</span><span id="L-753"><a href="#L-753"><span class="linenos">753</span></a><span class="sd">        :type bip_set: bool</span>
</span><span id="L-754"><a href="#L-754"><span class="linenos">754</span></a><span class="sd">        :returns: return the number of node couple combinations corresponding</span>
</span><span id="L-755"><a href="#L-755"><span class="linenos">755</span></a><span class="sd">            to the layer ``bip_set``</span>
</span><span id="L-756"><a href="#L-756"><span class="linenos">756</span></a><span class="sd">        :rtype: int</span>
</span><span id="L-757"><a href="#L-757"><span class="linenos">757</span></a>
</span><span id="L-758"><a href="#L-758"><span class="linenos">758</span></a><span class="sd">        :raise ValueError: raise an error if the parameter ``bip_set`` is</span>
</span><span id="L-759"><a href="#L-759"><span class="linenos">759</span></a><span class="sd">            neither ``True`` nor ``False``</span>
</span><span id="L-760"><a href="#L-760"><span class="linenos">760</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-761"><a href="#L-761"><span class="linenos">761</span></a>        <span class="k">if</span> <span class="n">bip_set</span><span class="p">:</span>
</span><span id="L-762"><a href="#L-762"><span class="linenos">762</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">triumat2flat_dim</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_rows</span><span class="p">)</span>
</span><span id="L-763"><a href="#L-763"><span class="linenos">763</span></a>        <span class="k">elif</span> <span class="ow">not</span> <span class="n">bip_set</span><span class="p">:</span>
</span><span id="L-764"><a href="#L-764"><span class="linenos">764</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">triumat2flat_dim</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_columns</span><span class="p">)</span>
</span><span id="L-765"><a href="#L-765"><span class="linenos">765</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-766"><a href="#L-766"><span class="linenos">766</span></a>            <span class="n">errmsg</span> <span class="o">=</span> <span class="s2">&quot;&#39;&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">bip_set</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&#39; &quot;</span> <span class="o">+</span> <span class="s1">&#39;not supported.&#39;</span>
</span><span id="L-767"><a href="#L-767"><span class="linenos">767</span></a>            <span class="k">raise</span> <span class="ne">NameError</span><span class="p">(</span><span class="n">errmsg</span><span class="p">)</span>
</span><span id="L-768"><a href="#L-768"><span class="linenos">768</span></a>
</span><span id="L-769"><a href="#L-769"><span class="linenos">769</span></a>    <span class="k">def</span> <span class="nf">split_range</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">m</span><span class="o">=</span><span class="mi">4</span><span class="p">):</span>
</span><span id="L-770"><a href="#L-770"><span class="linenos">770</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Split the interval :math:`\\left[0,\ldots, n\\right]` in ``m`` parts.</span>
</span><span id="L-771"><a href="#L-771"><span class="linenos">771</span></a>
</span><span id="L-772"><a href="#L-772"><span class="linenos">772</span></a><span class="sd">        :param n: upper limit of the range</span>
</span><span id="L-773"><a href="#L-773"><span class="linenos">773</span></a><span class="sd">        :type n: int</span>
</span><span id="L-774"><a href="#L-774"><span class="linenos">774</span></a><span class="sd">        :param m: number of part in which range should be split</span>
</span><span id="L-775"><a href="#L-775"><span class="linenos">775</span></a><span class="sd">        :type n: int</span>
</span><span id="L-776"><a href="#L-776"><span class="linenos">776</span></a><span class="sd">        :returns: delimiter indices for the ``m`` parts</span>
</span><span id="L-777"><a href="#L-777"><span class="linenos">777</span></a><span class="sd">        :rtype: list</span>
</span><span id="L-778"><a href="#L-778"><span class="linenos">778</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-779"><a href="#L-779"><span class="linenos">779</span></a>        <span class="k">return</span> <span class="p">[</span><span class="n">i</span> <span class="o">*</span> <span class="n">n</span> <span class="o">/</span> <span class="n">m</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">m</span><span class="p">)]</span>
</span><span id="L-780"><a href="#L-780"><span class="linenos">780</span></a>
</span><span id="L-781"><a href="#L-781"><span class="linenos">781</span></a><span class="c1"># ------------------------------------------------------------------------------</span>
</span><span id="L-782"><a href="#L-782"><span class="linenos">782</span></a><span class="c1"># Auxiliary methods</span>
</span><span id="L-783"><a href="#L-783"><span class="linenos">783</span></a><span class="c1"># ------------------------------------------------------------------------------</span>
</span><span id="L-784"><a href="#L-784"><span class="linenos">784</span></a>
</span><span id="L-785"><a href="#L-785"><span class="linenos">785</span></a>    <span class="nd">@staticmethod</span>
</span><span id="L-786"><a href="#L-786"><span class="linenos">786</span></a>    <span class="k">def</span> <span class="nf">triumat2flat_idx</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
</span><span id="L-787"><a href="#L-787"><span class="linenos">787</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Convert an matrix index couple to a flattened array index.</span>
</span><span id="L-788"><a href="#L-788"><span class="linenos">788</span></a>
</span><span id="L-789"><a href="#L-789"><span class="linenos">789</span></a><span class="sd">        Given a square matrix of dimension ``n`` and the index couple</span>
</span><span id="L-790"><a href="#L-790"><span class="linenos">790</span></a><span class="sd">        ``(i, j)`` *of the upper triangular part* of the matrix, return the</span>
</span><span id="L-791"><a href="#L-791"><span class="linenos">791</span></a><span class="sd">        index which the matrix element would have in a flattened array.</span>
</span><span id="L-792"><a href="#L-792"><span class="linenos">792</span></a>
</span><span id="L-793"><a href="#L-793"><span class="linenos">793</span></a><span class="sd">        .. note::</span>
</span><span id="L-794"><a href="#L-794"><span class="linenos">794</span></a><span class="sd">            * :math:`i \\in [0, ..., n - 1]`</span>
</span><span id="L-795"><a href="#L-795"><span class="linenos">795</span></a><span class="sd">            * :math:`j \\in [i + 1, ..., n - 1]`</span>
</span><span id="L-796"><a href="#L-796"><span class="linenos">796</span></a><span class="sd">            * returned index :math:`\\in [0,\\, n (n - 1) / 2 - 1]`</span>
</span><span id="L-797"><a href="#L-797"><span class="linenos">797</span></a>
</span><span id="L-798"><a href="#L-798"><span class="linenos">798</span></a><span class="sd">        :param i: row index</span>
</span><span id="L-799"><a href="#L-799"><span class="linenos">799</span></a><span class="sd">        :type i: int</span>
</span><span id="L-800"><a href="#L-800"><span class="linenos">800</span></a><span class="sd">        :param j: column index</span>
</span><span id="L-801"><a href="#L-801"><span class="linenos">801</span></a><span class="sd">        :type j: int</span>
</span><span id="L-802"><a href="#L-802"><span class="linenos">802</span></a><span class="sd">        :param n: dimension of the square matrix</span>
</span><span id="L-803"><a href="#L-803"><span class="linenos">803</span></a><span class="sd">        :type n: int</span>
</span><span id="L-804"><a href="#L-804"><span class="linenos">804</span></a><span class="sd">        :returns: flattened array index</span>
</span><span id="L-805"><a href="#L-805"><span class="linenos">805</span></a><span class="sd">        :rtype: int</span>
</span><span id="L-806"><a href="#L-806"><span class="linenos">806</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-807"><a href="#L-807"><span class="linenos">807</span></a>        <span class="k">return</span> <span class="nb">int</span><span class="p">((</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">n</span> <span class="o">-</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="mf">2.</span> <span class="o">-</span> <span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="p">(</span><span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="L-808"><a href="#L-808"><span class="linenos">808</span></a>
</span><span id="L-809"><a href="#L-809"><span class="linenos">809</span></a>    <span class="nd">@staticmethod</span>
</span><span id="L-810"><a href="#L-810"><span class="linenos">810</span></a>    <span class="k">def</span> <span class="nf">triumat2flat_dim</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
</span><span id="L-811"><a href="#L-811"><span class="linenos">811</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the size of the triangular part of a ``n x n`` matrix.</span>
</span><span id="L-812"><a href="#L-812"><span class="linenos">812</span></a>
</span><span id="L-813"><a href="#L-813"><span class="linenos">813</span></a><span class="sd">        :param n: the dimension of the square matrix</span>
</span><span id="L-814"><a href="#L-814"><span class="linenos">814</span></a><span class="sd">        :type n: int</span>
</span><span id="L-815"><a href="#L-815"><span class="linenos">815</span></a><span class="sd">        :returns: number of elements in the upper triangular part of the matrix</span>
</span><span id="L-816"><a href="#L-816"><span class="linenos">816</span></a><span class="sd">            (excluding the diagonal)</span>
</span><span id="L-817"><a href="#L-817"><span class="linenos">817</span></a><span class="sd">        :rtype: int</span>
</span><span id="L-818"><a href="#L-818"><span class="linenos">818</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-819"><a href="#L-819"><span class="linenos">819</span></a>        <span class="k">return</span> <span class="n">n</span> <span class="o">*</span> <span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
</span><span id="L-820"><a href="#L-820"><span class="linenos">820</span></a>
</span><span id="L-821"><a href="#L-821"><span class="linenos">821</span></a>    <span class="nd">@staticmethod</span>
</span><span id="L-822"><a href="#L-822"><span class="linenos">822</span></a>    <span class="k">def</span> <span class="nf">flat2triumat_dim</span><span class="p">(</span><span class="n">k</span><span class="p">):</span>
</span><span id="L-823"><a href="#L-823"><span class="linenos">823</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the dimension of the matrix hosting ``k`` triangular elements.</span>
</span><span id="L-824"><a href="#L-824"><span class="linenos">824</span></a>
</span><span id="L-825"><a href="#L-825"><span class="linenos">825</span></a><span class="sd">        :param k: the number of elements in the upper triangular</span>
</span><span id="L-826"><a href="#L-826"><span class="linenos">826</span></a><span class="sd">            part of the corresponding square matrix, excluding the diagonal</span>
</span><span id="L-827"><a href="#L-827"><span class="linenos">827</span></a><span class="sd">        :type k: int</span>
</span><span id="L-828"><a href="#L-828"><span class="linenos">828</span></a><span class="sd">        :returns: dimension of the corresponding square matrix</span>
</span><span id="L-829"><a href="#L-829"><span class="linenos">829</span></a><span class="sd">        :rtype: int</span>
</span><span id="L-830"><a href="#L-830"><span class="linenos">830</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-831"><a href="#L-831"><span class="linenos">831</span></a>        <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="mf">0.5</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">0.25</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">k</span><span class="p">))</span>
</span><span id="L-832"><a href="#L-832"><span class="linenos">832</span></a>
</span><span id="L-833"><a href="#L-833"><span class="linenos">833</span></a>    <span class="nd">@staticmethod</span>
</span><span id="L-834"><a href="#L-834"><span class="linenos">834</span></a>    <span class="k">def</span> <span class="nf">flat2triumat_idx</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
</span><span id="L-835"><a href="#L-835"><span class="linenos">835</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Convert an array index into the index couple of a triangular matrix.</span>
</span><span id="L-836"><a href="#L-836"><span class="linenos">836</span></a>
</span><span id="L-837"><a href="#L-837"><span class="linenos">837</span></a><span class="sd">        ``k`` is the index of an array of length :math:`\\binom{n}{2}{2}`,</span>
</span><span id="L-838"><a href="#L-838"><span class="linenos">838</span></a><span class="sd">        which contains the elements of an upper triangular matrix of dimension</span>
</span><span id="L-839"><a href="#L-839"><span class="linenos">839</span></a><span class="sd">        ``n`` excluding the diagonal. The function returns the index couple</span>
</span><span id="L-840"><a href="#L-840"><span class="linenos">840</span></a><span class="sd">        :math:`(i, j)` that corresponds to the entry ``k`` of the flat array.</span>
</span><span id="L-841"><a href="#L-841"><span class="linenos">841</span></a>
</span><span id="L-842"><a href="#L-842"><span class="linenos">842</span></a><span class="sd">        .. note::</span>
</span><span id="L-843"><a href="#L-843"><span class="linenos">843</span></a><span class="sd">            * :math:`k \\in \left[0,\\ldots, \\binom{n}{2} - 1\\right]`</span>
</span><span id="L-844"><a href="#L-844"><span class="linenos">844</span></a><span class="sd">            * returned indices:</span>
</span><span id="L-845"><a href="#L-845"><span class="linenos">845</span></a><span class="sd">                * :math:`i \\in [0,\\ldots, n - 1]`</span>
</span><span id="L-846"><a href="#L-846"><span class="linenos">846</span></a><span class="sd">                * :math:`j \\in [i + 1,\\ldots, n - 1]`</span>
</span><span id="L-847"><a href="#L-847"><span class="linenos">847</span></a>
</span><span id="L-848"><a href="#L-848"><span class="linenos">848</span></a><span class="sd">        :param k: flattened array index</span>
</span><span id="L-849"><a href="#L-849"><span class="linenos">849</span></a><span class="sd">        :type k: int</span>
</span><span id="L-850"><a href="#L-850"><span class="linenos">850</span></a><span class="sd">        :param n: dimension of the square matrix</span>
</span><span id="L-851"><a href="#L-851"><span class="linenos">851</span></a><span class="sd">        :type n: int</span>
</span><span id="L-852"><a href="#L-852"><span class="linenos">852</span></a><span class="sd">        :returns: matrix index tuple (row, column)</span>
</span><span id="L-853"><a href="#L-853"><span class="linenos">853</span></a><span class="sd">        :rtype: tuple</span>
</span><span id="L-854"><a href="#L-854"><span class="linenos">854</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-855"><a href="#L-855"><span class="linenos">855</span></a>        <span class="c1"># row index of array index k in the the upper triangular part of the</span>
</span><span id="L-856"><a href="#L-856"><span class="linenos">856</span></a>        <span class="c1"># square matrix</span>
</span><span id="L-857"><a href="#L-857"><span class="linenos">857</span></a>        <span class="n">r</span> <span class="o">=</span> <span class="n">n</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">-</span> <span class="nb">int</span><span class="p">(</span><span class="mf">0.5</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="o">-</span><span class="mi">8</span> <span class="o">*</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">n</span> <span class="o">*</span> <span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="mi">7</span><span class="p">)</span> <span class="o">-</span> <span class="mf">0.5</span><span class="p">)</span>
</span><span id="L-858"><a href="#L-858"><span class="linenos">858</span></a>        <span class="c1"># column index of array index k in the the upper triangular part of the</span>
</span><span id="L-859"><a href="#L-859"><span class="linenos">859</span></a>        <span class="c1"># square matrix</span>
</span><span id="L-860"><a href="#L-860"><span class="linenos">860</span></a>        <span class="n">c</span> <span class="o">=</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">r</span> <span class="o">*</span> <span class="p">(</span><span class="mi">3</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">n</span> <span class="o">+</span> <span class="n">r</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
</span><span id="L-861"><a href="#L-861"><span class="linenos">861</span></a>        <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">r</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
</span><span id="L-862"><a href="#L-862"><span class="linenos">862</span></a>
</span><span id="L-863"><a href="#L-863"><span class="linenos">863</span></a>    <span class="k">def</span> <span class="nf">save_biadjacency</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">delim</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">binary</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="L-864"><a href="#L-864"><span class="linenos">864</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Save the biadjacendy matrix of the BiCM null model.</span>
</span><span id="L-865"><a href="#L-865"><span class="linenos">865</span></a>
</span><span id="L-866"><a href="#L-866"><span class="linenos">866</span></a><span class="sd">        The matrix can either be saved as a binary NumPy ``.npy`` file or as a</span>
</span><span id="L-867"><a href="#L-867"><span class="linenos">867</span></a><span class="sd">        human-readable ``.csv`` file.</span>
</span><span id="L-868"><a href="#L-868"><span class="linenos">868</span></a>
</span><span id="L-869"><a href="#L-869"><span class="linenos">869</span></a><span class="sd">        .. note::</span>
</span><span id="L-870"><a href="#L-870"><span class="linenos">870</span></a>
</span><span id="L-871"><a href="#L-871"><span class="linenos">871</span></a><span class="sd">            * The relative path has to be provided in the filename, e.g.</span>
</span><span id="L-872"><a href="#L-872"><span class="linenos">872</span></a><span class="sd">              *../data/pvalue_matrix.csv*.</span>
</span><span id="L-873"><a href="#L-873"><span class="linenos">873</span></a>
</span><span id="L-874"><a href="#L-874"><span class="linenos">874</span></a><span class="sd">            * If ``binary==True``, NumPy</span>
</span><span id="L-875"><a href="#L-875"><span class="linenos">875</span></a><span class="sd">              automatically appends the format ending ``.npy`` to the file.</span>
</span><span id="L-876"><a href="#L-876"><span class="linenos">876</span></a>
</span><span id="L-877"><a href="#L-877"><span class="linenos">877</span></a><span class="sd">        :param filename: name of the output file</span>
</span><span id="L-878"><a href="#L-878"><span class="linenos">878</span></a><span class="sd">        :type filename: str</span>
</span><span id="L-879"><a href="#L-879"><span class="linenos">879</span></a><span class="sd">        :param delim: delimiter between values in file</span>
</span><span id="L-880"><a href="#L-880"><span class="linenos">880</span></a><span class="sd">        :type delim: str</span>
</span><span id="L-881"><a href="#L-881"><span class="linenos">881</span></a><span class="sd">        :param binary: if ``True``, save as binary ``.npy``, otherwise as a</span>
</span><span id="L-882"><a href="#L-882"><span class="linenos">882</span></a><span class="sd">            ``.csv`` file</span>
</span><span id="L-883"><a href="#L-883"><span class="linenos">883</span></a><span class="sd">        :type binary: bool</span>
</span><span id="L-884"><a href="#L-884"><span class="linenos">884</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-885"><a href="#L-885"><span class="linenos">885</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">save_array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">adj_matrix</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">delim</span><span class="p">,</span> <span class="n">binary</span><span class="p">)</span>
</span><span id="L-886"><a href="#L-886"><span class="linenos">886</span></a>
</span><span id="L-887"><a href="#L-887"><span class="linenos">887</span></a>    <span class="nd">@staticmethod</span>
</span><span id="L-888"><a href="#L-888"><span class="linenos">888</span></a>    <span class="k">def</span> <span class="nf">save_array</span><span class="p">(</span><span class="n">mat</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">delim</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">binary</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="L-889"><a href="#L-889"><span class="linenos">889</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Save the array ``mat`` in the file ``filename``.</span>
</span><span id="L-890"><a href="#L-890"><span class="linenos">890</span></a>
</span><span id="L-891"><a href="#L-891"><span class="linenos">891</span></a><span class="sd">        The array can either be saved as a binary NumPy ``.npy`` file or as a</span>
</span><span id="L-892"><a href="#L-892"><span class="linenos">892</span></a><span class="sd">        human-readable ``.npy`` file.</span>
</span><span id="L-893"><a href="#L-893"><span class="linenos">893</span></a>
</span><span id="L-894"><a href="#L-894"><span class="linenos">894</span></a><span class="sd">        .. note::</span>
</span><span id="L-895"><a href="#L-895"><span class="linenos">895</span></a>
</span><span id="L-896"><a href="#L-896"><span class="linenos">896</span></a><span class="sd">            * The relative path has to be provided in the filename, e.g.</span>
</span><span id="L-897"><a href="#L-897"><span class="linenos">897</span></a><span class="sd">              *../data/pvalue_matrix.csv*.</span>
</span><span id="L-898"><a href="#L-898"><span class="linenos">898</span></a>
</span><span id="L-899"><a href="#L-899"><span class="linenos">899</span></a><span class="sd">            * If ``binary==True``, NumPy</span>
</span><span id="L-900"><a href="#L-900"><span class="linenos">900</span></a><span class="sd">              automatically appends the format ending ``.npy`` to the file.</span>
</span><span id="L-901"><a href="#L-901"><span class="linenos">901</span></a>
</span><span id="L-902"><a href="#L-902"><span class="linenos">902</span></a><span class="sd">        :param mat: array</span>
</span><span id="L-903"><a href="#L-903"><span class="linenos">903</span></a><span class="sd">        :type mat: numpy.array</span>
</span><span id="L-904"><a href="#L-904"><span class="linenos">904</span></a><span class="sd">        :param filename: name of the output file</span>
</span><span id="L-905"><a href="#L-905"><span class="linenos">905</span></a><span class="sd">        :type filename: str</span>
</span><span id="L-906"><a href="#L-906"><span class="linenos">906</span></a><span class="sd">        :param delim: delimiter between values in file</span>
</span><span id="L-907"><a href="#L-907"><span class="linenos">907</span></a><span class="sd">        :type delim: str</span>
</span><span id="L-908"><a href="#L-908"><span class="linenos">908</span></a><span class="sd">        :param binary: if ``True``, save as binary ``.npy``, otherwise as a</span>
</span><span id="L-909"><a href="#L-909"><span class="linenos">909</span></a><span class="sd">            ``.csv`` file</span>
</span><span id="L-910"><a href="#L-910"><span class="linenos">910</span></a><span class="sd">        :type binary: bool</span>
</span><span id="L-911"><a href="#L-911"><span class="linenos">911</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-912"><a href="#L-912"><span class="linenos">912</span></a>        <span class="k">if</span> <span class="n">binary</span><span class="p">:</span>
</span><span id="L-913"><a href="#L-913"><span class="linenos">913</span></a>            <span class="n">np</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">mat</span><span class="p">)</span>
</span><span id="L-914"><a href="#L-914"><span class="linenos">914</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-915"><a href="#L-915"><span class="linenos">915</span></a>            <span class="n">np</span><span class="o">.</span><span class="n">savetxt</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">mat</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="n">delim</span><span class="p">)</span>
</span><span id="L-916"><a href="#L-916"><span class="linenos">916</span></a>
</span><span id="L-917"><a href="#L-917"><span class="linenos">917</span></a><span class="c1">################################################################################</span>
</span><span id="L-918"><a href="#L-918"><span class="linenos">918</span></a><span class="c1"># Main</span>
</span><span id="L-919"><a href="#L-919"><span class="linenos">919</span></a><span class="c1">################################################################################</span>
</span><span id="L-920"><a href="#L-920"><span class="linenos">920</span></a>
</span><span id="L-921"><a href="#L-921"><span class="linenos">921</span></a><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
</span><span id="L-922"><a href="#L-922"><span class="linenos">922</span></a>    <span class="k">pass</span>
</span></pre></div>


            </section>
                <section id="BiCM">
                            <input id="BiCM-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">BiCM</span>:

                <label class="view-source-button" for="BiCM-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#BiCM"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="BiCM-8"><a href="#BiCM-8"><span class="linenos">  8</span></a><span class="k">class</span> <span class="nc">BiCM</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
</span><span id="BiCM-9"><a href="#BiCM-9"><span class="linenos">  9</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Bipartite Configuration Model for undirected binary bipartite networks.</span>
</span><span id="BiCM-10"><a href="#BiCM-10"><span class="linenos"> 10</span></a>
</span><span id="BiCM-11"><a href="#BiCM-11"><span class="linenos"> 11</span></a><span class="sd">    This class implements the Bipartite Configuration Model (BiCM), which can</span>
</span><span id="BiCM-12"><a href="#BiCM-12"><span class="linenos"> 12</span></a><span class="sd">    be used as a null model for the analysis of undirected and binary bipartite</span>
</span><span id="BiCM-13"><a href="#BiCM-13"><span class="linenos"> 13</span></a><span class="sd">    networks. The class provides methods for calculating the biadjacency matrix</span>
</span><span id="BiCM-14"><a href="#BiCM-14"><span class="linenos"> 14</span></a><span class="sd">    of the null model and for quantifying node similarities in terms of</span>
</span><span id="BiCM-15"><a href="#BiCM-15"><span class="linenos"> 15</span></a><span class="sd">    p-values.</span>
</span><span id="BiCM-16"><a href="#BiCM-16"><span class="linenos"> 16</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="BiCM-17"><a href="#BiCM-17"><span class="linenos"> 17</span></a>
</span><span id="BiCM-18"><a href="#BiCM-18"><span class="linenos"> 18</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bin_mat</span><span class="p">):</span>
</span><span id="BiCM-19"><a href="#BiCM-19"><span class="linenos"> 19</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize the parameters of the BiCM.</span>
</span><span id="BiCM-20"><a href="#BiCM-20"><span class="linenos"> 20</span></a>
</span><span id="BiCM-21"><a href="#BiCM-21"><span class="linenos"> 21</span></a><span class="sd">        :param bin_mat: binary input matrix describing the biadjacency matrix</span>
</span><span id="BiCM-22"><a href="#BiCM-22"><span class="linenos"> 22</span></a><span class="sd">                of a bipartite graph with the nodes of one layer along the rows</span>
</span><span id="BiCM-23"><a href="#BiCM-23"><span class="linenos"> 23</span></a><span class="sd">                and the nodes of the other layer along the columns.</span>
</span><span id="BiCM-24"><a href="#BiCM-24"><span class="linenos"> 24</span></a><span class="sd">        :type bin_mat: numpy.array</span>
</span><span id="BiCM-25"><a href="#BiCM-25"><span class="linenos"> 25</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="BiCM-26"><a href="#BiCM-26"><span class="linenos"> 26</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">bin_mat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">bin_mat</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">)</span>
</span><span id="BiCM-27"><a href="#BiCM-27"><span class="linenos"> 27</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">check_input_matrix_is_binary</span><span class="p">()</span>
</span><span id="BiCM-28"><a href="#BiCM-28"><span class="linenos"> 28</span></a>        <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">num_rows</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_columns</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bin_mat</span><span class="o">.</span><span class="n">shape</span>
</span><span id="BiCM-29"><a href="#BiCM-29"><span class="linenos"> 29</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">dseq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">set_degree_seq</span><span class="p">()</span>
</span><span id="BiCM-30"><a href="#BiCM-30"><span class="linenos"> 30</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">dim</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dseq</span><span class="o">.</span><span class="n">size</span>
</span><span id="BiCM-31"><a href="#BiCM-31"><span class="linenos"> 31</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">sol</span> <span class="o">=</span> <span class="kc">None</span>             <span class="c1"># solution of the equation system</span>
</span><span id="BiCM-32"><a href="#BiCM-32"><span class="linenos"> 32</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">adj_matrix</span> <span class="o">=</span> <span class="kc">None</span>      <span class="c1"># biadjacency matrix of the null model</span>
</span><span id="BiCM-33"><a href="#BiCM-33"><span class="linenos"> 33</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">input_queue</span> <span class="o">=</span> <span class="kc">None</span>     <span class="c1"># queue for parallel processing</span>
</span><span id="BiCM-34"><a href="#BiCM-34"><span class="linenos"> 34</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">output_queue</span> <span class="o">=</span> <span class="kc">None</span>    <span class="c1"># queue for parallel processing</span>
</span><span id="BiCM-35"><a href="#BiCM-35"><span class="linenos"> 35</span></a>
</span><span id="BiCM-36"><a href="#BiCM-36"><span class="linenos"> 36</span></a>    <span class="k">def</span> <span class="nf">check_input_matrix_is_binary</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="BiCM-37"><a href="#BiCM-37"><span class="linenos"> 37</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Check that the input matrix is binary, i.e. entries are 0 or 1.</span>
</span><span id="BiCM-38"><a href="#BiCM-38"><span class="linenos"> 38</span></a>
</span><span id="BiCM-39"><a href="#BiCM-39"><span class="linenos"> 39</span></a><span class="sd">        :raise AssertionError: raise an error if the input matrix is not</span>
</span><span id="BiCM-40"><a href="#BiCM-40"><span class="linenos"> 40</span></a><span class="sd">            binary</span>
</span><span id="BiCM-41"><a href="#BiCM-41"><span class="linenos"> 41</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="BiCM-42"><a href="#BiCM-42"><span class="linenos"> 42</span></a>        <span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">logical_or</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bin_mat</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">bin_mat</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)),</span> \
</span><span id="BiCM-43"><a href="#BiCM-43"><span class="linenos"> 43</span></a>            <span class="s2">&quot;Input matrix is not binary.&quot;</span>
</span><span id="BiCM-44"><a href="#BiCM-44"><span class="linenos"> 44</span></a>
</span><span id="BiCM-45"><a href="#BiCM-45"><span class="linenos"> 45</span></a>    <span class="k">def</span> <span class="nf">set_degree_seq</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="BiCM-46"><a href="#BiCM-46"><span class="linenos"> 46</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the node degree sequence of the input matrix.</span>
</span><span id="BiCM-47"><a href="#BiCM-47"><span class="linenos"> 47</span></a>
</span><span id="BiCM-48"><a href="#BiCM-48"><span class="linenos"> 48</span></a><span class="sd">        :returns: node degree sequence [degrees row-nodes, degrees column-nodes]</span>
</span><span id="BiCM-49"><a href="#BiCM-49"><span class="linenos"> 49</span></a><span class="sd">        :rtype: numpy.array</span>
</span><span id="BiCM-50"><a href="#BiCM-50"><span class="linenos"> 50</span></a>
</span><span id="BiCM-51"><a href="#BiCM-51"><span class="linenos"> 51</span></a><span class="sd">        :raise AssertionError: raise an error if the length of the returned</span>
</span><span id="BiCM-52"><a href="#BiCM-52"><span class="linenos"> 52</span></a><span class="sd">            degree sequence does not correspond to the total number of nodes</span>
</span><span id="BiCM-53"><a href="#BiCM-53"><span class="linenos"> 53</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="BiCM-54"><a href="#BiCM-54"><span class="linenos"> 54</span></a>        <span class="n">dseq</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_rows</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_columns</span><span class="p">)</span>
</span><span id="BiCM-55"><a href="#BiCM-55"><span class="linenos"> 55</span></a>        <span class="n">dseq</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">num_rows</span><span class="p">:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bin_mat</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>
</span><span id="BiCM-56"><a href="#BiCM-56"><span class="linenos"> 56</span></a>        <span class="n">dseq</span><span class="p">[:</span><span class="bp">self</span><span class="o">.</span><span class="n">num_rows</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bin_mat</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
</span><span id="BiCM-57"><a href="#BiCM-57"><span class="linenos"> 57</span></a>        <span class="k">assert</span> <span class="n">dseq</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_rows</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_columns</span><span class="p">)</span>
</span><span id="BiCM-58"><a href="#BiCM-58"><span class="linenos"> 58</span></a>        <span class="k">return</span> <span class="n">dseq</span>
</span><span id="BiCM-59"><a href="#BiCM-59"><span class="linenos"> 59</span></a>
</span><span id="BiCM-60"><a href="#BiCM-60"><span class="linenos"> 60</span></a>    <span class="k">def</span> <span class="nf">make_bicm</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x0</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;hybr&#39;</span><span class="p">,</span> <span class="n">jac</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">tol</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="BiCM-61"><a href="#BiCM-61"><span class="linenos"> 61</span></a>                  <span class="n">callback</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">options</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="BiCM-62"><a href="#BiCM-62"><span class="linenos"> 62</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Create the biadjacency matrix of the BiCM null model.</span>
</span><span id="BiCM-63"><a href="#BiCM-63"><span class="linenos"> 63</span></a>
</span><span id="BiCM-64"><a href="#BiCM-64"><span class="linenos"> 64</span></a><span class="sd">        Solve the log-likelihood maximization problem to obtain the BiCM</span>
</span><span id="BiCM-65"><a href="#BiCM-65"><span class="linenos"> 65</span></a><span class="sd">        null model which respects constraints on the degree sequence of the</span>
</span><span id="BiCM-66"><a href="#BiCM-66"><span class="linenos"> 66</span></a><span class="sd">        input matrix.</span>
</span><span id="BiCM-67"><a href="#BiCM-67"><span class="linenos"> 67</span></a>
</span><span id="BiCM-68"><a href="#BiCM-68"><span class="linenos"> 68</span></a><span class="sd">        The problem is solved using ``scipy``&#39;s root function with the solver</span>
</span><span id="BiCM-69"><a href="#BiCM-69"><span class="linenos"> 69</span></a><span class="sd">        defined by ``method``. The status of the solver after running</span>
</span><span id="BiCM-70"><a href="#BiCM-70"><span class="linenos"> 70</span></a><span class="sd">        ``scipy.root``and the difference between the network and BiCM degrees</span>
</span><span id="BiCM-71"><a href="#BiCM-71"><span class="linenos"> 71</span></a><span class="sd">        are printed in the console.</span>
</span><span id="BiCM-72"><a href="#BiCM-72"><span class="linenos"> 72</span></a>
</span><span id="BiCM-73"><a href="#BiCM-73"><span class="linenos"> 73</span></a><span class="sd">        The default solver is the modified Powell method ``hybr``. Least-squares</span>
</span><span id="BiCM-74"><a href="#BiCM-74"><span class="linenos"> 74</span></a><span class="sd">        can be chosen with ``method=&#39;lm&#39;`` for the Levenberg-Marquardt approach.</span>
</span><span id="BiCM-75"><a href="#BiCM-75"><span class="linenos"> 75</span></a>
</span><span id="BiCM-76"><a href="#BiCM-76"><span class="linenos"> 76</span></a><span class="sd">        Depending on the solver, keyword arguments ``kwargs`` can be passed to</span>
</span><span id="BiCM-77"><a href="#BiCM-77"><span class="linenos"> 77</span></a><span class="sd">        the solver. Please refer to the `scipy.optimize.root documentation</span>
</span><span id="BiCM-78"><a href="#BiCM-78"><span class="linenos"> 78</span></a><span class="sd">        &lt;https://docs.scipy.org/doc/scipy-0.19.0/reference/generated/</span>
</span><span id="BiCM-79"><a href="#BiCM-79"><span class="linenos"> 79</span></a><span class="sd">        scipy.optimize.root.html&gt;`_ for detailed descriptions.</span>
</span><span id="BiCM-80"><a href="#BiCM-80"><span class="linenos"> 80</span></a>
</span><span id="BiCM-81"><a href="#BiCM-81"><span class="linenos"> 81</span></a><span class="sd">        .. note::</span>
</span><span id="BiCM-82"><a href="#BiCM-82"><span class="linenos"> 82</span></a>
</span><span id="BiCM-83"><a href="#BiCM-83"><span class="linenos"> 83</span></a><span class="sd">            It can happen that the solver ``method`` used by ``scipy.root``</span>
</span><span id="BiCM-84"><a href="#BiCM-84"><span class="linenos"> 84</span></a><span class="sd">            does not converge to a solution.</span>
</span><span id="BiCM-85"><a href="#BiCM-85"><span class="linenos"> 85</span></a><span class="sd">            In this case, please try another ``method`` or different initial</span>
</span><span id="BiCM-86"><a href="#BiCM-86"><span class="linenos"> 86</span></a><span class="sd">            conditions and refer to the `scipy.optimize.root documentation</span>
</span><span id="BiCM-87"><a href="#BiCM-87"><span class="linenos"> 87</span></a><span class="sd">            &lt;https://docs.scipy.org/doc/scipy-0.19.0/reference/generated/</span>
</span><span id="BiCM-88"><a href="#BiCM-88"><span class="linenos"> 88</span></a><span class="sd">            scipy.optimize.root.html&gt;`_.</span>
</span><span id="BiCM-89"><a href="#BiCM-89"><span class="linenos"> 89</span></a>
</span><span id="BiCM-90"><a href="#BiCM-90"><span class="linenos"> 90</span></a><span class="sd">        :param x0: initial guesses for the solutions. The first entries are the</span>
</span><span id="BiCM-91"><a href="#BiCM-91"><span class="linenos"> 91</span></a><span class="sd">            initial guesses for the row-nodes, followed by the initial guesses</span>
</span><span id="BiCM-92"><a href="#BiCM-92"><span class="linenos"> 92</span></a><span class="sd">            for the column-nodes.</span>
</span><span id="BiCM-93"><a href="#BiCM-93"><span class="linenos"> 93</span></a><span class="sd">        :type x0: 1d numpy.array, optional</span>
</span><span id="BiCM-94"><a href="#BiCM-94"><span class="linenos"> 94</span></a><span class="sd">        :param method: type of solver, default is ‘hybr’. For other</span>
</span><span id="BiCM-95"><a href="#BiCM-95"><span class="linenos"> 95</span></a><span class="sd">            solvers, see the `scipy.optimize.root documentation</span>
</span><span id="BiCM-96"><a href="#BiCM-96"><span class="linenos"> 96</span></a><span class="sd">            &lt;https://docs.scipy.org/doc/</span>
</span><span id="BiCM-97"><a href="#BiCM-97"><span class="linenos"> 97</span></a><span class="sd">            scipy-0.19.0/reference/generated/scipy.optimize.root.html&gt;`_.</span>
</span><span id="BiCM-98"><a href="#BiCM-98"><span class="linenos"> 98</span></a><span class="sd">        :type method: str, optional</span>
</span><span id="BiCM-99"><a href="#BiCM-99"><span class="linenos"> 99</span></a><span class="sd">        :param jac: Jacobian of the system</span>
</span><span id="BiCM-100"><a href="#BiCM-100"><span class="linenos">100</span></a><span class="sd">        :type jac: bool or callable, optional</span>
</span><span id="BiCM-101"><a href="#BiCM-101"><span class="linenos">101</span></a><span class="sd">        :param tol: tolerance for termination. For detailed control, use</span>
</span><span id="BiCM-102"><a href="#BiCM-102"><span class="linenos">102</span></a><span class="sd">            solver-specific options.</span>
</span><span id="BiCM-103"><a href="#BiCM-103"><span class="linenos">103</span></a><span class="sd">        :type tol: float, optional</span>
</span><span id="BiCM-104"><a href="#BiCM-104"><span class="linenos">104</span></a><span class="sd">        :param callback: optional callback function to be called at</span>
</span><span id="BiCM-105"><a href="#BiCM-105"><span class="linenos">105</span></a><span class="sd">            every iteration as ``callback(self.equations, x)``,</span>
</span><span id="BiCM-106"><a href="#BiCM-106"><span class="linenos">106</span></a><span class="sd">            see ``scipy.root`` documentation</span>
</span><span id="BiCM-107"><a href="#BiCM-107"><span class="linenos">107</span></a><span class="sd">        :type callback: function, optional</span>
</span><span id="BiCM-108"><a href="#BiCM-108"><span class="linenos">108</span></a><span class="sd">        :param options: a dictionary of solver options, e.g. ``xtol`` or</span>
</span><span id="BiCM-109"><a href="#BiCM-109"><span class="linenos">109</span></a><span class="sd">            ``maxiter``, see scipy.root documentation</span>
</span><span id="BiCM-110"><a href="#BiCM-110"><span class="linenos">110</span></a><span class="sd">        :type options: dict, optional</span>
</span><span id="BiCM-111"><a href="#BiCM-111"><span class="linenos">111</span></a><span class="sd">        :param kwargs: solver-specific options, please refer to the SciPy</span>
</span><span id="BiCM-112"><a href="#BiCM-112"><span class="linenos">112</span></a><span class="sd">            documentation</span>
</span><span id="BiCM-113"><a href="#BiCM-113"><span class="linenos">113</span></a>
</span><span id="BiCM-114"><a href="#BiCM-114"><span class="linenos">114</span></a><span class="sd">        :raise ValueError: raise an error if not enough initial conditions</span>
</span><span id="BiCM-115"><a href="#BiCM-115"><span class="linenos">115</span></a><span class="sd">            are provided</span>
</span><span id="BiCM-116"><a href="#BiCM-116"><span class="linenos">116</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="BiCM-117"><a href="#BiCM-117"><span class="linenos">117</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="BiCM-118"><a href="#BiCM-118"><span class="linenos">118</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">sol</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">solve_equations</span><span class="p">(</span><span class="n">x0</span><span class="o">=</span><span class="n">x0</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="n">method</span><span class="p">,</span> <span class="n">jac</span><span class="o">=</span><span class="n">jac</span><span class="p">,</span> <span class="n">tol</span><span class="o">=</span><span class="n">tol</span><span class="p">,</span>
</span><span id="BiCM-119"><a href="#BiCM-119"><span class="linenos">119</span></a>                                            <span class="n">callback</span><span class="o">=</span><span class="n">callback</span><span class="p">,</span> <span class="n">options</span><span class="o">=</span><span class="n">options</span><span class="p">)</span>
</span><span id="BiCM-120"><a href="#BiCM-120"><span class="linenos">120</span></a>            <span class="c1"># create BiCM biadjacency matrix:</span>
</span><span id="BiCM-121"><a href="#BiCM-121"><span class="linenos">121</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">adj_matrix</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_biadjacency_matrix</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sol</span><span class="o">.</span><span class="n">x</span><span class="p">)</span>
</span><span id="BiCM-122"><a href="#BiCM-122"><span class="linenos">122</span></a>            <span class="c1"># self.print_max_degree_differences()</span>
</span><span id="BiCM-123"><a href="#BiCM-123"><span class="linenos">123</span></a>            <span class="c1"># assert self.test_average_degrees(eps=1e-2)</span>
</span><span id="BiCM-124"><a href="#BiCM-124"><span class="linenos">124</span></a>        <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="BiCM-125"><a href="#BiCM-125"><span class="linenos">125</span></a>            <span class="c1"># Catch and handle the ValueError</span>
</span><span id="BiCM-126"><a href="#BiCM-126"><span class="linenos">126</span></a>            <span class="c1">#print(f&quot;Caught a ValueError: {e}&quot;)</span>
</span><span id="BiCM-127"><a href="#BiCM-127"><span class="linenos">127</span></a>            <span class="n">errror_msg</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="BiCM-128"><a href="#BiCM-128"><span class="linenos">128</span></a>
</span><span id="BiCM-129"><a href="#BiCM-129"><span class="linenos">129</span></a>
</span><span id="BiCM-130"><a href="#BiCM-130"><span class="linenos">130</span></a><span class="c1"># ------------------------------------------------------------------------------</span>
</span><span id="BiCM-131"><a href="#BiCM-131"><span class="linenos">131</span></a><span class="c1"># Solve coupled nonlinear equations and get BiCM biadjacency matrix</span>
</span><span id="BiCM-132"><a href="#BiCM-132"><span class="linenos">132</span></a><span class="c1"># ------------------------------------------------------------------------------</span>
</span><span id="BiCM-133"><a href="#BiCM-133"><span class="linenos">133</span></a>
</span><span id="BiCM-134"><a href="#BiCM-134"><span class="linenos">134</span></a>    <span class="k">def</span> <span class="nf">solve_equations</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x0</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;hybr&#39;</span><span class="p">,</span> <span class="n">jac</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">tol</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="BiCM-135"><a href="#BiCM-135"><span class="linenos">135</span></a>                        <span class="n">callback</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">options</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="BiCM-136"><a href="#BiCM-136"><span class="linenos">136</span></a>
</span><span id="BiCM-137"><a href="#BiCM-137"><span class="linenos">137</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Solve the system of equations of the maximum log-likelihood problem.</span>
</span><span id="BiCM-138"><a href="#BiCM-138"><span class="linenos">138</span></a>
</span><span id="BiCM-139"><a href="#BiCM-139"><span class="linenos">139</span></a><span class="sd">        The system of equations is solved using ``scipy``&#39;s root function with</span>
</span><span id="BiCM-140"><a href="#BiCM-140"><span class="linenos">140</span></a><span class="sd">        the solver defined by ``method``. The solutions correspond to the</span>
</span><span id="BiCM-141"><a href="#BiCM-141"><span class="linenos">141</span></a><span class="sd">        Lagrange multipliers</span>
</span><span id="BiCM-142"><a href="#BiCM-142"><span class="linenos">142</span></a>
</span><span id="BiCM-143"><a href="#BiCM-143"><span class="linenos">143</span></a><span class="sd">        .. math::</span>
</span><span id="BiCM-144"><a href="#BiCM-144"><span class="linenos">144</span></a>
</span><span id="BiCM-145"><a href="#BiCM-145"><span class="linenos">145</span></a><span class="sd">            x_i = \exp(-\\theta_i).</span>
</span><span id="BiCM-146"><a href="#BiCM-146"><span class="linenos">146</span></a>
</span><span id="BiCM-147"><a href="#BiCM-147"><span class="linenos">147</span></a><span class="sd">        Depending on the solver, keyword arguments ``kwargs`` can be passed to</span>
</span><span id="BiCM-148"><a href="#BiCM-148"><span class="linenos">148</span></a><span class="sd">        the solver. Please refer to the `scipy.optimize.root documentation</span>
</span><span id="BiCM-149"><a href="#BiCM-149"><span class="linenos">149</span></a><span class="sd">        &lt;https://docs.scipy.org/doc/scipy-0.19.0/reference/generated/</span>
</span><span id="BiCM-150"><a href="#BiCM-150"><span class="linenos">150</span></a><span class="sd">        scipy.optimize.root.html&gt;`_ for detailed descriptions.</span>
</span><span id="BiCM-151"><a href="#BiCM-151"><span class="linenos">151</span></a>
</span><span id="BiCM-152"><a href="#BiCM-152"><span class="linenos">152</span></a><span class="sd">        The default solver is the modified Powell method ``hybr``. Least-squares</span>
</span><span id="BiCM-153"><a href="#BiCM-153"><span class="linenos">153</span></a><span class="sd">        can be chosen with ``method=&#39;lm&#39;`` for the Levenberg-Marquardt approach.</span>
</span><span id="BiCM-154"><a href="#BiCM-154"><span class="linenos">154</span></a>
</span><span id="BiCM-155"><a href="#BiCM-155"><span class="linenos">155</span></a><span class="sd">        .. note::</span>
</span><span id="BiCM-156"><a href="#BiCM-156"><span class="linenos">156</span></a>
</span><span id="BiCM-157"><a href="#BiCM-157"><span class="linenos">157</span></a><span class="sd">            It can happen that the solver ``method`` used by ``scipy.root``</span>
</span><span id="BiCM-158"><a href="#BiCM-158"><span class="linenos">158</span></a><span class="sd">            does not converge to a solution.</span>
</span><span id="BiCM-159"><a href="#BiCM-159"><span class="linenos">159</span></a><span class="sd">            In this case, please try another ``method`` or different initial</span>
</span><span id="BiCM-160"><a href="#BiCM-160"><span class="linenos">160</span></a><span class="sd">            conditions and refer to the `scipy.optimize.root documentation</span>
</span><span id="BiCM-161"><a href="#BiCM-161"><span class="linenos">161</span></a><span class="sd">            &lt;https://docs.scipy.org/doc/scipy-0.19.0/reference/generated/</span>
</span><span id="BiCM-162"><a href="#BiCM-162"><span class="linenos">162</span></a><span class="sd">            scipy.optimize.root.html&gt;`_.</span>
</span><span id="BiCM-163"><a href="#BiCM-163"><span class="linenos">163</span></a>
</span><span id="BiCM-164"><a href="#BiCM-164"><span class="linenos">164</span></a><span class="sd">        :param x0: initial guesses for the solutions. The first entries are the</span>
</span><span id="BiCM-165"><a href="#BiCM-165"><span class="linenos">165</span></a><span class="sd">            initial guesses for the row-nodes, followed by the initial guesses</span>
</span><span id="BiCM-166"><a href="#BiCM-166"><span class="linenos">166</span></a><span class="sd">            for the column-nodes.</span>
</span><span id="BiCM-167"><a href="#BiCM-167"><span class="linenos">167</span></a><span class="sd">        :type x0: 1d numpy.array, optional</span>
</span><span id="BiCM-168"><a href="#BiCM-168"><span class="linenos">168</span></a><span class="sd">        :param method: type of solver, default is ‘hybr’. For other</span>
</span><span id="BiCM-169"><a href="#BiCM-169"><span class="linenos">169</span></a><span class="sd">            solvers, see the `scipy.optimize.root documentation</span>
</span><span id="BiCM-170"><a href="#BiCM-170"><span class="linenos">170</span></a><span class="sd">            &lt;https://docs.scipy.org/doc/</span>
</span><span id="BiCM-171"><a href="#BiCM-171"><span class="linenos">171</span></a><span class="sd">            scipy-0.19.0/reference/generated/scipy.optimize.root.html&gt;`_.</span>
</span><span id="BiCM-172"><a href="#BiCM-172"><span class="linenos">172</span></a><span class="sd">        :type method: str, optional</span>
</span><span id="BiCM-173"><a href="#BiCM-173"><span class="linenos">173</span></a><span class="sd">        :param jac: Jacobian of the system</span>
</span><span id="BiCM-174"><a href="#BiCM-174"><span class="linenos">174</span></a><span class="sd">        :type jac: bool or callable, optional</span>
</span><span id="BiCM-175"><a href="#BiCM-175"><span class="linenos">175</span></a><span class="sd">        :param tol: tolerance for termination. For detailed control, use</span>
</span><span id="BiCM-176"><a href="#BiCM-176"><span class="linenos">176</span></a><span class="sd">            solver-specific options.</span>
</span><span id="BiCM-177"><a href="#BiCM-177"><span class="linenos">177</span></a><span class="sd">        :type tol: float, optional</span>
</span><span id="BiCM-178"><a href="#BiCM-178"><span class="linenos">178</span></a><span class="sd">        :param callback: optional callback function to be called at</span>
</span><span id="BiCM-179"><a href="#BiCM-179"><span class="linenos">179</span></a><span class="sd">            every iteration as ``callback(self.equations, x)``,</span>
</span><span id="BiCM-180"><a href="#BiCM-180"><span class="linenos">180</span></a><span class="sd">            see ``scipy.root`` documentation</span>
</span><span id="BiCM-181"><a href="#BiCM-181"><span class="linenos">181</span></a><span class="sd">        :type callback: function, optional</span>
</span><span id="BiCM-182"><a href="#BiCM-182"><span class="linenos">182</span></a><span class="sd">        :param options: a dictionary of solver options, e.g. ``xtol`` or</span>
</span><span id="BiCM-183"><a href="#BiCM-183"><span class="linenos">183</span></a><span class="sd">            ``maxiter``, see scipy.root documentation</span>
</span><span id="BiCM-184"><a href="#BiCM-184"><span class="linenos">184</span></a><span class="sd">        :type options: dict, optional</span>
</span><span id="BiCM-185"><a href="#BiCM-185"><span class="linenos">185</span></a><span class="sd">        :param kwargs: solver-specific options, please refer to the SciPy</span>
</span><span id="BiCM-186"><a href="#BiCM-186"><span class="linenos">186</span></a><span class="sd">            documentation</span>
</span><span id="BiCM-187"><a href="#BiCM-187"><span class="linenos">187</span></a><span class="sd">        :returns: solution of the equation system</span>
</span><span id="BiCM-188"><a href="#BiCM-188"><span class="linenos">188</span></a><span class="sd">        :rtype: scipy.optimize.OptimizeResult</span>
</span><span id="BiCM-189"><a href="#BiCM-189"><span class="linenos">189</span></a>
</span><span id="BiCM-190"><a href="#BiCM-190"><span class="linenos">190</span></a><span class="sd">        :raise ValueError: raise an error if not enough initial conditions</span>
</span><span id="BiCM-191"><a href="#BiCM-191"><span class="linenos">191</span></a><span class="sd">            are provided</span>
</span><span id="BiCM-192"><a href="#BiCM-192"><span class="linenos">192</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="BiCM-193"><a href="#BiCM-193"><span class="linenos">193</span></a>        <span class="c1"># use Jacobian if the hybr solver is chosen</span>
</span><span id="BiCM-194"><a href="#BiCM-194"><span class="linenos">194</span></a>        <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;hybr&#39;</span><span class="p">:</span>
</span><span id="BiCM-195"><a href="#BiCM-195"><span class="linenos">195</span></a>            <span class="n">jac</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">jacobian</span>
</span><span id="BiCM-196"><a href="#BiCM-196"><span class="linenos">196</span></a>
</span><span id="BiCM-197"><a href="#BiCM-197"><span class="linenos">197</span></a>        <span class="c1"># set initial conditions</span>
</span><span id="BiCM-198"><a href="#BiCM-198"><span class="linenos">198</span></a>        <span class="k">if</span> <span class="n">x0</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="BiCM-199"><a href="#BiCM-199"><span class="linenos">199</span></a>            <span class="n">x0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dseq</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dseq</span><span class="p">))</span>
</span><span id="BiCM-200"><a href="#BiCM-200"><span class="linenos">200</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="BiCM-201"><a href="#BiCM-201"><span class="linenos">201</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="nb">len</span><span class="p">(</span><span class="n">x0</span><span class="p">)</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">dim</span><span class="p">:</span>
</span><span id="BiCM-202"><a href="#BiCM-202"><span class="linenos">202</span></a>                <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;One initial condition for each parameter is required.&quot;</span>
</span><span id="BiCM-203"><a href="#BiCM-203"><span class="linenos">203</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</span><span id="BiCM-204"><a href="#BiCM-204"><span class="linenos">204</span></a>
</span><span id="BiCM-205"><a href="#BiCM-205"><span class="linenos">205</span></a>        <span class="c1"># solve equation system</span>
</span><span id="BiCM-206"><a href="#BiCM-206"><span class="linenos">206</span></a>        <span class="n">sol</span> <span class="o">=</span> <span class="n">opt</span><span class="o">.</span><span class="n">root</span><span class="p">(</span><span class="n">fun</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">equations</span><span class="p">,</span> <span class="n">x0</span><span class="o">=</span><span class="n">x0</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="n">method</span><span class="p">,</span> <span class="n">jac</span><span class="o">=</span><span class="n">jac</span><span class="p">,</span>
</span><span id="BiCM-207"><a href="#BiCM-207"><span class="linenos">207</span></a>                       <span class="n">tol</span><span class="o">=</span><span class="n">tol</span><span class="p">,</span> <span class="n">options</span><span class="o">=</span><span class="n">options</span><span class="p">,</span> <span class="n">callback</span><span class="o">=</span><span class="n">callback</span><span class="p">)</span>
</span><span id="BiCM-208"><a href="#BiCM-208"><span class="linenos">208</span></a>
</span><span id="BiCM-209"><a href="#BiCM-209"><span class="linenos">209</span></a>        <span class="c1"># check whether system has been solved successfully</span>
</span><span id="BiCM-210"><a href="#BiCM-210"><span class="linenos">210</span></a>        <span class="c1">#print(&quot;Solver successful:&quot;, sol.success)</span>
</span><span id="BiCM-211"><a href="#BiCM-211"><span class="linenos">211</span></a>        <span class="c1">#print sol.message</span>
</span><span id="BiCM-212"><a href="#BiCM-212"><span class="linenos">212</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">sol</span><span class="o">.</span><span class="n">success</span><span class="p">:</span>
</span><span id="BiCM-213"><a href="#BiCM-213"><span class="linenos">213</span></a>            <span class="n">errmsg</span> <span class="o">=</span> <span class="s2">&quot;Try different initial conditions and/or a&quot;</span> <span class="o">+</span> \
</span><span id="BiCM-214"><a href="#BiCM-214"><span class="linenos">214</span></a>                     <span class="s2">&quot;different solver, see documentation at &quot;</span> <span class="o">+</span> \
</span><span id="BiCM-215"><a href="#BiCM-215"><span class="linenos">215</span></a>                     <span class="s2">&quot;https://docs.scipy.org/doc/scipy-0.19.0/reference/&quot;</span> <span class="o">+</span> \
</span><span id="BiCM-216"><a href="#BiCM-216"><span class="linenos">216</span></a>                     <span class="s2">&quot;generated/scipy.optimize.root.html&quot;</span>
</span><span id="BiCM-217"><a href="#BiCM-217"><span class="linenos">217</span></a>
</span><span id="BiCM-218"><a href="#BiCM-218"><span class="linenos">218</span></a>            <span class="c1">#print(errmsg)</span>
</span><span id="BiCM-219"><a href="#BiCM-219"><span class="linenos">219</span></a>        <span class="k">return</span> <span class="n">sol</span>
</span><span id="BiCM-220"><a href="#BiCM-220"><span class="linenos">220</span></a>
</span><span id="BiCM-221"><a href="#BiCM-221"><span class="linenos">221</span></a>    <span class="k">def</span> <span class="nf">equations</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xx</span><span class="p">):</span>
</span><span id="BiCM-222"><a href="#BiCM-222"><span class="linenos">222</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the equations of the log-likelihood maximization problem.</span>
</span><span id="BiCM-223"><a href="#BiCM-223"><span class="linenos">223</span></a>
</span><span id="BiCM-224"><a href="#BiCM-224"><span class="linenos">224</span></a><span class="sd">        Note that the equations for the row-nodes depend only on the</span>
</span><span id="BiCM-225"><a href="#BiCM-225"><span class="linenos">225</span></a><span class="sd">        column-nodes and vice versa, see [Saracco2015]_.</span>
</span><span id="BiCM-226"><a href="#BiCM-226"><span class="linenos">226</span></a>
</span><span id="BiCM-227"><a href="#BiCM-227"><span class="linenos">227</span></a><span class="sd">        :param xx: Lagrange multipliers which have to be solved</span>
</span><span id="BiCM-228"><a href="#BiCM-228"><span class="linenos">228</span></a><span class="sd">        :type xx: numpy.array</span>
</span><span id="BiCM-229"><a href="#BiCM-229"><span class="linenos">229</span></a><span class="sd">        :returns: equations to be solved (:math:`f(x) = 0`)</span>
</span><span id="BiCM-230"><a href="#BiCM-230"><span class="linenos">230</span></a><span class="sd">        :rtype: numpy.array</span>
</span><span id="BiCM-231"><a href="#BiCM-231"><span class="linenos">231</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="BiCM-232"><a href="#BiCM-232"><span class="linenos">232</span></a>        <span class="n">eq</span> <span class="o">=</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">dseq</span>
</span><span id="BiCM-233"><a href="#BiCM-233"><span class="linenos">233</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_rows</span><span class="p">):</span>
</span><span id="BiCM-234"><a href="#BiCM-234"><span class="linenos">234</span></a>            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_rows</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dim</span><span class="p">):</span>
</span><span id="BiCM-235"><a href="#BiCM-235"><span class="linenos">235</span></a>                <span class="n">dum</span> <span class="o">=</span> <span class="n">xx</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">xx</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">/</span> <span class="p">(</span><span class="mf">1.</span> <span class="o">+</span> <span class="n">xx</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">xx</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>
</span><span id="BiCM-236"><a href="#BiCM-236"><span class="linenos">236</span></a>                <span class="n">eq</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+=</span> <span class="n">dum</span>
</span><span id="BiCM-237"><a href="#BiCM-237"><span class="linenos">237</span></a>                <span class="n">eq</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">+=</span> <span class="n">dum</span>
</span><span id="BiCM-238"><a href="#BiCM-238"><span class="linenos">238</span></a>        <span class="k">return</span> <span class="n">eq</span>
</span><span id="BiCM-239"><a href="#BiCM-239"><span class="linenos">239</span></a>
</span><span id="BiCM-240"><a href="#BiCM-240"><span class="linenos">240</span></a>    <span class="k">def</span> <span class="nf">jacobian</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xx</span><span class="p">):</span>
</span><span id="BiCM-241"><a href="#BiCM-241"><span class="linenos">241</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Return a NumPy array with the Jacobian of the equation system.</span>
</span><span id="BiCM-242"><a href="#BiCM-242"><span class="linenos">242</span></a>
</span><span id="BiCM-243"><a href="#BiCM-243"><span class="linenos">243</span></a><span class="sd">        :param xx: Lagrange multipliers which have to be solved</span>
</span><span id="BiCM-244"><a href="#BiCM-244"><span class="linenos">244</span></a><span class="sd">        :type xx: numpy.array</span>
</span><span id="BiCM-245"><a href="#BiCM-245"><span class="linenos">245</span></a><span class="sd">        :returns: Jacobian</span>
</span><span id="BiCM-246"><a href="#BiCM-246"><span class="linenos">246</span></a><span class="sd">        :rtype: numpy.array</span>
</span><span id="BiCM-247"><a href="#BiCM-247"><span class="linenos">247</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="BiCM-248"><a href="#BiCM-248"><span class="linenos">248</span></a>        <span class="n">jac</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">dim</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dim</span><span class="p">))</span>
</span><span id="BiCM-249"><a href="#BiCM-249"><span class="linenos">249</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_rows</span><span class="p">):</span>
</span><span id="BiCM-250"><a href="#BiCM-250"><span class="linenos">250</span></a>            <span class="c1"># df_c / df_c&#39; = 0 for all c&#39; != c</span>
</span><span id="BiCM-251"><a href="#BiCM-251"><span class="linenos">251</span></a>            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_rows</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dim</span><span class="p">):</span>
</span><span id="BiCM-252"><a href="#BiCM-252"><span class="linenos">252</span></a>                <span class="c1"># df_c / dx_c != 0</span>
</span><span id="BiCM-253"><a href="#BiCM-253"><span class="linenos">253</span></a>                <span class="n">xxi</span> <span class="o">=</span> <span class="n">xx</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">/</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">+</span> <span class="n">xx</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">xx</span><span class="p">[</span><span class="n">j</span><span class="p">])</span> <span class="o">**</span> <span class="mi">2</span>
</span><span id="BiCM-254"><a href="#BiCM-254"><span class="linenos">254</span></a>                <span class="n">xxj</span> <span class="o">=</span> <span class="n">xx</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">/</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">+</span> <span class="n">xx</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">xx</span><span class="p">[</span><span class="n">j</span><span class="p">])</span> <span class="o">**</span> <span class="mi">2</span>
</span><span id="BiCM-255"><a href="#BiCM-255"><span class="linenos">255</span></a>                <span class="n">jac</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">+=</span> <span class="n">xxj</span>
</span><span id="BiCM-256"><a href="#BiCM-256"><span class="linenos">256</span></a>                <span class="n">jac</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">xxi</span>
</span><span id="BiCM-257"><a href="#BiCM-257"><span class="linenos">257</span></a>                <span class="n">jac</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">xxj</span>
</span><span id="BiCM-258"><a href="#BiCM-258"><span class="linenos">258</span></a>                <span class="n">jac</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">+=</span> <span class="n">xxi</span>
</span><span id="BiCM-259"><a href="#BiCM-259"><span class="linenos">259</span></a>        <span class="k">return</span> <span class="n">jac</span>
</span><span id="BiCM-260"><a href="#BiCM-260"><span class="linenos">260</span></a>
</span><span id="BiCM-261"><a href="#BiCM-261"><span class="linenos">261</span></a>    <span class="k">def</span> <span class="nf">get_biadjacency_matrix</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xx</span><span class="p">):</span>
</span><span id="BiCM-262"><a href="#BiCM-262"><span class="linenos">262</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot; Calculate the biadjacency matrix of the null model.</span>
</span><span id="BiCM-263"><a href="#BiCM-263"><span class="linenos">263</span></a>
</span><span id="BiCM-264"><a href="#BiCM-264"><span class="linenos">264</span></a><span class="sd">        The biadjacency matrix describes the BiCM null model, i.e. the optimal</span>
</span><span id="BiCM-265"><a href="#BiCM-265"><span class="linenos">265</span></a><span class="sd">        average graph :math:`&lt;G&gt;^*` with the average link probabilities</span>
</span><span id="BiCM-266"><a href="#BiCM-266"><span class="linenos">266</span></a><span class="sd">        :math:`&lt;G&gt;^*_{rc} = p_{rc}` ,</span>
</span><span id="BiCM-267"><a href="#BiCM-267"><span class="linenos">267</span></a><span class="sd">        :math:`p_{rc} = \\frac{x_r \\cdot x_c}{1 + x_r\\cdot x_c}.`</span>
</span><span id="BiCM-268"><a href="#BiCM-268"><span class="linenos">268</span></a><span class="sd">        :math:`x` are the solutions of the equation system which has to be</span>
</span><span id="BiCM-269"><a href="#BiCM-269"><span class="linenos">269</span></a><span class="sd">        solved for the null model.</span>
</span><span id="BiCM-270"><a href="#BiCM-270"><span class="linenos">270</span></a><span class="sd">        Note that :math:`r` and :math:`c` are taken from opposite bipartite</span>
</span><span id="BiCM-271"><a href="#BiCM-271"><span class="linenos">271</span></a><span class="sd">        node sets, thus :math:`r \\neq c`.</span>
</span><span id="BiCM-272"><a href="#BiCM-272"><span class="linenos">272</span></a>
</span><span id="BiCM-273"><a href="#BiCM-273"><span class="linenos">273</span></a><span class="sd">        :param xx: solutions of the equation system (Lagrange multipliers)</span>
</span><span id="BiCM-274"><a href="#BiCM-274"><span class="linenos">274</span></a><span class="sd">        :type xx: numpy.array</span>
</span><span id="BiCM-275"><a href="#BiCM-275"><span class="linenos">275</span></a><span class="sd">        :returns: biadjacency matrix of the null model</span>
</span><span id="BiCM-276"><a href="#BiCM-276"><span class="linenos">276</span></a><span class="sd">        :rtype: numpy.array</span>
</span><span id="BiCM-277"><a href="#BiCM-277"><span class="linenos">277</span></a>
</span><span id="BiCM-278"><a href="#BiCM-278"><span class="linenos">278</span></a><span class="sd">        :raises ValueError: raise an error if :math:`p_{rc} &lt; 0` or</span>
</span><span id="BiCM-279"><a href="#BiCM-279"><span class="linenos">279</span></a><span class="sd">            :math:`p_{rc} &gt; 1` for any :math:`r, c`</span>
</span><span id="BiCM-280"><a href="#BiCM-280"><span class="linenos">280</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="BiCM-281"><a href="#BiCM-281"><span class="linenos">281</span></a>        <span class="n">mat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">num_rows</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_columns</span><span class="p">))</span>
</span><span id="BiCM-282"><a href="#BiCM-282"><span class="linenos">282</span></a>        <span class="n">xp</span> <span class="o">=</span> <span class="n">xx</span><span class="p">[</span><span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_rows</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dim</span><span class="p">)]</span>
</span><span id="BiCM-283"><a href="#BiCM-283"><span class="linenos">283</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_rows</span><span class="p">):</span>
</span><span id="BiCM-284"><a href="#BiCM-284"><span class="linenos">284</span></a>            <span class="n">mat</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">]</span> <span class="o">=</span> <span class="n">xx</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">xp</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">xx</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">xp</span><span class="p">)</span>
</span><span id="BiCM-285"><a href="#BiCM-285"><span class="linenos">285</span></a>
</span><span id="BiCM-286"><a href="#BiCM-286"><span class="linenos">286</span></a>        <span class="c1"># account for machine precision:</span>
</span><span id="BiCM-287"><a href="#BiCM-287"><span class="linenos">287</span></a>        <span class="n">mat</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">finfo</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span><span class="o">.</span><span class="n">eps</span>
</span><span id="BiCM-288"><a href="#BiCM-288"><span class="linenos">288</span></a>
</span><span id="BiCM-289"><a href="#BiCM-289"><span class="linenos">289</span></a>        <span class="c1">#print(&#39;matrix debug:&#39;)</span>
</span><span id="BiCM-290"><a href="#BiCM-290"><span class="linenos">290</span></a>        <span class="c1">#for r in mat:</span>
</span><span id="BiCM-291"><a href="#BiCM-291"><span class="linenos">291</span></a>        <span class="c1">#    print(r)</span>
</span><span id="BiCM-292"><a href="#BiCM-292"><span class="linenos">292</span></a>
</span><span id="BiCM-293"><a href="#BiCM-293"><span class="linenos">293</span></a>        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">mat</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">):</span>
</span><span id="BiCM-294"><a href="#BiCM-294"><span class="linenos">294</span></a>            <span class="n">errmsg</span> <span class="o">=</span> <span class="s1">&#39;Error in get_adjacency_matrix: probabilities &lt; 0 in &#39;</span> \
</span><span id="BiCM-295"><a href="#BiCM-295"><span class="linenos">295</span></a>                  <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">mat</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">))</span>
</span><span id="BiCM-296"><a href="#BiCM-296"><span class="linenos">296</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">errmsg</span><span class="p">)</span>
</span><span id="BiCM-297"><a href="#BiCM-297"><span class="linenos">297</span></a>        <span class="k">elif</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">mat</span> <span class="o">&gt;</span> <span class="p">(</span><span class="mf">1.</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">finfo</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span><span class="o">.</span><span class="n">eps</span><span class="p">)):</span>
</span><span id="BiCM-298"><a href="#BiCM-298"><span class="linenos">298</span></a>            <span class="n">errmsg</span> <span class="o">=</span> <span class="s1">&#39;Error in get_adjacency_matrix: probabilities &gt; 1 in&#39;</span> \
</span><span id="BiCM-299"><a href="#BiCM-299"><span class="linenos">299</span></a>                  <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">mat</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">))</span>
</span><span id="BiCM-300"><a href="#BiCM-300"><span class="linenos">300</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">errmsg</span><span class="p">)</span>
</span><span id="BiCM-301"><a href="#BiCM-301"><span class="linenos">301</span></a>        <span class="k">assert</span> <span class="n">mat</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">bin_mat</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> \
</span><span id="BiCM-302"><a href="#BiCM-302"><span class="linenos">302</span></a>            <span class="s2">&quot;Biadjacency matrix has wrong dimensions.&quot;</span>
</span><span id="BiCM-303"><a href="#BiCM-303"><span class="linenos">303</span></a>        <span class="k">return</span> <span class="n">mat</span>
</span><span id="BiCM-304"><a href="#BiCM-304"><span class="linenos">304</span></a>
</span><span id="BiCM-305"><a href="#BiCM-305"><span class="linenos">305</span></a><span class="c1"># ------------------------------------------------------------------------------</span>
</span><span id="BiCM-306"><a href="#BiCM-306"><span class="linenos">306</span></a><span class="c1"># Test correctness of results:</span>
</span><span id="BiCM-307"><a href="#BiCM-307"><span class="linenos">307</span></a><span class="c1"># ------------------------------------------------------------------------------</span>
</span><span id="BiCM-308"><a href="#BiCM-308"><span class="linenos">308</span></a>
</span><span id="BiCM-309"><a href="#BiCM-309"><span class="linenos">309</span></a>    <span class="k">def</span> <span class="nf">print_max_degree_differences</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="BiCM-310"><a href="#BiCM-310"><span class="linenos">310</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Print the maximal differences between input network and BiCM degrees.</span>
</span><span id="BiCM-311"><a href="#BiCM-311"><span class="linenos">311</span></a>
</span><span id="BiCM-312"><a href="#BiCM-312"><span class="linenos">312</span></a><span class="sd">        Check that the degree sequence of the solved BiCM null model graph</span>
</span><span id="BiCM-313"><a href="#BiCM-313"><span class="linenos">313</span></a><span class="sd">        corresponds to the degree sequence of the input graph.</span>
</span><span id="BiCM-314"><a href="#BiCM-314"><span class="linenos">314</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="BiCM-315"><a href="#BiCM-315"><span class="linenos">315</span></a>        <span class="n">ave_deg_columns</span> <span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">adj_matrix</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span><span id="BiCM-316"><a href="#BiCM-316"><span class="linenos">316</span></a>        <span class="n">ave_deg_rows</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">adj_matrix</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="BiCM-317"><a href="#BiCM-317"><span class="linenos">317</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Maximal degree differences between data and BiCM:&quot;</span><span class="p">)</span>
</span><span id="BiCM-318"><a href="#BiCM-318"><span class="linenos">318</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Columns:&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span>
</span><span id="BiCM-319"><a href="#BiCM-319"><span class="linenos">319</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">dseq</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">num_rows</span><span class="p">:]</span> <span class="o">-</span> <span class="n">ave_deg_columns</span><span class="p">)))</span>
</span><span id="BiCM-320"><a href="#BiCM-320"><span class="linenos">320</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Rows:&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span>
</span><span id="BiCM-321"><a href="#BiCM-321"><span class="linenos">321</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">dseq</span><span class="p">[:</span><span class="bp">self</span><span class="o">.</span><span class="n">num_rows</span><span class="p">]</span> <span class="o">-</span> <span class="n">ave_deg_rows</span><span class="p">)))</span>
</span><span id="BiCM-322"><a href="#BiCM-322"><span class="linenos">322</span></a>
</span><span id="BiCM-323"><a href="#BiCM-323"><span class="linenos">323</span></a>    <span class="k">def</span> <span class="nf">test_average_degrees</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">eps</span><span class="o">=</span><span class="mf">1e-2</span><span class="p">):</span>
</span><span id="BiCM-324"><a href="#BiCM-324"><span class="linenos">324</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Test the constraints on the node degrees.</span>
</span><span id="BiCM-325"><a href="#BiCM-325"><span class="linenos">325</span></a>
</span><span id="BiCM-326"><a href="#BiCM-326"><span class="linenos">326</span></a><span class="sd">        Check that the degree sequence of the solved BiCM null model graph</span>
</span><span id="BiCM-327"><a href="#BiCM-327"><span class="linenos">327</span></a><span class="sd">        corresponds to the degree sequence of the input graph.</span>
</span><span id="BiCM-328"><a href="#BiCM-328"><span class="linenos">328</span></a>
</span><span id="BiCM-329"><a href="#BiCM-329"><span class="linenos">329</span></a><span class="sd">        :param eps: maximum difference between degrees of the real network</span>
</span><span id="BiCM-330"><a href="#BiCM-330"><span class="linenos">330</span></a><span class="sd">            and the BiCM</span>
</span><span id="BiCM-331"><a href="#BiCM-331"><span class="linenos">331</span></a><span class="sd">        :type eps: float</span>
</span><span id="BiCM-332"><a href="#BiCM-332"><span class="linenos">332</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="BiCM-333"><a href="#BiCM-333"><span class="linenos">333</span></a>        <span class="n">ave_deg_columns</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">adj_matrix</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>
</span><span id="BiCM-334"><a href="#BiCM-334"><span class="linenos">334</span></a>        <span class="n">ave_deg_rows</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">adj_matrix</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
</span><span id="BiCM-335"><a href="#BiCM-335"><span class="linenos">335</span></a>        <span class="n">c_derr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">logical_or</span><span class="p">(</span>
</span><span id="BiCM-336"><a href="#BiCM-336"><span class="linenos">336</span></a>            <span class="c1"># average degree too small:</span>
</span><span id="BiCM-337"><a href="#BiCM-337"><span class="linenos">337</span></a>            <span class="n">ave_deg_rows</span> <span class="o">+</span> <span class="n">eps</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">dseq</span><span class="p">[:</span><span class="bp">self</span><span class="o">.</span><span class="n">num_rows</span><span class="p">],</span>
</span><span id="BiCM-338"><a href="#BiCM-338"><span class="linenos">338</span></a>            <span class="c1"># average degree too large:</span>
</span><span id="BiCM-339"><a href="#BiCM-339"><span class="linenos">339</span></a>            <span class="n">ave_deg_rows</span> <span class="o">-</span> <span class="n">eps</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">dseq</span><span class="p">[:</span><span class="bp">self</span><span class="o">.</span><span class="n">num_rows</span><span class="p">]))</span>
</span><span id="BiCM-340"><a href="#BiCM-340"><span class="linenos">340</span></a>        <span class="n">p_derr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">logical_or</span><span class="p">(</span>
</span><span id="BiCM-341"><a href="#BiCM-341"><span class="linenos">341</span></a>            <span class="n">ave_deg_columns</span> <span class="o">+</span> <span class="n">eps</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">dseq</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">num_rows</span><span class="p">:],</span>
</span><span id="BiCM-342"><a href="#BiCM-342"><span class="linenos">342</span></a>            <span class="n">ave_deg_columns</span> <span class="o">-</span> <span class="n">eps</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">dseq</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">num_rows</span><span class="p">:]))</span>
</span><span id="BiCM-343"><a href="#BiCM-343"><span class="linenos">343</span></a>        <span class="c1"># Check row-nodes degrees:</span>
</span><span id="BiCM-344"><a href="#BiCM-344"><span class="linenos">344</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">array_equiv</span><span class="p">(</span><span class="n">c_derr</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])):</span>
</span><span id="BiCM-345"><a href="#BiCM-345"><span class="linenos">345</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;...inaccurate row-nodes degrees:&#39;</span><span class="p">)</span>
</span><span id="BiCM-346"><a href="#BiCM-346"><span class="linenos">346</span></a>            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">c_derr</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
</span><span id="BiCM-347"><a href="#BiCM-347"><span class="linenos">347</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Row-node &#39;</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
</span><span id="BiCM-348"><a href="#BiCM-348"><span class="linenos">348</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;input: </span><span class="si">{}</span><span class="s1">, avg </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dseq</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">ave_deg_rows</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
</span><span id="BiCM-349"><a href="#BiCM-349"><span class="linenos">349</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span><span id="BiCM-350"><a href="#BiCM-350"><span class="linenos">350</span></a>        <span class="c1"># Check column-nodes degrees:</span>
</span><span id="BiCM-351"><a href="#BiCM-351"><span class="linenos">351</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">array_equiv</span><span class="p">(</span><span class="n">p_derr</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])):</span>
</span><span id="BiCM-352"><a href="#BiCM-352"><span class="linenos">352</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;...inaccurate column-nodes degrees:&#39;</span><span class="p">)</span>
</span><span id="BiCM-353"><a href="#BiCM-353"><span class="linenos">353</span></a>            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">c_derr</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
</span><span id="BiCM-354"><a href="#BiCM-354"><span class="linenos">354</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Column-node &#39;</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
</span><span id="BiCM-355"><a href="#BiCM-355"><span class="linenos">355</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;input: </span><span class="si">{}</span><span class="s1">, avg </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dseq</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_rows</span><span class="p">],</span> <span class="n">ave_deg_columns</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
</span><span id="BiCM-356"><a href="#BiCM-356"><span class="linenos">356</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span><span id="BiCM-357"><a href="#BiCM-357"><span class="linenos">357</span></a>        <span class="k">return</span> <span class="kc">True</span>
</span><span id="BiCM-358"><a href="#BiCM-358"><span class="linenos">358</span></a>
</span><span id="BiCM-359"><a href="#BiCM-359"><span class="linenos">359</span></a><span class="c1"># ------------------------------------------------------------------------------</span>
</span><span id="BiCM-360"><a href="#BiCM-360"><span class="linenos">360</span></a><span class="c1"># Lambda motifs</span>
</span><span id="BiCM-361"><a href="#BiCM-361"><span class="linenos">361</span></a><span class="c1"># ------------------------------------------------------------------------------</span>
</span><span id="BiCM-362"><a href="#BiCM-362"><span class="linenos">362</span></a>
</span><span id="BiCM-363"><a href="#BiCM-363"><span class="linenos">363</span></a>    <span class="k">def</span> <span class="nf">lambda_motifs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bip_set</span><span class="p">,</span> <span class="n">parallel</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="BiCM-364"><a href="#BiCM-364"><span class="linenos">364</span></a>            <span class="n">delim</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">binary</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">num_chunks</span><span class="o">=</span><span class="mi">4</span><span class="p">):</span>
</span><span id="BiCM-365"><a href="#BiCM-365"><span class="linenos">365</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Calculate and save the p-values of the :math:`\\Lambda`-motifs.</span>
</span><span id="BiCM-366"><a href="#BiCM-366"><span class="linenos">366</span></a>
</span><span id="BiCM-367"><a href="#BiCM-367"><span class="linenos">367</span></a><span class="sd">        For each node couple in the bipartite layer specified by ``bip_set``,</span>
</span><span id="BiCM-368"><a href="#BiCM-368"><span class="linenos">368</span></a><span class="sd">        calculate the p-values of the corresponding :math:`\\Lambda`-motifs</span>
</span><span id="BiCM-369"><a href="#BiCM-369"><span class="linenos">369</span></a><span class="sd">        according to the link probabilities in the biadjacency matrix of the</span>
</span><span id="BiCM-370"><a href="#BiCM-370"><span class="linenos">370</span></a><span class="sd">        BiCM null model.</span>
</span><span id="BiCM-371"><a href="#BiCM-371"><span class="linenos">371</span></a>
</span><span id="BiCM-372"><a href="#BiCM-372"><span class="linenos">372</span></a><span class="sd">        The results can be saved either as a binary ``.npy`` or a</span>
</span><span id="BiCM-373"><a href="#BiCM-373"><span class="linenos">373</span></a><span class="sd">        human-readable ``.csv`` file, depending on ``binary``.</span>
</span><span id="BiCM-374"><a href="#BiCM-374"><span class="linenos">374</span></a>
</span><span id="BiCM-375"><a href="#BiCM-375"><span class="linenos">375</span></a><span class="sd">        .. note::</span>
</span><span id="BiCM-376"><a href="#BiCM-376"><span class="linenos">376</span></a>
</span><span id="BiCM-377"><a href="#BiCM-377"><span class="linenos">377</span></a><span class="sd">            * The total number of p-values that are calculated is split into</span>
</span><span id="BiCM-378"><a href="#BiCM-378"><span class="linenos">378</span></a><span class="sd">              ``num_chunks`` chunks, which are processed sequentially in order</span>
</span><span id="BiCM-379"><a href="#BiCM-379"><span class="linenos">379</span></a><span class="sd">              to avoid memory allocation errors. Note that a larger value of</span>
</span><span id="BiCM-380"><a href="#BiCM-380"><span class="linenos">380</span></a><span class="sd">              ``num_chunks`` will lead to less memory occupation, but comes at</span>
</span><span id="BiCM-381"><a href="#BiCM-381"><span class="linenos">381</span></a><span class="sd">              the cost of slower processing speed.</span>
</span><span id="BiCM-382"><a href="#BiCM-382"><span class="linenos">382</span></a>
</span><span id="BiCM-383"><a href="#BiCM-383"><span class="linenos">383</span></a><span class="sd">            * The output consists of a one-dimensional array of p-values. If</span>
</span><span id="BiCM-384"><a href="#BiCM-384"><span class="linenos">384</span></a><span class="sd">              the bipartite layer ``bip_set`` contains ``n`` nodes, this means</span>
</span><span id="BiCM-385"><a href="#BiCM-385"><span class="linenos">385</span></a><span class="sd">              that the array will contain :math:`\\binom{n}{2}` entries. The</span>
</span><span id="BiCM-386"><a href="#BiCM-386"><span class="linenos">386</span></a><span class="sd">              indices ``(i, j)`` of the nodes corresponding to entry ``k`` in</span>
</span><span id="BiCM-387"><a href="#BiCM-387"><span class="linenos">387</span></a><span class="sd">              the array can be reconstructed using the method</span>
</span><span id="BiCM-388"><a href="#BiCM-388"><span class="linenos">388</span></a><span class="sd">              :func:`BiCM.flat2_triumat_idx`. The number of nodes ``n``</span>
</span><span id="BiCM-389"><a href="#BiCM-389"><span class="linenos">389</span></a><span class="sd">              can be recovered from the length of the array with</span>
</span><span id="BiCM-390"><a href="#BiCM-390"><span class="linenos">390</span></a><span class="sd">              :func:`BiCM.flat2_triumat_dim`</span>
</span><span id="BiCM-391"><a href="#BiCM-391"><span class="linenos">391</span></a>
</span><span id="BiCM-392"><a href="#BiCM-392"><span class="linenos">392</span></a><span class="sd">            * If ``binary == False``, the ``filename`` should end with</span>
</span><span id="BiCM-393"><a href="#BiCM-393"><span class="linenos">393</span></a><span class="sd">              ``.csv``. If ``binary == True``, it will be saved in binary NumPy</span>
</span><span id="BiCM-394"><a href="#BiCM-394"><span class="linenos">394</span></a><span class="sd">              ``.npy`` format and the suffix ``.npy`` will be appended</span>
</span><span id="BiCM-395"><a href="#BiCM-395"><span class="linenos">395</span></a><span class="sd">              automatically. By default, the file is saved in binary format.</span>
</span><span id="BiCM-396"><a href="#BiCM-396"><span class="linenos">396</span></a>
</span><span id="BiCM-397"><a href="#BiCM-397"><span class="linenos">397</span></a><span class="sd">        :param bip_set: select row-nodes (``True``) or column-nodes (``False``)</span>
</span><span id="BiCM-398"><a href="#BiCM-398"><span class="linenos">398</span></a><span class="sd">        :type bip_set: bool</span>
</span><span id="BiCM-399"><a href="#BiCM-399"><span class="linenos">399</span></a><span class="sd">        :param parallel: select whether the calculation of the p-values should</span>
</span><span id="BiCM-400"><a href="#BiCM-400"><span class="linenos">400</span></a><span class="sd">            be run in parallel (``True``) or not (``False``)</span>
</span><span id="BiCM-401"><a href="#BiCM-401"><span class="linenos">401</span></a><span class="sd">        :type parallel: bool</span>
</span><span id="BiCM-402"><a href="#BiCM-402"><span class="linenos">402</span></a><span class="sd">        :param filename: name of the output file</span>
</span><span id="BiCM-403"><a href="#BiCM-403"><span class="linenos">403</span></a><span class="sd">        :type filename: str</span>
</span><span id="BiCM-404"><a href="#BiCM-404"><span class="linenos">404</span></a><span class="sd">        :param delim: delimiter between entries in the ``.csv``file, default is</span>
</span><span id="BiCM-405"><a href="#BiCM-405"><span class="linenos">405</span></a><span class="sd">            ``\\t``</span>
</span><span id="BiCM-406"><a href="#BiCM-406"><span class="linenos">406</span></a><span class="sd">        :type delim: str</span>
</span><span id="BiCM-407"><a href="#BiCM-407"><span class="linenos">407</span></a><span class="sd">        :param binary: if ``True``, the file will be saved in the binary</span>
</span><span id="BiCM-408"><a href="#BiCM-408"><span class="linenos">408</span></a><span class="sd">            NumPy format ``.npy``, otherwise as ``.csv``</span>
</span><span id="BiCM-409"><a href="#BiCM-409"><span class="linenos">409</span></a><span class="sd">        :type binary: bool</span>
</span><span id="BiCM-410"><a href="#BiCM-410"><span class="linenos">410</span></a><span class="sd">        :param num_chunks: number of chunks of p-value calculations that are</span>
</span><span id="BiCM-411"><a href="#BiCM-411"><span class="linenos">411</span></a><span class="sd">            performed sequentially</span>
</span><span id="BiCM-412"><a href="#BiCM-412"><span class="linenos">412</span></a><span class="sd">        :type num_chunks: int</span>
</span><span id="BiCM-413"><a href="#BiCM-413"><span class="linenos">413</span></a><span class="sd">        :raise ValueError: raise an error if the parameter ``bip_set`` is</span>
</span><span id="BiCM-414"><a href="#BiCM-414"><span class="linenos">414</span></a><span class="sd">            neither ``True`` nor ``False``</span>
</span><span id="BiCM-415"><a href="#BiCM-415"><span class="linenos">415</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="BiCM-416"><a href="#BiCM-416"><span class="linenos">416</span></a>        <span class="k">if</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">bip_set</span><span class="p">)</span> <span class="o">==</span> <span class="nb">bool</span><span class="p">)</span> <span class="ow">and</span> <span class="n">bip_set</span><span class="p">:</span>
</span><span id="BiCM-417"><a href="#BiCM-417"><span class="linenos">417</span></a>            <span class="n">biad_mat</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">adj_matrix</span>
</span><span id="BiCM-418"><a href="#BiCM-418"><span class="linenos">418</span></a>            <span class="n">bin_mat</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bin_mat</span>
</span><span id="BiCM-419"><a href="#BiCM-419"><span class="linenos">419</span></a>        <span class="k">elif</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">bip_set</span><span class="p">)</span> <span class="o">==</span> <span class="nb">bool</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">bip_set</span><span class="p">:</span>
</span><span id="BiCM-420"><a href="#BiCM-420"><span class="linenos">420</span></a>            <span class="n">biad_mat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">adj_matrix</span><span class="p">)</span>
</span><span id="BiCM-421"><a href="#BiCM-421"><span class="linenos">421</span></a>            <span class="n">bin_mat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bin_mat</span><span class="p">)</span>
</span><span id="BiCM-422"><a href="#BiCM-422"><span class="linenos">422</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="BiCM-423"><a href="#BiCM-423"><span class="linenos">423</span></a>            <span class="n">errmsg</span> <span class="o">=</span> <span class="s2">&quot;&#39;&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">bip_set</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&#39; &quot;</span> <span class="o">+</span> <span class="s1">&#39;not supported.&#39;</span>
</span><span id="BiCM-424"><a href="#BiCM-424"><span class="linenos">424</span></a>            <span class="k">raise</span> <span class="ne">NameError</span><span class="p">(</span><span class="n">errmsg</span><span class="p">)</span>
</span><span id="BiCM-425"><a href="#BiCM-425"><span class="linenos">425</span></a>
</span><span id="BiCM-426"><a href="#BiCM-426"><span class="linenos">426</span></a>        <span class="n">n</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_triup_dim</span><span class="p">(</span><span class="n">bip_set</span><span class="p">))</span> <span class="c1"># n. pairs..</span>
</span><span id="BiCM-427"><a href="#BiCM-427"><span class="linenos">427</span></a>        <span class="n">pval</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;float&#39;</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mf">0.1</span><span class="p">)</span>
</span><span id="BiCM-428"><a href="#BiCM-428"><span class="linenos">428</span></a>
</span><span id="BiCM-429"><a href="#BiCM-429"><span class="linenos">429</span></a>
</span><span id="BiCM-430"><a href="#BiCM-430"><span class="linenos">430</span></a>        <span class="c1"># handle layers of dimension 2 separately</span>
</span><span id="BiCM-431"><a href="#BiCM-431"><span class="linenos">431</span></a>        <span class="k">if</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="BiCM-432"><a href="#BiCM-432"><span class="linenos">432</span></a>            <span class="n">nlam</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">bin_mat</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:],</span> <span class="n">bin_mat</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
</span><span id="BiCM-433"><a href="#BiCM-433"><span class="linenos">433</span></a>            <span class="n">plam</span> <span class="o">=</span> <span class="n">biad_mat</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]</span> <span class="o">*</span> <span class="n">biad_mat</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span>
</span><span id="BiCM-434"><a href="#BiCM-434"><span class="linenos">434</span></a>            <span class="n">pb</span> <span class="o">=</span> <span class="n">PoiBin</span><span class="p">(</span><span class="n">plam</span><span class="p">)</span>
</span><span id="BiCM-435"><a href="#BiCM-435"><span class="linenos">435</span></a>            <span class="n">pval</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">pb</span><span class="o">.</span><span class="n">pval</span><span class="p">(</span><span class="n">nlam</span><span class="p">)</span>
</span><span id="BiCM-436"><a href="#BiCM-436"><span class="linenos">436</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="BiCM-437"><a href="#BiCM-437"><span class="linenos">437</span></a>            <span class="c1"># if the dimension of the network is too large, split the</span>
</span><span id="BiCM-438"><a href="#BiCM-438"><span class="linenos">438</span></a>            <span class="c1"># calculations # of the p-values in ``m`` intervals to avoid memory</span>
</span><span id="BiCM-439"><a href="#BiCM-439"><span class="linenos">439</span></a>            <span class="c1"># allocation errors</span>
</span><span id="BiCM-440"><a href="#BiCM-440"><span class="linenos">440</span></a>
</span><span id="BiCM-441"><a href="#BiCM-441"><span class="linenos">441</span></a>            <span class="c1"># correced - never bother with splitting for now</span>
</span><span id="BiCM-442"><a href="#BiCM-442"><span class="linenos">442</span></a>            <span class="k">if</span> <span class="n">n</span> <span class="o">&gt;</span> <span class="mi">100000</span><span class="p">:</span>
</span><span id="BiCM-443"><a href="#BiCM-443"><span class="linenos">443</span></a>                <span class="n">kk</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">split_range</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">m</span><span class="o">=</span><span class="n">num_chunks</span><span class="p">)</span>
</span><span id="BiCM-444"><a href="#BiCM-444"><span class="linenos">444</span></a>
</span><span id="BiCM-445"><a href="#BiCM-445"><span class="linenos">445</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="BiCM-446"><a href="#BiCM-446"><span class="linenos">446</span></a>                <span class="n">k1</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="BiCM-447"><a href="#BiCM-447"><span class="linenos">447</span></a>                <span class="n">k2</span> <span class="o">=</span> <span class="n">n</span>
</span><span id="BiCM-448"><a href="#BiCM-448"><span class="linenos">448</span></a>                <span class="n">nlam</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_lambda_motif_block</span><span class="p">(</span><span class="n">bin_mat</span><span class="p">,</span> <span class="n">k1</span><span class="p">,</span> <span class="n">k2</span><span class="p">)</span>
</span><span id="BiCM-449"><a href="#BiCM-449"><span class="linenos">449</span></a>                <span class="n">plam</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_plambda_block</span><span class="p">(</span><span class="n">biad_mat</span><span class="p">,</span> <span class="n">k1</span><span class="p">,</span> <span class="n">k2</span><span class="p">)</span>
</span><span id="BiCM-450"><a href="#BiCM-450"><span class="linenos">450</span></a>
</span><span id="BiCM-451"><a href="#BiCM-451"><span class="linenos">451</span></a>                <span class="n">pv</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_pvalues_q</span><span class="p">(</span><span class="n">plam</span><span class="p">,</span> <span class="n">nlam</span><span class="p">,</span> <span class="n">k1</span><span class="p">,</span> <span class="n">k2</span><span class="p">)</span>
</span><span id="BiCM-452"><a href="#BiCM-452"><span class="linenos">452</span></a>                <span class="c1">#print(&#39;p values found:&#39;)</span>
</span><span id="BiCM-453"><a href="#BiCM-453"><span class="linenos">453</span></a>                <span class="c1">#print(pv)</span>
</span><span id="BiCM-454"><a href="#BiCM-454"><span class="linenos">454</span></a>                <span class="n">pval</span><span class="p">[</span><span class="n">k1</span><span class="p">:]</span> <span class="o">=</span> <span class="n">pv</span>
</span><span id="BiCM-455"><a href="#BiCM-455"><span class="linenos">455</span></a>
</span><span id="BiCM-456"><a href="#BiCM-456"><span class="linenos">456</span></a>            <span class="c1">#print(&#39;pvals before:&#39;)</span>
</span><span id="BiCM-457"><a href="#BiCM-457"><span class="linenos">457</span></a>            <span class="c1">#print(pval)</span>
</span><span id="BiCM-458"><a href="#BiCM-458"><span class="linenos">458</span></a>
</span><span id="BiCM-459"><a href="#BiCM-459"><span class="linenos">459</span></a>            <span class="c1">## last interval</span>
</span><span id="BiCM-460"><a href="#BiCM-460"><span class="linenos">460</span></a>            <span class="c1">#k1 = kk[len(kk) - 1]</span>
</span><span id="BiCM-461"><a href="#BiCM-461"><span class="linenos">461</span></a>            <span class="c1">#k2 = n - 1</span>
</span><span id="BiCM-462"><a href="#BiCM-462"><span class="linenos">462</span></a>            <span class="c1">#nlam = self.get_lambda_motif_block(bin_mat, k1, k2)</span>
</span><span id="BiCM-463"><a href="#BiCM-463"><span class="linenos">463</span></a>            <span class="c1">#plam = self.get_plambda_block(biad_mat, k1, k2)</span>
</span><span id="BiCM-464"><a href="#BiCM-464"><span class="linenos">464</span></a>
</span><span id="BiCM-465"><a href="#BiCM-465"><span class="linenos">465</span></a>            <span class="c1"># for the last entry we have to INCLUDE k2, thus k2 + 1</span>
</span><span id="BiCM-466"><a href="#BiCM-466"><span class="linenos">466</span></a>            <span class="c1">#pv = self.get_pvalues_q(plam, nlam, k1, k2 + 1)</span>
</span><span id="BiCM-467"><a href="#BiCM-467"><span class="linenos">467</span></a>            <span class="c1">#pval[k1:] = pv</span>
</span><span id="BiCM-468"><a href="#BiCM-468"><span class="linenos">468</span></a>
</span><span id="BiCM-469"><a href="#BiCM-469"><span class="linenos">469</span></a>        <span class="c1"># check that all p-values have been calculated</span>
</span><span id="BiCM-470"><a href="#BiCM-470"><span class="linenos">470</span></a><span class="c1">#        assert np.all(pval &gt;= 0) and np.all(pval &lt;= 1)</span>
</span><span id="BiCM-471"><a href="#BiCM-471"><span class="linenos">471</span></a>        <span class="k">if</span> <span class="n">filename</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="BiCM-472"><a href="#BiCM-472"><span class="linenos">472</span></a>            <span class="n">fname</span> <span class="o">=</span> <span class="s1">&#39;p_values_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">bip_set</span><span class="p">)</span>
</span><span id="BiCM-473"><a href="#BiCM-473"><span class="linenos">473</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">binary</span><span class="p">:</span>
</span><span id="BiCM-474"><a href="#BiCM-474"><span class="linenos">474</span></a>                <span class="n">fname</span> <span class="o">+=</span>  <span class="s1">&#39;.csv&#39;</span>
</span><span id="BiCM-475"><a href="#BiCM-475"><span class="linenos">475</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="BiCM-476"><a href="#BiCM-476"><span class="linenos">476</span></a>            <span class="n">fname</span> <span class="o">=</span> <span class="n">filename</span>
</span><span id="BiCM-477"><a href="#BiCM-477"><span class="linenos">477</span></a>
</span><span id="BiCM-478"><a href="#BiCM-478"><span class="linenos">478</span></a>        <span class="c1"># account for machine precision:</span>
</span><span id="BiCM-479"><a href="#BiCM-479"><span class="linenos">479</span></a>        <span class="n">pval</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">finfo</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span><span class="o">.</span><span class="n">eps</span>
</span><span id="BiCM-480"><a href="#BiCM-480"><span class="linenos">480</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">save_array</span><span class="p">(</span><span class="n">pval</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="n">fname</span><span class="p">,</span> <span class="n">delim</span><span class="o">=</span><span class="n">delim</span><span class="p">,</span>
</span><span id="BiCM-481"><a href="#BiCM-481"><span class="linenos">481</span></a>                         <span class="n">binary</span><span class="o">=</span><span class="n">binary</span><span class="p">)</span>
</span><span id="BiCM-482"><a href="#BiCM-482"><span class="linenos">482</span></a>
</span><span id="BiCM-483"><a href="#BiCM-483"><span class="linenos">483</span></a>    <span class="k">def</span> <span class="nf">get_lambda_motif_block</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mm</span><span class="p">,</span> <span class="n">k1</span><span class="p">,</span> <span class="n">k2</span><span class="p">):</span>
</span><span id="BiCM-484"><a href="#BiCM-484"><span class="linenos">484</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Return a subset of :math:`\\Lambda`-motifs as observed in ``mm``.</span>
</span><span id="BiCM-485"><a href="#BiCM-485"><span class="linenos">485</span></a>
</span><span id="BiCM-486"><a href="#BiCM-486"><span class="linenos">486</span></a><span class="sd">        Given the binary input matrix ``mm``, count the number of</span>
</span><span id="BiCM-487"><a href="#BiCM-487"><span class="linenos">487</span></a><span class="sd">        :math:`\\Lambda`-motifs for all the node couples specified by the</span>
</span><span id="BiCM-488"><a href="#BiCM-488"><span class="linenos">488</span></a><span class="sd">        interval :math:`\\left[k_1, k_2\\right[`.</span>
</span><span id="BiCM-489"><a href="#BiCM-489"><span class="linenos">489</span></a>
</span><span id="BiCM-490"><a href="#BiCM-490"><span class="linenos">490</span></a>
</span><span id="BiCM-491"><a href="#BiCM-491"><span class="linenos">491</span></a><span class="sd">        .. note::</span>
</span><span id="BiCM-492"><a href="#BiCM-492"><span class="linenos">492</span></a>
</span><span id="BiCM-493"><a href="#BiCM-493"><span class="linenos">493</span></a><span class="sd">            * The :math:`\\Lambda`-motifs are counted between the **row-nodes**</span>
</span><span id="BiCM-494"><a href="#BiCM-494"><span class="linenos">494</span></a><span class="sd">              of the input matrix ``mm``.</span>
</span><span id="BiCM-495"><a href="#BiCM-495"><span class="linenos">495</span></a>
</span><span id="BiCM-496"><a href="#BiCM-496"><span class="linenos">496</span></a><span class="sd">            * If :math:`k_2 \equiv \\binom{mm.shape[0]}{2}`, the interval</span>
</span><span id="BiCM-497"><a href="#BiCM-497"><span class="linenos">497</span></a><span class="sd">              becomes :math:`\\left[k_1, k_2\\right]`.</span>
</span><span id="BiCM-498"><a href="#BiCM-498"><span class="linenos">498</span></a>
</span><span id="BiCM-499"><a href="#BiCM-499"><span class="linenos">499</span></a><span class="sd">        :param mm: binary matrix</span>
</span><span id="BiCM-500"><a href="#BiCM-500"><span class="linenos">500</span></a><span class="sd">        :type mm: numpy.array</span>
</span><span id="BiCM-501"><a href="#BiCM-501"><span class="linenos">501</span></a><span class="sd">        :param k1: lower interval limit</span>
</span><span id="BiCM-502"><a href="#BiCM-502"><span class="linenos">502</span></a><span class="sd">        :type k1: int</span>
</span><span id="BiCM-503"><a href="#BiCM-503"><span class="linenos">503</span></a><span class="sd">        :param k2: upper interval limit</span>
</span><span id="BiCM-504"><a href="#BiCM-504"><span class="linenos">504</span></a><span class="sd">        :type k2: int</span>
</span><span id="BiCM-505"><a href="#BiCM-505"><span class="linenos">505</span></a><span class="sd">        :returns: array of observed :math:`\\Lambda`-motifs</span>
</span><span id="BiCM-506"><a href="#BiCM-506"><span class="linenos">506</span></a><span class="sd">        :rtype: numpy.array</span>
</span><span id="BiCM-507"><a href="#BiCM-507"><span class="linenos">507</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="BiCM-508"><a href="#BiCM-508"><span class="linenos">508</span></a>        <span class="n">k1</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">k1</span><span class="p">)</span>
</span><span id="BiCM-509"><a href="#BiCM-509"><span class="linenos">509</span></a>        <span class="n">k2</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">k2</span><span class="p">)</span>
</span><span id="BiCM-510"><a href="#BiCM-510"><span class="linenos">510</span></a>        <span class="n">ndim</span> <span class="o">=</span> <span class="n">mm</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="BiCM-511"><a href="#BiCM-511"><span class="linenos">511</span></a>        <span class="c1"># if the upper limit is the largest possible index, i.e. corresponds to</span>
</span><span id="BiCM-512"><a href="#BiCM-512"><span class="linenos">512</span></a>        <span class="c1"># the node couple (ndim - 2, ndim - 1), where node indices start from 0,</span>
</span><span id="BiCM-513"><a href="#BiCM-513"><span class="linenos">513</span></a>        <span class="c1"># include the result</span>
</span><span id="BiCM-514"><a href="#BiCM-514"><span class="linenos">514</span></a>        <span class="k">if</span> <span class="n">k2</span> <span class="o">==</span> <span class="p">(</span><span class="n">ndim</span> <span class="o">*</span> <span class="p">(</span><span class="n">ndim</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
</span><span id="BiCM-515"><a href="#BiCM-515"><span class="linenos">515</span></a>            <span class="n">flag</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="BiCM-516"><a href="#BiCM-516"><span class="linenos">516</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="BiCM-517"><a href="#BiCM-517"><span class="linenos">517</span></a>            <span class="n">flag</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="BiCM-518"><a href="#BiCM-518"><span class="linenos">518</span></a>        <span class="n">aux</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="n">k2</span> <span class="o">-</span> <span class="n">k1</span> <span class="o">+</span> <span class="n">flag</span><span class="p">,</span> <span class="p">))</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="c1"># -1 as a test</span>
</span><span id="BiCM-519"><a href="#BiCM-519"><span class="linenos">519</span></a>        <span class="p">[</span><span class="n">i1</span><span class="p">,</span> <span class="n">j1</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">flat2triumat_idx</span><span class="p">(</span><span class="n">k1</span><span class="p">,</span> <span class="n">ndim</span><span class="p">)</span>
</span><span id="BiCM-520"><a href="#BiCM-520"><span class="linenos">520</span></a>        <span class="p">[</span><span class="n">i2</span><span class="p">,</span> <span class="n">j2</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">flat2triumat_idx</span><span class="p">(</span><span class="n">k2</span><span class="p">,</span> <span class="n">ndim</span><span class="p">)</span>
</span><span id="BiCM-521"><a href="#BiCM-521"><span class="linenos">521</span></a>
</span><span id="BiCM-522"><a href="#BiCM-522"><span class="linenos">522</span></a>        <span class="c1"># if limits have the same row index</span>
</span><span id="BiCM-523"><a href="#BiCM-523"><span class="linenos">523</span></a>        <span class="k">if</span> <span class="n">i1</span> <span class="o">==</span> <span class="n">i2</span><span class="p">:</span>
</span><span id="BiCM-524"><a href="#BiCM-524"><span class="linenos">524</span></a>            <span class="n">aux</span><span class="p">[:</span><span class="n">k2</span> <span class="o">-</span> <span class="n">k1</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">mm</span><span class="p">[</span><span class="n">i1</span><span class="p">,</span> <span class="p">:],</span> <span class="n">mm</span><span class="p">[</span><span class="n">j1</span><span class="p">:</span><span class="n">j2</span><span class="p">,</span> <span class="p">:]</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
</span><span id="BiCM-525"><a href="#BiCM-525"><span class="linenos">525</span></a>        <span class="c1"># if limits have different row indices</span>
</span><span id="BiCM-526"><a href="#BiCM-526"><span class="linenos">526</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="BiCM-527"><a href="#BiCM-527"><span class="linenos">527</span></a>            <span class="n">k</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="BiCM-528"><a href="#BiCM-528"><span class="linenos">528</span></a>            <span class="c1">#print(&#39;i1:&#39;, i1)</span>
</span><span id="BiCM-529"><a href="#BiCM-529"><span class="linenos">529</span></a>            <span class="c1">#print(&#39;j1:&#39;, j1)</span>
</span><span id="BiCM-530"><a href="#BiCM-530"><span class="linenos">530</span></a>            <span class="c1"># get values for lower limit row</span>
</span><span id="BiCM-531"><a href="#BiCM-531"><span class="linenos">531</span></a>            <span class="n">fi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">mm</span><span class="p">[</span><span class="n">i1</span><span class="p">,</span> <span class="p">:],</span> <span class="n">mm</span><span class="p">[</span><span class="n">j1</span><span class="p">:,</span> <span class="p">:]</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
</span><span id="BiCM-532"><a href="#BiCM-532"><span class="linenos">532</span></a>            <span class="n">aux</span><span class="p">[:</span><span class="nb">len</span><span class="p">(</span><span class="n">fi</span><span class="p">)]</span> <span class="o">=</span> <span class="n">fi</span>
</span><span id="BiCM-533"><a href="#BiCM-533"><span class="linenos">533</span></a>            <span class="n">k</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">fi</span><span class="p">)</span>
</span><span id="BiCM-534"><a href="#BiCM-534"><span class="linenos">534</span></a>            <span class="c1"># get values for intermediate rows</span>
</span><span id="BiCM-535"><a href="#BiCM-535"><span class="linenos">535</span></a>            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i1</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">i2</span><span class="p">):</span>
</span><span id="BiCM-536"><a href="#BiCM-536"><span class="linenos">536</span></a>                <span class="n">mid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">mm</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:],</span> <span class="n">mm</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:,</span> <span class="p">:]</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
</span><span id="BiCM-537"><a href="#BiCM-537"><span class="linenos">537</span></a>                <span class="n">aux</span><span class="p">[</span><span class="n">k</span> <span class="p">:</span> <span class="n">k</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">mid</span><span class="p">)]</span> <span class="o">=</span> <span class="n">mid</span>
</span><span id="BiCM-538"><a href="#BiCM-538"><span class="linenos">538</span></a>                <span class="n">k</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">mid</span><span class="p">)</span>
</span><span id="BiCM-539"><a href="#BiCM-539"><span class="linenos">539</span></a>            <span class="c1"># get values for upper limit row</span>
</span><span id="BiCM-540"><a href="#BiCM-540"><span class="linenos">540</span></a>            <span class="k">if</span> <span class="n">flag</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="BiCM-541"><a href="#BiCM-541"><span class="linenos">541</span></a>                <span class="n">aux</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">mm</span><span class="p">[</span><span class="n">ndim</span> <span class="o">-</span> <span class="mi">2</span><span class="p">,</span> <span class="p">:],</span> <span class="n">mm</span><span class="p">[</span><span class="n">ndim</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="p">:]</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
</span><span id="BiCM-542"><a href="#BiCM-542"><span class="linenos">542</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="BiCM-543"><a href="#BiCM-543"><span class="linenos">543</span></a>                <span class="n">la</span> <span class="o">=</span>  <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">mm</span><span class="p">[</span><span class="n">i2</span><span class="p">,</span> <span class="p">:],</span> <span class="n">mm</span><span class="p">[</span><span class="n">i2</span> <span class="o">+</span> <span class="mi">1</span> <span class="p">:</span> <span class="n">j2</span><span class="p">,</span> <span class="p">:]</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
</span><span id="BiCM-544"><a href="#BiCM-544"><span class="linenos">544</span></a>                <span class="n">aux</span><span class="p">[</span><span class="n">k</span><span class="p">:]</span> <span class="o">=</span> <span class="n">la</span>
</span><span id="BiCM-545"><a href="#BiCM-545"><span class="linenos">545</span></a>        <span class="k">return</span> <span class="n">aux</span>
</span><span id="BiCM-546"><a href="#BiCM-546"><span class="linenos">546</span></a>
</span><span id="BiCM-547"><a href="#BiCM-547"><span class="linenos">547</span></a>    <span class="k">def</span> <span class="nf">get_plambda_block</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">biad_mat</span><span class="p">,</span> <span class="n">k1</span><span class="p">,</span> <span class="n">k2</span><span class="p">):</span>
</span><span id="BiCM-548"><a href="#BiCM-548"><span class="linenos">548</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Return a subset of the :math:`\\Lambda` probability matrix.</span>
</span><span id="BiCM-549"><a href="#BiCM-549"><span class="linenos">549</span></a>
</span><span id="BiCM-550"><a href="#BiCM-550"><span class="linenos">550</span></a><span class="sd">        Given the biadjacency matrix ``biad_mat`` with</span>
</span><span id="BiCM-551"><a href="#BiCM-551"><span class="linenos">551</span></a><span class="sd">        :math:`\\mathbf{M}_{rc} = p_{rc}`, which describes the probabilities of</span>
</span><span id="BiCM-552"><a href="#BiCM-552"><span class="linenos">552</span></a><span class="sd">        row-node ``r`` and column-node ``c`` being linked, the method returns</span>
</span><span id="BiCM-553"><a href="#BiCM-553"><span class="linenos">553</span></a><span class="sd">        the matrix</span>
</span><span id="BiCM-554"><a href="#BiCM-554"><span class="linenos">554</span></a>
</span><span id="BiCM-555"><a href="#BiCM-555"><span class="linenos">555</span></a><span class="sd">        :math:`P(\\Lambda)_{ij} = \\left(M_{i\\alpha_1} \\cdot M_{j\\alpha_1},</span>
</span><span id="BiCM-556"><a href="#BiCM-556"><span class="linenos">556</span></a><span class="sd">        M_{i\\alpha_2} \\cdot M_{j\\alpha_2}, \\ldots\\right),`</span>
</span><span id="BiCM-557"><a href="#BiCM-557"><span class="linenos">557</span></a>
</span><span id="BiCM-558"><a href="#BiCM-558"><span class="linenos">558</span></a><span class="sd">        for all the node couples in the interval</span>
</span><span id="BiCM-559"><a href="#BiCM-559"><span class="linenos">559</span></a><span class="sd">        :math:`\\left[k_1, k_2\\right[`.  :math:`(i, j)` are two **row-nodes**</span>
</span><span id="BiCM-560"><a href="#BiCM-560"><span class="linenos">560</span></a><span class="sd">        of ``biad_mat`` and :math:`\\alpha_k` runs over the nodes in the</span>
</span><span id="BiCM-561"><a href="#BiCM-561"><span class="linenos">561</span></a><span class="sd">        opposite layer.</span>
</span><span id="BiCM-562"><a href="#BiCM-562"><span class="linenos">562</span></a>
</span><span id="BiCM-563"><a href="#BiCM-563"><span class="linenos">563</span></a><span class="sd">        .. note::</span>
</span><span id="BiCM-564"><a href="#BiCM-564"><span class="linenos">564</span></a>
</span><span id="BiCM-565"><a href="#BiCM-565"><span class="linenos">565</span></a><span class="sd">            * The probabilities are calculated between the **row-nodes** of the</span>
</span><span id="BiCM-566"><a href="#BiCM-566"><span class="linenos">566</span></a><span class="sd">              input matrix ``biad_mat``.</span>
</span><span id="BiCM-567"><a href="#BiCM-567"><span class="linenos">567</span></a>
</span><span id="BiCM-568"><a href="#BiCM-568"><span class="linenos">568</span></a><span class="sd">            * If :math:`k_2 \equiv \\binom{biad\\_mat.shape[0]}{2}`, the</span>
</span><span id="BiCM-569"><a href="#BiCM-569"><span class="linenos">569</span></a><span class="sd">              interval becomes :math:`\\left[k1, k2\\right]`.</span>
</span><span id="BiCM-570"><a href="#BiCM-570"><span class="linenos">570</span></a>
</span><span id="BiCM-571"><a href="#BiCM-571"><span class="linenos">571</span></a><span class="sd">        :param biad_mat: biadjacency matrix</span>
</span><span id="BiCM-572"><a href="#BiCM-572"><span class="linenos">572</span></a><span class="sd">        :type biad_mat: numpy.array</span>
</span><span id="BiCM-573"><a href="#BiCM-573"><span class="linenos">573</span></a><span class="sd">        :param k1: lower interval limit</span>
</span><span id="BiCM-574"><a href="#BiCM-574"><span class="linenos">574</span></a><span class="sd">        :type k1: int</span>
</span><span id="BiCM-575"><a href="#BiCM-575"><span class="linenos">575</span></a><span class="sd">        :param k2: upper interval limit</span>
</span><span id="BiCM-576"><a href="#BiCM-576"><span class="linenos">576</span></a><span class="sd">        :type k2: int</span>
</span><span id="BiCM-577"><a href="#BiCM-577"><span class="linenos">577</span></a><span class="sd">        :returns: :math:`\\Lambda`-motif probability matrix</span>
</span><span id="BiCM-578"><a href="#BiCM-578"><span class="linenos">578</span></a><span class="sd">        :rtype: numpy.array</span>
</span><span id="BiCM-579"><a href="#BiCM-579"><span class="linenos">579</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="BiCM-580"><a href="#BiCM-580"><span class="linenos">580</span></a>        <span class="p">[</span><span class="n">ndim1</span><span class="p">,</span> <span class="n">ndim2</span><span class="p">]</span> <span class="o">=</span> <span class="n">biad_mat</span><span class="o">.</span><span class="n">shape</span>
</span><span id="BiCM-581"><a href="#BiCM-581"><span class="linenos">581</span></a>        <span class="c1"># if the upper limit is the largest possible index, i.e. corresponds to</span>
</span><span id="BiCM-582"><a href="#BiCM-582"><span class="linenos">582</span></a>        <span class="c1"># the node couple (ndim - 2, ndim - 1), where node indices start from 0,</span>
</span><span id="BiCM-583"><a href="#BiCM-583"><span class="linenos">583</span></a>        <span class="c1"># include the result</span>
</span><span id="BiCM-584"><a href="#BiCM-584"><span class="linenos">584</span></a>        <span class="k">if</span> <span class="n">k2</span> <span class="o">==</span> <span class="p">(</span><span class="n">ndim1</span> <span class="o">*</span> <span class="p">(</span><span class="n">ndim1</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
</span><span id="BiCM-585"><a href="#BiCM-585"><span class="linenos">585</span></a>            <span class="n">flag</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="BiCM-586"><a href="#BiCM-586"><span class="linenos">586</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="BiCM-587"><a href="#BiCM-587"><span class="linenos">587</span></a>            <span class="n">flag</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="BiCM-588"><a href="#BiCM-588"><span class="linenos">588</span></a>        <span class="n">paux</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="n">k2</span> <span class="o">-</span> <span class="n">k1</span> <span class="o">+</span> <span class="n">flag</span><span class="p">,</span> <span class="n">ndim2</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;float&#39;</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mf">0.1</span><span class="p">)</span>
</span><span id="BiCM-589"><a href="#BiCM-589"><span class="linenos">589</span></a>        <span class="p">[</span><span class="n">i1</span><span class="p">,</span> <span class="n">j1</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">flat2triumat_idx</span><span class="p">(</span><span class="n">k1</span><span class="p">,</span> <span class="n">ndim1</span><span class="p">)</span>
</span><span id="BiCM-590"><a href="#BiCM-590"><span class="linenos">590</span></a>        <span class="p">[</span><span class="n">i2</span><span class="p">,</span> <span class="n">j2</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">flat2triumat_idx</span><span class="p">(</span><span class="n">k2</span><span class="p">,</span> <span class="n">ndim1</span><span class="p">)</span>
</span><span id="BiCM-591"><a href="#BiCM-591"><span class="linenos">591</span></a>
</span><span id="BiCM-592"><a href="#BiCM-592"><span class="linenos">592</span></a>        <span class="c1"># if limits have the same row index</span>
</span><span id="BiCM-593"><a href="#BiCM-593"><span class="linenos">593</span></a>        <span class="k">if</span> <span class="n">i1</span> <span class="o">==</span> <span class="n">i2</span><span class="p">:</span>
</span><span id="BiCM-594"><a href="#BiCM-594"><span class="linenos">594</span></a>            <span class="n">paux</span><span class="p">[:</span><span class="n">k2</span> <span class="o">-</span> <span class="n">k1</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">biad_mat</span><span class="p">[</span><span class="n">i1</span><span class="p">,</span> <span class="p">]</span> <span class="o">*</span> <span class="n">biad_mat</span><span class="p">[</span><span class="n">j1</span><span class="p">:</span><span class="n">j2</span><span class="p">,</span> <span class="p">:]</span>
</span><span id="BiCM-595"><a href="#BiCM-595"><span class="linenos">595</span></a>        <span class="c1"># if limits have different indices</span>
</span><span id="BiCM-596"><a href="#BiCM-596"><span class="linenos">596</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="BiCM-597"><a href="#BiCM-597"><span class="linenos">597</span></a>            <span class="n">k</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="BiCM-598"><a href="#BiCM-598"><span class="linenos">598</span></a>            <span class="c1"># get values for lower limit row</span>
</span><span id="BiCM-599"><a href="#BiCM-599"><span class="linenos">599</span></a>            <span class="n">fi</span> <span class="o">=</span> <span class="n">biad_mat</span><span class="p">[</span><span class="n">i1</span><span class="p">,</span> <span class="p">:]</span> <span class="o">*</span> <span class="n">biad_mat</span><span class="p">[</span><span class="n">j1</span><span class="p">:,</span> <span class="p">:]</span>
</span><span id="BiCM-600"><a href="#BiCM-600"><span class="linenos">600</span></a>            <span class="n">paux</span><span class="p">[:</span><span class="nb">len</span><span class="p">(</span><span class="n">fi</span><span class="p">),</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">fi</span>
</span><span id="BiCM-601"><a href="#BiCM-601"><span class="linenos">601</span></a>            <span class="n">k</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">fi</span><span class="p">)</span>
</span><span id="BiCM-602"><a href="#BiCM-602"><span class="linenos">602</span></a>            <span class="c1"># get values for intermediate rows</span>
</span><span id="BiCM-603"><a href="#BiCM-603"><span class="linenos">603</span></a>            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i1</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">i2</span><span class="p">):</span>
</span><span id="BiCM-604"><a href="#BiCM-604"><span class="linenos">604</span></a>                <span class="n">mid</span> <span class="o">=</span> <span class="n">biad_mat</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span> <span class="o">*</span> <span class="n">biad_mat</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:,</span> <span class="p">:]</span>
</span><span id="BiCM-605"><a href="#BiCM-605"><span class="linenos">605</span></a>                <span class="n">paux</span><span class="p">[</span><span class="n">k</span> <span class="p">:</span> <span class="n">k</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">mid</span><span class="p">),</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">mid</span>
</span><span id="BiCM-606"><a href="#BiCM-606"><span class="linenos">606</span></a>                <span class="n">k</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">mid</span><span class="p">)</span>
</span><span id="BiCM-607"><a href="#BiCM-607"><span class="linenos">607</span></a>            <span class="c1"># get values for upper limit row</span>
</span><span id="BiCM-608"><a href="#BiCM-608"><span class="linenos">608</span></a>            <span class="k">if</span> <span class="n">flag</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="BiCM-609"><a href="#BiCM-609"><span class="linenos">609</span></a>                <span class="n">paux</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">biad_mat</span><span class="p">[</span><span class="n">ndim1</span> <span class="o">-</span> <span class="mi">2</span><span class="p">,</span> <span class="p">:]</span> <span class="o">*</span> <span class="n">biad_mat</span><span class="p">[</span><span class="n">ndim1</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="p">:]</span>
</span><span id="BiCM-610"><a href="#BiCM-610"><span class="linenos">610</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="BiCM-611"><a href="#BiCM-611"><span class="linenos">611</span></a>                <span class="n">la</span> <span class="o">=</span> <span class="n">biad_mat</span><span class="p">[</span><span class="n">i2</span><span class="p">,</span> <span class="p">:]</span> <span class="o">*</span> <span class="n">biad_mat</span><span class="p">[</span><span class="n">i2</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:</span><span class="n">j2</span><span class="p">,</span> <span class="p">:]</span>
</span><span id="BiCM-612"><a href="#BiCM-612"><span class="linenos">612</span></a>                <span class="n">paux</span><span class="p">[</span><span class="n">k</span><span class="p">:,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">la</span>
</span><span id="BiCM-613"><a href="#BiCM-613"><span class="linenos">613</span></a>        <span class="k">return</span> <span class="n">paux</span>
</span><span id="BiCM-614"><a href="#BiCM-614"><span class="linenos">614</span></a>
</span><span id="BiCM-615"><a href="#BiCM-615"><span class="linenos">615</span></a>    <span class="k">def</span> <span class="nf">get_pvalues_q</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">plam_mat</span><span class="p">,</span> <span class="n">nlam_mat</span><span class="p">,</span> <span class="n">k1</span><span class="p">,</span> <span class="n">k2</span><span class="p">,</span> <span class="n">parallel</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
</span><span id="BiCM-616"><a href="#BiCM-616"><span class="linenos">616</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Calculate the p-values of the observed :math:`\\Lambda`-motifs.</span>
</span><span id="BiCM-617"><a href="#BiCM-617"><span class="linenos">617</span></a>
</span><span id="BiCM-618"><a href="#BiCM-618"><span class="linenos">618</span></a><span class="sd">        For each number of :math:`\\Lambda`-motifs in ``nlam_mat`` for the node</span>
</span><span id="BiCM-619"><a href="#BiCM-619"><span class="linenos">619</span></a><span class="sd">        interval :math:`\\left[k1, k2\\right[`, construct the Poisson Binomial</span>
</span><span id="BiCM-620"><a href="#BiCM-620"><span class="linenos">620</span></a><span class="sd">        distribution using the corresponding</span>
</span><span id="BiCM-621"><a href="#BiCM-621"><span class="linenos">621</span></a><span class="sd">        probabilities in ``plam_mat`` and calculate the p-value.</span>
</span><span id="BiCM-622"><a href="#BiCM-622"><span class="linenos">622</span></a>
</span><span id="BiCM-623"><a href="#BiCM-623"><span class="linenos">623</span></a><span class="sd">        :param plam_mat: array containing the list of probabilities for the</span>
</span><span id="BiCM-624"><a href="#BiCM-624"><span class="linenos">624</span></a><span class="sd">            single observations of :math:`\\Lambda`-motifs</span>
</span><span id="BiCM-625"><a href="#BiCM-625"><span class="linenos">625</span></a><span class="sd">        :type plam_mat: numpy.array (square matrix)</span>
</span><span id="BiCM-626"><a href="#BiCM-626"><span class="linenos">626</span></a><span class="sd">        :param nlam_mat: array containing the observations of</span>
</span><span id="BiCM-627"><a href="#BiCM-627"><span class="linenos">627</span></a><span class="sd">            :math:`\\Lambda`-motifs</span>
</span><span id="BiCM-628"><a href="#BiCM-628"><span class="linenos">628</span></a><span class="sd">        :type nlam_mat: numpy.array (square matrix)</span>
</span><span id="BiCM-629"><a href="#BiCM-629"><span class="linenos">629</span></a><span class="sd">        :param k1: lower interval limit</span>
</span><span id="BiCM-630"><a href="#BiCM-630"><span class="linenos">630</span></a><span class="sd">        :type k1: int</span>
</span><span id="BiCM-631"><a href="#BiCM-631"><span class="linenos">631</span></a><span class="sd">        :param k2: upper interval limit</span>
</span><span id="BiCM-632"><a href="#BiCM-632"><span class="linenos">632</span></a><span class="sd">        :type k2: int</span>
</span><span id="BiCM-633"><a href="#BiCM-633"><span class="linenos">633</span></a><span class="sd">        :param parallel: if ``True``, the calculation is executed in parallel;</span>
</span><span id="BiCM-634"><a href="#BiCM-634"><span class="linenos">634</span></a><span class="sd">            if ``False``, only one process is started</span>
</span><span id="BiCM-635"><a href="#BiCM-635"><span class="linenos">635</span></a><span class="sd">        :type parallel: bool</span>
</span><span id="BiCM-636"><a href="#BiCM-636"><span class="linenos">636</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="BiCM-637"><a href="#BiCM-637"><span class="linenos">637</span></a>        <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">nlam_mat</span><span class="p">)</span>
</span><span id="BiCM-638"><a href="#BiCM-638"><span class="linenos">638</span></a>        <span class="c1"># the array must be sharable to be accessible by all processes</span>
</span><span id="BiCM-639"><a href="#BiCM-639"><span class="linenos">639</span></a>        <span class="n">shared_array_base</span> <span class="o">=</span> <span class="n">multiprocessing</span><span class="o">.</span><span class="n">Array</span><span class="p">(</span><span class="n">ctypes</span><span class="o">.</span><span class="n">c_double</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
</span><span id="BiCM-640"><a href="#BiCM-640"><span class="linenos">640</span></a>        <span class="n">pval_mat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">frombuffer</span><span class="p">(</span><span class="n">shared_array_base</span><span class="o">.</span><span class="n">get_obj</span><span class="p">())</span>
</span><span id="BiCM-641"><a href="#BiCM-641"><span class="linenos">641</span></a>
</span><span id="BiCM-642"><a href="#BiCM-642"><span class="linenos">642</span></a>        <span class="c1"># number of processes running in parallel has to be tested.</span>
</span><span id="BiCM-643"><a href="#BiCM-643"><span class="linenos">643</span></a>        <span class="c1"># good guess is multiprocessing.cpu_count() +- 1</span>
</span><span id="BiCM-644"><a href="#BiCM-644"><span class="linenos">644</span></a>        <span class="k">if</span> <span class="n">parallel</span><span class="p">:</span>
</span><span id="BiCM-645"><a href="#BiCM-645"><span class="linenos">645</span></a>            <span class="n">num_procs</span> <span class="o">=</span> <span class="n">multiprocessing</span><span class="o">.</span><span class="n">cpu_count</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span>
</span><span id="BiCM-646"><a href="#BiCM-646"><span class="linenos">646</span></a>        <span class="k">elif</span> <span class="ow">not</span> <span class="n">parallel</span><span class="p">:</span>
</span><span id="BiCM-647"><a href="#BiCM-647"><span class="linenos">647</span></a>            <span class="n">num_procs</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="BiCM-648"><a href="#BiCM-648"><span class="linenos">648</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="BiCM-649"><a href="#BiCM-649"><span class="linenos">649</span></a>            <span class="n">num_procs</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="BiCM-650"><a href="#BiCM-650"><span class="linenos">650</span></a>
</span><span id="BiCM-651"><a href="#BiCM-651"><span class="linenos">651</span></a>        <span class="c1"># create 2 queues</span>
</span><span id="BiCM-652"><a href="#BiCM-652"><span class="linenos">652</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">input_queue</span> <span class="o">=</span> <span class="n">multiprocessing</span><span class="o">.</span><span class="n">Queue</span><span class="p">()</span>
</span><span id="BiCM-653"><a href="#BiCM-653"><span class="linenos">653</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">output_queue</span> <span class="o">=</span> <span class="n">multiprocessing</span><span class="o">.</span><span class="n">Queue</span><span class="p">()</span>
</span><span id="BiCM-654"><a href="#BiCM-654"><span class="linenos">654</span></a>
</span><span id="BiCM-655"><a href="#BiCM-655"><span class="linenos">655</span></a>        <span class="c1"># (1) add tuples of matrix elements and indices to the input queue</span>
</span><span id="BiCM-656"><a href="#BiCM-656"><span class="linenos">656</span></a>        <span class="n">p_inqueue</span> <span class="o">=</span> <span class="n">multiprocessing</span><span class="o">.</span><span class="n">Process</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">add2inqueue</span><span class="p">,</span>
</span><span id="BiCM-657"><a href="#BiCM-657"><span class="linenos">657</span></a>                                            <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">num_procs</span><span class="p">,</span> <span class="n">plam_mat</span><span class="p">,</span> <span class="n">nlam_mat</span><span class="p">,</span>
</span><span id="BiCM-658"><a href="#BiCM-658"><span class="linenos">658</span></a>                                                <span class="n">k1</span><span class="p">,</span> <span class="n">k2</span><span class="p">))</span>
</span><span id="BiCM-659"><a href="#BiCM-659"><span class="linenos">659</span></a>
</span><span id="BiCM-660"><a href="#BiCM-660"><span class="linenos">660</span></a>
</span><span id="BiCM-661"><a href="#BiCM-661"><span class="linenos">661</span></a>        <span class="n">pval_mat</span> <span class="o">=</span> <span class="n">multiprocessing</span><span class="o">.</span><span class="n">Array</span><span class="p">(</span><span class="s1">&#39;d&#39;</span><span class="p">,</span> <span class="n">pval_mat</span><span class="p">)</span>
</span><span id="BiCM-662"><a href="#BiCM-662"><span class="linenos">662</span></a>
</span><span id="BiCM-663"><a href="#BiCM-663"><span class="linenos">663</span></a>        <span class="c1">#  (2) Put the results from the out-queue into the p-value array.</span>
</span><span id="BiCM-664"><a href="#BiCM-664"><span class="linenos">664</span></a>        <span class="n">p_outqueue</span> <span class="o">=</span> <span class="n">multiprocessing</span><span class="o">.</span><span class="n">Process</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">outqueue2pval_mat</span><span class="p">,</span>
</span><span id="BiCM-665"><a href="#BiCM-665"><span class="linenos">665</span></a>                                             <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">num_procs</span><span class="p">,</span> <span class="n">pval_mat</span><span class="p">))</span>
</span><span id="BiCM-666"><a href="#BiCM-666"><span class="linenos">666</span></a>
</span><span id="BiCM-667"><a href="#BiCM-667"><span class="linenos">667</span></a>        <span class="c1"># (3) pval computer...</span>
</span><span id="BiCM-668"><a href="#BiCM-668"><span class="linenos">668</span></a>        <span class="n">ps</span> <span class="o">=</span> <span class="p">[</span><span class="n">multiprocessing</span><span class="o">.</span><span class="n">Process</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">pval_process_worker</span><span class="p">,</span>
</span><span id="BiCM-669"><a href="#BiCM-669"><span class="linenos">669</span></a>                                      <span class="n">args</span><span class="o">=</span><span class="p">())</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_procs</span><span class="p">)]</span>
</span><span id="BiCM-670"><a href="#BiCM-670"><span class="linenos">670</span></a>
</span><span id="BiCM-671"><a href="#BiCM-671"><span class="linenos">671</span></a>        <span class="c1"># start queues</span>
</span><span id="BiCM-672"><a href="#BiCM-672"><span class="linenos">672</span></a>        <span class="n">p_inqueue</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
</span><span id="BiCM-673"><a href="#BiCM-673"><span class="linenos">673</span></a>        <span class="n">p_outqueue</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
</span><span id="BiCM-674"><a href="#BiCM-674"><span class="linenos">674</span></a>
</span><span id="BiCM-675"><a href="#BiCM-675"><span class="linenos">675</span></a>        <span class="c1"># start processes</span>
</span><span id="BiCM-676"><a href="#BiCM-676"><span class="linenos">676</span></a>        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">ps</span><span class="p">:</span>
</span><span id="BiCM-677"><a href="#BiCM-677"><span class="linenos">677</span></a>            <span class="n">p</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>       <span class="c1"># each process has an id, p.pid</span>
</span><span id="BiCM-678"><a href="#BiCM-678"><span class="linenos">678</span></a>        <span class="n">p_inqueue</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>
</span><span id="BiCM-679"><a href="#BiCM-679"><span class="linenos">679</span></a>
</span><span id="BiCM-680"><a href="#BiCM-680"><span class="linenos">680</span></a>        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">ps</span><span class="p">:</span>
</span><span id="BiCM-681"><a href="#BiCM-681"><span class="linenos">681</span></a>            <span class="n">p</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>
</span><span id="BiCM-682"><a href="#BiCM-682"><span class="linenos">682</span></a>        <span class="n">p_outqueue</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>
</span><span id="BiCM-683"><a href="#BiCM-683"><span class="linenos">683</span></a>
</span><span id="BiCM-684"><a href="#BiCM-684"><span class="linenos">684</span></a>        <span class="c1">#print(&#39;final matrix:&#39;)</span>
</span><span id="BiCM-685"><a href="#BiCM-685"><span class="linenos">685</span></a>        <span class="n">pval_mat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">frombuffer</span><span class="p">(</span><span class="n">pval_mat</span><span class="o">.</span><span class="n">get_obj</span><span class="p">(),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
</span><span id="BiCM-686"><a href="#BiCM-686"><span class="linenos">686</span></a>        <span class="c1">#for i in range(len(pval_mat)):</span>
</span><span id="BiCM-687"><a href="#BiCM-687"><span class="linenos">687</span></a>        <span class="c1">#    value = pval_mat[i]</span>
</span><span id="BiCM-688"><a href="#BiCM-688"><span class="linenos">688</span></a>        <span class="c1">#    print(value)</span>
</span><span id="BiCM-689"><a href="#BiCM-689"><span class="linenos">689</span></a>        <span class="c1">#print(&#39;--------&#39;)</span>
</span><span id="BiCM-690"><a href="#BiCM-690"><span class="linenos">690</span></a>        <span class="c1">#print(pval_mat)</span>
</span><span id="BiCM-691"><a href="#BiCM-691"><span class="linenos">691</span></a>        <span class="c1">#print(&#39;-------&#39;)</span>
</span><span id="BiCM-692"><a href="#BiCM-692"><span class="linenos">692</span></a>
</span><span id="BiCM-693"><a href="#BiCM-693"><span class="linenos">693</span></a>
</span><span id="BiCM-694"><a href="#BiCM-694"><span class="linenos">694</span></a>        <span class="k">return</span> <span class="n">pval_mat</span>
</span><span id="BiCM-695"><a href="#BiCM-695"><span class="linenos">695</span></a>
</span><span id="BiCM-696"><a href="#BiCM-696"><span class="linenos">696</span></a>    <span class="k">def</span> <span class="nf">add2inqueue</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nprocs</span><span class="p">,</span> <span class="n">plam_mat</span><span class="p">,</span> <span class="n">nlam_mat</span><span class="p">,</span> <span class="n">k1</span><span class="p">,</span> <span class="n">k2</span><span class="p">):</span>
</span><span id="BiCM-697"><a href="#BiCM-697"><span class="linenos">697</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Add elements to the in-queue to calculate the p-values.</span>
</span><span id="BiCM-698"><a href="#BiCM-698"><span class="linenos">698</span></a>
</span><span id="BiCM-699"><a href="#BiCM-699"><span class="linenos">699</span></a><span class="sd">        :param nprocs: number of processes running in parallel</span>
</span><span id="BiCM-700"><a href="#BiCM-700"><span class="linenos">700</span></a><span class="sd">        :type nprocs: int</span>
</span><span id="BiCM-701"><a href="#BiCM-701"><span class="linenos">701</span></a><span class="sd">        :param plam_mat: array containing the list of probabilities for the</span>
</span><span id="BiCM-702"><a href="#BiCM-702"><span class="linenos">702</span></a><span class="sd">            single observations of :math:`\\Lambda`-motifs</span>
</span><span id="BiCM-703"><a href="#BiCM-703"><span class="linenos">703</span></a><span class="sd">        :type plam_mat: numpy.array (square matrix)</span>
</span><span id="BiCM-704"><a href="#BiCM-704"><span class="linenos">704</span></a><span class="sd">        :param nlam_mat: array containing the observations of</span>
</span><span id="BiCM-705"><a href="#BiCM-705"><span class="linenos">705</span></a><span class="sd">            :math:`\\Lambda`-motifs</span>
</span><span id="BiCM-706"><a href="#BiCM-706"><span class="linenos">706</span></a><span class="sd">        :type nlam_mat: numpy.array (square matrix)</span>
</span><span id="BiCM-707"><a href="#BiCM-707"><span class="linenos">707</span></a><span class="sd">        :param k1: lower interval limit</span>
</span><span id="BiCM-708"><a href="#BiCM-708"><span class="linenos">708</span></a><span class="sd">        :type k1: int</span>
</span><span id="BiCM-709"><a href="#BiCM-709"><span class="linenos">709</span></a><span class="sd">        :param k2: upper interval limit</span>
</span><span id="BiCM-710"><a href="#BiCM-710"><span class="linenos">710</span></a><span class="sd">        :type k2: int</span>
</span><span id="BiCM-711"><a href="#BiCM-711"><span class="linenos">711</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="BiCM-712"><a href="#BiCM-712"><span class="linenos">712</span></a>        <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">plam_mat</span><span class="p">)</span>
</span><span id="BiCM-713"><a href="#BiCM-713"><span class="linenos">713</span></a>        <span class="c1"># add tuples of matrix elements and indices to the input queue</span>
</span><span id="BiCM-714"><a href="#BiCM-714"><span class="linenos">714</span></a>        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">k1</span><span class="p">,</span> <span class="n">k2</span><span class="p">):</span>
</span><span id="BiCM-715"><a href="#BiCM-715"><span class="linenos">715</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">input_queue</span><span class="o">.</span><span class="n">put</span><span class="p">((</span><span class="n">k</span> <span class="o">-</span> <span class="n">k1</span><span class="p">,</span> <span class="n">plam_mat</span><span class="p">[</span><span class="n">k</span> <span class="o">-</span> <span class="n">k1</span><span class="p">,</span> <span class="p">:],</span>
</span><span id="BiCM-716"><a href="#BiCM-716"><span class="linenos">716</span></a>                                  <span class="n">nlam_mat</span><span class="p">[</span><span class="n">k</span> <span class="o">-</span> <span class="n">k1</span><span class="p">]))</span>
</span><span id="BiCM-717"><a href="#BiCM-717"><span class="linenos">717</span></a>
</span><span id="BiCM-718"><a href="#BiCM-718"><span class="linenos">718</span></a>        <span class="c1"># add as many poison pills &quot;STOP&quot; to the queue as there are workers</span>
</span><span id="BiCM-719"><a href="#BiCM-719"><span class="linenos">719</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nprocs</span><span class="p">):</span>
</span><span id="BiCM-720"><a href="#BiCM-720"><span class="linenos">720</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">input_queue</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="s2">&quot;STOP&quot;</span><span class="p">)</span>
</span><span id="BiCM-721"><a href="#BiCM-721"><span class="linenos">721</span></a>
</span><span id="BiCM-722"><a href="#BiCM-722"><span class="linenos">722</span></a>    <span class="k">def</span> <span class="nf">pval_process_worker</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="BiCM-723"><a href="#BiCM-723"><span class="linenos">723</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Calculate p-values and add them to the out-queue.&quot;&quot;&quot;</span>
</span><span id="BiCM-724"><a href="#BiCM-724"><span class="linenos">724</span></a>        <span class="c1"># take elements from the queue as long as the element is not &quot;STOP&quot;</span>
</span><span id="BiCM-725"><a href="#BiCM-725"><span class="linenos">725</span></a>        <span class="k">for</span> <span class="n">tupl</span> <span class="ow">in</span> <span class="nb">iter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">input_queue</span><span class="o">.</span><span class="n">get</span><span class="p">,</span> <span class="s2">&quot;STOP&quot;</span><span class="p">):</span>
</span><span id="BiCM-726"><a href="#BiCM-726"><span class="linenos">726</span></a>            <span class="n">pb</span> <span class="o">=</span> <span class="n">PoiBin</span><span class="p">(</span><span class="n">tupl</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</span><span id="BiCM-727"><a href="#BiCM-727"><span class="linenos">727</span></a>
</span><span id="BiCM-728"><a href="#BiCM-728"><span class="linenos">728</span></a>            <span class="n">pv</span> <span class="o">=</span> <span class="n">pb</span><span class="o">.</span><span class="n">pval</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">tupl</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
</span><span id="BiCM-729"><a href="#BiCM-729"><span class="linenos">729</span></a>            <span class="c1">#print(&#39;loc {}, pval computed: {}&#39;.format(pb, pv))</span>
</span><span id="BiCM-730"><a href="#BiCM-730"><span class="linenos">730</span></a>            <span class="c1"># add the result to the output queue</span>
</span><span id="BiCM-731"><a href="#BiCM-731"><span class="linenos">731</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">output_queue</span><span class="o">.</span><span class="n">put</span><span class="p">((</span><span class="n">tupl</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">pv</span><span class="p">))</span>
</span><span id="BiCM-732"><a href="#BiCM-732"><span class="linenos">732</span></a>        <span class="c1"># once all the elements in the input queue have been dealt with, add a</span>
</span><span id="BiCM-733"><a href="#BiCM-733"><span class="linenos">733</span></a>        <span class="c1"># &quot;STOP&quot; to the output queue</span>
</span><span id="BiCM-734"><a href="#BiCM-734"><span class="linenos">734</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">output_queue</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="s2">&quot;STOP&quot;</span><span class="p">)</span>
</span><span id="BiCM-735"><a href="#BiCM-735"><span class="linenos">735</span></a>
</span><span id="BiCM-736"><a href="#BiCM-736"><span class="linenos">736</span></a>    <span class="k">def</span> <span class="nf">outqueue2pval_mat</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nprocs</span><span class="p">,</span> <span class="n">pvalmat</span><span class="p">):</span>
</span><span id="BiCM-737"><a href="#BiCM-737"><span class="linenos">737</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Put the results from the out-queue into the p-value array.&quot;&quot;&quot;</span>
</span><span id="BiCM-738"><a href="#BiCM-738"><span class="linenos">738</span></a>        <span class="c1"># stop the work after having met nprocs times &quot;STOP&quot;</span>
</span><span id="BiCM-739"><a href="#BiCM-739"><span class="linenos">739</span></a>        <span class="k">for</span> <span class="n">work</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nprocs</span><span class="p">):</span>
</span><span id="BiCM-740"><a href="#BiCM-740"><span class="linenos">740</span></a>            <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="nb">iter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">output_queue</span><span class="o">.</span><span class="n">get</span><span class="p">,</span> <span class="s2">&quot;STOP&quot;</span><span class="p">):</span>
</span><span id="BiCM-741"><a href="#BiCM-741"><span class="linenos">741</span></a>                <span class="n">k</span> <span class="o">=</span> <span class="n">val</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="BiCM-742"><a href="#BiCM-742"><span class="linenos">742</span></a>                <span class="c1">#print(&#39;popping pval from out que:&#39;, val[1])</span>
</span><span id="BiCM-743"><a href="#BiCM-743"><span class="linenos">743</span></a>                <span class="n">pvalmat</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="BiCM-744"><a href="#BiCM-744"><span class="linenos">744</span></a>
</span><span id="BiCM-745"><a href="#BiCM-745"><span class="linenos">745</span></a>        <span class="c1">#print(&#39;final matrix&#39;)</span>
</span><span id="BiCM-746"><a href="#BiCM-746"><span class="linenos">746</span></a>        <span class="c1">#print(pvalmat)</span>
</span><span id="BiCM-747"><a href="#BiCM-747"><span class="linenos">747</span></a>
</span><span id="BiCM-748"><a href="#BiCM-748"><span class="linenos">748</span></a>
</span><span id="BiCM-749"><a href="#BiCM-749"><span class="linenos">749</span></a>    <span class="k">def</span> <span class="nf">get_triup_dim</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bip_set</span><span class="p">):</span>
</span><span id="BiCM-750"><a href="#BiCM-750"><span class="linenos">750</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the number of possible node couples in ``bip_set``.</span>
</span><span id="BiCM-751"><a href="#BiCM-751"><span class="linenos">751</span></a>
</span><span id="BiCM-752"><a href="#BiCM-752"><span class="linenos">752</span></a><span class="sd">        :param bip_set: selects row-nodes (``True``) or column-nodes</span>
</span><span id="BiCM-753"><a href="#BiCM-753"><span class="linenos">753</span></a><span class="sd">            (``False``)</span>
</span><span id="BiCM-754"><a href="#BiCM-754"><span class="linenos">754</span></a><span class="sd">        :type bip_set: bool</span>
</span><span id="BiCM-755"><a href="#BiCM-755"><span class="linenos">755</span></a><span class="sd">        :returns: return the number of node couple combinations corresponding</span>
</span><span id="BiCM-756"><a href="#BiCM-756"><span class="linenos">756</span></a><span class="sd">            to the layer ``bip_set``</span>
</span><span id="BiCM-757"><a href="#BiCM-757"><span class="linenos">757</span></a><span class="sd">        :rtype: int</span>
</span><span id="BiCM-758"><a href="#BiCM-758"><span class="linenos">758</span></a>
</span><span id="BiCM-759"><a href="#BiCM-759"><span class="linenos">759</span></a><span class="sd">        :raise ValueError: raise an error if the parameter ``bip_set`` is</span>
</span><span id="BiCM-760"><a href="#BiCM-760"><span class="linenos">760</span></a><span class="sd">            neither ``True`` nor ``False``</span>
</span><span id="BiCM-761"><a href="#BiCM-761"><span class="linenos">761</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="BiCM-762"><a href="#BiCM-762"><span class="linenos">762</span></a>        <span class="k">if</span> <span class="n">bip_set</span><span class="p">:</span>
</span><span id="BiCM-763"><a href="#BiCM-763"><span class="linenos">763</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">triumat2flat_dim</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_rows</span><span class="p">)</span>
</span><span id="BiCM-764"><a href="#BiCM-764"><span class="linenos">764</span></a>        <span class="k">elif</span> <span class="ow">not</span> <span class="n">bip_set</span><span class="p">:</span>
</span><span id="BiCM-765"><a href="#BiCM-765"><span class="linenos">765</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">triumat2flat_dim</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_columns</span><span class="p">)</span>
</span><span id="BiCM-766"><a href="#BiCM-766"><span class="linenos">766</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="BiCM-767"><a href="#BiCM-767"><span class="linenos">767</span></a>            <span class="n">errmsg</span> <span class="o">=</span> <span class="s2">&quot;&#39;&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">bip_set</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&#39; &quot;</span> <span class="o">+</span> <span class="s1">&#39;not supported.&#39;</span>
</span><span id="BiCM-768"><a href="#BiCM-768"><span class="linenos">768</span></a>            <span class="k">raise</span> <span class="ne">NameError</span><span class="p">(</span><span class="n">errmsg</span><span class="p">)</span>
</span><span id="BiCM-769"><a href="#BiCM-769"><span class="linenos">769</span></a>
</span><span id="BiCM-770"><a href="#BiCM-770"><span class="linenos">770</span></a>    <span class="k">def</span> <span class="nf">split_range</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">m</span><span class="o">=</span><span class="mi">4</span><span class="p">):</span>
</span><span id="BiCM-771"><a href="#BiCM-771"><span class="linenos">771</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Split the interval :math:`\\left[0,\ldots, n\\right]` in ``m`` parts.</span>
</span><span id="BiCM-772"><a href="#BiCM-772"><span class="linenos">772</span></a>
</span><span id="BiCM-773"><a href="#BiCM-773"><span class="linenos">773</span></a><span class="sd">        :param n: upper limit of the range</span>
</span><span id="BiCM-774"><a href="#BiCM-774"><span class="linenos">774</span></a><span class="sd">        :type n: int</span>
</span><span id="BiCM-775"><a href="#BiCM-775"><span class="linenos">775</span></a><span class="sd">        :param m: number of part in which range should be split</span>
</span><span id="BiCM-776"><a href="#BiCM-776"><span class="linenos">776</span></a><span class="sd">        :type n: int</span>
</span><span id="BiCM-777"><a href="#BiCM-777"><span class="linenos">777</span></a><span class="sd">        :returns: delimiter indices for the ``m`` parts</span>
</span><span id="BiCM-778"><a href="#BiCM-778"><span class="linenos">778</span></a><span class="sd">        :rtype: list</span>
</span><span id="BiCM-779"><a href="#BiCM-779"><span class="linenos">779</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="BiCM-780"><a href="#BiCM-780"><span class="linenos">780</span></a>        <span class="k">return</span> <span class="p">[</span><span class="n">i</span> <span class="o">*</span> <span class="n">n</span> <span class="o">/</span> <span class="n">m</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">m</span><span class="p">)]</span>
</span><span id="BiCM-781"><a href="#BiCM-781"><span class="linenos">781</span></a>
</span><span id="BiCM-782"><a href="#BiCM-782"><span class="linenos">782</span></a><span class="c1"># ------------------------------------------------------------------------------</span>
</span><span id="BiCM-783"><a href="#BiCM-783"><span class="linenos">783</span></a><span class="c1"># Auxiliary methods</span>
</span><span id="BiCM-784"><a href="#BiCM-784"><span class="linenos">784</span></a><span class="c1"># ------------------------------------------------------------------------------</span>
</span><span id="BiCM-785"><a href="#BiCM-785"><span class="linenos">785</span></a>
</span><span id="BiCM-786"><a href="#BiCM-786"><span class="linenos">786</span></a>    <span class="nd">@staticmethod</span>
</span><span id="BiCM-787"><a href="#BiCM-787"><span class="linenos">787</span></a>    <span class="k">def</span> <span class="nf">triumat2flat_idx</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
</span><span id="BiCM-788"><a href="#BiCM-788"><span class="linenos">788</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Convert an matrix index couple to a flattened array index.</span>
</span><span id="BiCM-789"><a href="#BiCM-789"><span class="linenos">789</span></a>
</span><span id="BiCM-790"><a href="#BiCM-790"><span class="linenos">790</span></a><span class="sd">        Given a square matrix of dimension ``n`` and the index couple</span>
</span><span id="BiCM-791"><a href="#BiCM-791"><span class="linenos">791</span></a><span class="sd">        ``(i, j)`` *of the upper triangular part* of the matrix, return the</span>
</span><span id="BiCM-792"><a href="#BiCM-792"><span class="linenos">792</span></a><span class="sd">        index which the matrix element would have in a flattened array.</span>
</span><span id="BiCM-793"><a href="#BiCM-793"><span class="linenos">793</span></a>
</span><span id="BiCM-794"><a href="#BiCM-794"><span class="linenos">794</span></a><span class="sd">        .. note::</span>
</span><span id="BiCM-795"><a href="#BiCM-795"><span class="linenos">795</span></a><span class="sd">            * :math:`i \\in [0, ..., n - 1]`</span>
</span><span id="BiCM-796"><a href="#BiCM-796"><span class="linenos">796</span></a><span class="sd">            * :math:`j \\in [i + 1, ..., n - 1]`</span>
</span><span id="BiCM-797"><a href="#BiCM-797"><span class="linenos">797</span></a><span class="sd">            * returned index :math:`\\in [0,\\, n (n - 1) / 2 - 1]`</span>
</span><span id="BiCM-798"><a href="#BiCM-798"><span class="linenos">798</span></a>
</span><span id="BiCM-799"><a href="#BiCM-799"><span class="linenos">799</span></a><span class="sd">        :param i: row index</span>
</span><span id="BiCM-800"><a href="#BiCM-800"><span class="linenos">800</span></a><span class="sd">        :type i: int</span>
</span><span id="BiCM-801"><a href="#BiCM-801"><span class="linenos">801</span></a><span class="sd">        :param j: column index</span>
</span><span id="BiCM-802"><a href="#BiCM-802"><span class="linenos">802</span></a><span class="sd">        :type j: int</span>
</span><span id="BiCM-803"><a href="#BiCM-803"><span class="linenos">803</span></a><span class="sd">        :param n: dimension of the square matrix</span>
</span><span id="BiCM-804"><a href="#BiCM-804"><span class="linenos">804</span></a><span class="sd">        :type n: int</span>
</span><span id="BiCM-805"><a href="#BiCM-805"><span class="linenos">805</span></a><span class="sd">        :returns: flattened array index</span>
</span><span id="BiCM-806"><a href="#BiCM-806"><span class="linenos">806</span></a><span class="sd">        :rtype: int</span>
</span><span id="BiCM-807"><a href="#BiCM-807"><span class="linenos">807</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="BiCM-808"><a href="#BiCM-808"><span class="linenos">808</span></a>        <span class="k">return</span> <span class="nb">int</span><span class="p">((</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">n</span> <span class="o">-</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="mf">2.</span> <span class="o">-</span> <span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="p">(</span><span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="BiCM-809"><a href="#BiCM-809"><span class="linenos">809</span></a>
</span><span id="BiCM-810"><a href="#BiCM-810"><span class="linenos">810</span></a>    <span class="nd">@staticmethod</span>
</span><span id="BiCM-811"><a href="#BiCM-811"><span class="linenos">811</span></a>    <span class="k">def</span> <span class="nf">triumat2flat_dim</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
</span><span id="BiCM-812"><a href="#BiCM-812"><span class="linenos">812</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the size of the triangular part of a ``n x n`` matrix.</span>
</span><span id="BiCM-813"><a href="#BiCM-813"><span class="linenos">813</span></a>
</span><span id="BiCM-814"><a href="#BiCM-814"><span class="linenos">814</span></a><span class="sd">        :param n: the dimension of the square matrix</span>
</span><span id="BiCM-815"><a href="#BiCM-815"><span class="linenos">815</span></a><span class="sd">        :type n: int</span>
</span><span id="BiCM-816"><a href="#BiCM-816"><span class="linenos">816</span></a><span class="sd">        :returns: number of elements in the upper triangular part of the matrix</span>
</span><span id="BiCM-817"><a href="#BiCM-817"><span class="linenos">817</span></a><span class="sd">            (excluding the diagonal)</span>
</span><span id="BiCM-818"><a href="#BiCM-818"><span class="linenos">818</span></a><span class="sd">        :rtype: int</span>
</span><span id="BiCM-819"><a href="#BiCM-819"><span class="linenos">819</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="BiCM-820"><a href="#BiCM-820"><span class="linenos">820</span></a>        <span class="k">return</span> <span class="n">n</span> <span class="o">*</span> <span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
</span><span id="BiCM-821"><a href="#BiCM-821"><span class="linenos">821</span></a>
</span><span id="BiCM-822"><a href="#BiCM-822"><span class="linenos">822</span></a>    <span class="nd">@staticmethod</span>
</span><span id="BiCM-823"><a href="#BiCM-823"><span class="linenos">823</span></a>    <span class="k">def</span> <span class="nf">flat2triumat_dim</span><span class="p">(</span><span class="n">k</span><span class="p">):</span>
</span><span id="BiCM-824"><a href="#BiCM-824"><span class="linenos">824</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the dimension of the matrix hosting ``k`` triangular elements.</span>
</span><span id="BiCM-825"><a href="#BiCM-825"><span class="linenos">825</span></a>
</span><span id="BiCM-826"><a href="#BiCM-826"><span class="linenos">826</span></a><span class="sd">        :param k: the number of elements in the upper triangular</span>
</span><span id="BiCM-827"><a href="#BiCM-827"><span class="linenos">827</span></a><span class="sd">            part of the corresponding square matrix, excluding the diagonal</span>
</span><span id="BiCM-828"><a href="#BiCM-828"><span class="linenos">828</span></a><span class="sd">        :type k: int</span>
</span><span id="BiCM-829"><a href="#BiCM-829"><span class="linenos">829</span></a><span class="sd">        :returns: dimension of the corresponding square matrix</span>
</span><span id="BiCM-830"><a href="#BiCM-830"><span class="linenos">830</span></a><span class="sd">        :rtype: int</span>
</span><span id="BiCM-831"><a href="#BiCM-831"><span class="linenos">831</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="BiCM-832"><a href="#BiCM-832"><span class="linenos">832</span></a>        <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="mf">0.5</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">0.25</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">k</span><span class="p">))</span>
</span><span id="BiCM-833"><a href="#BiCM-833"><span class="linenos">833</span></a>
</span><span id="BiCM-834"><a href="#BiCM-834"><span class="linenos">834</span></a>    <span class="nd">@staticmethod</span>
</span><span id="BiCM-835"><a href="#BiCM-835"><span class="linenos">835</span></a>    <span class="k">def</span> <span class="nf">flat2triumat_idx</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
</span><span id="BiCM-836"><a href="#BiCM-836"><span class="linenos">836</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Convert an array index into the index couple of a triangular matrix.</span>
</span><span id="BiCM-837"><a href="#BiCM-837"><span class="linenos">837</span></a>
</span><span id="BiCM-838"><a href="#BiCM-838"><span class="linenos">838</span></a><span class="sd">        ``k`` is the index of an array of length :math:`\\binom{n}{2}{2}`,</span>
</span><span id="BiCM-839"><a href="#BiCM-839"><span class="linenos">839</span></a><span class="sd">        which contains the elements of an upper triangular matrix of dimension</span>
</span><span id="BiCM-840"><a href="#BiCM-840"><span class="linenos">840</span></a><span class="sd">        ``n`` excluding the diagonal. The function returns the index couple</span>
</span><span id="BiCM-841"><a href="#BiCM-841"><span class="linenos">841</span></a><span class="sd">        :math:`(i, j)` that corresponds to the entry ``k`` of the flat array.</span>
</span><span id="BiCM-842"><a href="#BiCM-842"><span class="linenos">842</span></a>
</span><span id="BiCM-843"><a href="#BiCM-843"><span class="linenos">843</span></a><span class="sd">        .. note::</span>
</span><span id="BiCM-844"><a href="#BiCM-844"><span class="linenos">844</span></a><span class="sd">            * :math:`k \\in \left[0,\\ldots, \\binom{n}{2} - 1\\right]`</span>
</span><span id="BiCM-845"><a href="#BiCM-845"><span class="linenos">845</span></a><span class="sd">            * returned indices:</span>
</span><span id="BiCM-846"><a href="#BiCM-846"><span class="linenos">846</span></a><span class="sd">                * :math:`i \\in [0,\\ldots, n - 1]`</span>
</span><span id="BiCM-847"><a href="#BiCM-847"><span class="linenos">847</span></a><span class="sd">                * :math:`j \\in [i + 1,\\ldots, n - 1]`</span>
</span><span id="BiCM-848"><a href="#BiCM-848"><span class="linenos">848</span></a>
</span><span id="BiCM-849"><a href="#BiCM-849"><span class="linenos">849</span></a><span class="sd">        :param k: flattened array index</span>
</span><span id="BiCM-850"><a href="#BiCM-850"><span class="linenos">850</span></a><span class="sd">        :type k: int</span>
</span><span id="BiCM-851"><a href="#BiCM-851"><span class="linenos">851</span></a><span class="sd">        :param n: dimension of the square matrix</span>
</span><span id="BiCM-852"><a href="#BiCM-852"><span class="linenos">852</span></a><span class="sd">        :type n: int</span>
</span><span id="BiCM-853"><a href="#BiCM-853"><span class="linenos">853</span></a><span class="sd">        :returns: matrix index tuple (row, column)</span>
</span><span id="BiCM-854"><a href="#BiCM-854"><span class="linenos">854</span></a><span class="sd">        :rtype: tuple</span>
</span><span id="BiCM-855"><a href="#BiCM-855"><span class="linenos">855</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="BiCM-856"><a href="#BiCM-856"><span class="linenos">856</span></a>        <span class="c1"># row index of array index k in the the upper triangular part of the</span>
</span><span id="BiCM-857"><a href="#BiCM-857"><span class="linenos">857</span></a>        <span class="c1"># square matrix</span>
</span><span id="BiCM-858"><a href="#BiCM-858"><span class="linenos">858</span></a>        <span class="n">r</span> <span class="o">=</span> <span class="n">n</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">-</span> <span class="nb">int</span><span class="p">(</span><span class="mf">0.5</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="o">-</span><span class="mi">8</span> <span class="o">*</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">n</span> <span class="o">*</span> <span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="mi">7</span><span class="p">)</span> <span class="o">-</span> <span class="mf">0.5</span><span class="p">)</span>
</span><span id="BiCM-859"><a href="#BiCM-859"><span class="linenos">859</span></a>        <span class="c1"># column index of array index k in the the upper triangular part of the</span>
</span><span id="BiCM-860"><a href="#BiCM-860"><span class="linenos">860</span></a>        <span class="c1"># square matrix</span>
</span><span id="BiCM-861"><a href="#BiCM-861"><span class="linenos">861</span></a>        <span class="n">c</span> <span class="o">=</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">r</span> <span class="o">*</span> <span class="p">(</span><span class="mi">3</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">n</span> <span class="o">+</span> <span class="n">r</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
</span><span id="BiCM-862"><a href="#BiCM-862"><span class="linenos">862</span></a>        <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">r</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
</span><span id="BiCM-863"><a href="#BiCM-863"><span class="linenos">863</span></a>
</span><span id="BiCM-864"><a href="#BiCM-864"><span class="linenos">864</span></a>    <span class="k">def</span> <span class="nf">save_biadjacency</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">delim</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">binary</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="BiCM-865"><a href="#BiCM-865"><span class="linenos">865</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Save the biadjacendy matrix of the BiCM null model.</span>
</span><span id="BiCM-866"><a href="#BiCM-866"><span class="linenos">866</span></a>
</span><span id="BiCM-867"><a href="#BiCM-867"><span class="linenos">867</span></a><span class="sd">        The matrix can either be saved as a binary NumPy ``.npy`` file or as a</span>
</span><span id="BiCM-868"><a href="#BiCM-868"><span class="linenos">868</span></a><span class="sd">        human-readable ``.csv`` file.</span>
</span><span id="BiCM-869"><a href="#BiCM-869"><span class="linenos">869</span></a>
</span><span id="BiCM-870"><a href="#BiCM-870"><span class="linenos">870</span></a><span class="sd">        .. note::</span>
</span><span id="BiCM-871"><a href="#BiCM-871"><span class="linenos">871</span></a>
</span><span id="BiCM-872"><a href="#BiCM-872"><span class="linenos">872</span></a><span class="sd">            * The relative path has to be provided in the filename, e.g.</span>
</span><span id="BiCM-873"><a href="#BiCM-873"><span class="linenos">873</span></a><span class="sd">              *../data/pvalue_matrix.csv*.</span>
</span><span id="BiCM-874"><a href="#BiCM-874"><span class="linenos">874</span></a>
</span><span id="BiCM-875"><a href="#BiCM-875"><span class="linenos">875</span></a><span class="sd">            * If ``binary==True``, NumPy</span>
</span><span id="BiCM-876"><a href="#BiCM-876"><span class="linenos">876</span></a><span class="sd">              automatically appends the format ending ``.npy`` to the file.</span>
</span><span id="BiCM-877"><a href="#BiCM-877"><span class="linenos">877</span></a>
</span><span id="BiCM-878"><a href="#BiCM-878"><span class="linenos">878</span></a><span class="sd">        :param filename: name of the output file</span>
</span><span id="BiCM-879"><a href="#BiCM-879"><span class="linenos">879</span></a><span class="sd">        :type filename: str</span>
</span><span id="BiCM-880"><a href="#BiCM-880"><span class="linenos">880</span></a><span class="sd">        :param delim: delimiter between values in file</span>
</span><span id="BiCM-881"><a href="#BiCM-881"><span class="linenos">881</span></a><span class="sd">        :type delim: str</span>
</span><span id="BiCM-882"><a href="#BiCM-882"><span class="linenos">882</span></a><span class="sd">        :param binary: if ``True``, save as binary ``.npy``, otherwise as a</span>
</span><span id="BiCM-883"><a href="#BiCM-883"><span class="linenos">883</span></a><span class="sd">            ``.csv`` file</span>
</span><span id="BiCM-884"><a href="#BiCM-884"><span class="linenos">884</span></a><span class="sd">        :type binary: bool</span>
</span><span id="BiCM-885"><a href="#BiCM-885"><span class="linenos">885</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="BiCM-886"><a href="#BiCM-886"><span class="linenos">886</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">save_array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">adj_matrix</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">delim</span><span class="p">,</span> <span class="n">binary</span><span class="p">)</span>
</span><span id="BiCM-887"><a href="#BiCM-887"><span class="linenos">887</span></a>
</span><span id="BiCM-888"><a href="#BiCM-888"><span class="linenos">888</span></a>    <span class="nd">@staticmethod</span>
</span><span id="BiCM-889"><a href="#BiCM-889"><span class="linenos">889</span></a>    <span class="k">def</span> <span class="nf">save_array</span><span class="p">(</span><span class="n">mat</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">delim</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">binary</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="BiCM-890"><a href="#BiCM-890"><span class="linenos">890</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Save the array ``mat`` in the file ``filename``.</span>
</span><span id="BiCM-891"><a href="#BiCM-891"><span class="linenos">891</span></a>
</span><span id="BiCM-892"><a href="#BiCM-892"><span class="linenos">892</span></a><span class="sd">        The array can either be saved as a binary NumPy ``.npy`` file or as a</span>
</span><span id="BiCM-893"><a href="#BiCM-893"><span class="linenos">893</span></a><span class="sd">        human-readable ``.npy`` file.</span>
</span><span id="BiCM-894"><a href="#BiCM-894"><span class="linenos">894</span></a>
</span><span id="BiCM-895"><a href="#BiCM-895"><span class="linenos">895</span></a><span class="sd">        .. note::</span>
</span><span id="BiCM-896"><a href="#BiCM-896"><span class="linenos">896</span></a>
</span><span id="BiCM-897"><a href="#BiCM-897"><span class="linenos">897</span></a><span class="sd">            * The relative path has to be provided in the filename, e.g.</span>
</span><span id="BiCM-898"><a href="#BiCM-898"><span class="linenos">898</span></a><span class="sd">              *../data/pvalue_matrix.csv*.</span>
</span><span id="BiCM-899"><a href="#BiCM-899"><span class="linenos">899</span></a>
</span><span id="BiCM-900"><a href="#BiCM-900"><span class="linenos">900</span></a><span class="sd">            * If ``binary==True``, NumPy</span>
</span><span id="BiCM-901"><a href="#BiCM-901"><span class="linenos">901</span></a><span class="sd">              automatically appends the format ending ``.npy`` to the file.</span>
</span><span id="BiCM-902"><a href="#BiCM-902"><span class="linenos">902</span></a>
</span><span id="BiCM-903"><a href="#BiCM-903"><span class="linenos">903</span></a><span class="sd">        :param mat: array</span>
</span><span id="BiCM-904"><a href="#BiCM-904"><span class="linenos">904</span></a><span class="sd">        :type mat: numpy.array</span>
</span><span id="BiCM-905"><a href="#BiCM-905"><span class="linenos">905</span></a><span class="sd">        :param filename: name of the output file</span>
</span><span id="BiCM-906"><a href="#BiCM-906"><span class="linenos">906</span></a><span class="sd">        :type filename: str</span>
</span><span id="BiCM-907"><a href="#BiCM-907"><span class="linenos">907</span></a><span class="sd">        :param delim: delimiter between values in file</span>
</span><span id="BiCM-908"><a href="#BiCM-908"><span class="linenos">908</span></a><span class="sd">        :type delim: str</span>
</span><span id="BiCM-909"><a href="#BiCM-909"><span class="linenos">909</span></a><span class="sd">        :param binary: if ``True``, save as binary ``.npy``, otherwise as a</span>
</span><span id="BiCM-910"><a href="#BiCM-910"><span class="linenos">910</span></a><span class="sd">            ``.csv`` file</span>
</span><span id="BiCM-911"><a href="#BiCM-911"><span class="linenos">911</span></a><span class="sd">        :type binary: bool</span>
</span><span id="BiCM-912"><a href="#BiCM-912"><span class="linenos">912</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="BiCM-913"><a href="#BiCM-913"><span class="linenos">913</span></a>        <span class="k">if</span> <span class="n">binary</span><span class="p">:</span>
</span><span id="BiCM-914"><a href="#BiCM-914"><span class="linenos">914</span></a>            <span class="n">np</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">mat</span><span class="p">)</span>
</span><span id="BiCM-915"><a href="#BiCM-915"><span class="linenos">915</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="BiCM-916"><a href="#BiCM-916"><span class="linenos">916</span></a>            <span class="n">np</span><span class="o">.</span><span class="n">savetxt</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">mat</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="n">delim</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Bipartite Configuration Model for undirected binary bipartite networks.</p>

<p>This class implements the Bipartite Configuration Model (BiCM), which can
be used as a null model for the analysis of undirected and binary bipartite
networks. The class provides methods for calculating the biadjacency matrix
of the null model and for quantifying node similarities in terms of
p-values.</p>
</div>


                            <div id="BiCM.__init__" class="classattr">
                                        <input id="BiCM.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">BiCM</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">bin_mat</span></span>)</span>

                <label class="view-source-button" for="BiCM.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#BiCM.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="BiCM.__init__-18"><a href="#BiCM.__init__-18"><span class="linenos">18</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bin_mat</span><span class="p">):</span>
</span><span id="BiCM.__init__-19"><a href="#BiCM.__init__-19"><span class="linenos">19</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize the parameters of the BiCM.</span>
</span><span id="BiCM.__init__-20"><a href="#BiCM.__init__-20"><span class="linenos">20</span></a>
</span><span id="BiCM.__init__-21"><a href="#BiCM.__init__-21"><span class="linenos">21</span></a><span class="sd">        :param bin_mat: binary input matrix describing the biadjacency matrix</span>
</span><span id="BiCM.__init__-22"><a href="#BiCM.__init__-22"><span class="linenos">22</span></a><span class="sd">                of a bipartite graph with the nodes of one layer along the rows</span>
</span><span id="BiCM.__init__-23"><a href="#BiCM.__init__-23"><span class="linenos">23</span></a><span class="sd">                and the nodes of the other layer along the columns.</span>
</span><span id="BiCM.__init__-24"><a href="#BiCM.__init__-24"><span class="linenos">24</span></a><span class="sd">        :type bin_mat: numpy.array</span>
</span><span id="BiCM.__init__-25"><a href="#BiCM.__init__-25"><span class="linenos">25</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="BiCM.__init__-26"><a href="#BiCM.__init__-26"><span class="linenos">26</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">bin_mat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">bin_mat</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">)</span>
</span><span id="BiCM.__init__-27"><a href="#BiCM.__init__-27"><span class="linenos">27</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">check_input_matrix_is_binary</span><span class="p">()</span>
</span><span id="BiCM.__init__-28"><a href="#BiCM.__init__-28"><span class="linenos">28</span></a>        <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">num_rows</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_columns</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bin_mat</span><span class="o">.</span><span class="n">shape</span>
</span><span id="BiCM.__init__-29"><a href="#BiCM.__init__-29"><span class="linenos">29</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">dseq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">set_degree_seq</span><span class="p">()</span>
</span><span id="BiCM.__init__-30"><a href="#BiCM.__init__-30"><span class="linenos">30</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">dim</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dseq</span><span class="o">.</span><span class="n">size</span>
</span><span id="BiCM.__init__-31"><a href="#BiCM.__init__-31"><span class="linenos">31</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">sol</span> <span class="o">=</span> <span class="kc">None</span>             <span class="c1"># solution of the equation system</span>
</span><span id="BiCM.__init__-32"><a href="#BiCM.__init__-32"><span class="linenos">32</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">adj_matrix</span> <span class="o">=</span> <span class="kc">None</span>      <span class="c1"># biadjacency matrix of the null model</span>
</span><span id="BiCM.__init__-33"><a href="#BiCM.__init__-33"><span class="linenos">33</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">input_queue</span> <span class="o">=</span> <span class="kc">None</span>     <span class="c1"># queue for parallel processing</span>
</span><span id="BiCM.__init__-34"><a href="#BiCM.__init__-34"><span class="linenos">34</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">output_queue</span> <span class="o">=</span> <span class="kc">None</span>    <span class="c1"># queue for parallel processing</span>
</span></pre></div>


            <div class="docstring"><p>Initialize the parameters of the BiCM.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>bin_mat</strong>:  binary input matrix describing the biadjacency matrix
of a bipartite graph with the nodes of one layer along the rows
and the nodes of the other layer along the columns.</li>
</ul>
</div>


                            </div>
                            <div id="BiCM.bin_mat" class="classattr">
                                <div class="attr variable">
            <span class="name">bin_mat</span>

        
    </div>
    <a class="headerlink" href="#BiCM.bin_mat"></a>
    
    

                            </div>
                            <div id="BiCM.dseq" class="classattr">
                                <div class="attr variable">
            <span class="name">dseq</span>

        
    </div>
    <a class="headerlink" href="#BiCM.dseq"></a>
    
    

                            </div>
                            <div id="BiCM.dim" class="classattr">
                                <div class="attr variable">
            <span class="name">dim</span>

        
    </div>
    <a class="headerlink" href="#BiCM.dim"></a>
    
    

                            </div>
                            <div id="BiCM.sol" class="classattr">
                                <div class="attr variable">
            <span class="name">sol</span>

        
    </div>
    <a class="headerlink" href="#BiCM.sol"></a>
    
    

                            </div>
                            <div id="BiCM.adj_matrix" class="classattr">
                                <div class="attr variable">
            <span class="name">adj_matrix</span>

        
    </div>
    <a class="headerlink" href="#BiCM.adj_matrix"></a>
    
    

                            </div>
                            <div id="BiCM.input_queue" class="classattr">
                                <div class="attr variable">
            <span class="name">input_queue</span>

        
    </div>
    <a class="headerlink" href="#BiCM.input_queue"></a>
    
    

                            </div>
                            <div id="BiCM.output_queue" class="classattr">
                                <div class="attr variable">
            <span class="name">output_queue</span>

        
    </div>
    <a class="headerlink" href="#BiCM.output_queue"></a>
    
    

                            </div>
                            <div id="BiCM.check_input_matrix_is_binary" class="classattr">
                                        <input id="BiCM.check_input_matrix_is_binary-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">check_input_matrix_is_binary</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="BiCM.check_input_matrix_is_binary-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#BiCM.check_input_matrix_is_binary"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="BiCM.check_input_matrix_is_binary-36"><a href="#BiCM.check_input_matrix_is_binary-36"><span class="linenos">36</span></a>    <span class="k">def</span> <span class="nf">check_input_matrix_is_binary</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="BiCM.check_input_matrix_is_binary-37"><a href="#BiCM.check_input_matrix_is_binary-37"><span class="linenos">37</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Check that the input matrix is binary, i.e. entries are 0 or 1.</span>
</span><span id="BiCM.check_input_matrix_is_binary-38"><a href="#BiCM.check_input_matrix_is_binary-38"><span class="linenos">38</span></a>
</span><span id="BiCM.check_input_matrix_is_binary-39"><a href="#BiCM.check_input_matrix_is_binary-39"><span class="linenos">39</span></a><span class="sd">        :raise AssertionError: raise an error if the input matrix is not</span>
</span><span id="BiCM.check_input_matrix_is_binary-40"><a href="#BiCM.check_input_matrix_is_binary-40"><span class="linenos">40</span></a><span class="sd">            binary</span>
</span><span id="BiCM.check_input_matrix_is_binary-41"><a href="#BiCM.check_input_matrix_is_binary-41"><span class="linenos">41</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="BiCM.check_input_matrix_is_binary-42"><a href="#BiCM.check_input_matrix_is_binary-42"><span class="linenos">42</span></a>        <span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">logical_or</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bin_mat</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">bin_mat</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)),</span> \
</span><span id="BiCM.check_input_matrix_is_binary-43"><a href="#BiCM.check_input_matrix_is_binary-43"><span class="linenos">43</span></a>            <span class="s2">&quot;Input matrix is not binary.&quot;</span>
</span></pre></div>


            <div class="docstring"><p>Check that the input matrix is binary, i.e. entries are 0 or 1.</p>

<p>:raise AssertionError: raise an error if the input matrix is not
    binary</p>
</div>


                            </div>
                            <div id="BiCM.set_degree_seq" class="classattr">
                                        <input id="BiCM.set_degree_seq-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">set_degree_seq</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="BiCM.set_degree_seq-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#BiCM.set_degree_seq"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="BiCM.set_degree_seq-45"><a href="#BiCM.set_degree_seq-45"><span class="linenos">45</span></a>    <span class="k">def</span> <span class="nf">set_degree_seq</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="BiCM.set_degree_seq-46"><a href="#BiCM.set_degree_seq-46"><span class="linenos">46</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the node degree sequence of the input matrix.</span>
</span><span id="BiCM.set_degree_seq-47"><a href="#BiCM.set_degree_seq-47"><span class="linenos">47</span></a>
</span><span id="BiCM.set_degree_seq-48"><a href="#BiCM.set_degree_seq-48"><span class="linenos">48</span></a><span class="sd">        :returns: node degree sequence [degrees row-nodes, degrees column-nodes]</span>
</span><span id="BiCM.set_degree_seq-49"><a href="#BiCM.set_degree_seq-49"><span class="linenos">49</span></a><span class="sd">        :rtype: numpy.array</span>
</span><span id="BiCM.set_degree_seq-50"><a href="#BiCM.set_degree_seq-50"><span class="linenos">50</span></a>
</span><span id="BiCM.set_degree_seq-51"><a href="#BiCM.set_degree_seq-51"><span class="linenos">51</span></a><span class="sd">        :raise AssertionError: raise an error if the length of the returned</span>
</span><span id="BiCM.set_degree_seq-52"><a href="#BiCM.set_degree_seq-52"><span class="linenos">52</span></a><span class="sd">            degree sequence does not correspond to the total number of nodes</span>
</span><span id="BiCM.set_degree_seq-53"><a href="#BiCM.set_degree_seq-53"><span class="linenos">53</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="BiCM.set_degree_seq-54"><a href="#BiCM.set_degree_seq-54"><span class="linenos">54</span></a>        <span class="n">dseq</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_rows</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_columns</span><span class="p">)</span>
</span><span id="BiCM.set_degree_seq-55"><a href="#BiCM.set_degree_seq-55"><span class="linenos">55</span></a>        <span class="n">dseq</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">num_rows</span><span class="p">:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bin_mat</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>
</span><span id="BiCM.set_degree_seq-56"><a href="#BiCM.set_degree_seq-56"><span class="linenos">56</span></a>        <span class="n">dseq</span><span class="p">[:</span><span class="bp">self</span><span class="o">.</span><span class="n">num_rows</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bin_mat</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
</span><span id="BiCM.set_degree_seq-57"><a href="#BiCM.set_degree_seq-57"><span class="linenos">57</span></a>        <span class="k">assert</span> <span class="n">dseq</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_rows</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_columns</span><span class="p">)</span>
</span><span id="BiCM.set_degree_seq-58"><a href="#BiCM.set_degree_seq-58"><span class="linenos">58</span></a>        <span class="k">return</span> <span class="n">dseq</span>
</span></pre></div>


            <div class="docstring"><p>Return the node degree sequence of the input matrix.</p>

<p>:returns: node degree sequence [degrees row-nodes, degrees column-nodes]</p>

<p>:raise AssertionError: raise an error if the length of the returned
    degree sequence does not correspond to the total number of nodes</p>
</div>


                            </div>
                            <div id="BiCM.make_bicm" class="classattr">
                                        <input id="BiCM.make_bicm-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">make_bicm</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">x0</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">method</span><span class="o">=</span><span class="s1">&#39;hybr&#39;</span>,</span><span class="param">	<span class="n">jac</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">tol</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">callback</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">options</span><span class="o">=</span><span class="kc">None</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="BiCM.make_bicm-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#BiCM.make_bicm"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="BiCM.make_bicm-60"><a href="#BiCM.make_bicm-60"><span class="linenos"> 60</span></a>    <span class="k">def</span> <span class="nf">make_bicm</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x0</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;hybr&#39;</span><span class="p">,</span> <span class="n">jac</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">tol</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="BiCM.make_bicm-61"><a href="#BiCM.make_bicm-61"><span class="linenos"> 61</span></a>                  <span class="n">callback</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">options</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="BiCM.make_bicm-62"><a href="#BiCM.make_bicm-62"><span class="linenos"> 62</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Create the biadjacency matrix of the BiCM null model.</span>
</span><span id="BiCM.make_bicm-63"><a href="#BiCM.make_bicm-63"><span class="linenos"> 63</span></a>
</span><span id="BiCM.make_bicm-64"><a href="#BiCM.make_bicm-64"><span class="linenos"> 64</span></a><span class="sd">        Solve the log-likelihood maximization problem to obtain the BiCM</span>
</span><span id="BiCM.make_bicm-65"><a href="#BiCM.make_bicm-65"><span class="linenos"> 65</span></a><span class="sd">        null model which respects constraints on the degree sequence of the</span>
</span><span id="BiCM.make_bicm-66"><a href="#BiCM.make_bicm-66"><span class="linenos"> 66</span></a><span class="sd">        input matrix.</span>
</span><span id="BiCM.make_bicm-67"><a href="#BiCM.make_bicm-67"><span class="linenos"> 67</span></a>
</span><span id="BiCM.make_bicm-68"><a href="#BiCM.make_bicm-68"><span class="linenos"> 68</span></a><span class="sd">        The problem is solved using ``scipy``&#39;s root function with the solver</span>
</span><span id="BiCM.make_bicm-69"><a href="#BiCM.make_bicm-69"><span class="linenos"> 69</span></a><span class="sd">        defined by ``method``. The status of the solver after running</span>
</span><span id="BiCM.make_bicm-70"><a href="#BiCM.make_bicm-70"><span class="linenos"> 70</span></a><span class="sd">        ``scipy.root``and the difference between the network and BiCM degrees</span>
</span><span id="BiCM.make_bicm-71"><a href="#BiCM.make_bicm-71"><span class="linenos"> 71</span></a><span class="sd">        are printed in the console.</span>
</span><span id="BiCM.make_bicm-72"><a href="#BiCM.make_bicm-72"><span class="linenos"> 72</span></a>
</span><span id="BiCM.make_bicm-73"><a href="#BiCM.make_bicm-73"><span class="linenos"> 73</span></a><span class="sd">        The default solver is the modified Powell method ``hybr``. Least-squares</span>
</span><span id="BiCM.make_bicm-74"><a href="#BiCM.make_bicm-74"><span class="linenos"> 74</span></a><span class="sd">        can be chosen with ``method=&#39;lm&#39;`` for the Levenberg-Marquardt approach.</span>
</span><span id="BiCM.make_bicm-75"><a href="#BiCM.make_bicm-75"><span class="linenos"> 75</span></a>
</span><span id="BiCM.make_bicm-76"><a href="#BiCM.make_bicm-76"><span class="linenos"> 76</span></a><span class="sd">        Depending on the solver, keyword arguments ``kwargs`` can be passed to</span>
</span><span id="BiCM.make_bicm-77"><a href="#BiCM.make_bicm-77"><span class="linenos"> 77</span></a><span class="sd">        the solver. Please refer to the `scipy.optimize.root documentation</span>
</span><span id="BiCM.make_bicm-78"><a href="#BiCM.make_bicm-78"><span class="linenos"> 78</span></a><span class="sd">        &lt;https://docs.scipy.org/doc/scipy-0.19.0/reference/generated/</span>
</span><span id="BiCM.make_bicm-79"><a href="#BiCM.make_bicm-79"><span class="linenos"> 79</span></a><span class="sd">        scipy.optimize.root.html&gt;`_ for detailed descriptions.</span>
</span><span id="BiCM.make_bicm-80"><a href="#BiCM.make_bicm-80"><span class="linenos"> 80</span></a>
</span><span id="BiCM.make_bicm-81"><a href="#BiCM.make_bicm-81"><span class="linenos"> 81</span></a><span class="sd">        .. note::</span>
</span><span id="BiCM.make_bicm-82"><a href="#BiCM.make_bicm-82"><span class="linenos"> 82</span></a>
</span><span id="BiCM.make_bicm-83"><a href="#BiCM.make_bicm-83"><span class="linenos"> 83</span></a><span class="sd">            It can happen that the solver ``method`` used by ``scipy.root``</span>
</span><span id="BiCM.make_bicm-84"><a href="#BiCM.make_bicm-84"><span class="linenos"> 84</span></a><span class="sd">            does not converge to a solution.</span>
</span><span id="BiCM.make_bicm-85"><a href="#BiCM.make_bicm-85"><span class="linenos"> 85</span></a><span class="sd">            In this case, please try another ``method`` or different initial</span>
</span><span id="BiCM.make_bicm-86"><a href="#BiCM.make_bicm-86"><span class="linenos"> 86</span></a><span class="sd">            conditions and refer to the `scipy.optimize.root documentation</span>
</span><span id="BiCM.make_bicm-87"><a href="#BiCM.make_bicm-87"><span class="linenos"> 87</span></a><span class="sd">            &lt;https://docs.scipy.org/doc/scipy-0.19.0/reference/generated/</span>
</span><span id="BiCM.make_bicm-88"><a href="#BiCM.make_bicm-88"><span class="linenos"> 88</span></a><span class="sd">            scipy.optimize.root.html&gt;`_.</span>
</span><span id="BiCM.make_bicm-89"><a href="#BiCM.make_bicm-89"><span class="linenos"> 89</span></a>
</span><span id="BiCM.make_bicm-90"><a href="#BiCM.make_bicm-90"><span class="linenos"> 90</span></a><span class="sd">        :param x0: initial guesses for the solutions. The first entries are the</span>
</span><span id="BiCM.make_bicm-91"><a href="#BiCM.make_bicm-91"><span class="linenos"> 91</span></a><span class="sd">            initial guesses for the row-nodes, followed by the initial guesses</span>
</span><span id="BiCM.make_bicm-92"><a href="#BiCM.make_bicm-92"><span class="linenos"> 92</span></a><span class="sd">            for the column-nodes.</span>
</span><span id="BiCM.make_bicm-93"><a href="#BiCM.make_bicm-93"><span class="linenos"> 93</span></a><span class="sd">        :type x0: 1d numpy.array, optional</span>
</span><span id="BiCM.make_bicm-94"><a href="#BiCM.make_bicm-94"><span class="linenos"> 94</span></a><span class="sd">        :param method: type of solver, default is ‘hybr’. For other</span>
</span><span id="BiCM.make_bicm-95"><a href="#BiCM.make_bicm-95"><span class="linenos"> 95</span></a><span class="sd">            solvers, see the `scipy.optimize.root documentation</span>
</span><span id="BiCM.make_bicm-96"><a href="#BiCM.make_bicm-96"><span class="linenos"> 96</span></a><span class="sd">            &lt;https://docs.scipy.org/doc/</span>
</span><span id="BiCM.make_bicm-97"><a href="#BiCM.make_bicm-97"><span class="linenos"> 97</span></a><span class="sd">            scipy-0.19.0/reference/generated/scipy.optimize.root.html&gt;`_.</span>
</span><span id="BiCM.make_bicm-98"><a href="#BiCM.make_bicm-98"><span class="linenos"> 98</span></a><span class="sd">        :type method: str, optional</span>
</span><span id="BiCM.make_bicm-99"><a href="#BiCM.make_bicm-99"><span class="linenos"> 99</span></a><span class="sd">        :param jac: Jacobian of the system</span>
</span><span id="BiCM.make_bicm-100"><a href="#BiCM.make_bicm-100"><span class="linenos">100</span></a><span class="sd">        :type jac: bool or callable, optional</span>
</span><span id="BiCM.make_bicm-101"><a href="#BiCM.make_bicm-101"><span class="linenos">101</span></a><span class="sd">        :param tol: tolerance for termination. For detailed control, use</span>
</span><span id="BiCM.make_bicm-102"><a href="#BiCM.make_bicm-102"><span class="linenos">102</span></a><span class="sd">            solver-specific options.</span>
</span><span id="BiCM.make_bicm-103"><a href="#BiCM.make_bicm-103"><span class="linenos">103</span></a><span class="sd">        :type tol: float, optional</span>
</span><span id="BiCM.make_bicm-104"><a href="#BiCM.make_bicm-104"><span class="linenos">104</span></a><span class="sd">        :param callback: optional callback function to be called at</span>
</span><span id="BiCM.make_bicm-105"><a href="#BiCM.make_bicm-105"><span class="linenos">105</span></a><span class="sd">            every iteration as ``callback(self.equations, x)``,</span>
</span><span id="BiCM.make_bicm-106"><a href="#BiCM.make_bicm-106"><span class="linenos">106</span></a><span class="sd">            see ``scipy.root`` documentation</span>
</span><span id="BiCM.make_bicm-107"><a href="#BiCM.make_bicm-107"><span class="linenos">107</span></a><span class="sd">        :type callback: function, optional</span>
</span><span id="BiCM.make_bicm-108"><a href="#BiCM.make_bicm-108"><span class="linenos">108</span></a><span class="sd">        :param options: a dictionary of solver options, e.g. ``xtol`` or</span>
</span><span id="BiCM.make_bicm-109"><a href="#BiCM.make_bicm-109"><span class="linenos">109</span></a><span class="sd">            ``maxiter``, see scipy.root documentation</span>
</span><span id="BiCM.make_bicm-110"><a href="#BiCM.make_bicm-110"><span class="linenos">110</span></a><span class="sd">        :type options: dict, optional</span>
</span><span id="BiCM.make_bicm-111"><a href="#BiCM.make_bicm-111"><span class="linenos">111</span></a><span class="sd">        :param kwargs: solver-specific options, please refer to the SciPy</span>
</span><span id="BiCM.make_bicm-112"><a href="#BiCM.make_bicm-112"><span class="linenos">112</span></a><span class="sd">            documentation</span>
</span><span id="BiCM.make_bicm-113"><a href="#BiCM.make_bicm-113"><span class="linenos">113</span></a>
</span><span id="BiCM.make_bicm-114"><a href="#BiCM.make_bicm-114"><span class="linenos">114</span></a><span class="sd">        :raise ValueError: raise an error if not enough initial conditions</span>
</span><span id="BiCM.make_bicm-115"><a href="#BiCM.make_bicm-115"><span class="linenos">115</span></a><span class="sd">            are provided</span>
</span><span id="BiCM.make_bicm-116"><a href="#BiCM.make_bicm-116"><span class="linenos">116</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="BiCM.make_bicm-117"><a href="#BiCM.make_bicm-117"><span class="linenos">117</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="BiCM.make_bicm-118"><a href="#BiCM.make_bicm-118"><span class="linenos">118</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">sol</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">solve_equations</span><span class="p">(</span><span class="n">x0</span><span class="o">=</span><span class="n">x0</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="n">method</span><span class="p">,</span> <span class="n">jac</span><span class="o">=</span><span class="n">jac</span><span class="p">,</span> <span class="n">tol</span><span class="o">=</span><span class="n">tol</span><span class="p">,</span>
</span><span id="BiCM.make_bicm-119"><a href="#BiCM.make_bicm-119"><span class="linenos">119</span></a>                                            <span class="n">callback</span><span class="o">=</span><span class="n">callback</span><span class="p">,</span> <span class="n">options</span><span class="o">=</span><span class="n">options</span><span class="p">)</span>
</span><span id="BiCM.make_bicm-120"><a href="#BiCM.make_bicm-120"><span class="linenos">120</span></a>            <span class="c1"># create BiCM biadjacency matrix:</span>
</span><span id="BiCM.make_bicm-121"><a href="#BiCM.make_bicm-121"><span class="linenos">121</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">adj_matrix</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_biadjacency_matrix</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sol</span><span class="o">.</span><span class="n">x</span><span class="p">)</span>
</span><span id="BiCM.make_bicm-122"><a href="#BiCM.make_bicm-122"><span class="linenos">122</span></a>            <span class="c1"># self.print_max_degree_differences()</span>
</span><span id="BiCM.make_bicm-123"><a href="#BiCM.make_bicm-123"><span class="linenos">123</span></a>            <span class="c1"># assert self.test_average_degrees(eps=1e-2)</span>
</span><span id="BiCM.make_bicm-124"><a href="#BiCM.make_bicm-124"><span class="linenos">124</span></a>        <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="BiCM.make_bicm-125"><a href="#BiCM.make_bicm-125"><span class="linenos">125</span></a>            <span class="c1"># Catch and handle the ValueError</span>
</span><span id="BiCM.make_bicm-126"><a href="#BiCM.make_bicm-126"><span class="linenos">126</span></a>            <span class="c1">#print(f&quot;Caught a ValueError: {e}&quot;)</span>
</span><span id="BiCM.make_bicm-127"><a href="#BiCM.make_bicm-127"><span class="linenos">127</span></a>            <span class="n">errror_msg</span> <span class="o">=</span> <span class="kc">True</span>
</span></pre></div>


            <div class="docstring"><p>Create the biadjacency matrix of the BiCM null model.</p>

<p>Solve the log-likelihood maximization problem to obtain the BiCM
null model which respects constraints on the degree sequence of the
input matrix.</p>

<p>The problem is solved using <code>scipy</code>'s root function with the solver
defined by <code>method</code>. The status of the solver after running
<code>scipy.root</code>and the difference between the network and BiCM degrees
are printed in the console.</p>

<p>The default solver is the modified Powell method <code>hybr</code>. Least-squares
can be chosen with <code>method='lm'</code> for the Levenberg-Marquardt approach.</p>

<p>Depending on the solver, keyword arguments <code>kwargs</code> can be passed to
the solver. Please refer to the <code>scipy.optimize.root documentation
&lt;https://docs.scipy.org/doc/scipy-0.19.0/reference/generated/
scipy.optimize.root.html&gt;</code>_ for detailed descriptions.</p>

<div class="pdoc-alert pdoc-alert-note">

<p>It can happen that the solver <code>method</code> used by <code>scipy.root</code>
does not converge to a solution.
In this case, please try another <code>method</code> or different initial
conditions and refer to the <code>scipy.optimize.root documentation
&lt;https://docs.scipy.org/doc/scipy-0.19.0/reference/generated/
scipy.optimize.root.html&gt;</code>_.</p>

</div>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>x0</strong>:  initial guesses for the solutions. The first entries are the
initial guesses for the row-nodes, followed by the initial guesses
for the column-nodes.</li>
<li><strong>method</strong>:  type of solver, default is ‘hybr’. For other
solvers, see the <code>scipy.optimize.root documentation
&lt;https://docs.scipy.org/doc/
scipy-0.19.0/reference/generated/scipy.optimize.root.html&gt;</code>_.</li>
<li><strong>jac</strong>:  Jacobian of the system</li>
<li><strong>tol</strong>:  tolerance for termination. For detailed control, use
solver-specific options.</li>
<li><strong>callback</strong>:  optional callback function to be called at
every iteration as <code>callback(self.equations, x)</code>,
see <code>scipy.root</code> documentation</li>
<li><strong>options</strong>:  a dictionary of solver options, e.g. <code>xtol</code> or
<code>maxiter</code>, see scipy.root documentation</li>
<li><strong>kwargs</strong>:  solver-specific options, please refer to the SciPy
documentation</li>
</ul>

<p>:raise ValueError: raise an error if not enough initial conditions
    are provided</p>
</div>


                            </div>
                            <div id="BiCM.solve_equations" class="classattr">
                                        <input id="BiCM.solve_equations-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">solve_equations</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">x0</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">method</span><span class="o">=</span><span class="s1">&#39;hybr&#39;</span>,</span><span class="param">	<span class="n">jac</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">tol</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">callback</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">options</span><span class="o">=</span><span class="kc">None</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="BiCM.solve_equations-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#BiCM.solve_equations"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="BiCM.solve_equations-134"><a href="#BiCM.solve_equations-134"><span class="linenos">134</span></a>    <span class="k">def</span> <span class="nf">solve_equations</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x0</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;hybr&#39;</span><span class="p">,</span> <span class="n">jac</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">tol</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="BiCM.solve_equations-135"><a href="#BiCM.solve_equations-135"><span class="linenos">135</span></a>                        <span class="n">callback</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">options</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="BiCM.solve_equations-136"><a href="#BiCM.solve_equations-136"><span class="linenos">136</span></a>
</span><span id="BiCM.solve_equations-137"><a href="#BiCM.solve_equations-137"><span class="linenos">137</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Solve the system of equations of the maximum log-likelihood problem.</span>
</span><span id="BiCM.solve_equations-138"><a href="#BiCM.solve_equations-138"><span class="linenos">138</span></a>
</span><span id="BiCM.solve_equations-139"><a href="#BiCM.solve_equations-139"><span class="linenos">139</span></a><span class="sd">        The system of equations is solved using ``scipy``&#39;s root function with</span>
</span><span id="BiCM.solve_equations-140"><a href="#BiCM.solve_equations-140"><span class="linenos">140</span></a><span class="sd">        the solver defined by ``method``. The solutions correspond to the</span>
</span><span id="BiCM.solve_equations-141"><a href="#BiCM.solve_equations-141"><span class="linenos">141</span></a><span class="sd">        Lagrange multipliers</span>
</span><span id="BiCM.solve_equations-142"><a href="#BiCM.solve_equations-142"><span class="linenos">142</span></a>
</span><span id="BiCM.solve_equations-143"><a href="#BiCM.solve_equations-143"><span class="linenos">143</span></a><span class="sd">        .. math::</span>
</span><span id="BiCM.solve_equations-144"><a href="#BiCM.solve_equations-144"><span class="linenos">144</span></a>
</span><span id="BiCM.solve_equations-145"><a href="#BiCM.solve_equations-145"><span class="linenos">145</span></a><span class="sd">            x_i = \exp(-\\theta_i).</span>
</span><span id="BiCM.solve_equations-146"><a href="#BiCM.solve_equations-146"><span class="linenos">146</span></a>
</span><span id="BiCM.solve_equations-147"><a href="#BiCM.solve_equations-147"><span class="linenos">147</span></a><span class="sd">        Depending on the solver, keyword arguments ``kwargs`` can be passed to</span>
</span><span id="BiCM.solve_equations-148"><a href="#BiCM.solve_equations-148"><span class="linenos">148</span></a><span class="sd">        the solver. Please refer to the `scipy.optimize.root documentation</span>
</span><span id="BiCM.solve_equations-149"><a href="#BiCM.solve_equations-149"><span class="linenos">149</span></a><span class="sd">        &lt;https://docs.scipy.org/doc/scipy-0.19.0/reference/generated/</span>
</span><span id="BiCM.solve_equations-150"><a href="#BiCM.solve_equations-150"><span class="linenos">150</span></a><span class="sd">        scipy.optimize.root.html&gt;`_ for detailed descriptions.</span>
</span><span id="BiCM.solve_equations-151"><a href="#BiCM.solve_equations-151"><span class="linenos">151</span></a>
</span><span id="BiCM.solve_equations-152"><a href="#BiCM.solve_equations-152"><span class="linenos">152</span></a><span class="sd">        The default solver is the modified Powell method ``hybr``. Least-squares</span>
</span><span id="BiCM.solve_equations-153"><a href="#BiCM.solve_equations-153"><span class="linenos">153</span></a><span class="sd">        can be chosen with ``method=&#39;lm&#39;`` for the Levenberg-Marquardt approach.</span>
</span><span id="BiCM.solve_equations-154"><a href="#BiCM.solve_equations-154"><span class="linenos">154</span></a>
</span><span id="BiCM.solve_equations-155"><a href="#BiCM.solve_equations-155"><span class="linenos">155</span></a><span class="sd">        .. note::</span>
</span><span id="BiCM.solve_equations-156"><a href="#BiCM.solve_equations-156"><span class="linenos">156</span></a>
</span><span id="BiCM.solve_equations-157"><a href="#BiCM.solve_equations-157"><span class="linenos">157</span></a><span class="sd">            It can happen that the solver ``method`` used by ``scipy.root``</span>
</span><span id="BiCM.solve_equations-158"><a href="#BiCM.solve_equations-158"><span class="linenos">158</span></a><span class="sd">            does not converge to a solution.</span>
</span><span id="BiCM.solve_equations-159"><a href="#BiCM.solve_equations-159"><span class="linenos">159</span></a><span class="sd">            In this case, please try another ``method`` or different initial</span>
</span><span id="BiCM.solve_equations-160"><a href="#BiCM.solve_equations-160"><span class="linenos">160</span></a><span class="sd">            conditions and refer to the `scipy.optimize.root documentation</span>
</span><span id="BiCM.solve_equations-161"><a href="#BiCM.solve_equations-161"><span class="linenos">161</span></a><span class="sd">            &lt;https://docs.scipy.org/doc/scipy-0.19.0/reference/generated/</span>
</span><span id="BiCM.solve_equations-162"><a href="#BiCM.solve_equations-162"><span class="linenos">162</span></a><span class="sd">            scipy.optimize.root.html&gt;`_.</span>
</span><span id="BiCM.solve_equations-163"><a href="#BiCM.solve_equations-163"><span class="linenos">163</span></a>
</span><span id="BiCM.solve_equations-164"><a href="#BiCM.solve_equations-164"><span class="linenos">164</span></a><span class="sd">        :param x0: initial guesses for the solutions. The first entries are the</span>
</span><span id="BiCM.solve_equations-165"><a href="#BiCM.solve_equations-165"><span class="linenos">165</span></a><span class="sd">            initial guesses for the row-nodes, followed by the initial guesses</span>
</span><span id="BiCM.solve_equations-166"><a href="#BiCM.solve_equations-166"><span class="linenos">166</span></a><span class="sd">            for the column-nodes.</span>
</span><span id="BiCM.solve_equations-167"><a href="#BiCM.solve_equations-167"><span class="linenos">167</span></a><span class="sd">        :type x0: 1d numpy.array, optional</span>
</span><span id="BiCM.solve_equations-168"><a href="#BiCM.solve_equations-168"><span class="linenos">168</span></a><span class="sd">        :param method: type of solver, default is ‘hybr’. For other</span>
</span><span id="BiCM.solve_equations-169"><a href="#BiCM.solve_equations-169"><span class="linenos">169</span></a><span class="sd">            solvers, see the `scipy.optimize.root documentation</span>
</span><span id="BiCM.solve_equations-170"><a href="#BiCM.solve_equations-170"><span class="linenos">170</span></a><span class="sd">            &lt;https://docs.scipy.org/doc/</span>
</span><span id="BiCM.solve_equations-171"><a href="#BiCM.solve_equations-171"><span class="linenos">171</span></a><span class="sd">            scipy-0.19.0/reference/generated/scipy.optimize.root.html&gt;`_.</span>
</span><span id="BiCM.solve_equations-172"><a href="#BiCM.solve_equations-172"><span class="linenos">172</span></a><span class="sd">        :type method: str, optional</span>
</span><span id="BiCM.solve_equations-173"><a href="#BiCM.solve_equations-173"><span class="linenos">173</span></a><span class="sd">        :param jac: Jacobian of the system</span>
</span><span id="BiCM.solve_equations-174"><a href="#BiCM.solve_equations-174"><span class="linenos">174</span></a><span class="sd">        :type jac: bool or callable, optional</span>
</span><span id="BiCM.solve_equations-175"><a href="#BiCM.solve_equations-175"><span class="linenos">175</span></a><span class="sd">        :param tol: tolerance for termination. For detailed control, use</span>
</span><span id="BiCM.solve_equations-176"><a href="#BiCM.solve_equations-176"><span class="linenos">176</span></a><span class="sd">            solver-specific options.</span>
</span><span id="BiCM.solve_equations-177"><a href="#BiCM.solve_equations-177"><span class="linenos">177</span></a><span class="sd">        :type tol: float, optional</span>
</span><span id="BiCM.solve_equations-178"><a href="#BiCM.solve_equations-178"><span class="linenos">178</span></a><span class="sd">        :param callback: optional callback function to be called at</span>
</span><span id="BiCM.solve_equations-179"><a href="#BiCM.solve_equations-179"><span class="linenos">179</span></a><span class="sd">            every iteration as ``callback(self.equations, x)``,</span>
</span><span id="BiCM.solve_equations-180"><a href="#BiCM.solve_equations-180"><span class="linenos">180</span></a><span class="sd">            see ``scipy.root`` documentation</span>
</span><span id="BiCM.solve_equations-181"><a href="#BiCM.solve_equations-181"><span class="linenos">181</span></a><span class="sd">        :type callback: function, optional</span>
</span><span id="BiCM.solve_equations-182"><a href="#BiCM.solve_equations-182"><span class="linenos">182</span></a><span class="sd">        :param options: a dictionary of solver options, e.g. ``xtol`` or</span>
</span><span id="BiCM.solve_equations-183"><a href="#BiCM.solve_equations-183"><span class="linenos">183</span></a><span class="sd">            ``maxiter``, see scipy.root documentation</span>
</span><span id="BiCM.solve_equations-184"><a href="#BiCM.solve_equations-184"><span class="linenos">184</span></a><span class="sd">        :type options: dict, optional</span>
</span><span id="BiCM.solve_equations-185"><a href="#BiCM.solve_equations-185"><span class="linenos">185</span></a><span class="sd">        :param kwargs: solver-specific options, please refer to the SciPy</span>
</span><span id="BiCM.solve_equations-186"><a href="#BiCM.solve_equations-186"><span class="linenos">186</span></a><span class="sd">            documentation</span>
</span><span id="BiCM.solve_equations-187"><a href="#BiCM.solve_equations-187"><span class="linenos">187</span></a><span class="sd">        :returns: solution of the equation system</span>
</span><span id="BiCM.solve_equations-188"><a href="#BiCM.solve_equations-188"><span class="linenos">188</span></a><span class="sd">        :rtype: scipy.optimize.OptimizeResult</span>
</span><span id="BiCM.solve_equations-189"><a href="#BiCM.solve_equations-189"><span class="linenos">189</span></a>
</span><span id="BiCM.solve_equations-190"><a href="#BiCM.solve_equations-190"><span class="linenos">190</span></a><span class="sd">        :raise ValueError: raise an error if not enough initial conditions</span>
</span><span id="BiCM.solve_equations-191"><a href="#BiCM.solve_equations-191"><span class="linenos">191</span></a><span class="sd">            are provided</span>
</span><span id="BiCM.solve_equations-192"><a href="#BiCM.solve_equations-192"><span class="linenos">192</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="BiCM.solve_equations-193"><a href="#BiCM.solve_equations-193"><span class="linenos">193</span></a>        <span class="c1"># use Jacobian if the hybr solver is chosen</span>
</span><span id="BiCM.solve_equations-194"><a href="#BiCM.solve_equations-194"><span class="linenos">194</span></a>        <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;hybr&#39;</span><span class="p">:</span>
</span><span id="BiCM.solve_equations-195"><a href="#BiCM.solve_equations-195"><span class="linenos">195</span></a>            <span class="n">jac</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">jacobian</span>
</span><span id="BiCM.solve_equations-196"><a href="#BiCM.solve_equations-196"><span class="linenos">196</span></a>
</span><span id="BiCM.solve_equations-197"><a href="#BiCM.solve_equations-197"><span class="linenos">197</span></a>        <span class="c1"># set initial conditions</span>
</span><span id="BiCM.solve_equations-198"><a href="#BiCM.solve_equations-198"><span class="linenos">198</span></a>        <span class="k">if</span> <span class="n">x0</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="BiCM.solve_equations-199"><a href="#BiCM.solve_equations-199"><span class="linenos">199</span></a>            <span class="n">x0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dseq</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dseq</span><span class="p">))</span>
</span><span id="BiCM.solve_equations-200"><a href="#BiCM.solve_equations-200"><span class="linenos">200</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="BiCM.solve_equations-201"><a href="#BiCM.solve_equations-201"><span class="linenos">201</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="nb">len</span><span class="p">(</span><span class="n">x0</span><span class="p">)</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">dim</span><span class="p">:</span>
</span><span id="BiCM.solve_equations-202"><a href="#BiCM.solve_equations-202"><span class="linenos">202</span></a>                <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;One initial condition for each parameter is required.&quot;</span>
</span><span id="BiCM.solve_equations-203"><a href="#BiCM.solve_equations-203"><span class="linenos">203</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</span><span id="BiCM.solve_equations-204"><a href="#BiCM.solve_equations-204"><span class="linenos">204</span></a>
</span><span id="BiCM.solve_equations-205"><a href="#BiCM.solve_equations-205"><span class="linenos">205</span></a>        <span class="c1"># solve equation system</span>
</span><span id="BiCM.solve_equations-206"><a href="#BiCM.solve_equations-206"><span class="linenos">206</span></a>        <span class="n">sol</span> <span class="o">=</span> <span class="n">opt</span><span class="o">.</span><span class="n">root</span><span class="p">(</span><span class="n">fun</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">equations</span><span class="p">,</span> <span class="n">x0</span><span class="o">=</span><span class="n">x0</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="n">method</span><span class="p">,</span> <span class="n">jac</span><span class="o">=</span><span class="n">jac</span><span class="p">,</span>
</span><span id="BiCM.solve_equations-207"><a href="#BiCM.solve_equations-207"><span class="linenos">207</span></a>                       <span class="n">tol</span><span class="o">=</span><span class="n">tol</span><span class="p">,</span> <span class="n">options</span><span class="o">=</span><span class="n">options</span><span class="p">,</span> <span class="n">callback</span><span class="o">=</span><span class="n">callback</span><span class="p">)</span>
</span><span id="BiCM.solve_equations-208"><a href="#BiCM.solve_equations-208"><span class="linenos">208</span></a>
</span><span id="BiCM.solve_equations-209"><a href="#BiCM.solve_equations-209"><span class="linenos">209</span></a>        <span class="c1"># check whether system has been solved successfully</span>
</span><span id="BiCM.solve_equations-210"><a href="#BiCM.solve_equations-210"><span class="linenos">210</span></a>        <span class="c1">#print(&quot;Solver successful:&quot;, sol.success)</span>
</span><span id="BiCM.solve_equations-211"><a href="#BiCM.solve_equations-211"><span class="linenos">211</span></a>        <span class="c1">#print sol.message</span>
</span><span id="BiCM.solve_equations-212"><a href="#BiCM.solve_equations-212"><span class="linenos">212</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">sol</span><span class="o">.</span><span class="n">success</span><span class="p">:</span>
</span><span id="BiCM.solve_equations-213"><a href="#BiCM.solve_equations-213"><span class="linenos">213</span></a>            <span class="n">errmsg</span> <span class="o">=</span> <span class="s2">&quot;Try different initial conditions and/or a&quot;</span> <span class="o">+</span> \
</span><span id="BiCM.solve_equations-214"><a href="#BiCM.solve_equations-214"><span class="linenos">214</span></a>                     <span class="s2">&quot;different solver, see documentation at &quot;</span> <span class="o">+</span> \
</span><span id="BiCM.solve_equations-215"><a href="#BiCM.solve_equations-215"><span class="linenos">215</span></a>                     <span class="s2">&quot;https://docs.scipy.org/doc/scipy-0.19.0/reference/&quot;</span> <span class="o">+</span> \
</span><span id="BiCM.solve_equations-216"><a href="#BiCM.solve_equations-216"><span class="linenos">216</span></a>                     <span class="s2">&quot;generated/scipy.optimize.root.html&quot;</span>
</span><span id="BiCM.solve_equations-217"><a href="#BiCM.solve_equations-217"><span class="linenos">217</span></a>
</span><span id="BiCM.solve_equations-218"><a href="#BiCM.solve_equations-218"><span class="linenos">218</span></a>            <span class="c1">#print(errmsg)</span>
</span><span id="BiCM.solve_equations-219"><a href="#BiCM.solve_equations-219"><span class="linenos">219</span></a>        <span class="k">return</span> <span class="n">sol</span>
</span></pre></div>


            <div class="docstring"><p>Solve the system of equations of the maximum log-likelihood problem.</p>

<p>The system of equations is solved using <code>scipy</code>'s root function with
the solver defined by <code>method</code>. The solutions correspond to the
Lagrange multipliers</p>

<p>$$x_i = \exp(-\theta_i).$$</p>

<p>Depending on the solver, keyword arguments <code>kwargs</code> can be passed to
the solver. Please refer to the <code>scipy.optimize.root documentation
&lt;https://docs.scipy.org/doc/scipy-0.19.0/reference/generated/
scipy.optimize.root.html&gt;</code>_ for detailed descriptions.</p>

<p>The default solver is the modified Powell method <code>hybr</code>. Least-squares
can be chosen with <code>method='lm'</code> for the Levenberg-Marquardt approach.</p>

<div class="pdoc-alert pdoc-alert-note">

<p>It can happen that the solver <code>method</code> used by <code>scipy.root</code>
does not converge to a solution.
In this case, please try another <code>method</code> or different initial
conditions and refer to the <code>scipy.optimize.root documentation
&lt;https://docs.scipy.org/doc/scipy-0.19.0/reference/generated/
scipy.optimize.root.html&gt;</code>_.</p>

</div>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>x0</strong>:  initial guesses for the solutions. The first entries are the
initial guesses for the row-nodes, followed by the initial guesses
for the column-nodes.</li>
<li><strong>method</strong>:  type of solver, default is ‘hybr’. For other
solvers, see the <code>scipy.optimize.root documentation
&lt;https://docs.scipy.org/doc/
scipy-0.19.0/reference/generated/scipy.optimize.root.html&gt;</code>_.</li>
<li><strong>jac</strong>:  Jacobian of the system</li>
<li><strong>tol</strong>:  tolerance for termination. For detailed control, use
solver-specific options.</li>
<li><strong>callback</strong>:  optional callback function to be called at
every iteration as <code>callback(self.equations, x)</code>,
see <code>scipy.root</code> documentation</li>
<li><strong>options</strong>:  a dictionary of solver options, e.g. <code>xtol</code> or
<code>maxiter</code>, see scipy.root documentation</li>
<li><strong>kwargs</strong>:  solver-specific options, please refer to the SciPy
documentation
:returns: solution of the equation system</li>
</ul>

<p>:raise ValueError: raise an error if not enough initial conditions
    are provided</p>
</div>


                            </div>
                            <div id="BiCM.equations" class="classattr">
                                        <input id="BiCM.equations-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">equations</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">xx</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="BiCM.equations-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#BiCM.equations"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="BiCM.equations-221"><a href="#BiCM.equations-221"><span class="linenos">221</span></a>    <span class="k">def</span> <span class="nf">equations</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xx</span><span class="p">):</span>
</span><span id="BiCM.equations-222"><a href="#BiCM.equations-222"><span class="linenos">222</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the equations of the log-likelihood maximization problem.</span>
</span><span id="BiCM.equations-223"><a href="#BiCM.equations-223"><span class="linenos">223</span></a>
</span><span id="BiCM.equations-224"><a href="#BiCM.equations-224"><span class="linenos">224</span></a><span class="sd">        Note that the equations for the row-nodes depend only on the</span>
</span><span id="BiCM.equations-225"><a href="#BiCM.equations-225"><span class="linenos">225</span></a><span class="sd">        column-nodes and vice versa, see [Saracco2015]_.</span>
</span><span id="BiCM.equations-226"><a href="#BiCM.equations-226"><span class="linenos">226</span></a>
</span><span id="BiCM.equations-227"><a href="#BiCM.equations-227"><span class="linenos">227</span></a><span class="sd">        :param xx: Lagrange multipliers which have to be solved</span>
</span><span id="BiCM.equations-228"><a href="#BiCM.equations-228"><span class="linenos">228</span></a><span class="sd">        :type xx: numpy.array</span>
</span><span id="BiCM.equations-229"><a href="#BiCM.equations-229"><span class="linenos">229</span></a><span class="sd">        :returns: equations to be solved (:math:`f(x) = 0`)</span>
</span><span id="BiCM.equations-230"><a href="#BiCM.equations-230"><span class="linenos">230</span></a><span class="sd">        :rtype: numpy.array</span>
</span><span id="BiCM.equations-231"><a href="#BiCM.equations-231"><span class="linenos">231</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="BiCM.equations-232"><a href="#BiCM.equations-232"><span class="linenos">232</span></a>        <span class="n">eq</span> <span class="o">=</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">dseq</span>
</span><span id="BiCM.equations-233"><a href="#BiCM.equations-233"><span class="linenos">233</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_rows</span><span class="p">):</span>
</span><span id="BiCM.equations-234"><a href="#BiCM.equations-234"><span class="linenos">234</span></a>            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_rows</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dim</span><span class="p">):</span>
</span><span id="BiCM.equations-235"><a href="#BiCM.equations-235"><span class="linenos">235</span></a>                <span class="n">dum</span> <span class="o">=</span> <span class="n">xx</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">xx</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">/</span> <span class="p">(</span><span class="mf">1.</span> <span class="o">+</span> <span class="n">xx</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">xx</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>
</span><span id="BiCM.equations-236"><a href="#BiCM.equations-236"><span class="linenos">236</span></a>                <span class="n">eq</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+=</span> <span class="n">dum</span>
</span><span id="BiCM.equations-237"><a href="#BiCM.equations-237"><span class="linenos">237</span></a>                <span class="n">eq</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">+=</span> <span class="n">dum</span>
</span><span id="BiCM.equations-238"><a href="#BiCM.equations-238"><span class="linenos">238</span></a>        <span class="k">return</span> <span class="n">eq</span>
</span></pre></div>


            <div class="docstring"><p>Return the equations of the log-likelihood maximization problem.</p>

<p>Note that the equations for the row-nodes depend only on the
column-nodes and vice versa, see [Saracco2015]_.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>xx</strong>:  Lagrange multipliers which have to be solved
:returns: equations to be solved (\( f(x) = 0 \))</li>
</ul>
</div>


                            </div>
                            <div id="BiCM.jacobian" class="classattr">
                                        <input id="BiCM.jacobian-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">jacobian</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">xx</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="BiCM.jacobian-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#BiCM.jacobian"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="BiCM.jacobian-240"><a href="#BiCM.jacobian-240"><span class="linenos">240</span></a>    <span class="k">def</span> <span class="nf">jacobian</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xx</span><span class="p">):</span>
</span><span id="BiCM.jacobian-241"><a href="#BiCM.jacobian-241"><span class="linenos">241</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Return a NumPy array with the Jacobian of the equation system.</span>
</span><span id="BiCM.jacobian-242"><a href="#BiCM.jacobian-242"><span class="linenos">242</span></a>
</span><span id="BiCM.jacobian-243"><a href="#BiCM.jacobian-243"><span class="linenos">243</span></a><span class="sd">        :param xx: Lagrange multipliers which have to be solved</span>
</span><span id="BiCM.jacobian-244"><a href="#BiCM.jacobian-244"><span class="linenos">244</span></a><span class="sd">        :type xx: numpy.array</span>
</span><span id="BiCM.jacobian-245"><a href="#BiCM.jacobian-245"><span class="linenos">245</span></a><span class="sd">        :returns: Jacobian</span>
</span><span id="BiCM.jacobian-246"><a href="#BiCM.jacobian-246"><span class="linenos">246</span></a><span class="sd">        :rtype: numpy.array</span>
</span><span id="BiCM.jacobian-247"><a href="#BiCM.jacobian-247"><span class="linenos">247</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="BiCM.jacobian-248"><a href="#BiCM.jacobian-248"><span class="linenos">248</span></a>        <span class="n">jac</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">dim</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dim</span><span class="p">))</span>
</span><span id="BiCM.jacobian-249"><a href="#BiCM.jacobian-249"><span class="linenos">249</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_rows</span><span class="p">):</span>
</span><span id="BiCM.jacobian-250"><a href="#BiCM.jacobian-250"><span class="linenos">250</span></a>            <span class="c1"># df_c / df_c&#39; = 0 for all c&#39; != c</span>
</span><span id="BiCM.jacobian-251"><a href="#BiCM.jacobian-251"><span class="linenos">251</span></a>            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_rows</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dim</span><span class="p">):</span>
</span><span id="BiCM.jacobian-252"><a href="#BiCM.jacobian-252"><span class="linenos">252</span></a>                <span class="c1"># df_c / dx_c != 0</span>
</span><span id="BiCM.jacobian-253"><a href="#BiCM.jacobian-253"><span class="linenos">253</span></a>                <span class="n">xxi</span> <span class="o">=</span> <span class="n">xx</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">/</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">+</span> <span class="n">xx</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">xx</span><span class="p">[</span><span class="n">j</span><span class="p">])</span> <span class="o">**</span> <span class="mi">2</span>
</span><span id="BiCM.jacobian-254"><a href="#BiCM.jacobian-254"><span class="linenos">254</span></a>                <span class="n">xxj</span> <span class="o">=</span> <span class="n">xx</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">/</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">+</span> <span class="n">xx</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">xx</span><span class="p">[</span><span class="n">j</span><span class="p">])</span> <span class="o">**</span> <span class="mi">2</span>
</span><span id="BiCM.jacobian-255"><a href="#BiCM.jacobian-255"><span class="linenos">255</span></a>                <span class="n">jac</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">+=</span> <span class="n">xxj</span>
</span><span id="BiCM.jacobian-256"><a href="#BiCM.jacobian-256"><span class="linenos">256</span></a>                <span class="n">jac</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">xxi</span>
</span><span id="BiCM.jacobian-257"><a href="#BiCM.jacobian-257"><span class="linenos">257</span></a>                <span class="n">jac</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">xxj</span>
</span><span id="BiCM.jacobian-258"><a href="#BiCM.jacobian-258"><span class="linenos">258</span></a>                <span class="n">jac</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">+=</span> <span class="n">xxi</span>
</span><span id="BiCM.jacobian-259"><a href="#BiCM.jacobian-259"><span class="linenos">259</span></a>        <span class="k">return</span> <span class="n">jac</span>
</span></pre></div>


            <div class="docstring"><p>Return a NumPy array with the Jacobian of the equation system.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>xx</strong>:  Lagrange multipliers which have to be solved
:returns: Jacobian</li>
</ul>
</div>


                            </div>
                            <div id="BiCM.get_biadjacency_matrix" class="classattr">
                                        <input id="BiCM.get_biadjacency_matrix-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_biadjacency_matrix</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">xx</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="BiCM.get_biadjacency_matrix-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#BiCM.get_biadjacency_matrix"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="BiCM.get_biadjacency_matrix-261"><a href="#BiCM.get_biadjacency_matrix-261"><span class="linenos">261</span></a>    <span class="k">def</span> <span class="nf">get_biadjacency_matrix</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xx</span><span class="p">):</span>
</span><span id="BiCM.get_biadjacency_matrix-262"><a href="#BiCM.get_biadjacency_matrix-262"><span class="linenos">262</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot; Calculate the biadjacency matrix of the null model.</span>
</span><span id="BiCM.get_biadjacency_matrix-263"><a href="#BiCM.get_biadjacency_matrix-263"><span class="linenos">263</span></a>
</span><span id="BiCM.get_biadjacency_matrix-264"><a href="#BiCM.get_biadjacency_matrix-264"><span class="linenos">264</span></a><span class="sd">        The biadjacency matrix describes the BiCM null model, i.e. the optimal</span>
</span><span id="BiCM.get_biadjacency_matrix-265"><a href="#BiCM.get_biadjacency_matrix-265"><span class="linenos">265</span></a><span class="sd">        average graph :math:`&lt;G&gt;^*` with the average link probabilities</span>
</span><span id="BiCM.get_biadjacency_matrix-266"><a href="#BiCM.get_biadjacency_matrix-266"><span class="linenos">266</span></a><span class="sd">        :math:`&lt;G&gt;^*_{rc} = p_{rc}` ,</span>
</span><span id="BiCM.get_biadjacency_matrix-267"><a href="#BiCM.get_biadjacency_matrix-267"><span class="linenos">267</span></a><span class="sd">        :math:`p_{rc} = \\frac{x_r \\cdot x_c}{1 + x_r\\cdot x_c}.`</span>
</span><span id="BiCM.get_biadjacency_matrix-268"><a href="#BiCM.get_biadjacency_matrix-268"><span class="linenos">268</span></a><span class="sd">        :math:`x` are the solutions of the equation system which has to be</span>
</span><span id="BiCM.get_biadjacency_matrix-269"><a href="#BiCM.get_biadjacency_matrix-269"><span class="linenos">269</span></a><span class="sd">        solved for the null model.</span>
</span><span id="BiCM.get_biadjacency_matrix-270"><a href="#BiCM.get_biadjacency_matrix-270"><span class="linenos">270</span></a><span class="sd">        Note that :math:`r` and :math:`c` are taken from opposite bipartite</span>
</span><span id="BiCM.get_biadjacency_matrix-271"><a href="#BiCM.get_biadjacency_matrix-271"><span class="linenos">271</span></a><span class="sd">        node sets, thus :math:`r \\neq c`.</span>
</span><span id="BiCM.get_biadjacency_matrix-272"><a href="#BiCM.get_biadjacency_matrix-272"><span class="linenos">272</span></a>
</span><span id="BiCM.get_biadjacency_matrix-273"><a href="#BiCM.get_biadjacency_matrix-273"><span class="linenos">273</span></a><span class="sd">        :param xx: solutions of the equation system (Lagrange multipliers)</span>
</span><span id="BiCM.get_biadjacency_matrix-274"><a href="#BiCM.get_biadjacency_matrix-274"><span class="linenos">274</span></a><span class="sd">        :type xx: numpy.array</span>
</span><span id="BiCM.get_biadjacency_matrix-275"><a href="#BiCM.get_biadjacency_matrix-275"><span class="linenos">275</span></a><span class="sd">        :returns: biadjacency matrix of the null model</span>
</span><span id="BiCM.get_biadjacency_matrix-276"><a href="#BiCM.get_biadjacency_matrix-276"><span class="linenos">276</span></a><span class="sd">        :rtype: numpy.array</span>
</span><span id="BiCM.get_biadjacency_matrix-277"><a href="#BiCM.get_biadjacency_matrix-277"><span class="linenos">277</span></a>
</span><span id="BiCM.get_biadjacency_matrix-278"><a href="#BiCM.get_biadjacency_matrix-278"><span class="linenos">278</span></a><span class="sd">        :raises ValueError: raise an error if :math:`p_{rc} &lt; 0` or</span>
</span><span id="BiCM.get_biadjacency_matrix-279"><a href="#BiCM.get_biadjacency_matrix-279"><span class="linenos">279</span></a><span class="sd">            :math:`p_{rc} &gt; 1` for any :math:`r, c`</span>
</span><span id="BiCM.get_biadjacency_matrix-280"><a href="#BiCM.get_biadjacency_matrix-280"><span class="linenos">280</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="BiCM.get_biadjacency_matrix-281"><a href="#BiCM.get_biadjacency_matrix-281"><span class="linenos">281</span></a>        <span class="n">mat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">num_rows</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_columns</span><span class="p">))</span>
</span><span id="BiCM.get_biadjacency_matrix-282"><a href="#BiCM.get_biadjacency_matrix-282"><span class="linenos">282</span></a>        <span class="n">xp</span> <span class="o">=</span> <span class="n">xx</span><span class="p">[</span><span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_rows</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dim</span><span class="p">)]</span>
</span><span id="BiCM.get_biadjacency_matrix-283"><a href="#BiCM.get_biadjacency_matrix-283"><span class="linenos">283</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_rows</span><span class="p">):</span>
</span><span id="BiCM.get_biadjacency_matrix-284"><a href="#BiCM.get_biadjacency_matrix-284"><span class="linenos">284</span></a>            <span class="n">mat</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">]</span> <span class="o">=</span> <span class="n">xx</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">xp</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">xx</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">xp</span><span class="p">)</span>
</span><span id="BiCM.get_biadjacency_matrix-285"><a href="#BiCM.get_biadjacency_matrix-285"><span class="linenos">285</span></a>
</span><span id="BiCM.get_biadjacency_matrix-286"><a href="#BiCM.get_biadjacency_matrix-286"><span class="linenos">286</span></a>        <span class="c1"># account for machine precision:</span>
</span><span id="BiCM.get_biadjacency_matrix-287"><a href="#BiCM.get_biadjacency_matrix-287"><span class="linenos">287</span></a>        <span class="n">mat</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">finfo</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span><span class="o">.</span><span class="n">eps</span>
</span><span id="BiCM.get_biadjacency_matrix-288"><a href="#BiCM.get_biadjacency_matrix-288"><span class="linenos">288</span></a>
</span><span id="BiCM.get_biadjacency_matrix-289"><a href="#BiCM.get_biadjacency_matrix-289"><span class="linenos">289</span></a>        <span class="c1">#print(&#39;matrix debug:&#39;)</span>
</span><span id="BiCM.get_biadjacency_matrix-290"><a href="#BiCM.get_biadjacency_matrix-290"><span class="linenos">290</span></a>        <span class="c1">#for r in mat:</span>
</span><span id="BiCM.get_biadjacency_matrix-291"><a href="#BiCM.get_biadjacency_matrix-291"><span class="linenos">291</span></a>        <span class="c1">#    print(r)</span>
</span><span id="BiCM.get_biadjacency_matrix-292"><a href="#BiCM.get_biadjacency_matrix-292"><span class="linenos">292</span></a>
</span><span id="BiCM.get_biadjacency_matrix-293"><a href="#BiCM.get_biadjacency_matrix-293"><span class="linenos">293</span></a>        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">mat</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">):</span>
</span><span id="BiCM.get_biadjacency_matrix-294"><a href="#BiCM.get_biadjacency_matrix-294"><span class="linenos">294</span></a>            <span class="n">errmsg</span> <span class="o">=</span> <span class="s1">&#39;Error in get_adjacency_matrix: probabilities &lt; 0 in &#39;</span> \
</span><span id="BiCM.get_biadjacency_matrix-295"><a href="#BiCM.get_biadjacency_matrix-295"><span class="linenos">295</span></a>                  <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">mat</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">))</span>
</span><span id="BiCM.get_biadjacency_matrix-296"><a href="#BiCM.get_biadjacency_matrix-296"><span class="linenos">296</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">errmsg</span><span class="p">)</span>
</span><span id="BiCM.get_biadjacency_matrix-297"><a href="#BiCM.get_biadjacency_matrix-297"><span class="linenos">297</span></a>        <span class="k">elif</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">mat</span> <span class="o">&gt;</span> <span class="p">(</span><span class="mf">1.</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">finfo</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span><span class="o">.</span><span class="n">eps</span><span class="p">)):</span>
</span><span id="BiCM.get_biadjacency_matrix-298"><a href="#BiCM.get_biadjacency_matrix-298"><span class="linenos">298</span></a>            <span class="n">errmsg</span> <span class="o">=</span> <span class="s1">&#39;Error in get_adjacency_matrix: probabilities &gt; 1 in&#39;</span> \
</span><span id="BiCM.get_biadjacency_matrix-299"><a href="#BiCM.get_biadjacency_matrix-299"><span class="linenos">299</span></a>                  <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">mat</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">))</span>
</span><span id="BiCM.get_biadjacency_matrix-300"><a href="#BiCM.get_biadjacency_matrix-300"><span class="linenos">300</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">errmsg</span><span class="p">)</span>
</span><span id="BiCM.get_biadjacency_matrix-301"><a href="#BiCM.get_biadjacency_matrix-301"><span class="linenos">301</span></a>        <span class="k">assert</span> <span class="n">mat</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">bin_mat</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> \
</span><span id="BiCM.get_biadjacency_matrix-302"><a href="#BiCM.get_biadjacency_matrix-302"><span class="linenos">302</span></a>            <span class="s2">&quot;Biadjacency matrix has wrong dimensions.&quot;</span>
</span><span id="BiCM.get_biadjacency_matrix-303"><a href="#BiCM.get_biadjacency_matrix-303"><span class="linenos">303</span></a>        <span class="k">return</span> <span class="n">mat</span>
</span></pre></div>


            <div class="docstring"><p>Calculate the biadjacency matrix of the null model.</p>

<p>The biadjacency matrix describes the BiCM null model, i.e. the optimal
average graph \( <G>^* \) with the average link probabilities
\( <G>^*_{rc} = p_{rc} \) ,
\( p_{rc} = \frac{x_r \cdot x_c}{1 + x_r\cdot x_c}. \)
\( x \) are the solutions of the equation system which has to be
solved for the null model.
Note that \( r \) and \( c \) are taken from opposite bipartite
node sets, thus \( r \neq c \).</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>xx</strong>:  solutions of the equation system (Lagrange multipliers)
:returns: biadjacency matrix of the null model</li>
</ul>

<h6 id="raises">Raises</h6>

<ul>
<li><strong>ValueError</strong>:  raise an error if \( p_{rc} &lt; 0 \) or
\( p_{rc} &gt; 1 \) for any \( r, c \)</li>
</ul>
</div>


                            </div>
                            <div id="BiCM.print_max_degree_differences" class="classattr">
                                        <input id="BiCM.print_max_degree_differences-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">print_max_degree_differences</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="BiCM.print_max_degree_differences-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#BiCM.print_max_degree_differences"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="BiCM.print_max_degree_differences-309"><a href="#BiCM.print_max_degree_differences-309"><span class="linenos">309</span></a>    <span class="k">def</span> <span class="nf">print_max_degree_differences</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="BiCM.print_max_degree_differences-310"><a href="#BiCM.print_max_degree_differences-310"><span class="linenos">310</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Print the maximal differences between input network and BiCM degrees.</span>
</span><span id="BiCM.print_max_degree_differences-311"><a href="#BiCM.print_max_degree_differences-311"><span class="linenos">311</span></a>
</span><span id="BiCM.print_max_degree_differences-312"><a href="#BiCM.print_max_degree_differences-312"><span class="linenos">312</span></a><span class="sd">        Check that the degree sequence of the solved BiCM null model graph</span>
</span><span id="BiCM.print_max_degree_differences-313"><a href="#BiCM.print_max_degree_differences-313"><span class="linenos">313</span></a><span class="sd">        corresponds to the degree sequence of the input graph.</span>
</span><span id="BiCM.print_max_degree_differences-314"><a href="#BiCM.print_max_degree_differences-314"><span class="linenos">314</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="BiCM.print_max_degree_differences-315"><a href="#BiCM.print_max_degree_differences-315"><span class="linenos">315</span></a>        <span class="n">ave_deg_columns</span> <span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">adj_matrix</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span><span id="BiCM.print_max_degree_differences-316"><a href="#BiCM.print_max_degree_differences-316"><span class="linenos">316</span></a>        <span class="n">ave_deg_rows</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">adj_matrix</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="BiCM.print_max_degree_differences-317"><a href="#BiCM.print_max_degree_differences-317"><span class="linenos">317</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Maximal degree differences between data and BiCM:&quot;</span><span class="p">)</span>
</span><span id="BiCM.print_max_degree_differences-318"><a href="#BiCM.print_max_degree_differences-318"><span class="linenos">318</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Columns:&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span>
</span><span id="BiCM.print_max_degree_differences-319"><a href="#BiCM.print_max_degree_differences-319"><span class="linenos">319</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">dseq</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">num_rows</span><span class="p">:]</span> <span class="o">-</span> <span class="n">ave_deg_columns</span><span class="p">)))</span>
</span><span id="BiCM.print_max_degree_differences-320"><a href="#BiCM.print_max_degree_differences-320"><span class="linenos">320</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Rows:&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span>
</span><span id="BiCM.print_max_degree_differences-321"><a href="#BiCM.print_max_degree_differences-321"><span class="linenos">321</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">dseq</span><span class="p">[:</span><span class="bp">self</span><span class="o">.</span><span class="n">num_rows</span><span class="p">]</span> <span class="o">-</span> <span class="n">ave_deg_rows</span><span class="p">)))</span>
</span></pre></div>


            <div class="docstring"><p>Print the maximal differences between input network and BiCM degrees.</p>

<p>Check that the degree sequence of the solved BiCM null model graph
corresponds to the degree sequence of the input graph.</p>
</div>


                            </div>
                            <div id="BiCM.test_average_degrees" class="classattr">
                                        <input id="BiCM.test_average_degrees-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">test_average_degrees</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">eps</span><span class="o">=</span><span class="mf">0.01</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="BiCM.test_average_degrees-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#BiCM.test_average_degrees"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="BiCM.test_average_degrees-323"><a href="#BiCM.test_average_degrees-323"><span class="linenos">323</span></a>    <span class="k">def</span> <span class="nf">test_average_degrees</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">eps</span><span class="o">=</span><span class="mf">1e-2</span><span class="p">):</span>
</span><span id="BiCM.test_average_degrees-324"><a href="#BiCM.test_average_degrees-324"><span class="linenos">324</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Test the constraints on the node degrees.</span>
</span><span id="BiCM.test_average_degrees-325"><a href="#BiCM.test_average_degrees-325"><span class="linenos">325</span></a>
</span><span id="BiCM.test_average_degrees-326"><a href="#BiCM.test_average_degrees-326"><span class="linenos">326</span></a><span class="sd">        Check that the degree sequence of the solved BiCM null model graph</span>
</span><span id="BiCM.test_average_degrees-327"><a href="#BiCM.test_average_degrees-327"><span class="linenos">327</span></a><span class="sd">        corresponds to the degree sequence of the input graph.</span>
</span><span id="BiCM.test_average_degrees-328"><a href="#BiCM.test_average_degrees-328"><span class="linenos">328</span></a>
</span><span id="BiCM.test_average_degrees-329"><a href="#BiCM.test_average_degrees-329"><span class="linenos">329</span></a><span class="sd">        :param eps: maximum difference between degrees of the real network</span>
</span><span id="BiCM.test_average_degrees-330"><a href="#BiCM.test_average_degrees-330"><span class="linenos">330</span></a><span class="sd">            and the BiCM</span>
</span><span id="BiCM.test_average_degrees-331"><a href="#BiCM.test_average_degrees-331"><span class="linenos">331</span></a><span class="sd">        :type eps: float</span>
</span><span id="BiCM.test_average_degrees-332"><a href="#BiCM.test_average_degrees-332"><span class="linenos">332</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="BiCM.test_average_degrees-333"><a href="#BiCM.test_average_degrees-333"><span class="linenos">333</span></a>        <span class="n">ave_deg_columns</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">adj_matrix</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>
</span><span id="BiCM.test_average_degrees-334"><a href="#BiCM.test_average_degrees-334"><span class="linenos">334</span></a>        <span class="n">ave_deg_rows</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">adj_matrix</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
</span><span id="BiCM.test_average_degrees-335"><a href="#BiCM.test_average_degrees-335"><span class="linenos">335</span></a>        <span class="n">c_derr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">logical_or</span><span class="p">(</span>
</span><span id="BiCM.test_average_degrees-336"><a href="#BiCM.test_average_degrees-336"><span class="linenos">336</span></a>            <span class="c1"># average degree too small:</span>
</span><span id="BiCM.test_average_degrees-337"><a href="#BiCM.test_average_degrees-337"><span class="linenos">337</span></a>            <span class="n">ave_deg_rows</span> <span class="o">+</span> <span class="n">eps</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">dseq</span><span class="p">[:</span><span class="bp">self</span><span class="o">.</span><span class="n">num_rows</span><span class="p">],</span>
</span><span id="BiCM.test_average_degrees-338"><a href="#BiCM.test_average_degrees-338"><span class="linenos">338</span></a>            <span class="c1"># average degree too large:</span>
</span><span id="BiCM.test_average_degrees-339"><a href="#BiCM.test_average_degrees-339"><span class="linenos">339</span></a>            <span class="n">ave_deg_rows</span> <span class="o">-</span> <span class="n">eps</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">dseq</span><span class="p">[:</span><span class="bp">self</span><span class="o">.</span><span class="n">num_rows</span><span class="p">]))</span>
</span><span id="BiCM.test_average_degrees-340"><a href="#BiCM.test_average_degrees-340"><span class="linenos">340</span></a>        <span class="n">p_derr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">logical_or</span><span class="p">(</span>
</span><span id="BiCM.test_average_degrees-341"><a href="#BiCM.test_average_degrees-341"><span class="linenos">341</span></a>            <span class="n">ave_deg_columns</span> <span class="o">+</span> <span class="n">eps</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">dseq</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">num_rows</span><span class="p">:],</span>
</span><span id="BiCM.test_average_degrees-342"><a href="#BiCM.test_average_degrees-342"><span class="linenos">342</span></a>            <span class="n">ave_deg_columns</span> <span class="o">-</span> <span class="n">eps</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">dseq</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">num_rows</span><span class="p">:]))</span>
</span><span id="BiCM.test_average_degrees-343"><a href="#BiCM.test_average_degrees-343"><span class="linenos">343</span></a>        <span class="c1"># Check row-nodes degrees:</span>
</span><span id="BiCM.test_average_degrees-344"><a href="#BiCM.test_average_degrees-344"><span class="linenos">344</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">array_equiv</span><span class="p">(</span><span class="n">c_derr</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])):</span>
</span><span id="BiCM.test_average_degrees-345"><a href="#BiCM.test_average_degrees-345"><span class="linenos">345</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;...inaccurate row-nodes degrees:&#39;</span><span class="p">)</span>
</span><span id="BiCM.test_average_degrees-346"><a href="#BiCM.test_average_degrees-346"><span class="linenos">346</span></a>            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">c_derr</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
</span><span id="BiCM.test_average_degrees-347"><a href="#BiCM.test_average_degrees-347"><span class="linenos">347</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Row-node &#39;</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
</span><span id="BiCM.test_average_degrees-348"><a href="#BiCM.test_average_degrees-348"><span class="linenos">348</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;input: </span><span class="si">{}</span><span class="s1">, avg </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dseq</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">ave_deg_rows</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
</span><span id="BiCM.test_average_degrees-349"><a href="#BiCM.test_average_degrees-349"><span class="linenos">349</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span><span id="BiCM.test_average_degrees-350"><a href="#BiCM.test_average_degrees-350"><span class="linenos">350</span></a>        <span class="c1"># Check column-nodes degrees:</span>
</span><span id="BiCM.test_average_degrees-351"><a href="#BiCM.test_average_degrees-351"><span class="linenos">351</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">array_equiv</span><span class="p">(</span><span class="n">p_derr</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])):</span>
</span><span id="BiCM.test_average_degrees-352"><a href="#BiCM.test_average_degrees-352"><span class="linenos">352</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;...inaccurate column-nodes degrees:&#39;</span><span class="p">)</span>
</span><span id="BiCM.test_average_degrees-353"><a href="#BiCM.test_average_degrees-353"><span class="linenos">353</span></a>            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">c_derr</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
</span><span id="BiCM.test_average_degrees-354"><a href="#BiCM.test_average_degrees-354"><span class="linenos">354</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Column-node &#39;</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
</span><span id="BiCM.test_average_degrees-355"><a href="#BiCM.test_average_degrees-355"><span class="linenos">355</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;input: </span><span class="si">{}</span><span class="s1">, avg </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dseq</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_rows</span><span class="p">],</span> <span class="n">ave_deg_columns</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
</span><span id="BiCM.test_average_degrees-356"><a href="#BiCM.test_average_degrees-356"><span class="linenos">356</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span><span id="BiCM.test_average_degrees-357"><a href="#BiCM.test_average_degrees-357"><span class="linenos">357</span></a>        <span class="k">return</span> <span class="kc">True</span>
</span></pre></div>


            <div class="docstring"><p>Test the constraints on the node degrees.</p>

<p>Check that the degree sequence of the solved BiCM null model graph
corresponds to the degree sequence of the input graph.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>eps</strong>:  maximum difference between degrees of the real network
and the BiCM</li>
</ul>
</div>


                            </div>
                            <div id="BiCM.lambda_motifs" class="classattr">
                                        <input id="BiCM.lambda_motifs-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">lambda_motifs</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">bip_set</span>,</span><span class="param">	<span class="n">parallel</span><span class="o">=</span><span class="kc">True</span>,</span><span class="param">	<span class="n">filename</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">delim</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span>,</span><span class="param">	<span class="n">binary</span><span class="o">=</span><span class="kc">True</span>,</span><span class="param">	<span class="n">num_chunks</span><span class="o">=</span><span class="mi">4</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="BiCM.lambda_motifs-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#BiCM.lambda_motifs"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="BiCM.lambda_motifs-363"><a href="#BiCM.lambda_motifs-363"><span class="linenos">363</span></a>    <span class="k">def</span> <span class="nf">lambda_motifs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bip_set</span><span class="p">,</span> <span class="n">parallel</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="BiCM.lambda_motifs-364"><a href="#BiCM.lambda_motifs-364"><span class="linenos">364</span></a>            <span class="n">delim</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">binary</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">num_chunks</span><span class="o">=</span><span class="mi">4</span><span class="p">):</span>
</span><span id="BiCM.lambda_motifs-365"><a href="#BiCM.lambda_motifs-365"><span class="linenos">365</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Calculate and save the p-values of the :math:`\\Lambda`-motifs.</span>
</span><span id="BiCM.lambda_motifs-366"><a href="#BiCM.lambda_motifs-366"><span class="linenos">366</span></a>
</span><span id="BiCM.lambda_motifs-367"><a href="#BiCM.lambda_motifs-367"><span class="linenos">367</span></a><span class="sd">        For each node couple in the bipartite layer specified by ``bip_set``,</span>
</span><span id="BiCM.lambda_motifs-368"><a href="#BiCM.lambda_motifs-368"><span class="linenos">368</span></a><span class="sd">        calculate the p-values of the corresponding :math:`\\Lambda`-motifs</span>
</span><span id="BiCM.lambda_motifs-369"><a href="#BiCM.lambda_motifs-369"><span class="linenos">369</span></a><span class="sd">        according to the link probabilities in the biadjacency matrix of the</span>
</span><span id="BiCM.lambda_motifs-370"><a href="#BiCM.lambda_motifs-370"><span class="linenos">370</span></a><span class="sd">        BiCM null model.</span>
</span><span id="BiCM.lambda_motifs-371"><a href="#BiCM.lambda_motifs-371"><span class="linenos">371</span></a>
</span><span id="BiCM.lambda_motifs-372"><a href="#BiCM.lambda_motifs-372"><span class="linenos">372</span></a><span class="sd">        The results can be saved either as a binary ``.npy`` or a</span>
</span><span id="BiCM.lambda_motifs-373"><a href="#BiCM.lambda_motifs-373"><span class="linenos">373</span></a><span class="sd">        human-readable ``.csv`` file, depending on ``binary``.</span>
</span><span id="BiCM.lambda_motifs-374"><a href="#BiCM.lambda_motifs-374"><span class="linenos">374</span></a>
</span><span id="BiCM.lambda_motifs-375"><a href="#BiCM.lambda_motifs-375"><span class="linenos">375</span></a><span class="sd">        .. note::</span>
</span><span id="BiCM.lambda_motifs-376"><a href="#BiCM.lambda_motifs-376"><span class="linenos">376</span></a>
</span><span id="BiCM.lambda_motifs-377"><a href="#BiCM.lambda_motifs-377"><span class="linenos">377</span></a><span class="sd">            * The total number of p-values that are calculated is split into</span>
</span><span id="BiCM.lambda_motifs-378"><a href="#BiCM.lambda_motifs-378"><span class="linenos">378</span></a><span class="sd">              ``num_chunks`` chunks, which are processed sequentially in order</span>
</span><span id="BiCM.lambda_motifs-379"><a href="#BiCM.lambda_motifs-379"><span class="linenos">379</span></a><span class="sd">              to avoid memory allocation errors. Note that a larger value of</span>
</span><span id="BiCM.lambda_motifs-380"><a href="#BiCM.lambda_motifs-380"><span class="linenos">380</span></a><span class="sd">              ``num_chunks`` will lead to less memory occupation, but comes at</span>
</span><span id="BiCM.lambda_motifs-381"><a href="#BiCM.lambda_motifs-381"><span class="linenos">381</span></a><span class="sd">              the cost of slower processing speed.</span>
</span><span id="BiCM.lambda_motifs-382"><a href="#BiCM.lambda_motifs-382"><span class="linenos">382</span></a>
</span><span id="BiCM.lambda_motifs-383"><a href="#BiCM.lambda_motifs-383"><span class="linenos">383</span></a><span class="sd">            * The output consists of a one-dimensional array of p-values. If</span>
</span><span id="BiCM.lambda_motifs-384"><a href="#BiCM.lambda_motifs-384"><span class="linenos">384</span></a><span class="sd">              the bipartite layer ``bip_set`` contains ``n`` nodes, this means</span>
</span><span id="BiCM.lambda_motifs-385"><a href="#BiCM.lambda_motifs-385"><span class="linenos">385</span></a><span class="sd">              that the array will contain :math:`\\binom{n}{2}` entries. The</span>
</span><span id="BiCM.lambda_motifs-386"><a href="#BiCM.lambda_motifs-386"><span class="linenos">386</span></a><span class="sd">              indices ``(i, j)`` of the nodes corresponding to entry ``k`` in</span>
</span><span id="BiCM.lambda_motifs-387"><a href="#BiCM.lambda_motifs-387"><span class="linenos">387</span></a><span class="sd">              the array can be reconstructed using the method</span>
</span><span id="BiCM.lambda_motifs-388"><a href="#BiCM.lambda_motifs-388"><span class="linenos">388</span></a><span class="sd">              :func:`BiCM.flat2_triumat_idx`. The number of nodes ``n``</span>
</span><span id="BiCM.lambda_motifs-389"><a href="#BiCM.lambda_motifs-389"><span class="linenos">389</span></a><span class="sd">              can be recovered from the length of the array with</span>
</span><span id="BiCM.lambda_motifs-390"><a href="#BiCM.lambda_motifs-390"><span class="linenos">390</span></a><span class="sd">              :func:`BiCM.flat2_triumat_dim`</span>
</span><span id="BiCM.lambda_motifs-391"><a href="#BiCM.lambda_motifs-391"><span class="linenos">391</span></a>
</span><span id="BiCM.lambda_motifs-392"><a href="#BiCM.lambda_motifs-392"><span class="linenos">392</span></a><span class="sd">            * If ``binary == False``, the ``filename`` should end with</span>
</span><span id="BiCM.lambda_motifs-393"><a href="#BiCM.lambda_motifs-393"><span class="linenos">393</span></a><span class="sd">              ``.csv``. If ``binary == True``, it will be saved in binary NumPy</span>
</span><span id="BiCM.lambda_motifs-394"><a href="#BiCM.lambda_motifs-394"><span class="linenos">394</span></a><span class="sd">              ``.npy`` format and the suffix ``.npy`` will be appended</span>
</span><span id="BiCM.lambda_motifs-395"><a href="#BiCM.lambda_motifs-395"><span class="linenos">395</span></a><span class="sd">              automatically. By default, the file is saved in binary format.</span>
</span><span id="BiCM.lambda_motifs-396"><a href="#BiCM.lambda_motifs-396"><span class="linenos">396</span></a>
</span><span id="BiCM.lambda_motifs-397"><a href="#BiCM.lambda_motifs-397"><span class="linenos">397</span></a><span class="sd">        :param bip_set: select row-nodes (``True``) or column-nodes (``False``)</span>
</span><span id="BiCM.lambda_motifs-398"><a href="#BiCM.lambda_motifs-398"><span class="linenos">398</span></a><span class="sd">        :type bip_set: bool</span>
</span><span id="BiCM.lambda_motifs-399"><a href="#BiCM.lambda_motifs-399"><span class="linenos">399</span></a><span class="sd">        :param parallel: select whether the calculation of the p-values should</span>
</span><span id="BiCM.lambda_motifs-400"><a href="#BiCM.lambda_motifs-400"><span class="linenos">400</span></a><span class="sd">            be run in parallel (``True``) or not (``False``)</span>
</span><span id="BiCM.lambda_motifs-401"><a href="#BiCM.lambda_motifs-401"><span class="linenos">401</span></a><span class="sd">        :type parallel: bool</span>
</span><span id="BiCM.lambda_motifs-402"><a href="#BiCM.lambda_motifs-402"><span class="linenos">402</span></a><span class="sd">        :param filename: name of the output file</span>
</span><span id="BiCM.lambda_motifs-403"><a href="#BiCM.lambda_motifs-403"><span class="linenos">403</span></a><span class="sd">        :type filename: str</span>
</span><span id="BiCM.lambda_motifs-404"><a href="#BiCM.lambda_motifs-404"><span class="linenos">404</span></a><span class="sd">        :param delim: delimiter between entries in the ``.csv``file, default is</span>
</span><span id="BiCM.lambda_motifs-405"><a href="#BiCM.lambda_motifs-405"><span class="linenos">405</span></a><span class="sd">            ``\\t``</span>
</span><span id="BiCM.lambda_motifs-406"><a href="#BiCM.lambda_motifs-406"><span class="linenos">406</span></a><span class="sd">        :type delim: str</span>
</span><span id="BiCM.lambda_motifs-407"><a href="#BiCM.lambda_motifs-407"><span class="linenos">407</span></a><span class="sd">        :param binary: if ``True``, the file will be saved in the binary</span>
</span><span id="BiCM.lambda_motifs-408"><a href="#BiCM.lambda_motifs-408"><span class="linenos">408</span></a><span class="sd">            NumPy format ``.npy``, otherwise as ``.csv``</span>
</span><span id="BiCM.lambda_motifs-409"><a href="#BiCM.lambda_motifs-409"><span class="linenos">409</span></a><span class="sd">        :type binary: bool</span>
</span><span id="BiCM.lambda_motifs-410"><a href="#BiCM.lambda_motifs-410"><span class="linenos">410</span></a><span class="sd">        :param num_chunks: number of chunks of p-value calculations that are</span>
</span><span id="BiCM.lambda_motifs-411"><a href="#BiCM.lambda_motifs-411"><span class="linenos">411</span></a><span class="sd">            performed sequentially</span>
</span><span id="BiCM.lambda_motifs-412"><a href="#BiCM.lambda_motifs-412"><span class="linenos">412</span></a><span class="sd">        :type num_chunks: int</span>
</span><span id="BiCM.lambda_motifs-413"><a href="#BiCM.lambda_motifs-413"><span class="linenos">413</span></a><span class="sd">        :raise ValueError: raise an error if the parameter ``bip_set`` is</span>
</span><span id="BiCM.lambda_motifs-414"><a href="#BiCM.lambda_motifs-414"><span class="linenos">414</span></a><span class="sd">            neither ``True`` nor ``False``</span>
</span><span id="BiCM.lambda_motifs-415"><a href="#BiCM.lambda_motifs-415"><span class="linenos">415</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="BiCM.lambda_motifs-416"><a href="#BiCM.lambda_motifs-416"><span class="linenos">416</span></a>        <span class="k">if</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">bip_set</span><span class="p">)</span> <span class="o">==</span> <span class="nb">bool</span><span class="p">)</span> <span class="ow">and</span> <span class="n">bip_set</span><span class="p">:</span>
</span><span id="BiCM.lambda_motifs-417"><a href="#BiCM.lambda_motifs-417"><span class="linenos">417</span></a>            <span class="n">biad_mat</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">adj_matrix</span>
</span><span id="BiCM.lambda_motifs-418"><a href="#BiCM.lambda_motifs-418"><span class="linenos">418</span></a>            <span class="n">bin_mat</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bin_mat</span>
</span><span id="BiCM.lambda_motifs-419"><a href="#BiCM.lambda_motifs-419"><span class="linenos">419</span></a>        <span class="k">elif</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">bip_set</span><span class="p">)</span> <span class="o">==</span> <span class="nb">bool</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">bip_set</span><span class="p">:</span>
</span><span id="BiCM.lambda_motifs-420"><a href="#BiCM.lambda_motifs-420"><span class="linenos">420</span></a>            <span class="n">biad_mat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">adj_matrix</span><span class="p">)</span>
</span><span id="BiCM.lambda_motifs-421"><a href="#BiCM.lambda_motifs-421"><span class="linenos">421</span></a>            <span class="n">bin_mat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bin_mat</span><span class="p">)</span>
</span><span id="BiCM.lambda_motifs-422"><a href="#BiCM.lambda_motifs-422"><span class="linenos">422</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="BiCM.lambda_motifs-423"><a href="#BiCM.lambda_motifs-423"><span class="linenos">423</span></a>            <span class="n">errmsg</span> <span class="o">=</span> <span class="s2">&quot;&#39;&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">bip_set</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&#39; &quot;</span> <span class="o">+</span> <span class="s1">&#39;not supported.&#39;</span>
</span><span id="BiCM.lambda_motifs-424"><a href="#BiCM.lambda_motifs-424"><span class="linenos">424</span></a>            <span class="k">raise</span> <span class="ne">NameError</span><span class="p">(</span><span class="n">errmsg</span><span class="p">)</span>
</span><span id="BiCM.lambda_motifs-425"><a href="#BiCM.lambda_motifs-425"><span class="linenos">425</span></a>
</span><span id="BiCM.lambda_motifs-426"><a href="#BiCM.lambda_motifs-426"><span class="linenos">426</span></a>        <span class="n">n</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_triup_dim</span><span class="p">(</span><span class="n">bip_set</span><span class="p">))</span> <span class="c1"># n. pairs..</span>
</span><span id="BiCM.lambda_motifs-427"><a href="#BiCM.lambda_motifs-427"><span class="linenos">427</span></a>        <span class="n">pval</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;float&#39;</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mf">0.1</span><span class="p">)</span>
</span><span id="BiCM.lambda_motifs-428"><a href="#BiCM.lambda_motifs-428"><span class="linenos">428</span></a>
</span><span id="BiCM.lambda_motifs-429"><a href="#BiCM.lambda_motifs-429"><span class="linenos">429</span></a>
</span><span id="BiCM.lambda_motifs-430"><a href="#BiCM.lambda_motifs-430"><span class="linenos">430</span></a>        <span class="c1"># handle layers of dimension 2 separately</span>
</span><span id="BiCM.lambda_motifs-431"><a href="#BiCM.lambda_motifs-431"><span class="linenos">431</span></a>        <span class="k">if</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="BiCM.lambda_motifs-432"><a href="#BiCM.lambda_motifs-432"><span class="linenos">432</span></a>            <span class="n">nlam</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">bin_mat</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:],</span> <span class="n">bin_mat</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
</span><span id="BiCM.lambda_motifs-433"><a href="#BiCM.lambda_motifs-433"><span class="linenos">433</span></a>            <span class="n">plam</span> <span class="o">=</span> <span class="n">biad_mat</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]</span> <span class="o">*</span> <span class="n">biad_mat</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span>
</span><span id="BiCM.lambda_motifs-434"><a href="#BiCM.lambda_motifs-434"><span class="linenos">434</span></a>            <span class="n">pb</span> <span class="o">=</span> <span class="n">PoiBin</span><span class="p">(</span><span class="n">plam</span><span class="p">)</span>
</span><span id="BiCM.lambda_motifs-435"><a href="#BiCM.lambda_motifs-435"><span class="linenos">435</span></a>            <span class="n">pval</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">pb</span><span class="o">.</span><span class="n">pval</span><span class="p">(</span><span class="n">nlam</span><span class="p">)</span>
</span><span id="BiCM.lambda_motifs-436"><a href="#BiCM.lambda_motifs-436"><span class="linenos">436</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="BiCM.lambda_motifs-437"><a href="#BiCM.lambda_motifs-437"><span class="linenos">437</span></a>            <span class="c1"># if the dimension of the network is too large, split the</span>
</span><span id="BiCM.lambda_motifs-438"><a href="#BiCM.lambda_motifs-438"><span class="linenos">438</span></a>            <span class="c1"># calculations # of the p-values in ``m`` intervals to avoid memory</span>
</span><span id="BiCM.lambda_motifs-439"><a href="#BiCM.lambda_motifs-439"><span class="linenos">439</span></a>            <span class="c1"># allocation errors</span>
</span><span id="BiCM.lambda_motifs-440"><a href="#BiCM.lambda_motifs-440"><span class="linenos">440</span></a>
</span><span id="BiCM.lambda_motifs-441"><a href="#BiCM.lambda_motifs-441"><span class="linenos">441</span></a>            <span class="c1"># correced - never bother with splitting for now</span>
</span><span id="BiCM.lambda_motifs-442"><a href="#BiCM.lambda_motifs-442"><span class="linenos">442</span></a>            <span class="k">if</span> <span class="n">n</span> <span class="o">&gt;</span> <span class="mi">100000</span><span class="p">:</span>
</span><span id="BiCM.lambda_motifs-443"><a href="#BiCM.lambda_motifs-443"><span class="linenos">443</span></a>                <span class="n">kk</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">split_range</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">m</span><span class="o">=</span><span class="n">num_chunks</span><span class="p">)</span>
</span><span id="BiCM.lambda_motifs-444"><a href="#BiCM.lambda_motifs-444"><span class="linenos">444</span></a>
</span><span id="BiCM.lambda_motifs-445"><a href="#BiCM.lambda_motifs-445"><span class="linenos">445</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="BiCM.lambda_motifs-446"><a href="#BiCM.lambda_motifs-446"><span class="linenos">446</span></a>                <span class="n">k1</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="BiCM.lambda_motifs-447"><a href="#BiCM.lambda_motifs-447"><span class="linenos">447</span></a>                <span class="n">k2</span> <span class="o">=</span> <span class="n">n</span>
</span><span id="BiCM.lambda_motifs-448"><a href="#BiCM.lambda_motifs-448"><span class="linenos">448</span></a>                <span class="n">nlam</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_lambda_motif_block</span><span class="p">(</span><span class="n">bin_mat</span><span class="p">,</span> <span class="n">k1</span><span class="p">,</span> <span class="n">k2</span><span class="p">)</span>
</span><span id="BiCM.lambda_motifs-449"><a href="#BiCM.lambda_motifs-449"><span class="linenos">449</span></a>                <span class="n">plam</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_plambda_block</span><span class="p">(</span><span class="n">biad_mat</span><span class="p">,</span> <span class="n">k1</span><span class="p">,</span> <span class="n">k2</span><span class="p">)</span>
</span><span id="BiCM.lambda_motifs-450"><a href="#BiCM.lambda_motifs-450"><span class="linenos">450</span></a>
</span><span id="BiCM.lambda_motifs-451"><a href="#BiCM.lambda_motifs-451"><span class="linenos">451</span></a>                <span class="n">pv</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_pvalues_q</span><span class="p">(</span><span class="n">plam</span><span class="p">,</span> <span class="n">nlam</span><span class="p">,</span> <span class="n">k1</span><span class="p">,</span> <span class="n">k2</span><span class="p">)</span>
</span><span id="BiCM.lambda_motifs-452"><a href="#BiCM.lambda_motifs-452"><span class="linenos">452</span></a>                <span class="c1">#print(&#39;p values found:&#39;)</span>
</span><span id="BiCM.lambda_motifs-453"><a href="#BiCM.lambda_motifs-453"><span class="linenos">453</span></a>                <span class="c1">#print(pv)</span>
</span><span id="BiCM.lambda_motifs-454"><a href="#BiCM.lambda_motifs-454"><span class="linenos">454</span></a>                <span class="n">pval</span><span class="p">[</span><span class="n">k1</span><span class="p">:]</span> <span class="o">=</span> <span class="n">pv</span>
</span><span id="BiCM.lambda_motifs-455"><a href="#BiCM.lambda_motifs-455"><span class="linenos">455</span></a>
</span><span id="BiCM.lambda_motifs-456"><a href="#BiCM.lambda_motifs-456"><span class="linenos">456</span></a>            <span class="c1">#print(&#39;pvals before:&#39;)</span>
</span><span id="BiCM.lambda_motifs-457"><a href="#BiCM.lambda_motifs-457"><span class="linenos">457</span></a>            <span class="c1">#print(pval)</span>
</span><span id="BiCM.lambda_motifs-458"><a href="#BiCM.lambda_motifs-458"><span class="linenos">458</span></a>
</span><span id="BiCM.lambda_motifs-459"><a href="#BiCM.lambda_motifs-459"><span class="linenos">459</span></a>            <span class="c1">## last interval</span>
</span><span id="BiCM.lambda_motifs-460"><a href="#BiCM.lambda_motifs-460"><span class="linenos">460</span></a>            <span class="c1">#k1 = kk[len(kk) - 1]</span>
</span><span id="BiCM.lambda_motifs-461"><a href="#BiCM.lambda_motifs-461"><span class="linenos">461</span></a>            <span class="c1">#k2 = n - 1</span>
</span><span id="BiCM.lambda_motifs-462"><a href="#BiCM.lambda_motifs-462"><span class="linenos">462</span></a>            <span class="c1">#nlam = self.get_lambda_motif_block(bin_mat, k1, k2)</span>
</span><span id="BiCM.lambda_motifs-463"><a href="#BiCM.lambda_motifs-463"><span class="linenos">463</span></a>            <span class="c1">#plam = self.get_plambda_block(biad_mat, k1, k2)</span>
</span><span id="BiCM.lambda_motifs-464"><a href="#BiCM.lambda_motifs-464"><span class="linenos">464</span></a>
</span><span id="BiCM.lambda_motifs-465"><a href="#BiCM.lambda_motifs-465"><span class="linenos">465</span></a>            <span class="c1"># for the last entry we have to INCLUDE k2, thus k2 + 1</span>
</span><span id="BiCM.lambda_motifs-466"><a href="#BiCM.lambda_motifs-466"><span class="linenos">466</span></a>            <span class="c1">#pv = self.get_pvalues_q(plam, nlam, k1, k2 + 1)</span>
</span><span id="BiCM.lambda_motifs-467"><a href="#BiCM.lambda_motifs-467"><span class="linenos">467</span></a>            <span class="c1">#pval[k1:] = pv</span>
</span><span id="BiCM.lambda_motifs-468"><a href="#BiCM.lambda_motifs-468"><span class="linenos">468</span></a>
</span><span id="BiCM.lambda_motifs-469"><a href="#BiCM.lambda_motifs-469"><span class="linenos">469</span></a>        <span class="c1"># check that all p-values have been calculated</span>
</span><span id="BiCM.lambda_motifs-470"><a href="#BiCM.lambda_motifs-470"><span class="linenos">470</span></a><span class="c1">#        assert np.all(pval &gt;= 0) and np.all(pval &lt;= 1)</span>
</span><span id="BiCM.lambda_motifs-471"><a href="#BiCM.lambda_motifs-471"><span class="linenos">471</span></a>        <span class="k">if</span> <span class="n">filename</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="BiCM.lambda_motifs-472"><a href="#BiCM.lambda_motifs-472"><span class="linenos">472</span></a>            <span class="n">fname</span> <span class="o">=</span> <span class="s1">&#39;p_values_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">bip_set</span><span class="p">)</span>
</span><span id="BiCM.lambda_motifs-473"><a href="#BiCM.lambda_motifs-473"><span class="linenos">473</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">binary</span><span class="p">:</span>
</span><span id="BiCM.lambda_motifs-474"><a href="#BiCM.lambda_motifs-474"><span class="linenos">474</span></a>                <span class="n">fname</span> <span class="o">+=</span>  <span class="s1">&#39;.csv&#39;</span>
</span><span id="BiCM.lambda_motifs-475"><a href="#BiCM.lambda_motifs-475"><span class="linenos">475</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="BiCM.lambda_motifs-476"><a href="#BiCM.lambda_motifs-476"><span class="linenos">476</span></a>            <span class="n">fname</span> <span class="o">=</span> <span class="n">filename</span>
</span><span id="BiCM.lambda_motifs-477"><a href="#BiCM.lambda_motifs-477"><span class="linenos">477</span></a>
</span><span id="BiCM.lambda_motifs-478"><a href="#BiCM.lambda_motifs-478"><span class="linenos">478</span></a>        <span class="c1"># account for machine precision:</span>
</span><span id="BiCM.lambda_motifs-479"><a href="#BiCM.lambda_motifs-479"><span class="linenos">479</span></a>        <span class="n">pval</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">finfo</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span><span class="o">.</span><span class="n">eps</span>
</span><span id="BiCM.lambda_motifs-480"><a href="#BiCM.lambda_motifs-480"><span class="linenos">480</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">save_array</span><span class="p">(</span><span class="n">pval</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="n">fname</span><span class="p">,</span> <span class="n">delim</span><span class="o">=</span><span class="n">delim</span><span class="p">,</span>
</span><span id="BiCM.lambda_motifs-481"><a href="#BiCM.lambda_motifs-481"><span class="linenos">481</span></a>                         <span class="n">binary</span><span class="o">=</span><span class="n">binary</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Calculate and save the p-values of the \( \Lambda \)-motifs.</p>

<p>For each node couple in the bipartite layer specified by <code>bip_set</code>,
calculate the p-values of the corresponding \( \Lambda \)-motifs
according to the link probabilities in the biadjacency matrix of the
BiCM null model.</p>

<p>The results can be saved either as a binary <code>.npy</code> or a
human-readable <code>.csv</code> file, depending on <code>binary</code>.</p>

<div class="pdoc-alert pdoc-alert-note">

<ul>
<li><p>The total number of p-values that are calculated is split into
<code>num_chunks</code> chunks, which are processed sequentially in order
to avoid memory allocation errors. Note that a larger value of
<code>num_chunks</code> will lead to less memory occupation, but comes at
the cost of slower processing speed.</p></li>
<li><p>The output consists of a one-dimensional array of p-values. If
the bipartite layer <code>bip_set</code> contains <code>n</code> nodes, this means
that the array will contain \( \binom{n}{2} \) entries. The
indices <code>(i, j)</code> of the nodes corresponding to entry <code>k</code> in
the array can be reconstructed using the method
<code>BiCM.flat2_triumat_idx()</code>. The number of nodes <code>n</code>
can be recovered from the length of the array with
<code>BiCM.flat2_triumat_dim()</code></p></li>
<li><p>If <code>binary == False</code>, the <code>filename</code> should end with
<code>.csv</code>. If <code>binary == True</code>, it will be saved in binary NumPy
<code>.npy</code> format and the suffix <code>.npy</code> will be appended
automatically. By default, the file is saved in binary format.</p></li>
</ul>

</div>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>bip_set</strong>:  select row-nodes (<code>True</code>) or column-nodes (<code>False</code>)</li>
<li><strong>parallel</strong>:  select whether the calculation of the p-values should
be run in parallel (<code>True</code>) or not (<code>False</code>)</li>
<li><strong>filename</strong>:  name of the output file</li>
<li><strong>delim</strong>:  delimiter between entries in the <code>.csv</code>file, default is
<code>\t</code></li>
<li><strong>binary</strong>:  if <code>True</code>, the file will be saved in the binary
NumPy format <code>.npy</code>, otherwise as <code>.csv</code></li>
<li><strong>num_chunks</strong>:  number of chunks of p-value calculations that are
performed sequentially
:raise ValueError: raise an error if the parameter <code>bip_set</code> is
neither <code>True</code> nor <code>False</code></li>
</ul>
</div>


                            </div>
                            <div id="BiCM.get_lambda_motif_block" class="classattr">
                                        <input id="BiCM.get_lambda_motif_block-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_lambda_motif_block</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">mm</span>, </span><span class="param"><span class="n">k1</span>, </span><span class="param"><span class="n">k2</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="BiCM.get_lambda_motif_block-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#BiCM.get_lambda_motif_block"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="BiCM.get_lambda_motif_block-483"><a href="#BiCM.get_lambda_motif_block-483"><span class="linenos">483</span></a>    <span class="k">def</span> <span class="nf">get_lambda_motif_block</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mm</span><span class="p">,</span> <span class="n">k1</span><span class="p">,</span> <span class="n">k2</span><span class="p">):</span>
</span><span id="BiCM.get_lambda_motif_block-484"><a href="#BiCM.get_lambda_motif_block-484"><span class="linenos">484</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Return a subset of :math:`\\Lambda`-motifs as observed in ``mm``.</span>
</span><span id="BiCM.get_lambda_motif_block-485"><a href="#BiCM.get_lambda_motif_block-485"><span class="linenos">485</span></a>
</span><span id="BiCM.get_lambda_motif_block-486"><a href="#BiCM.get_lambda_motif_block-486"><span class="linenos">486</span></a><span class="sd">        Given the binary input matrix ``mm``, count the number of</span>
</span><span id="BiCM.get_lambda_motif_block-487"><a href="#BiCM.get_lambda_motif_block-487"><span class="linenos">487</span></a><span class="sd">        :math:`\\Lambda`-motifs for all the node couples specified by the</span>
</span><span id="BiCM.get_lambda_motif_block-488"><a href="#BiCM.get_lambda_motif_block-488"><span class="linenos">488</span></a><span class="sd">        interval :math:`\\left[k_1, k_2\\right[`.</span>
</span><span id="BiCM.get_lambda_motif_block-489"><a href="#BiCM.get_lambda_motif_block-489"><span class="linenos">489</span></a>
</span><span id="BiCM.get_lambda_motif_block-490"><a href="#BiCM.get_lambda_motif_block-490"><span class="linenos">490</span></a>
</span><span id="BiCM.get_lambda_motif_block-491"><a href="#BiCM.get_lambda_motif_block-491"><span class="linenos">491</span></a><span class="sd">        .. note::</span>
</span><span id="BiCM.get_lambda_motif_block-492"><a href="#BiCM.get_lambda_motif_block-492"><span class="linenos">492</span></a>
</span><span id="BiCM.get_lambda_motif_block-493"><a href="#BiCM.get_lambda_motif_block-493"><span class="linenos">493</span></a><span class="sd">            * The :math:`\\Lambda`-motifs are counted between the **row-nodes**</span>
</span><span id="BiCM.get_lambda_motif_block-494"><a href="#BiCM.get_lambda_motif_block-494"><span class="linenos">494</span></a><span class="sd">              of the input matrix ``mm``.</span>
</span><span id="BiCM.get_lambda_motif_block-495"><a href="#BiCM.get_lambda_motif_block-495"><span class="linenos">495</span></a>
</span><span id="BiCM.get_lambda_motif_block-496"><a href="#BiCM.get_lambda_motif_block-496"><span class="linenos">496</span></a><span class="sd">            * If :math:`k_2 \equiv \\binom{mm.shape[0]}{2}`, the interval</span>
</span><span id="BiCM.get_lambda_motif_block-497"><a href="#BiCM.get_lambda_motif_block-497"><span class="linenos">497</span></a><span class="sd">              becomes :math:`\\left[k_1, k_2\\right]`.</span>
</span><span id="BiCM.get_lambda_motif_block-498"><a href="#BiCM.get_lambda_motif_block-498"><span class="linenos">498</span></a>
</span><span id="BiCM.get_lambda_motif_block-499"><a href="#BiCM.get_lambda_motif_block-499"><span class="linenos">499</span></a><span class="sd">        :param mm: binary matrix</span>
</span><span id="BiCM.get_lambda_motif_block-500"><a href="#BiCM.get_lambda_motif_block-500"><span class="linenos">500</span></a><span class="sd">        :type mm: numpy.array</span>
</span><span id="BiCM.get_lambda_motif_block-501"><a href="#BiCM.get_lambda_motif_block-501"><span class="linenos">501</span></a><span class="sd">        :param k1: lower interval limit</span>
</span><span id="BiCM.get_lambda_motif_block-502"><a href="#BiCM.get_lambda_motif_block-502"><span class="linenos">502</span></a><span class="sd">        :type k1: int</span>
</span><span id="BiCM.get_lambda_motif_block-503"><a href="#BiCM.get_lambda_motif_block-503"><span class="linenos">503</span></a><span class="sd">        :param k2: upper interval limit</span>
</span><span id="BiCM.get_lambda_motif_block-504"><a href="#BiCM.get_lambda_motif_block-504"><span class="linenos">504</span></a><span class="sd">        :type k2: int</span>
</span><span id="BiCM.get_lambda_motif_block-505"><a href="#BiCM.get_lambda_motif_block-505"><span class="linenos">505</span></a><span class="sd">        :returns: array of observed :math:`\\Lambda`-motifs</span>
</span><span id="BiCM.get_lambda_motif_block-506"><a href="#BiCM.get_lambda_motif_block-506"><span class="linenos">506</span></a><span class="sd">        :rtype: numpy.array</span>
</span><span id="BiCM.get_lambda_motif_block-507"><a href="#BiCM.get_lambda_motif_block-507"><span class="linenos">507</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="BiCM.get_lambda_motif_block-508"><a href="#BiCM.get_lambda_motif_block-508"><span class="linenos">508</span></a>        <span class="n">k1</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">k1</span><span class="p">)</span>
</span><span id="BiCM.get_lambda_motif_block-509"><a href="#BiCM.get_lambda_motif_block-509"><span class="linenos">509</span></a>        <span class="n">k2</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">k2</span><span class="p">)</span>
</span><span id="BiCM.get_lambda_motif_block-510"><a href="#BiCM.get_lambda_motif_block-510"><span class="linenos">510</span></a>        <span class="n">ndim</span> <span class="o">=</span> <span class="n">mm</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="BiCM.get_lambda_motif_block-511"><a href="#BiCM.get_lambda_motif_block-511"><span class="linenos">511</span></a>        <span class="c1"># if the upper limit is the largest possible index, i.e. corresponds to</span>
</span><span id="BiCM.get_lambda_motif_block-512"><a href="#BiCM.get_lambda_motif_block-512"><span class="linenos">512</span></a>        <span class="c1"># the node couple (ndim - 2, ndim - 1), where node indices start from 0,</span>
</span><span id="BiCM.get_lambda_motif_block-513"><a href="#BiCM.get_lambda_motif_block-513"><span class="linenos">513</span></a>        <span class="c1"># include the result</span>
</span><span id="BiCM.get_lambda_motif_block-514"><a href="#BiCM.get_lambda_motif_block-514"><span class="linenos">514</span></a>        <span class="k">if</span> <span class="n">k2</span> <span class="o">==</span> <span class="p">(</span><span class="n">ndim</span> <span class="o">*</span> <span class="p">(</span><span class="n">ndim</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
</span><span id="BiCM.get_lambda_motif_block-515"><a href="#BiCM.get_lambda_motif_block-515"><span class="linenos">515</span></a>            <span class="n">flag</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="BiCM.get_lambda_motif_block-516"><a href="#BiCM.get_lambda_motif_block-516"><span class="linenos">516</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="BiCM.get_lambda_motif_block-517"><a href="#BiCM.get_lambda_motif_block-517"><span class="linenos">517</span></a>            <span class="n">flag</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="BiCM.get_lambda_motif_block-518"><a href="#BiCM.get_lambda_motif_block-518"><span class="linenos">518</span></a>        <span class="n">aux</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="n">k2</span> <span class="o">-</span> <span class="n">k1</span> <span class="o">+</span> <span class="n">flag</span><span class="p">,</span> <span class="p">))</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="c1"># -1 as a test</span>
</span><span id="BiCM.get_lambda_motif_block-519"><a href="#BiCM.get_lambda_motif_block-519"><span class="linenos">519</span></a>        <span class="p">[</span><span class="n">i1</span><span class="p">,</span> <span class="n">j1</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">flat2triumat_idx</span><span class="p">(</span><span class="n">k1</span><span class="p">,</span> <span class="n">ndim</span><span class="p">)</span>
</span><span id="BiCM.get_lambda_motif_block-520"><a href="#BiCM.get_lambda_motif_block-520"><span class="linenos">520</span></a>        <span class="p">[</span><span class="n">i2</span><span class="p">,</span> <span class="n">j2</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">flat2triumat_idx</span><span class="p">(</span><span class="n">k2</span><span class="p">,</span> <span class="n">ndim</span><span class="p">)</span>
</span><span id="BiCM.get_lambda_motif_block-521"><a href="#BiCM.get_lambda_motif_block-521"><span class="linenos">521</span></a>
</span><span id="BiCM.get_lambda_motif_block-522"><a href="#BiCM.get_lambda_motif_block-522"><span class="linenos">522</span></a>        <span class="c1"># if limits have the same row index</span>
</span><span id="BiCM.get_lambda_motif_block-523"><a href="#BiCM.get_lambda_motif_block-523"><span class="linenos">523</span></a>        <span class="k">if</span> <span class="n">i1</span> <span class="o">==</span> <span class="n">i2</span><span class="p">:</span>
</span><span id="BiCM.get_lambda_motif_block-524"><a href="#BiCM.get_lambda_motif_block-524"><span class="linenos">524</span></a>            <span class="n">aux</span><span class="p">[:</span><span class="n">k2</span> <span class="o">-</span> <span class="n">k1</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">mm</span><span class="p">[</span><span class="n">i1</span><span class="p">,</span> <span class="p">:],</span> <span class="n">mm</span><span class="p">[</span><span class="n">j1</span><span class="p">:</span><span class="n">j2</span><span class="p">,</span> <span class="p">:]</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
</span><span id="BiCM.get_lambda_motif_block-525"><a href="#BiCM.get_lambda_motif_block-525"><span class="linenos">525</span></a>        <span class="c1"># if limits have different row indices</span>
</span><span id="BiCM.get_lambda_motif_block-526"><a href="#BiCM.get_lambda_motif_block-526"><span class="linenos">526</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="BiCM.get_lambda_motif_block-527"><a href="#BiCM.get_lambda_motif_block-527"><span class="linenos">527</span></a>            <span class="n">k</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="BiCM.get_lambda_motif_block-528"><a href="#BiCM.get_lambda_motif_block-528"><span class="linenos">528</span></a>            <span class="c1">#print(&#39;i1:&#39;, i1)</span>
</span><span id="BiCM.get_lambda_motif_block-529"><a href="#BiCM.get_lambda_motif_block-529"><span class="linenos">529</span></a>            <span class="c1">#print(&#39;j1:&#39;, j1)</span>
</span><span id="BiCM.get_lambda_motif_block-530"><a href="#BiCM.get_lambda_motif_block-530"><span class="linenos">530</span></a>            <span class="c1"># get values for lower limit row</span>
</span><span id="BiCM.get_lambda_motif_block-531"><a href="#BiCM.get_lambda_motif_block-531"><span class="linenos">531</span></a>            <span class="n">fi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">mm</span><span class="p">[</span><span class="n">i1</span><span class="p">,</span> <span class="p">:],</span> <span class="n">mm</span><span class="p">[</span><span class="n">j1</span><span class="p">:,</span> <span class="p">:]</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
</span><span id="BiCM.get_lambda_motif_block-532"><a href="#BiCM.get_lambda_motif_block-532"><span class="linenos">532</span></a>            <span class="n">aux</span><span class="p">[:</span><span class="nb">len</span><span class="p">(</span><span class="n">fi</span><span class="p">)]</span> <span class="o">=</span> <span class="n">fi</span>
</span><span id="BiCM.get_lambda_motif_block-533"><a href="#BiCM.get_lambda_motif_block-533"><span class="linenos">533</span></a>            <span class="n">k</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">fi</span><span class="p">)</span>
</span><span id="BiCM.get_lambda_motif_block-534"><a href="#BiCM.get_lambda_motif_block-534"><span class="linenos">534</span></a>            <span class="c1"># get values for intermediate rows</span>
</span><span id="BiCM.get_lambda_motif_block-535"><a href="#BiCM.get_lambda_motif_block-535"><span class="linenos">535</span></a>            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i1</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">i2</span><span class="p">):</span>
</span><span id="BiCM.get_lambda_motif_block-536"><a href="#BiCM.get_lambda_motif_block-536"><span class="linenos">536</span></a>                <span class="n">mid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">mm</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:],</span> <span class="n">mm</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:,</span> <span class="p">:]</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
</span><span id="BiCM.get_lambda_motif_block-537"><a href="#BiCM.get_lambda_motif_block-537"><span class="linenos">537</span></a>                <span class="n">aux</span><span class="p">[</span><span class="n">k</span> <span class="p">:</span> <span class="n">k</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">mid</span><span class="p">)]</span> <span class="o">=</span> <span class="n">mid</span>
</span><span id="BiCM.get_lambda_motif_block-538"><a href="#BiCM.get_lambda_motif_block-538"><span class="linenos">538</span></a>                <span class="n">k</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">mid</span><span class="p">)</span>
</span><span id="BiCM.get_lambda_motif_block-539"><a href="#BiCM.get_lambda_motif_block-539"><span class="linenos">539</span></a>            <span class="c1"># get values for upper limit row</span>
</span><span id="BiCM.get_lambda_motif_block-540"><a href="#BiCM.get_lambda_motif_block-540"><span class="linenos">540</span></a>            <span class="k">if</span> <span class="n">flag</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="BiCM.get_lambda_motif_block-541"><a href="#BiCM.get_lambda_motif_block-541"><span class="linenos">541</span></a>                <span class="n">aux</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">mm</span><span class="p">[</span><span class="n">ndim</span> <span class="o">-</span> <span class="mi">2</span><span class="p">,</span> <span class="p">:],</span> <span class="n">mm</span><span class="p">[</span><span class="n">ndim</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="p">:]</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
</span><span id="BiCM.get_lambda_motif_block-542"><a href="#BiCM.get_lambda_motif_block-542"><span class="linenos">542</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="BiCM.get_lambda_motif_block-543"><a href="#BiCM.get_lambda_motif_block-543"><span class="linenos">543</span></a>                <span class="n">la</span> <span class="o">=</span>  <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">mm</span><span class="p">[</span><span class="n">i2</span><span class="p">,</span> <span class="p">:],</span> <span class="n">mm</span><span class="p">[</span><span class="n">i2</span> <span class="o">+</span> <span class="mi">1</span> <span class="p">:</span> <span class="n">j2</span><span class="p">,</span> <span class="p">:]</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
</span><span id="BiCM.get_lambda_motif_block-544"><a href="#BiCM.get_lambda_motif_block-544"><span class="linenos">544</span></a>                <span class="n">aux</span><span class="p">[</span><span class="n">k</span><span class="p">:]</span> <span class="o">=</span> <span class="n">la</span>
</span><span id="BiCM.get_lambda_motif_block-545"><a href="#BiCM.get_lambda_motif_block-545"><span class="linenos">545</span></a>        <span class="k">return</span> <span class="n">aux</span>
</span></pre></div>


            <div class="docstring"><p>Return a subset of \( \Lambda \)-motifs as observed in <code>mm</code>.</p>

<p>Given the binary input matrix <code>mm</code>, count the number of
\( \Lambda \)-motifs for all the node couples specified by the
interval \( \left[k_1, k_2\right[ \).</p>

<div class="pdoc-alert pdoc-alert-note">

<ul>
<li><p>The \( \Lambda \)-motifs are counted between the <strong>row-nodes</strong>
of the input matrix <code>mm</code>.</p></li>
<li><p>If \( k_2 \equiv \binom{mm.shape[0]}{2} \), the interval
becomes \( \left[k_1, k_2\right] \).</p></li>
</ul>

</div>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>mm</strong>:  binary matrix</li>
<li><strong>k1</strong>:  lower interval limit</li>
<li><strong>k2</strong>:  upper interval limit
:returns: array of observed \( \Lambda \)-motifs</li>
</ul>
</div>


                            </div>
                            <div id="BiCM.get_plambda_block" class="classattr">
                                        <input id="BiCM.get_plambda_block-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_plambda_block</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">biad_mat</span>, </span><span class="param"><span class="n">k1</span>, </span><span class="param"><span class="n">k2</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="BiCM.get_plambda_block-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#BiCM.get_plambda_block"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="BiCM.get_plambda_block-547"><a href="#BiCM.get_plambda_block-547"><span class="linenos">547</span></a>    <span class="k">def</span> <span class="nf">get_plambda_block</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">biad_mat</span><span class="p">,</span> <span class="n">k1</span><span class="p">,</span> <span class="n">k2</span><span class="p">):</span>
</span><span id="BiCM.get_plambda_block-548"><a href="#BiCM.get_plambda_block-548"><span class="linenos">548</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Return a subset of the :math:`\\Lambda` probability matrix.</span>
</span><span id="BiCM.get_plambda_block-549"><a href="#BiCM.get_plambda_block-549"><span class="linenos">549</span></a>
</span><span id="BiCM.get_plambda_block-550"><a href="#BiCM.get_plambda_block-550"><span class="linenos">550</span></a><span class="sd">        Given the biadjacency matrix ``biad_mat`` with</span>
</span><span id="BiCM.get_plambda_block-551"><a href="#BiCM.get_plambda_block-551"><span class="linenos">551</span></a><span class="sd">        :math:`\\mathbf{M}_{rc} = p_{rc}`, which describes the probabilities of</span>
</span><span id="BiCM.get_plambda_block-552"><a href="#BiCM.get_plambda_block-552"><span class="linenos">552</span></a><span class="sd">        row-node ``r`` and column-node ``c`` being linked, the method returns</span>
</span><span id="BiCM.get_plambda_block-553"><a href="#BiCM.get_plambda_block-553"><span class="linenos">553</span></a><span class="sd">        the matrix</span>
</span><span id="BiCM.get_plambda_block-554"><a href="#BiCM.get_plambda_block-554"><span class="linenos">554</span></a>
</span><span id="BiCM.get_plambda_block-555"><a href="#BiCM.get_plambda_block-555"><span class="linenos">555</span></a><span class="sd">        :math:`P(\\Lambda)_{ij} = \\left(M_{i\\alpha_1} \\cdot M_{j\\alpha_1},</span>
</span><span id="BiCM.get_plambda_block-556"><a href="#BiCM.get_plambda_block-556"><span class="linenos">556</span></a><span class="sd">        M_{i\\alpha_2} \\cdot M_{j\\alpha_2}, \\ldots\\right),`</span>
</span><span id="BiCM.get_plambda_block-557"><a href="#BiCM.get_plambda_block-557"><span class="linenos">557</span></a>
</span><span id="BiCM.get_plambda_block-558"><a href="#BiCM.get_plambda_block-558"><span class="linenos">558</span></a><span class="sd">        for all the node couples in the interval</span>
</span><span id="BiCM.get_plambda_block-559"><a href="#BiCM.get_plambda_block-559"><span class="linenos">559</span></a><span class="sd">        :math:`\\left[k_1, k_2\\right[`.  :math:`(i, j)` are two **row-nodes**</span>
</span><span id="BiCM.get_plambda_block-560"><a href="#BiCM.get_plambda_block-560"><span class="linenos">560</span></a><span class="sd">        of ``biad_mat`` and :math:`\\alpha_k` runs over the nodes in the</span>
</span><span id="BiCM.get_plambda_block-561"><a href="#BiCM.get_plambda_block-561"><span class="linenos">561</span></a><span class="sd">        opposite layer.</span>
</span><span id="BiCM.get_plambda_block-562"><a href="#BiCM.get_plambda_block-562"><span class="linenos">562</span></a>
</span><span id="BiCM.get_plambda_block-563"><a href="#BiCM.get_plambda_block-563"><span class="linenos">563</span></a><span class="sd">        .. note::</span>
</span><span id="BiCM.get_plambda_block-564"><a href="#BiCM.get_plambda_block-564"><span class="linenos">564</span></a>
</span><span id="BiCM.get_plambda_block-565"><a href="#BiCM.get_plambda_block-565"><span class="linenos">565</span></a><span class="sd">            * The probabilities are calculated between the **row-nodes** of the</span>
</span><span id="BiCM.get_plambda_block-566"><a href="#BiCM.get_plambda_block-566"><span class="linenos">566</span></a><span class="sd">              input matrix ``biad_mat``.</span>
</span><span id="BiCM.get_plambda_block-567"><a href="#BiCM.get_plambda_block-567"><span class="linenos">567</span></a>
</span><span id="BiCM.get_plambda_block-568"><a href="#BiCM.get_plambda_block-568"><span class="linenos">568</span></a><span class="sd">            * If :math:`k_2 \equiv \\binom{biad\\_mat.shape[0]}{2}`, the</span>
</span><span id="BiCM.get_plambda_block-569"><a href="#BiCM.get_plambda_block-569"><span class="linenos">569</span></a><span class="sd">              interval becomes :math:`\\left[k1, k2\\right]`.</span>
</span><span id="BiCM.get_plambda_block-570"><a href="#BiCM.get_plambda_block-570"><span class="linenos">570</span></a>
</span><span id="BiCM.get_plambda_block-571"><a href="#BiCM.get_plambda_block-571"><span class="linenos">571</span></a><span class="sd">        :param biad_mat: biadjacency matrix</span>
</span><span id="BiCM.get_plambda_block-572"><a href="#BiCM.get_plambda_block-572"><span class="linenos">572</span></a><span class="sd">        :type biad_mat: numpy.array</span>
</span><span id="BiCM.get_plambda_block-573"><a href="#BiCM.get_plambda_block-573"><span class="linenos">573</span></a><span class="sd">        :param k1: lower interval limit</span>
</span><span id="BiCM.get_plambda_block-574"><a href="#BiCM.get_plambda_block-574"><span class="linenos">574</span></a><span class="sd">        :type k1: int</span>
</span><span id="BiCM.get_plambda_block-575"><a href="#BiCM.get_plambda_block-575"><span class="linenos">575</span></a><span class="sd">        :param k2: upper interval limit</span>
</span><span id="BiCM.get_plambda_block-576"><a href="#BiCM.get_plambda_block-576"><span class="linenos">576</span></a><span class="sd">        :type k2: int</span>
</span><span id="BiCM.get_plambda_block-577"><a href="#BiCM.get_plambda_block-577"><span class="linenos">577</span></a><span class="sd">        :returns: :math:`\\Lambda`-motif probability matrix</span>
</span><span id="BiCM.get_plambda_block-578"><a href="#BiCM.get_plambda_block-578"><span class="linenos">578</span></a><span class="sd">        :rtype: numpy.array</span>
</span><span id="BiCM.get_plambda_block-579"><a href="#BiCM.get_plambda_block-579"><span class="linenos">579</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="BiCM.get_plambda_block-580"><a href="#BiCM.get_plambda_block-580"><span class="linenos">580</span></a>        <span class="p">[</span><span class="n">ndim1</span><span class="p">,</span> <span class="n">ndim2</span><span class="p">]</span> <span class="o">=</span> <span class="n">biad_mat</span><span class="o">.</span><span class="n">shape</span>
</span><span id="BiCM.get_plambda_block-581"><a href="#BiCM.get_plambda_block-581"><span class="linenos">581</span></a>        <span class="c1"># if the upper limit is the largest possible index, i.e. corresponds to</span>
</span><span id="BiCM.get_plambda_block-582"><a href="#BiCM.get_plambda_block-582"><span class="linenos">582</span></a>        <span class="c1"># the node couple (ndim - 2, ndim - 1), where node indices start from 0,</span>
</span><span id="BiCM.get_plambda_block-583"><a href="#BiCM.get_plambda_block-583"><span class="linenos">583</span></a>        <span class="c1"># include the result</span>
</span><span id="BiCM.get_plambda_block-584"><a href="#BiCM.get_plambda_block-584"><span class="linenos">584</span></a>        <span class="k">if</span> <span class="n">k2</span> <span class="o">==</span> <span class="p">(</span><span class="n">ndim1</span> <span class="o">*</span> <span class="p">(</span><span class="n">ndim1</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
</span><span id="BiCM.get_plambda_block-585"><a href="#BiCM.get_plambda_block-585"><span class="linenos">585</span></a>            <span class="n">flag</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="BiCM.get_plambda_block-586"><a href="#BiCM.get_plambda_block-586"><span class="linenos">586</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="BiCM.get_plambda_block-587"><a href="#BiCM.get_plambda_block-587"><span class="linenos">587</span></a>            <span class="n">flag</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="BiCM.get_plambda_block-588"><a href="#BiCM.get_plambda_block-588"><span class="linenos">588</span></a>        <span class="n">paux</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="n">k2</span> <span class="o">-</span> <span class="n">k1</span> <span class="o">+</span> <span class="n">flag</span><span class="p">,</span> <span class="n">ndim2</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;float&#39;</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mf">0.1</span><span class="p">)</span>
</span><span id="BiCM.get_plambda_block-589"><a href="#BiCM.get_plambda_block-589"><span class="linenos">589</span></a>        <span class="p">[</span><span class="n">i1</span><span class="p">,</span> <span class="n">j1</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">flat2triumat_idx</span><span class="p">(</span><span class="n">k1</span><span class="p">,</span> <span class="n">ndim1</span><span class="p">)</span>
</span><span id="BiCM.get_plambda_block-590"><a href="#BiCM.get_plambda_block-590"><span class="linenos">590</span></a>        <span class="p">[</span><span class="n">i2</span><span class="p">,</span> <span class="n">j2</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">flat2triumat_idx</span><span class="p">(</span><span class="n">k2</span><span class="p">,</span> <span class="n">ndim1</span><span class="p">)</span>
</span><span id="BiCM.get_plambda_block-591"><a href="#BiCM.get_plambda_block-591"><span class="linenos">591</span></a>
</span><span id="BiCM.get_plambda_block-592"><a href="#BiCM.get_plambda_block-592"><span class="linenos">592</span></a>        <span class="c1"># if limits have the same row index</span>
</span><span id="BiCM.get_plambda_block-593"><a href="#BiCM.get_plambda_block-593"><span class="linenos">593</span></a>        <span class="k">if</span> <span class="n">i1</span> <span class="o">==</span> <span class="n">i2</span><span class="p">:</span>
</span><span id="BiCM.get_plambda_block-594"><a href="#BiCM.get_plambda_block-594"><span class="linenos">594</span></a>            <span class="n">paux</span><span class="p">[:</span><span class="n">k2</span> <span class="o">-</span> <span class="n">k1</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">biad_mat</span><span class="p">[</span><span class="n">i1</span><span class="p">,</span> <span class="p">]</span> <span class="o">*</span> <span class="n">biad_mat</span><span class="p">[</span><span class="n">j1</span><span class="p">:</span><span class="n">j2</span><span class="p">,</span> <span class="p">:]</span>
</span><span id="BiCM.get_plambda_block-595"><a href="#BiCM.get_plambda_block-595"><span class="linenos">595</span></a>        <span class="c1"># if limits have different indices</span>
</span><span id="BiCM.get_plambda_block-596"><a href="#BiCM.get_plambda_block-596"><span class="linenos">596</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="BiCM.get_plambda_block-597"><a href="#BiCM.get_plambda_block-597"><span class="linenos">597</span></a>            <span class="n">k</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="BiCM.get_plambda_block-598"><a href="#BiCM.get_plambda_block-598"><span class="linenos">598</span></a>            <span class="c1"># get values for lower limit row</span>
</span><span id="BiCM.get_plambda_block-599"><a href="#BiCM.get_plambda_block-599"><span class="linenos">599</span></a>            <span class="n">fi</span> <span class="o">=</span> <span class="n">biad_mat</span><span class="p">[</span><span class="n">i1</span><span class="p">,</span> <span class="p">:]</span> <span class="o">*</span> <span class="n">biad_mat</span><span class="p">[</span><span class="n">j1</span><span class="p">:,</span> <span class="p">:]</span>
</span><span id="BiCM.get_plambda_block-600"><a href="#BiCM.get_plambda_block-600"><span class="linenos">600</span></a>            <span class="n">paux</span><span class="p">[:</span><span class="nb">len</span><span class="p">(</span><span class="n">fi</span><span class="p">),</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">fi</span>
</span><span id="BiCM.get_plambda_block-601"><a href="#BiCM.get_plambda_block-601"><span class="linenos">601</span></a>            <span class="n">k</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">fi</span><span class="p">)</span>
</span><span id="BiCM.get_plambda_block-602"><a href="#BiCM.get_plambda_block-602"><span class="linenos">602</span></a>            <span class="c1"># get values for intermediate rows</span>
</span><span id="BiCM.get_plambda_block-603"><a href="#BiCM.get_plambda_block-603"><span class="linenos">603</span></a>            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i1</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">i2</span><span class="p">):</span>
</span><span id="BiCM.get_plambda_block-604"><a href="#BiCM.get_plambda_block-604"><span class="linenos">604</span></a>                <span class="n">mid</span> <span class="o">=</span> <span class="n">biad_mat</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span> <span class="o">*</span> <span class="n">biad_mat</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:,</span> <span class="p">:]</span>
</span><span id="BiCM.get_plambda_block-605"><a href="#BiCM.get_plambda_block-605"><span class="linenos">605</span></a>                <span class="n">paux</span><span class="p">[</span><span class="n">k</span> <span class="p">:</span> <span class="n">k</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">mid</span><span class="p">),</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">mid</span>
</span><span id="BiCM.get_plambda_block-606"><a href="#BiCM.get_plambda_block-606"><span class="linenos">606</span></a>                <span class="n">k</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">mid</span><span class="p">)</span>
</span><span id="BiCM.get_plambda_block-607"><a href="#BiCM.get_plambda_block-607"><span class="linenos">607</span></a>            <span class="c1"># get values for upper limit row</span>
</span><span id="BiCM.get_plambda_block-608"><a href="#BiCM.get_plambda_block-608"><span class="linenos">608</span></a>            <span class="k">if</span> <span class="n">flag</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="BiCM.get_plambda_block-609"><a href="#BiCM.get_plambda_block-609"><span class="linenos">609</span></a>                <span class="n">paux</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">biad_mat</span><span class="p">[</span><span class="n">ndim1</span> <span class="o">-</span> <span class="mi">2</span><span class="p">,</span> <span class="p">:]</span> <span class="o">*</span> <span class="n">biad_mat</span><span class="p">[</span><span class="n">ndim1</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="p">:]</span>
</span><span id="BiCM.get_plambda_block-610"><a href="#BiCM.get_plambda_block-610"><span class="linenos">610</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="BiCM.get_plambda_block-611"><a href="#BiCM.get_plambda_block-611"><span class="linenos">611</span></a>                <span class="n">la</span> <span class="o">=</span> <span class="n">biad_mat</span><span class="p">[</span><span class="n">i2</span><span class="p">,</span> <span class="p">:]</span> <span class="o">*</span> <span class="n">biad_mat</span><span class="p">[</span><span class="n">i2</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:</span><span class="n">j2</span><span class="p">,</span> <span class="p">:]</span>
</span><span id="BiCM.get_plambda_block-612"><a href="#BiCM.get_plambda_block-612"><span class="linenos">612</span></a>                <span class="n">paux</span><span class="p">[</span><span class="n">k</span><span class="p">:,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">la</span>
</span><span id="BiCM.get_plambda_block-613"><a href="#BiCM.get_plambda_block-613"><span class="linenos">613</span></a>        <span class="k">return</span> <span class="n">paux</span>
</span></pre></div>


            <div class="docstring"><p>Return a subset of the \( \Lambda \) probability matrix.</p>

<p>Given the biadjacency matrix <code>biad_mat</code> with
\( \mathbf{M}_{rc} = p_{rc} \), which describes the probabilities of
row-node <code>r</code> and column-node <code>c</code> being linked, the method returns
the matrix</p>

<p>:math:<code>P(\Lambda)_{ij} = \left(M_{i\alpha_1} \cdot M_{j\alpha_1},
M_{i\alpha_2} \cdot M_{j\alpha_2}, \ldots\right),</code></p>

<p>for all the node couples in the interval
\( \left[k_1, k_2\right[ \).  \( (i, j) \) are two <strong>row-nodes</strong>
of <code>biad_mat</code> and \( \alpha_k \) runs over the nodes in the
opposite layer.</p>

<div class="pdoc-alert pdoc-alert-note">

<ul>
<li><p>The probabilities are calculated between the <strong>row-nodes</strong> of the
input matrix <code>biad_mat</code>.</p></li>
<li><p>If \( k_2 \equiv \binom{biad_mat.shape[0]}{2} \), the
interval becomes \( \left[k1, k2\right] \).</p></li>
</ul>

</div>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>biad_mat</strong>:  biadjacency matrix</li>
<li><strong>k1</strong>:  lower interval limit</li>
<li><strong>k2</strong>:  upper interval limit
:returns: \( \Lambda \)-motif probability matrix</li>
</ul>
</div>


                            </div>
                            <div id="BiCM.get_pvalues_q" class="classattr">
                                        <input id="BiCM.get_pvalues_q-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_pvalues_q</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">plam_mat</span>, </span><span class="param"><span class="n">nlam_mat</span>, </span><span class="param"><span class="n">k1</span>, </span><span class="param"><span class="n">k2</span>, </span><span class="param"><span class="n">parallel</span><span class="o">=</span><span class="kc">True</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="BiCM.get_pvalues_q-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#BiCM.get_pvalues_q"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="BiCM.get_pvalues_q-615"><a href="#BiCM.get_pvalues_q-615"><span class="linenos">615</span></a>    <span class="k">def</span> <span class="nf">get_pvalues_q</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">plam_mat</span><span class="p">,</span> <span class="n">nlam_mat</span><span class="p">,</span> <span class="n">k1</span><span class="p">,</span> <span class="n">k2</span><span class="p">,</span> <span class="n">parallel</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
</span><span id="BiCM.get_pvalues_q-616"><a href="#BiCM.get_pvalues_q-616"><span class="linenos">616</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Calculate the p-values of the observed :math:`\\Lambda`-motifs.</span>
</span><span id="BiCM.get_pvalues_q-617"><a href="#BiCM.get_pvalues_q-617"><span class="linenos">617</span></a>
</span><span id="BiCM.get_pvalues_q-618"><a href="#BiCM.get_pvalues_q-618"><span class="linenos">618</span></a><span class="sd">        For each number of :math:`\\Lambda`-motifs in ``nlam_mat`` for the node</span>
</span><span id="BiCM.get_pvalues_q-619"><a href="#BiCM.get_pvalues_q-619"><span class="linenos">619</span></a><span class="sd">        interval :math:`\\left[k1, k2\\right[`, construct the Poisson Binomial</span>
</span><span id="BiCM.get_pvalues_q-620"><a href="#BiCM.get_pvalues_q-620"><span class="linenos">620</span></a><span class="sd">        distribution using the corresponding</span>
</span><span id="BiCM.get_pvalues_q-621"><a href="#BiCM.get_pvalues_q-621"><span class="linenos">621</span></a><span class="sd">        probabilities in ``plam_mat`` and calculate the p-value.</span>
</span><span id="BiCM.get_pvalues_q-622"><a href="#BiCM.get_pvalues_q-622"><span class="linenos">622</span></a>
</span><span id="BiCM.get_pvalues_q-623"><a href="#BiCM.get_pvalues_q-623"><span class="linenos">623</span></a><span class="sd">        :param plam_mat: array containing the list of probabilities for the</span>
</span><span id="BiCM.get_pvalues_q-624"><a href="#BiCM.get_pvalues_q-624"><span class="linenos">624</span></a><span class="sd">            single observations of :math:`\\Lambda`-motifs</span>
</span><span id="BiCM.get_pvalues_q-625"><a href="#BiCM.get_pvalues_q-625"><span class="linenos">625</span></a><span class="sd">        :type plam_mat: numpy.array (square matrix)</span>
</span><span id="BiCM.get_pvalues_q-626"><a href="#BiCM.get_pvalues_q-626"><span class="linenos">626</span></a><span class="sd">        :param nlam_mat: array containing the observations of</span>
</span><span id="BiCM.get_pvalues_q-627"><a href="#BiCM.get_pvalues_q-627"><span class="linenos">627</span></a><span class="sd">            :math:`\\Lambda`-motifs</span>
</span><span id="BiCM.get_pvalues_q-628"><a href="#BiCM.get_pvalues_q-628"><span class="linenos">628</span></a><span class="sd">        :type nlam_mat: numpy.array (square matrix)</span>
</span><span id="BiCM.get_pvalues_q-629"><a href="#BiCM.get_pvalues_q-629"><span class="linenos">629</span></a><span class="sd">        :param k1: lower interval limit</span>
</span><span id="BiCM.get_pvalues_q-630"><a href="#BiCM.get_pvalues_q-630"><span class="linenos">630</span></a><span class="sd">        :type k1: int</span>
</span><span id="BiCM.get_pvalues_q-631"><a href="#BiCM.get_pvalues_q-631"><span class="linenos">631</span></a><span class="sd">        :param k2: upper interval limit</span>
</span><span id="BiCM.get_pvalues_q-632"><a href="#BiCM.get_pvalues_q-632"><span class="linenos">632</span></a><span class="sd">        :type k2: int</span>
</span><span id="BiCM.get_pvalues_q-633"><a href="#BiCM.get_pvalues_q-633"><span class="linenos">633</span></a><span class="sd">        :param parallel: if ``True``, the calculation is executed in parallel;</span>
</span><span id="BiCM.get_pvalues_q-634"><a href="#BiCM.get_pvalues_q-634"><span class="linenos">634</span></a><span class="sd">            if ``False``, only one process is started</span>
</span><span id="BiCM.get_pvalues_q-635"><a href="#BiCM.get_pvalues_q-635"><span class="linenos">635</span></a><span class="sd">        :type parallel: bool</span>
</span><span id="BiCM.get_pvalues_q-636"><a href="#BiCM.get_pvalues_q-636"><span class="linenos">636</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="BiCM.get_pvalues_q-637"><a href="#BiCM.get_pvalues_q-637"><span class="linenos">637</span></a>        <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">nlam_mat</span><span class="p">)</span>
</span><span id="BiCM.get_pvalues_q-638"><a href="#BiCM.get_pvalues_q-638"><span class="linenos">638</span></a>        <span class="c1"># the array must be sharable to be accessible by all processes</span>
</span><span id="BiCM.get_pvalues_q-639"><a href="#BiCM.get_pvalues_q-639"><span class="linenos">639</span></a>        <span class="n">shared_array_base</span> <span class="o">=</span> <span class="n">multiprocessing</span><span class="o">.</span><span class="n">Array</span><span class="p">(</span><span class="n">ctypes</span><span class="o">.</span><span class="n">c_double</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
</span><span id="BiCM.get_pvalues_q-640"><a href="#BiCM.get_pvalues_q-640"><span class="linenos">640</span></a>        <span class="n">pval_mat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">frombuffer</span><span class="p">(</span><span class="n">shared_array_base</span><span class="o">.</span><span class="n">get_obj</span><span class="p">())</span>
</span><span id="BiCM.get_pvalues_q-641"><a href="#BiCM.get_pvalues_q-641"><span class="linenos">641</span></a>
</span><span id="BiCM.get_pvalues_q-642"><a href="#BiCM.get_pvalues_q-642"><span class="linenos">642</span></a>        <span class="c1"># number of processes running in parallel has to be tested.</span>
</span><span id="BiCM.get_pvalues_q-643"><a href="#BiCM.get_pvalues_q-643"><span class="linenos">643</span></a>        <span class="c1"># good guess is multiprocessing.cpu_count() +- 1</span>
</span><span id="BiCM.get_pvalues_q-644"><a href="#BiCM.get_pvalues_q-644"><span class="linenos">644</span></a>        <span class="k">if</span> <span class="n">parallel</span><span class="p">:</span>
</span><span id="BiCM.get_pvalues_q-645"><a href="#BiCM.get_pvalues_q-645"><span class="linenos">645</span></a>            <span class="n">num_procs</span> <span class="o">=</span> <span class="n">multiprocessing</span><span class="o">.</span><span class="n">cpu_count</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span>
</span><span id="BiCM.get_pvalues_q-646"><a href="#BiCM.get_pvalues_q-646"><span class="linenos">646</span></a>        <span class="k">elif</span> <span class="ow">not</span> <span class="n">parallel</span><span class="p">:</span>
</span><span id="BiCM.get_pvalues_q-647"><a href="#BiCM.get_pvalues_q-647"><span class="linenos">647</span></a>            <span class="n">num_procs</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="BiCM.get_pvalues_q-648"><a href="#BiCM.get_pvalues_q-648"><span class="linenos">648</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="BiCM.get_pvalues_q-649"><a href="#BiCM.get_pvalues_q-649"><span class="linenos">649</span></a>            <span class="n">num_procs</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="BiCM.get_pvalues_q-650"><a href="#BiCM.get_pvalues_q-650"><span class="linenos">650</span></a>
</span><span id="BiCM.get_pvalues_q-651"><a href="#BiCM.get_pvalues_q-651"><span class="linenos">651</span></a>        <span class="c1"># create 2 queues</span>
</span><span id="BiCM.get_pvalues_q-652"><a href="#BiCM.get_pvalues_q-652"><span class="linenos">652</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">input_queue</span> <span class="o">=</span> <span class="n">multiprocessing</span><span class="o">.</span><span class="n">Queue</span><span class="p">()</span>
</span><span id="BiCM.get_pvalues_q-653"><a href="#BiCM.get_pvalues_q-653"><span class="linenos">653</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">output_queue</span> <span class="o">=</span> <span class="n">multiprocessing</span><span class="o">.</span><span class="n">Queue</span><span class="p">()</span>
</span><span id="BiCM.get_pvalues_q-654"><a href="#BiCM.get_pvalues_q-654"><span class="linenos">654</span></a>
</span><span id="BiCM.get_pvalues_q-655"><a href="#BiCM.get_pvalues_q-655"><span class="linenos">655</span></a>        <span class="c1"># (1) add tuples of matrix elements and indices to the input queue</span>
</span><span id="BiCM.get_pvalues_q-656"><a href="#BiCM.get_pvalues_q-656"><span class="linenos">656</span></a>        <span class="n">p_inqueue</span> <span class="o">=</span> <span class="n">multiprocessing</span><span class="o">.</span><span class="n">Process</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">add2inqueue</span><span class="p">,</span>
</span><span id="BiCM.get_pvalues_q-657"><a href="#BiCM.get_pvalues_q-657"><span class="linenos">657</span></a>                                            <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">num_procs</span><span class="p">,</span> <span class="n">plam_mat</span><span class="p">,</span> <span class="n">nlam_mat</span><span class="p">,</span>
</span><span id="BiCM.get_pvalues_q-658"><a href="#BiCM.get_pvalues_q-658"><span class="linenos">658</span></a>                                                <span class="n">k1</span><span class="p">,</span> <span class="n">k2</span><span class="p">))</span>
</span><span id="BiCM.get_pvalues_q-659"><a href="#BiCM.get_pvalues_q-659"><span class="linenos">659</span></a>
</span><span id="BiCM.get_pvalues_q-660"><a href="#BiCM.get_pvalues_q-660"><span class="linenos">660</span></a>
</span><span id="BiCM.get_pvalues_q-661"><a href="#BiCM.get_pvalues_q-661"><span class="linenos">661</span></a>        <span class="n">pval_mat</span> <span class="o">=</span> <span class="n">multiprocessing</span><span class="o">.</span><span class="n">Array</span><span class="p">(</span><span class="s1">&#39;d&#39;</span><span class="p">,</span> <span class="n">pval_mat</span><span class="p">)</span>
</span><span id="BiCM.get_pvalues_q-662"><a href="#BiCM.get_pvalues_q-662"><span class="linenos">662</span></a>
</span><span id="BiCM.get_pvalues_q-663"><a href="#BiCM.get_pvalues_q-663"><span class="linenos">663</span></a>        <span class="c1">#  (2) Put the results from the out-queue into the p-value array.</span>
</span><span id="BiCM.get_pvalues_q-664"><a href="#BiCM.get_pvalues_q-664"><span class="linenos">664</span></a>        <span class="n">p_outqueue</span> <span class="o">=</span> <span class="n">multiprocessing</span><span class="o">.</span><span class="n">Process</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">outqueue2pval_mat</span><span class="p">,</span>
</span><span id="BiCM.get_pvalues_q-665"><a href="#BiCM.get_pvalues_q-665"><span class="linenos">665</span></a>                                             <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">num_procs</span><span class="p">,</span> <span class="n">pval_mat</span><span class="p">))</span>
</span><span id="BiCM.get_pvalues_q-666"><a href="#BiCM.get_pvalues_q-666"><span class="linenos">666</span></a>
</span><span id="BiCM.get_pvalues_q-667"><a href="#BiCM.get_pvalues_q-667"><span class="linenos">667</span></a>        <span class="c1"># (3) pval computer...</span>
</span><span id="BiCM.get_pvalues_q-668"><a href="#BiCM.get_pvalues_q-668"><span class="linenos">668</span></a>        <span class="n">ps</span> <span class="o">=</span> <span class="p">[</span><span class="n">multiprocessing</span><span class="o">.</span><span class="n">Process</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">pval_process_worker</span><span class="p">,</span>
</span><span id="BiCM.get_pvalues_q-669"><a href="#BiCM.get_pvalues_q-669"><span class="linenos">669</span></a>                                      <span class="n">args</span><span class="o">=</span><span class="p">())</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_procs</span><span class="p">)]</span>
</span><span id="BiCM.get_pvalues_q-670"><a href="#BiCM.get_pvalues_q-670"><span class="linenos">670</span></a>
</span><span id="BiCM.get_pvalues_q-671"><a href="#BiCM.get_pvalues_q-671"><span class="linenos">671</span></a>        <span class="c1"># start queues</span>
</span><span id="BiCM.get_pvalues_q-672"><a href="#BiCM.get_pvalues_q-672"><span class="linenos">672</span></a>        <span class="n">p_inqueue</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
</span><span id="BiCM.get_pvalues_q-673"><a href="#BiCM.get_pvalues_q-673"><span class="linenos">673</span></a>        <span class="n">p_outqueue</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
</span><span id="BiCM.get_pvalues_q-674"><a href="#BiCM.get_pvalues_q-674"><span class="linenos">674</span></a>
</span><span id="BiCM.get_pvalues_q-675"><a href="#BiCM.get_pvalues_q-675"><span class="linenos">675</span></a>        <span class="c1"># start processes</span>
</span><span id="BiCM.get_pvalues_q-676"><a href="#BiCM.get_pvalues_q-676"><span class="linenos">676</span></a>        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">ps</span><span class="p">:</span>
</span><span id="BiCM.get_pvalues_q-677"><a href="#BiCM.get_pvalues_q-677"><span class="linenos">677</span></a>            <span class="n">p</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>       <span class="c1"># each process has an id, p.pid</span>
</span><span id="BiCM.get_pvalues_q-678"><a href="#BiCM.get_pvalues_q-678"><span class="linenos">678</span></a>        <span class="n">p_inqueue</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>
</span><span id="BiCM.get_pvalues_q-679"><a href="#BiCM.get_pvalues_q-679"><span class="linenos">679</span></a>
</span><span id="BiCM.get_pvalues_q-680"><a href="#BiCM.get_pvalues_q-680"><span class="linenos">680</span></a>        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">ps</span><span class="p">:</span>
</span><span id="BiCM.get_pvalues_q-681"><a href="#BiCM.get_pvalues_q-681"><span class="linenos">681</span></a>            <span class="n">p</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>
</span><span id="BiCM.get_pvalues_q-682"><a href="#BiCM.get_pvalues_q-682"><span class="linenos">682</span></a>        <span class="n">p_outqueue</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>
</span><span id="BiCM.get_pvalues_q-683"><a href="#BiCM.get_pvalues_q-683"><span class="linenos">683</span></a>
</span><span id="BiCM.get_pvalues_q-684"><a href="#BiCM.get_pvalues_q-684"><span class="linenos">684</span></a>        <span class="c1">#print(&#39;final matrix:&#39;)</span>
</span><span id="BiCM.get_pvalues_q-685"><a href="#BiCM.get_pvalues_q-685"><span class="linenos">685</span></a>        <span class="n">pval_mat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">frombuffer</span><span class="p">(</span><span class="n">pval_mat</span><span class="o">.</span><span class="n">get_obj</span><span class="p">(),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
</span><span id="BiCM.get_pvalues_q-686"><a href="#BiCM.get_pvalues_q-686"><span class="linenos">686</span></a>        <span class="c1">#for i in range(len(pval_mat)):</span>
</span><span id="BiCM.get_pvalues_q-687"><a href="#BiCM.get_pvalues_q-687"><span class="linenos">687</span></a>        <span class="c1">#    value = pval_mat[i]</span>
</span><span id="BiCM.get_pvalues_q-688"><a href="#BiCM.get_pvalues_q-688"><span class="linenos">688</span></a>        <span class="c1">#    print(value)</span>
</span><span id="BiCM.get_pvalues_q-689"><a href="#BiCM.get_pvalues_q-689"><span class="linenos">689</span></a>        <span class="c1">#print(&#39;--------&#39;)</span>
</span><span id="BiCM.get_pvalues_q-690"><a href="#BiCM.get_pvalues_q-690"><span class="linenos">690</span></a>        <span class="c1">#print(pval_mat)</span>
</span><span id="BiCM.get_pvalues_q-691"><a href="#BiCM.get_pvalues_q-691"><span class="linenos">691</span></a>        <span class="c1">#print(&#39;-------&#39;)</span>
</span><span id="BiCM.get_pvalues_q-692"><a href="#BiCM.get_pvalues_q-692"><span class="linenos">692</span></a>
</span><span id="BiCM.get_pvalues_q-693"><a href="#BiCM.get_pvalues_q-693"><span class="linenos">693</span></a>
</span><span id="BiCM.get_pvalues_q-694"><a href="#BiCM.get_pvalues_q-694"><span class="linenos">694</span></a>        <span class="k">return</span> <span class="n">pval_mat</span>
</span></pre></div>


            <div class="docstring"><p>Calculate the p-values of the observed \( \Lambda \)-motifs.</p>

<p>For each number of \( \Lambda \)-motifs in <code>nlam_mat</code> for the node
interval \( \left[k1, k2\right[ \), construct the Poisson Binomial
distribution using the corresponding
probabilities in <code>plam_mat</code> and calculate the p-value.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>plam_mat</strong>:  array containing the list of probabilities for the
single observations of \( \Lambda \)-motifs</li>
<li><strong>nlam_mat</strong>:  array containing the observations of
\( \Lambda \)-motifs</li>
<li><strong>k1</strong>:  lower interval limit</li>
<li><strong>k2</strong>:  upper interval limit</li>
<li><strong>parallel</strong>:  if <code>True</code>, the calculation is executed in parallel;
if <code>False</code>, only one process is started</li>
</ul>
</div>


                            </div>
                            <div id="BiCM.add2inqueue" class="classattr">
                                        <input id="BiCM.add2inqueue-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">add2inqueue</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">nprocs</span>, </span><span class="param"><span class="n">plam_mat</span>, </span><span class="param"><span class="n">nlam_mat</span>, </span><span class="param"><span class="n">k1</span>, </span><span class="param"><span class="n">k2</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="BiCM.add2inqueue-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#BiCM.add2inqueue"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="BiCM.add2inqueue-696"><a href="#BiCM.add2inqueue-696"><span class="linenos">696</span></a>    <span class="k">def</span> <span class="nf">add2inqueue</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nprocs</span><span class="p">,</span> <span class="n">plam_mat</span><span class="p">,</span> <span class="n">nlam_mat</span><span class="p">,</span> <span class="n">k1</span><span class="p">,</span> <span class="n">k2</span><span class="p">):</span>
</span><span id="BiCM.add2inqueue-697"><a href="#BiCM.add2inqueue-697"><span class="linenos">697</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Add elements to the in-queue to calculate the p-values.</span>
</span><span id="BiCM.add2inqueue-698"><a href="#BiCM.add2inqueue-698"><span class="linenos">698</span></a>
</span><span id="BiCM.add2inqueue-699"><a href="#BiCM.add2inqueue-699"><span class="linenos">699</span></a><span class="sd">        :param nprocs: number of processes running in parallel</span>
</span><span id="BiCM.add2inqueue-700"><a href="#BiCM.add2inqueue-700"><span class="linenos">700</span></a><span class="sd">        :type nprocs: int</span>
</span><span id="BiCM.add2inqueue-701"><a href="#BiCM.add2inqueue-701"><span class="linenos">701</span></a><span class="sd">        :param plam_mat: array containing the list of probabilities for the</span>
</span><span id="BiCM.add2inqueue-702"><a href="#BiCM.add2inqueue-702"><span class="linenos">702</span></a><span class="sd">            single observations of :math:`\\Lambda`-motifs</span>
</span><span id="BiCM.add2inqueue-703"><a href="#BiCM.add2inqueue-703"><span class="linenos">703</span></a><span class="sd">        :type plam_mat: numpy.array (square matrix)</span>
</span><span id="BiCM.add2inqueue-704"><a href="#BiCM.add2inqueue-704"><span class="linenos">704</span></a><span class="sd">        :param nlam_mat: array containing the observations of</span>
</span><span id="BiCM.add2inqueue-705"><a href="#BiCM.add2inqueue-705"><span class="linenos">705</span></a><span class="sd">            :math:`\\Lambda`-motifs</span>
</span><span id="BiCM.add2inqueue-706"><a href="#BiCM.add2inqueue-706"><span class="linenos">706</span></a><span class="sd">        :type nlam_mat: numpy.array (square matrix)</span>
</span><span id="BiCM.add2inqueue-707"><a href="#BiCM.add2inqueue-707"><span class="linenos">707</span></a><span class="sd">        :param k1: lower interval limit</span>
</span><span id="BiCM.add2inqueue-708"><a href="#BiCM.add2inqueue-708"><span class="linenos">708</span></a><span class="sd">        :type k1: int</span>
</span><span id="BiCM.add2inqueue-709"><a href="#BiCM.add2inqueue-709"><span class="linenos">709</span></a><span class="sd">        :param k2: upper interval limit</span>
</span><span id="BiCM.add2inqueue-710"><a href="#BiCM.add2inqueue-710"><span class="linenos">710</span></a><span class="sd">        :type k2: int</span>
</span><span id="BiCM.add2inqueue-711"><a href="#BiCM.add2inqueue-711"><span class="linenos">711</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="BiCM.add2inqueue-712"><a href="#BiCM.add2inqueue-712"><span class="linenos">712</span></a>        <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">plam_mat</span><span class="p">)</span>
</span><span id="BiCM.add2inqueue-713"><a href="#BiCM.add2inqueue-713"><span class="linenos">713</span></a>        <span class="c1"># add tuples of matrix elements and indices to the input queue</span>
</span><span id="BiCM.add2inqueue-714"><a href="#BiCM.add2inqueue-714"><span class="linenos">714</span></a>        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">k1</span><span class="p">,</span> <span class="n">k2</span><span class="p">):</span>
</span><span id="BiCM.add2inqueue-715"><a href="#BiCM.add2inqueue-715"><span class="linenos">715</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">input_queue</span><span class="o">.</span><span class="n">put</span><span class="p">((</span><span class="n">k</span> <span class="o">-</span> <span class="n">k1</span><span class="p">,</span> <span class="n">plam_mat</span><span class="p">[</span><span class="n">k</span> <span class="o">-</span> <span class="n">k1</span><span class="p">,</span> <span class="p">:],</span>
</span><span id="BiCM.add2inqueue-716"><a href="#BiCM.add2inqueue-716"><span class="linenos">716</span></a>                                  <span class="n">nlam_mat</span><span class="p">[</span><span class="n">k</span> <span class="o">-</span> <span class="n">k1</span><span class="p">]))</span>
</span><span id="BiCM.add2inqueue-717"><a href="#BiCM.add2inqueue-717"><span class="linenos">717</span></a>
</span><span id="BiCM.add2inqueue-718"><a href="#BiCM.add2inqueue-718"><span class="linenos">718</span></a>        <span class="c1"># add as many poison pills &quot;STOP&quot; to the queue as there are workers</span>
</span><span id="BiCM.add2inqueue-719"><a href="#BiCM.add2inqueue-719"><span class="linenos">719</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nprocs</span><span class="p">):</span>
</span><span id="BiCM.add2inqueue-720"><a href="#BiCM.add2inqueue-720"><span class="linenos">720</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">input_queue</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="s2">&quot;STOP&quot;</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Add elements to the in-queue to calculate the p-values.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>nprocs</strong>:  number of processes running in parallel</li>
<li><strong>plam_mat</strong>:  array containing the list of probabilities for the
single observations of \( \Lambda \)-motifs</li>
<li><strong>nlam_mat</strong>:  array containing the observations of
\( \Lambda \)-motifs</li>
<li><strong>k1</strong>:  lower interval limit</li>
<li><strong>k2</strong>:  upper interval limit</li>
</ul>
</div>


                            </div>
                            <div id="BiCM.pval_process_worker" class="classattr">
                                        <input id="BiCM.pval_process_worker-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">pval_process_worker</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="BiCM.pval_process_worker-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#BiCM.pval_process_worker"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="BiCM.pval_process_worker-722"><a href="#BiCM.pval_process_worker-722"><span class="linenos">722</span></a>    <span class="k">def</span> <span class="nf">pval_process_worker</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="BiCM.pval_process_worker-723"><a href="#BiCM.pval_process_worker-723"><span class="linenos">723</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Calculate p-values and add them to the out-queue.&quot;&quot;&quot;</span>
</span><span id="BiCM.pval_process_worker-724"><a href="#BiCM.pval_process_worker-724"><span class="linenos">724</span></a>        <span class="c1"># take elements from the queue as long as the element is not &quot;STOP&quot;</span>
</span><span id="BiCM.pval_process_worker-725"><a href="#BiCM.pval_process_worker-725"><span class="linenos">725</span></a>        <span class="k">for</span> <span class="n">tupl</span> <span class="ow">in</span> <span class="nb">iter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">input_queue</span><span class="o">.</span><span class="n">get</span><span class="p">,</span> <span class="s2">&quot;STOP&quot;</span><span class="p">):</span>
</span><span id="BiCM.pval_process_worker-726"><a href="#BiCM.pval_process_worker-726"><span class="linenos">726</span></a>            <span class="n">pb</span> <span class="o">=</span> <span class="n">PoiBin</span><span class="p">(</span><span class="n">tupl</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</span><span id="BiCM.pval_process_worker-727"><a href="#BiCM.pval_process_worker-727"><span class="linenos">727</span></a>
</span><span id="BiCM.pval_process_worker-728"><a href="#BiCM.pval_process_worker-728"><span class="linenos">728</span></a>            <span class="n">pv</span> <span class="o">=</span> <span class="n">pb</span><span class="o">.</span><span class="n">pval</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">tupl</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
</span><span id="BiCM.pval_process_worker-729"><a href="#BiCM.pval_process_worker-729"><span class="linenos">729</span></a>            <span class="c1">#print(&#39;loc {}, pval computed: {}&#39;.format(pb, pv))</span>
</span><span id="BiCM.pval_process_worker-730"><a href="#BiCM.pval_process_worker-730"><span class="linenos">730</span></a>            <span class="c1"># add the result to the output queue</span>
</span><span id="BiCM.pval_process_worker-731"><a href="#BiCM.pval_process_worker-731"><span class="linenos">731</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">output_queue</span><span class="o">.</span><span class="n">put</span><span class="p">((</span><span class="n">tupl</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">pv</span><span class="p">))</span>
</span><span id="BiCM.pval_process_worker-732"><a href="#BiCM.pval_process_worker-732"><span class="linenos">732</span></a>        <span class="c1"># once all the elements in the input queue have been dealt with, add a</span>
</span><span id="BiCM.pval_process_worker-733"><a href="#BiCM.pval_process_worker-733"><span class="linenos">733</span></a>        <span class="c1"># &quot;STOP&quot; to the output queue</span>
</span><span id="BiCM.pval_process_worker-734"><a href="#BiCM.pval_process_worker-734"><span class="linenos">734</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">output_queue</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="s2">&quot;STOP&quot;</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Calculate p-values and add them to the out-queue.</p>
</div>


                            </div>
                            <div id="BiCM.outqueue2pval_mat" class="classattr">
                                        <input id="BiCM.outqueue2pval_mat-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">outqueue2pval_mat</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">nprocs</span>, </span><span class="param"><span class="n">pvalmat</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="BiCM.outqueue2pval_mat-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#BiCM.outqueue2pval_mat"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="BiCM.outqueue2pval_mat-736"><a href="#BiCM.outqueue2pval_mat-736"><span class="linenos">736</span></a>    <span class="k">def</span> <span class="nf">outqueue2pval_mat</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nprocs</span><span class="p">,</span> <span class="n">pvalmat</span><span class="p">):</span>
</span><span id="BiCM.outqueue2pval_mat-737"><a href="#BiCM.outqueue2pval_mat-737"><span class="linenos">737</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Put the results from the out-queue into the p-value array.&quot;&quot;&quot;</span>
</span><span id="BiCM.outqueue2pval_mat-738"><a href="#BiCM.outqueue2pval_mat-738"><span class="linenos">738</span></a>        <span class="c1"># stop the work after having met nprocs times &quot;STOP&quot;</span>
</span><span id="BiCM.outqueue2pval_mat-739"><a href="#BiCM.outqueue2pval_mat-739"><span class="linenos">739</span></a>        <span class="k">for</span> <span class="n">work</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nprocs</span><span class="p">):</span>
</span><span id="BiCM.outqueue2pval_mat-740"><a href="#BiCM.outqueue2pval_mat-740"><span class="linenos">740</span></a>            <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="nb">iter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">output_queue</span><span class="o">.</span><span class="n">get</span><span class="p">,</span> <span class="s2">&quot;STOP&quot;</span><span class="p">):</span>
</span><span id="BiCM.outqueue2pval_mat-741"><a href="#BiCM.outqueue2pval_mat-741"><span class="linenos">741</span></a>                <span class="n">k</span> <span class="o">=</span> <span class="n">val</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="BiCM.outqueue2pval_mat-742"><a href="#BiCM.outqueue2pval_mat-742"><span class="linenos">742</span></a>                <span class="c1">#print(&#39;popping pval from out que:&#39;, val[1])</span>
</span><span id="BiCM.outqueue2pval_mat-743"><a href="#BiCM.outqueue2pval_mat-743"><span class="linenos">743</span></a>                <span class="n">pvalmat</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="BiCM.outqueue2pval_mat-744"><a href="#BiCM.outqueue2pval_mat-744"><span class="linenos">744</span></a>
</span><span id="BiCM.outqueue2pval_mat-745"><a href="#BiCM.outqueue2pval_mat-745"><span class="linenos">745</span></a>        <span class="c1">#print(&#39;final matrix&#39;)</span>
</span><span id="BiCM.outqueue2pval_mat-746"><a href="#BiCM.outqueue2pval_mat-746"><span class="linenos">746</span></a>        <span class="c1">#print(pvalmat)</span>
</span></pre></div>


            <div class="docstring"><p>Put the results from the out-queue into the p-value array.</p>
</div>


                            </div>
                            <div id="BiCM.get_triup_dim" class="classattr">
                                        <input id="BiCM.get_triup_dim-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_triup_dim</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">bip_set</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="BiCM.get_triup_dim-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#BiCM.get_triup_dim"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="BiCM.get_triup_dim-749"><a href="#BiCM.get_triup_dim-749"><span class="linenos">749</span></a>    <span class="k">def</span> <span class="nf">get_triup_dim</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bip_set</span><span class="p">):</span>
</span><span id="BiCM.get_triup_dim-750"><a href="#BiCM.get_triup_dim-750"><span class="linenos">750</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the number of possible node couples in ``bip_set``.</span>
</span><span id="BiCM.get_triup_dim-751"><a href="#BiCM.get_triup_dim-751"><span class="linenos">751</span></a>
</span><span id="BiCM.get_triup_dim-752"><a href="#BiCM.get_triup_dim-752"><span class="linenos">752</span></a><span class="sd">        :param bip_set: selects row-nodes (``True``) or column-nodes</span>
</span><span id="BiCM.get_triup_dim-753"><a href="#BiCM.get_triup_dim-753"><span class="linenos">753</span></a><span class="sd">            (``False``)</span>
</span><span id="BiCM.get_triup_dim-754"><a href="#BiCM.get_triup_dim-754"><span class="linenos">754</span></a><span class="sd">        :type bip_set: bool</span>
</span><span id="BiCM.get_triup_dim-755"><a href="#BiCM.get_triup_dim-755"><span class="linenos">755</span></a><span class="sd">        :returns: return the number of node couple combinations corresponding</span>
</span><span id="BiCM.get_triup_dim-756"><a href="#BiCM.get_triup_dim-756"><span class="linenos">756</span></a><span class="sd">            to the layer ``bip_set``</span>
</span><span id="BiCM.get_triup_dim-757"><a href="#BiCM.get_triup_dim-757"><span class="linenos">757</span></a><span class="sd">        :rtype: int</span>
</span><span id="BiCM.get_triup_dim-758"><a href="#BiCM.get_triup_dim-758"><span class="linenos">758</span></a>
</span><span id="BiCM.get_triup_dim-759"><a href="#BiCM.get_triup_dim-759"><span class="linenos">759</span></a><span class="sd">        :raise ValueError: raise an error if the parameter ``bip_set`` is</span>
</span><span id="BiCM.get_triup_dim-760"><a href="#BiCM.get_triup_dim-760"><span class="linenos">760</span></a><span class="sd">            neither ``True`` nor ``False``</span>
</span><span id="BiCM.get_triup_dim-761"><a href="#BiCM.get_triup_dim-761"><span class="linenos">761</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="BiCM.get_triup_dim-762"><a href="#BiCM.get_triup_dim-762"><span class="linenos">762</span></a>        <span class="k">if</span> <span class="n">bip_set</span><span class="p">:</span>
</span><span id="BiCM.get_triup_dim-763"><a href="#BiCM.get_triup_dim-763"><span class="linenos">763</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">triumat2flat_dim</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_rows</span><span class="p">)</span>
</span><span id="BiCM.get_triup_dim-764"><a href="#BiCM.get_triup_dim-764"><span class="linenos">764</span></a>        <span class="k">elif</span> <span class="ow">not</span> <span class="n">bip_set</span><span class="p">:</span>
</span><span id="BiCM.get_triup_dim-765"><a href="#BiCM.get_triup_dim-765"><span class="linenos">765</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">triumat2flat_dim</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_columns</span><span class="p">)</span>
</span><span id="BiCM.get_triup_dim-766"><a href="#BiCM.get_triup_dim-766"><span class="linenos">766</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="BiCM.get_triup_dim-767"><a href="#BiCM.get_triup_dim-767"><span class="linenos">767</span></a>            <span class="n">errmsg</span> <span class="o">=</span> <span class="s2">&quot;&#39;&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">bip_set</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&#39; &quot;</span> <span class="o">+</span> <span class="s1">&#39;not supported.&#39;</span>
</span><span id="BiCM.get_triup_dim-768"><a href="#BiCM.get_triup_dim-768"><span class="linenos">768</span></a>            <span class="k">raise</span> <span class="ne">NameError</span><span class="p">(</span><span class="n">errmsg</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Return the number of possible node couples in <code>bip_set</code>.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>bip_set</strong>:  selects row-nodes (<code>True</code>) or column-nodes
(<code>False</code>)
:returns: return the number of node couple combinations corresponding
to the layer <code>bip_set</code></li>
</ul>

<p>:raise ValueError: raise an error if the parameter <code>bip_set</code> is
    neither <code>True</code> nor <code>False</code></p>
</div>


                            </div>
                            <div id="BiCM.split_range" class="classattr">
                                        <input id="BiCM.split_range-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">split_range</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">n</span>, </span><span class="param"><span class="n">m</span><span class="o">=</span><span class="mi">4</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="BiCM.split_range-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#BiCM.split_range"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="BiCM.split_range-770"><a href="#BiCM.split_range-770"><span class="linenos">770</span></a>    <span class="k">def</span> <span class="nf">split_range</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">m</span><span class="o">=</span><span class="mi">4</span><span class="p">):</span>
</span><span id="BiCM.split_range-771"><a href="#BiCM.split_range-771"><span class="linenos">771</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Split the interval :math:`\\left[0,\ldots, n\\right]` in ``m`` parts.</span>
</span><span id="BiCM.split_range-772"><a href="#BiCM.split_range-772"><span class="linenos">772</span></a>
</span><span id="BiCM.split_range-773"><a href="#BiCM.split_range-773"><span class="linenos">773</span></a><span class="sd">        :param n: upper limit of the range</span>
</span><span id="BiCM.split_range-774"><a href="#BiCM.split_range-774"><span class="linenos">774</span></a><span class="sd">        :type n: int</span>
</span><span id="BiCM.split_range-775"><a href="#BiCM.split_range-775"><span class="linenos">775</span></a><span class="sd">        :param m: number of part in which range should be split</span>
</span><span id="BiCM.split_range-776"><a href="#BiCM.split_range-776"><span class="linenos">776</span></a><span class="sd">        :type n: int</span>
</span><span id="BiCM.split_range-777"><a href="#BiCM.split_range-777"><span class="linenos">777</span></a><span class="sd">        :returns: delimiter indices for the ``m`` parts</span>
</span><span id="BiCM.split_range-778"><a href="#BiCM.split_range-778"><span class="linenos">778</span></a><span class="sd">        :rtype: list</span>
</span><span id="BiCM.split_range-779"><a href="#BiCM.split_range-779"><span class="linenos">779</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="BiCM.split_range-780"><a href="#BiCM.split_range-780"><span class="linenos">780</span></a>        <span class="k">return</span> <span class="p">[</span><span class="n">i</span> <span class="o">*</span> <span class="n">n</span> <span class="o">/</span> <span class="n">m</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">m</span><span class="p">)]</span>
</span></pre></div>


            <div class="docstring"><p>Split the interval \( \left[0,\ldots, n\right] \) in <code>m</code> parts.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>n</strong>:  upper limit of the range</li>
<li><strong>m</strong>:  number of part in which range should be split
:returns: delimiter indices for the <code>m</code> parts</li>
</ul>
</div>


                            </div>
                            <div id="BiCM.triumat2flat_idx" class="classattr">
                                        <input id="BiCM.triumat2flat_idx-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@staticmethod</div>

        <span class="def">def</span>
        <span class="name">triumat2flat_idx</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">i</span>, </span><span class="param"><span class="n">j</span>, </span><span class="param"><span class="n">n</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="BiCM.triumat2flat_idx-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#BiCM.triumat2flat_idx"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="BiCM.triumat2flat_idx-786"><a href="#BiCM.triumat2flat_idx-786"><span class="linenos">786</span></a>    <span class="nd">@staticmethod</span>
</span><span id="BiCM.triumat2flat_idx-787"><a href="#BiCM.triumat2flat_idx-787"><span class="linenos">787</span></a>    <span class="k">def</span> <span class="nf">triumat2flat_idx</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
</span><span id="BiCM.triumat2flat_idx-788"><a href="#BiCM.triumat2flat_idx-788"><span class="linenos">788</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Convert an matrix index couple to a flattened array index.</span>
</span><span id="BiCM.triumat2flat_idx-789"><a href="#BiCM.triumat2flat_idx-789"><span class="linenos">789</span></a>
</span><span id="BiCM.triumat2flat_idx-790"><a href="#BiCM.triumat2flat_idx-790"><span class="linenos">790</span></a><span class="sd">        Given a square matrix of dimension ``n`` and the index couple</span>
</span><span id="BiCM.triumat2flat_idx-791"><a href="#BiCM.triumat2flat_idx-791"><span class="linenos">791</span></a><span class="sd">        ``(i, j)`` *of the upper triangular part* of the matrix, return the</span>
</span><span id="BiCM.triumat2flat_idx-792"><a href="#BiCM.triumat2flat_idx-792"><span class="linenos">792</span></a><span class="sd">        index which the matrix element would have in a flattened array.</span>
</span><span id="BiCM.triumat2flat_idx-793"><a href="#BiCM.triumat2flat_idx-793"><span class="linenos">793</span></a>
</span><span id="BiCM.triumat2flat_idx-794"><a href="#BiCM.triumat2flat_idx-794"><span class="linenos">794</span></a><span class="sd">        .. note::</span>
</span><span id="BiCM.triumat2flat_idx-795"><a href="#BiCM.triumat2flat_idx-795"><span class="linenos">795</span></a><span class="sd">            * :math:`i \\in [0, ..., n - 1]`</span>
</span><span id="BiCM.triumat2flat_idx-796"><a href="#BiCM.triumat2flat_idx-796"><span class="linenos">796</span></a><span class="sd">            * :math:`j \\in [i + 1, ..., n - 1]`</span>
</span><span id="BiCM.triumat2flat_idx-797"><a href="#BiCM.triumat2flat_idx-797"><span class="linenos">797</span></a><span class="sd">            * returned index :math:`\\in [0,\\, n (n - 1) / 2 - 1]`</span>
</span><span id="BiCM.triumat2flat_idx-798"><a href="#BiCM.triumat2flat_idx-798"><span class="linenos">798</span></a>
</span><span id="BiCM.triumat2flat_idx-799"><a href="#BiCM.triumat2flat_idx-799"><span class="linenos">799</span></a><span class="sd">        :param i: row index</span>
</span><span id="BiCM.triumat2flat_idx-800"><a href="#BiCM.triumat2flat_idx-800"><span class="linenos">800</span></a><span class="sd">        :type i: int</span>
</span><span id="BiCM.triumat2flat_idx-801"><a href="#BiCM.triumat2flat_idx-801"><span class="linenos">801</span></a><span class="sd">        :param j: column index</span>
</span><span id="BiCM.triumat2flat_idx-802"><a href="#BiCM.triumat2flat_idx-802"><span class="linenos">802</span></a><span class="sd">        :type j: int</span>
</span><span id="BiCM.triumat2flat_idx-803"><a href="#BiCM.triumat2flat_idx-803"><span class="linenos">803</span></a><span class="sd">        :param n: dimension of the square matrix</span>
</span><span id="BiCM.triumat2flat_idx-804"><a href="#BiCM.triumat2flat_idx-804"><span class="linenos">804</span></a><span class="sd">        :type n: int</span>
</span><span id="BiCM.triumat2flat_idx-805"><a href="#BiCM.triumat2flat_idx-805"><span class="linenos">805</span></a><span class="sd">        :returns: flattened array index</span>
</span><span id="BiCM.triumat2flat_idx-806"><a href="#BiCM.triumat2flat_idx-806"><span class="linenos">806</span></a><span class="sd">        :rtype: int</span>
</span><span id="BiCM.triumat2flat_idx-807"><a href="#BiCM.triumat2flat_idx-807"><span class="linenos">807</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="BiCM.triumat2flat_idx-808"><a href="#BiCM.triumat2flat_idx-808"><span class="linenos">808</span></a>        <span class="k">return</span> <span class="nb">int</span><span class="p">((</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">n</span> <span class="o">-</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="mf">2.</span> <span class="o">-</span> <span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="p">(</span><span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Convert an matrix index couple to a flattened array index.</p>

<p>Given a square matrix of dimension <code>n</code> and the index couple
<code>(i, j)</code> <em>of the upper triangular part</em> of the matrix, return the
index which the matrix element would have in a flattened array.</p>

<div class="pdoc-alert pdoc-alert-note">

<ul>
<li>\( i \in [0, ..., n - 1] \)</li>
<li>\( j \in [i + 1, ..., n - 1] \)</li>
<li>returned index \( \in [0,\, n (n - 1) / 2 - 1] \)</li>
</ul>

</div>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>i</strong>:  row index</li>
<li><strong>j</strong>:  column index</li>
<li><strong>n</strong>:  dimension of the square matrix
:returns: flattened array index</li>
</ul>
</div>


                            </div>
                            <div id="BiCM.triumat2flat_dim" class="classattr">
                                        <input id="BiCM.triumat2flat_dim-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@staticmethod</div>

        <span class="def">def</span>
        <span class="name">triumat2flat_dim</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">n</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="BiCM.triumat2flat_dim-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#BiCM.triumat2flat_dim"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="BiCM.triumat2flat_dim-810"><a href="#BiCM.triumat2flat_dim-810"><span class="linenos">810</span></a>    <span class="nd">@staticmethod</span>
</span><span id="BiCM.triumat2flat_dim-811"><a href="#BiCM.triumat2flat_dim-811"><span class="linenos">811</span></a>    <span class="k">def</span> <span class="nf">triumat2flat_dim</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
</span><span id="BiCM.triumat2flat_dim-812"><a href="#BiCM.triumat2flat_dim-812"><span class="linenos">812</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the size of the triangular part of a ``n x n`` matrix.</span>
</span><span id="BiCM.triumat2flat_dim-813"><a href="#BiCM.triumat2flat_dim-813"><span class="linenos">813</span></a>
</span><span id="BiCM.triumat2flat_dim-814"><a href="#BiCM.triumat2flat_dim-814"><span class="linenos">814</span></a><span class="sd">        :param n: the dimension of the square matrix</span>
</span><span id="BiCM.triumat2flat_dim-815"><a href="#BiCM.triumat2flat_dim-815"><span class="linenos">815</span></a><span class="sd">        :type n: int</span>
</span><span id="BiCM.triumat2flat_dim-816"><a href="#BiCM.triumat2flat_dim-816"><span class="linenos">816</span></a><span class="sd">        :returns: number of elements in the upper triangular part of the matrix</span>
</span><span id="BiCM.triumat2flat_dim-817"><a href="#BiCM.triumat2flat_dim-817"><span class="linenos">817</span></a><span class="sd">            (excluding the diagonal)</span>
</span><span id="BiCM.triumat2flat_dim-818"><a href="#BiCM.triumat2flat_dim-818"><span class="linenos">818</span></a><span class="sd">        :rtype: int</span>
</span><span id="BiCM.triumat2flat_dim-819"><a href="#BiCM.triumat2flat_dim-819"><span class="linenos">819</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="BiCM.triumat2flat_dim-820"><a href="#BiCM.triumat2flat_dim-820"><span class="linenos">820</span></a>        <span class="k">return</span> <span class="n">n</span> <span class="o">*</span> <span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
</span></pre></div>


            <div class="docstring"><p>Return the size of the triangular part of a <code>n x n</code> matrix.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>n</strong>:  the dimension of the square matrix
:returns: number of elements in the upper triangular part of the matrix
(excluding the diagonal)</li>
</ul>
</div>


                            </div>
                            <div id="BiCM.flat2triumat_dim" class="classattr">
                                        <input id="BiCM.flat2triumat_dim-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@staticmethod</div>

        <span class="def">def</span>
        <span class="name">flat2triumat_dim</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">k</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="BiCM.flat2triumat_dim-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#BiCM.flat2triumat_dim"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="BiCM.flat2triumat_dim-822"><a href="#BiCM.flat2triumat_dim-822"><span class="linenos">822</span></a>    <span class="nd">@staticmethod</span>
</span><span id="BiCM.flat2triumat_dim-823"><a href="#BiCM.flat2triumat_dim-823"><span class="linenos">823</span></a>    <span class="k">def</span> <span class="nf">flat2triumat_dim</span><span class="p">(</span><span class="n">k</span><span class="p">):</span>
</span><span id="BiCM.flat2triumat_dim-824"><a href="#BiCM.flat2triumat_dim-824"><span class="linenos">824</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the dimension of the matrix hosting ``k`` triangular elements.</span>
</span><span id="BiCM.flat2triumat_dim-825"><a href="#BiCM.flat2triumat_dim-825"><span class="linenos">825</span></a>
</span><span id="BiCM.flat2triumat_dim-826"><a href="#BiCM.flat2triumat_dim-826"><span class="linenos">826</span></a><span class="sd">        :param k: the number of elements in the upper triangular</span>
</span><span id="BiCM.flat2triumat_dim-827"><a href="#BiCM.flat2triumat_dim-827"><span class="linenos">827</span></a><span class="sd">            part of the corresponding square matrix, excluding the diagonal</span>
</span><span id="BiCM.flat2triumat_dim-828"><a href="#BiCM.flat2triumat_dim-828"><span class="linenos">828</span></a><span class="sd">        :type k: int</span>
</span><span id="BiCM.flat2triumat_dim-829"><a href="#BiCM.flat2triumat_dim-829"><span class="linenos">829</span></a><span class="sd">        :returns: dimension of the corresponding square matrix</span>
</span><span id="BiCM.flat2triumat_dim-830"><a href="#BiCM.flat2triumat_dim-830"><span class="linenos">830</span></a><span class="sd">        :rtype: int</span>
</span><span id="BiCM.flat2triumat_dim-831"><a href="#BiCM.flat2triumat_dim-831"><span class="linenos">831</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="BiCM.flat2triumat_dim-832"><a href="#BiCM.flat2triumat_dim-832"><span class="linenos">832</span></a>        <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="mf">0.5</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">0.25</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">k</span><span class="p">))</span>
</span></pre></div>


            <div class="docstring"><p>Return the dimension of the matrix hosting <code>k</code> triangular elements.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>k</strong>:  the number of elements in the upper triangular
part of the corresponding square matrix, excluding the diagonal
:returns: dimension of the corresponding square matrix</li>
</ul>
</div>


                            </div>
                            <div id="BiCM.flat2triumat_idx" class="classattr">
                                        <input id="BiCM.flat2triumat_idx-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@staticmethod</div>

        <span class="def">def</span>
        <span class="name">flat2triumat_idx</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">k</span>, </span><span class="param"><span class="n">n</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="BiCM.flat2triumat_idx-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#BiCM.flat2triumat_idx"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="BiCM.flat2triumat_idx-834"><a href="#BiCM.flat2triumat_idx-834"><span class="linenos">834</span></a>    <span class="nd">@staticmethod</span>
</span><span id="BiCM.flat2triumat_idx-835"><a href="#BiCM.flat2triumat_idx-835"><span class="linenos">835</span></a>    <span class="k">def</span> <span class="nf">flat2triumat_idx</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
</span><span id="BiCM.flat2triumat_idx-836"><a href="#BiCM.flat2triumat_idx-836"><span class="linenos">836</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Convert an array index into the index couple of a triangular matrix.</span>
</span><span id="BiCM.flat2triumat_idx-837"><a href="#BiCM.flat2triumat_idx-837"><span class="linenos">837</span></a>
</span><span id="BiCM.flat2triumat_idx-838"><a href="#BiCM.flat2triumat_idx-838"><span class="linenos">838</span></a><span class="sd">        ``k`` is the index of an array of length :math:`\\binom{n}{2}{2}`,</span>
</span><span id="BiCM.flat2triumat_idx-839"><a href="#BiCM.flat2triumat_idx-839"><span class="linenos">839</span></a><span class="sd">        which contains the elements of an upper triangular matrix of dimension</span>
</span><span id="BiCM.flat2triumat_idx-840"><a href="#BiCM.flat2triumat_idx-840"><span class="linenos">840</span></a><span class="sd">        ``n`` excluding the diagonal. The function returns the index couple</span>
</span><span id="BiCM.flat2triumat_idx-841"><a href="#BiCM.flat2triumat_idx-841"><span class="linenos">841</span></a><span class="sd">        :math:`(i, j)` that corresponds to the entry ``k`` of the flat array.</span>
</span><span id="BiCM.flat2triumat_idx-842"><a href="#BiCM.flat2triumat_idx-842"><span class="linenos">842</span></a>
</span><span id="BiCM.flat2triumat_idx-843"><a href="#BiCM.flat2triumat_idx-843"><span class="linenos">843</span></a><span class="sd">        .. note::</span>
</span><span id="BiCM.flat2triumat_idx-844"><a href="#BiCM.flat2triumat_idx-844"><span class="linenos">844</span></a><span class="sd">            * :math:`k \\in \left[0,\\ldots, \\binom{n}{2} - 1\\right]`</span>
</span><span id="BiCM.flat2triumat_idx-845"><a href="#BiCM.flat2triumat_idx-845"><span class="linenos">845</span></a><span class="sd">            * returned indices:</span>
</span><span id="BiCM.flat2triumat_idx-846"><a href="#BiCM.flat2triumat_idx-846"><span class="linenos">846</span></a><span class="sd">                * :math:`i \\in [0,\\ldots, n - 1]`</span>
</span><span id="BiCM.flat2triumat_idx-847"><a href="#BiCM.flat2triumat_idx-847"><span class="linenos">847</span></a><span class="sd">                * :math:`j \\in [i + 1,\\ldots, n - 1]`</span>
</span><span id="BiCM.flat2triumat_idx-848"><a href="#BiCM.flat2triumat_idx-848"><span class="linenos">848</span></a>
</span><span id="BiCM.flat2triumat_idx-849"><a href="#BiCM.flat2triumat_idx-849"><span class="linenos">849</span></a><span class="sd">        :param k: flattened array index</span>
</span><span id="BiCM.flat2triumat_idx-850"><a href="#BiCM.flat2triumat_idx-850"><span class="linenos">850</span></a><span class="sd">        :type k: int</span>
</span><span id="BiCM.flat2triumat_idx-851"><a href="#BiCM.flat2triumat_idx-851"><span class="linenos">851</span></a><span class="sd">        :param n: dimension of the square matrix</span>
</span><span id="BiCM.flat2triumat_idx-852"><a href="#BiCM.flat2triumat_idx-852"><span class="linenos">852</span></a><span class="sd">        :type n: int</span>
</span><span id="BiCM.flat2triumat_idx-853"><a href="#BiCM.flat2triumat_idx-853"><span class="linenos">853</span></a><span class="sd">        :returns: matrix index tuple (row, column)</span>
</span><span id="BiCM.flat2triumat_idx-854"><a href="#BiCM.flat2triumat_idx-854"><span class="linenos">854</span></a><span class="sd">        :rtype: tuple</span>
</span><span id="BiCM.flat2triumat_idx-855"><a href="#BiCM.flat2triumat_idx-855"><span class="linenos">855</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="BiCM.flat2triumat_idx-856"><a href="#BiCM.flat2triumat_idx-856"><span class="linenos">856</span></a>        <span class="c1"># row index of array index k in the the upper triangular part of the</span>
</span><span id="BiCM.flat2triumat_idx-857"><a href="#BiCM.flat2triumat_idx-857"><span class="linenos">857</span></a>        <span class="c1"># square matrix</span>
</span><span id="BiCM.flat2triumat_idx-858"><a href="#BiCM.flat2triumat_idx-858"><span class="linenos">858</span></a>        <span class="n">r</span> <span class="o">=</span> <span class="n">n</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">-</span> <span class="nb">int</span><span class="p">(</span><span class="mf">0.5</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="o">-</span><span class="mi">8</span> <span class="o">*</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">n</span> <span class="o">*</span> <span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="mi">7</span><span class="p">)</span> <span class="o">-</span> <span class="mf">0.5</span><span class="p">)</span>
</span><span id="BiCM.flat2triumat_idx-859"><a href="#BiCM.flat2triumat_idx-859"><span class="linenos">859</span></a>        <span class="c1"># column index of array index k in the the upper triangular part of the</span>
</span><span id="BiCM.flat2triumat_idx-860"><a href="#BiCM.flat2triumat_idx-860"><span class="linenos">860</span></a>        <span class="c1"># square matrix</span>
</span><span id="BiCM.flat2triumat_idx-861"><a href="#BiCM.flat2triumat_idx-861"><span class="linenos">861</span></a>        <span class="n">c</span> <span class="o">=</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">r</span> <span class="o">*</span> <span class="p">(</span><span class="mi">3</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">n</span> <span class="o">+</span> <span class="n">r</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
</span><span id="BiCM.flat2triumat_idx-862"><a href="#BiCM.flat2triumat_idx-862"><span class="linenos">862</span></a>        <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">r</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Convert an array index into the index couple of a triangular matrix.</p>

<p><code>k</code> is the index of an array of length \( \binom{n}{2}{2} \),
which contains the elements of an upper triangular matrix of dimension
<code>n</code> excluding the diagonal. The function returns the index couple
\( (i, j) \) that corresponds to the entry <code>k</code> of the flat array.</p>

<div class="pdoc-alert pdoc-alert-note">

<ul>
<li>\( k \in \left[0,\ldots, \binom{n}{2} - 1\right] \)</li>
<li>returned indices:
<ul>
<li>\( i \in [0,\ldots, n - 1] \)</li>
<li>\( j \in [i + 1,\ldots, n - 1] \)</li>
</ul></li>
</ul>

</div>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>k</strong>:  flattened array index</li>
<li><strong>n</strong>:  dimension of the square matrix
:returns: matrix index tuple (row, column)</li>
</ul>
</div>


                            </div>
                            <div id="BiCM.save_biadjacency" class="classattr">
                                        <input id="BiCM.save_biadjacency-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">save_biadjacency</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">filename</span>, </span><span class="param"><span class="n">delim</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span>, </span><span class="param"><span class="n">binary</span><span class="o">=</span><span class="kc">False</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="BiCM.save_biadjacency-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#BiCM.save_biadjacency"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="BiCM.save_biadjacency-864"><a href="#BiCM.save_biadjacency-864"><span class="linenos">864</span></a>    <span class="k">def</span> <span class="nf">save_biadjacency</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">delim</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">binary</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="BiCM.save_biadjacency-865"><a href="#BiCM.save_biadjacency-865"><span class="linenos">865</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Save the biadjacendy matrix of the BiCM null model.</span>
</span><span id="BiCM.save_biadjacency-866"><a href="#BiCM.save_biadjacency-866"><span class="linenos">866</span></a>
</span><span id="BiCM.save_biadjacency-867"><a href="#BiCM.save_biadjacency-867"><span class="linenos">867</span></a><span class="sd">        The matrix can either be saved as a binary NumPy ``.npy`` file or as a</span>
</span><span id="BiCM.save_biadjacency-868"><a href="#BiCM.save_biadjacency-868"><span class="linenos">868</span></a><span class="sd">        human-readable ``.csv`` file.</span>
</span><span id="BiCM.save_biadjacency-869"><a href="#BiCM.save_biadjacency-869"><span class="linenos">869</span></a>
</span><span id="BiCM.save_biadjacency-870"><a href="#BiCM.save_biadjacency-870"><span class="linenos">870</span></a><span class="sd">        .. note::</span>
</span><span id="BiCM.save_biadjacency-871"><a href="#BiCM.save_biadjacency-871"><span class="linenos">871</span></a>
</span><span id="BiCM.save_biadjacency-872"><a href="#BiCM.save_biadjacency-872"><span class="linenos">872</span></a><span class="sd">            * The relative path has to be provided in the filename, e.g.</span>
</span><span id="BiCM.save_biadjacency-873"><a href="#BiCM.save_biadjacency-873"><span class="linenos">873</span></a><span class="sd">              *../data/pvalue_matrix.csv*.</span>
</span><span id="BiCM.save_biadjacency-874"><a href="#BiCM.save_biadjacency-874"><span class="linenos">874</span></a>
</span><span id="BiCM.save_biadjacency-875"><a href="#BiCM.save_biadjacency-875"><span class="linenos">875</span></a><span class="sd">            * If ``binary==True``, NumPy</span>
</span><span id="BiCM.save_biadjacency-876"><a href="#BiCM.save_biadjacency-876"><span class="linenos">876</span></a><span class="sd">              automatically appends the format ending ``.npy`` to the file.</span>
</span><span id="BiCM.save_biadjacency-877"><a href="#BiCM.save_biadjacency-877"><span class="linenos">877</span></a>
</span><span id="BiCM.save_biadjacency-878"><a href="#BiCM.save_biadjacency-878"><span class="linenos">878</span></a><span class="sd">        :param filename: name of the output file</span>
</span><span id="BiCM.save_biadjacency-879"><a href="#BiCM.save_biadjacency-879"><span class="linenos">879</span></a><span class="sd">        :type filename: str</span>
</span><span id="BiCM.save_biadjacency-880"><a href="#BiCM.save_biadjacency-880"><span class="linenos">880</span></a><span class="sd">        :param delim: delimiter between values in file</span>
</span><span id="BiCM.save_biadjacency-881"><a href="#BiCM.save_biadjacency-881"><span class="linenos">881</span></a><span class="sd">        :type delim: str</span>
</span><span id="BiCM.save_biadjacency-882"><a href="#BiCM.save_biadjacency-882"><span class="linenos">882</span></a><span class="sd">        :param binary: if ``True``, save as binary ``.npy``, otherwise as a</span>
</span><span id="BiCM.save_biadjacency-883"><a href="#BiCM.save_biadjacency-883"><span class="linenos">883</span></a><span class="sd">            ``.csv`` file</span>
</span><span id="BiCM.save_biadjacency-884"><a href="#BiCM.save_biadjacency-884"><span class="linenos">884</span></a><span class="sd">        :type binary: bool</span>
</span><span id="BiCM.save_biadjacency-885"><a href="#BiCM.save_biadjacency-885"><span class="linenos">885</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="BiCM.save_biadjacency-886"><a href="#BiCM.save_biadjacency-886"><span class="linenos">886</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">save_array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">adj_matrix</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">delim</span><span class="p">,</span> <span class="n">binary</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Save the biadjacendy matrix of the BiCM null model.</p>

<p>The matrix can either be saved as a binary NumPy <code>.npy</code> file or as a
human-readable <code>.csv</code> file.</p>

<div class="pdoc-alert pdoc-alert-note">

<ul>
<li><p>The relative path has to be provided in the filename, e.g.
<em>../data/pvalue_matrix.csv</em>.</p></li>
<li><p>If <code>binary==True</code>, NumPy
automatically appends the format ending <code>.npy</code> to the file.</p></li>
</ul>

</div>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>filename</strong>:  name of the output file</li>
<li><strong>delim</strong>:  delimiter between values in file</li>
<li><strong>binary</strong>:  if <code>True</code>, save as binary <code>.npy</code>, otherwise as a
<code>.csv</code> file</li>
</ul>
</div>


                            </div>
                            <div id="BiCM.save_array" class="classattr">
                                        <input id="BiCM.save_array-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@staticmethod</div>

        <span class="def">def</span>
        <span class="name">save_array</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">mat</span>, </span><span class="param"><span class="n">filename</span>, </span><span class="param"><span class="n">delim</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span>, </span><span class="param"><span class="n">binary</span><span class="o">=</span><span class="kc">False</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="BiCM.save_array-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#BiCM.save_array"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="BiCM.save_array-888"><a href="#BiCM.save_array-888"><span class="linenos">888</span></a>    <span class="nd">@staticmethod</span>
</span><span id="BiCM.save_array-889"><a href="#BiCM.save_array-889"><span class="linenos">889</span></a>    <span class="k">def</span> <span class="nf">save_array</span><span class="p">(</span><span class="n">mat</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">delim</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">binary</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="BiCM.save_array-890"><a href="#BiCM.save_array-890"><span class="linenos">890</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Save the array ``mat`` in the file ``filename``.</span>
</span><span id="BiCM.save_array-891"><a href="#BiCM.save_array-891"><span class="linenos">891</span></a>
</span><span id="BiCM.save_array-892"><a href="#BiCM.save_array-892"><span class="linenos">892</span></a><span class="sd">        The array can either be saved as a binary NumPy ``.npy`` file or as a</span>
</span><span id="BiCM.save_array-893"><a href="#BiCM.save_array-893"><span class="linenos">893</span></a><span class="sd">        human-readable ``.npy`` file.</span>
</span><span id="BiCM.save_array-894"><a href="#BiCM.save_array-894"><span class="linenos">894</span></a>
</span><span id="BiCM.save_array-895"><a href="#BiCM.save_array-895"><span class="linenos">895</span></a><span class="sd">        .. note::</span>
</span><span id="BiCM.save_array-896"><a href="#BiCM.save_array-896"><span class="linenos">896</span></a>
</span><span id="BiCM.save_array-897"><a href="#BiCM.save_array-897"><span class="linenos">897</span></a><span class="sd">            * The relative path has to be provided in the filename, e.g.</span>
</span><span id="BiCM.save_array-898"><a href="#BiCM.save_array-898"><span class="linenos">898</span></a><span class="sd">              *../data/pvalue_matrix.csv*.</span>
</span><span id="BiCM.save_array-899"><a href="#BiCM.save_array-899"><span class="linenos">899</span></a>
</span><span id="BiCM.save_array-900"><a href="#BiCM.save_array-900"><span class="linenos">900</span></a><span class="sd">            * If ``binary==True``, NumPy</span>
</span><span id="BiCM.save_array-901"><a href="#BiCM.save_array-901"><span class="linenos">901</span></a><span class="sd">              automatically appends the format ending ``.npy`` to the file.</span>
</span><span id="BiCM.save_array-902"><a href="#BiCM.save_array-902"><span class="linenos">902</span></a>
</span><span id="BiCM.save_array-903"><a href="#BiCM.save_array-903"><span class="linenos">903</span></a><span class="sd">        :param mat: array</span>
</span><span id="BiCM.save_array-904"><a href="#BiCM.save_array-904"><span class="linenos">904</span></a><span class="sd">        :type mat: numpy.array</span>
</span><span id="BiCM.save_array-905"><a href="#BiCM.save_array-905"><span class="linenos">905</span></a><span class="sd">        :param filename: name of the output file</span>
</span><span id="BiCM.save_array-906"><a href="#BiCM.save_array-906"><span class="linenos">906</span></a><span class="sd">        :type filename: str</span>
</span><span id="BiCM.save_array-907"><a href="#BiCM.save_array-907"><span class="linenos">907</span></a><span class="sd">        :param delim: delimiter between values in file</span>
</span><span id="BiCM.save_array-908"><a href="#BiCM.save_array-908"><span class="linenos">908</span></a><span class="sd">        :type delim: str</span>
</span><span id="BiCM.save_array-909"><a href="#BiCM.save_array-909"><span class="linenos">909</span></a><span class="sd">        :param binary: if ``True``, save as binary ``.npy``, otherwise as a</span>
</span><span id="BiCM.save_array-910"><a href="#BiCM.save_array-910"><span class="linenos">910</span></a><span class="sd">            ``.csv`` file</span>
</span><span id="BiCM.save_array-911"><a href="#BiCM.save_array-911"><span class="linenos">911</span></a><span class="sd">        :type binary: bool</span>
</span><span id="BiCM.save_array-912"><a href="#BiCM.save_array-912"><span class="linenos">912</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="BiCM.save_array-913"><a href="#BiCM.save_array-913"><span class="linenos">913</span></a>        <span class="k">if</span> <span class="n">binary</span><span class="p">:</span>
</span><span id="BiCM.save_array-914"><a href="#BiCM.save_array-914"><span class="linenos">914</span></a>            <span class="n">np</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">mat</span><span class="p">)</span>
</span><span id="BiCM.save_array-915"><a href="#BiCM.save_array-915"><span class="linenos">915</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="BiCM.save_array-916"><a href="#BiCM.save_array-916"><span class="linenos">916</span></a>            <span class="n">np</span><span class="o">.</span><span class="n">savetxt</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">mat</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="n">delim</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Save the array <code>mat</code> in the file <code>filename</code>.</p>

<p>The array can either be saved as a binary NumPy <code>.npy</code> file or as a
human-readable <code>.npy</code> file.</p>

<div class="pdoc-alert pdoc-alert-note">

<ul>
<li><p>The relative path has to be provided in the filename, e.g.
<em>../data/pvalue_matrix.csv</em>.</p></li>
<li><p>If <code>binary==True</code>, NumPy
automatically appends the format ending <code>.npy</code> to the file.</p></li>
</ul>

</div>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>mat</strong>:  array</li>
<li><strong>filename</strong>:  name of the output file</li>
<li><strong>delim</strong>:  delimiter between values in file</li>
<li><strong>binary</strong>:  if <code>True</code>, save as binary <code>.npy</code>, otherwise as a
<code>.csv</code> file</li>
</ul>
</div>


                            </div>
                </section>
    </main>
<script>
    function escapeHTML(html) {
        return document.createElement('div').appendChild(document.createTextNode(html)).parentNode.innerHTML;
    }

    const originalContent = document.querySelector("main.pdoc");
    let currentContent = originalContent;

    function setContent(innerHTML) {
        let elem;
        if (innerHTML) {
            elem = document.createElement("main");
            elem.classList.add("pdoc");
            elem.innerHTML = innerHTML;
        } else {
            elem = originalContent;
        }
        if (currentContent !== elem) {
            currentContent.replaceWith(elem);
            currentContent = elem;
        }
    }

    function getSearchTerm() {
        return (new URL(window.location)).searchParams.get("search");
    }

    const searchBox = document.querySelector(".pdoc input[type=search]");
    searchBox.addEventListener("input", function () {
        let url = new URL(window.location);
        if (searchBox.value.trim()) {
            url.hash = "";
            url.searchParams.set("search", searchBox.value);
        } else {
            url.searchParams.delete("search");
        }
        history.replaceState("", "", url.toString());
        onInput();
    });
    window.addEventListener("popstate", onInput);


    let search, searchErr;

    async function initialize() {
        try {
            search = await new Promise((resolve, reject) => {
                const script = document.createElement("script");
                script.type = "text/javascript";
                script.async = true;
                script.onload = () => resolve(window.pdocSearch);
                script.onerror = (e) => reject(e);
                script.src = "../../../../search.js";
                document.getElementsByTagName("head")[0].appendChild(script);
            });
        } catch (e) {
            console.error("Cannot fetch pdoc search index");
            searchErr = "Cannot fetch search index.";
        }
        onInput();

        document.querySelector("nav.pdoc").addEventListener("click", e => {
            if (e.target.hash) {
                searchBox.value = "";
                searchBox.dispatchEvent(new Event("input"));
            }
        });
    }

    function onInput() {
        setContent((() => {
            const term = getSearchTerm();
            if (!term) {
                return null
            }
            if (searchErr) {
                return `<h3>Error: ${searchErr}</h3>`
            }
            if (!search) {
                return "<h3>Searching...</h3>"
            }

            window.scrollTo({top: 0, left: 0, behavior: 'auto'});

            const results = search(term);

            let html;
            if (results.length === 0) {
                html = `No search results for '${escapeHTML(term)}'.`
            } else {
                html = `<h4>${results.length} search result${results.length > 1 ? "s" : ""} for '${escapeHTML(term)}'.</h4>`;
            }
            for (let result of results.slice(0, 10)) {
                let doc = result.doc;
                let url = `../../../../${doc.modulename.replaceAll(".", "/")}.html`;
                if (doc.qualname) {
                    url += `#${doc.qualname}`;
                }

                let heading;
                switch (result.doc.kind) {
                    case "function":
                        if (doc.fullname.endsWith(".__init__")) {
                            heading = `<span class="name">${doc.fullname.replace(/\.__init__$/, "")}</span>${doc.signature}`;
                        } else {
                            heading = `<span class="def">${doc.funcdef}</span> <span class="name">${doc.fullname}</span>${doc.signature}`;
                        }
                        break;
                    case "class":
                        heading = `<span class="def">class</span> <span class="name">${doc.fullname}</span>`;
                        if (doc.bases)
                            heading += `<wbr>(<span class="base">${doc.bases}</span>)`;
                        heading += `:`;
                        break;
                    case "variable":
                        heading = `<span class="name">${doc.fullname}</span>`;
                        if (doc.annotation)
                            heading += `<span class="annotation">${doc.annotation}</span>`;
                        if (doc.default_value)
                            heading += `<span class="default_value"> = ${doc.default_value}</span>`;
                        break;
                    default:
                        heading = `<span class="name">${doc.fullname}</span>`;
                        break;
                }
                html += `
                        <section class="search-result">
                        <a href="${url}" class="attr ${doc.kind}">${heading}</a>
                        <div class="docstring">${doc.doc}</div>
                        </section>
                    `;

            }
            return html;
        })());
    }

    if (getSearchTerm()) {
        initialize();
        searchBox.value = getSearchTerm();
        onInput();
    } else {
        searchBox.addEventListener("focus", initialize, {once: true});
    }

    searchBox.addEventListener("keydown", e => {
        if (["ArrowDown", "ArrowUp", "Enter"].includes(e.key)) {
            let focused = currentContent.querySelector(".search-result.focused");
            if (!focused) {
                currentContent.querySelector(".search-result").classList.add("focused");
            } else if (
                e.key === "ArrowDown"
                && focused.nextElementSibling
                && focused.nextElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.nextElementSibling.classList.add("focused");
                focused.nextElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "ArrowUp"
                && focused.previousElementSibling
                && focused.previousElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.previousElementSibling.classList.add("focused");
                focused.previousElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "Enter"
            ) {
                focused.querySelector("a").click();
            }
        }
    });
</script></body>
</html>